import{r as b,j as e}from"./index-CY24ibap.js";import{K as D}from"./Kriskogram-BJlN50nd.js";function q(t){const n=new DOMParser().parseFromString(t,"text/xml"),i=n.querySelector("parsererror");if(i)throw new Error(`GEXF parsing error: ${i.textContent}`);const a=n.querySelector("graph");if(!a)throw new Error("No graph element found in GEXF file");const o=A(a,"node"),l=A(a,"edge"),u=T(a,o),h=Y(a,l),d=L(u,h);return{nodes:u,edges:h,attributes:{node:o,edge:l},timeRange:d}}function F(t){const{timeRange:r}=t,n=[];for(let i=r.start;i<=r.end;i++){const a={nodes:[],edges:[],timestamp:i};t.nodes.forEach(o=>{N(o.spells,i)&&a.nodes.push(K(o))}),t.edges.forEach(o=>{N(o.spells,i)&&a.edges.push(M(o))}),n.push(a)}return n}async function R(t){try{const r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch GEXF file: ${r.statusText}`);const n=await r.text();return q(n)}catch(r){throw new Error(`Error loading GEXF file: ${r instanceof Error?r.message:"Unknown error"}`)}}function A(t,r){const n={},i=t.querySelector(`attributes[class="${r}"]`);return i&&i.querySelectorAll("attribute").forEach(o=>{const l=o.getAttribute("id"),u=o.getAttribute("title"),h=o.getAttribute("type");l&&u&&h&&(n[l]={id:l,title:u,type:h})}),n}function T(t,r){const n=[];return t.querySelectorAll("node").forEach(a=>{const o=a.getAttribute("id"),l=a.getAttribute("label")||o||"";if(!o)return;const u={};a.querySelectorAll("attvalue").forEach(m=>{const x=m.getAttribute("for"),c=m.getAttribute("value");if(x&&c!==null){const p=r[x];p&&(u[p.title]=E(c,p.type))}});const d=[];a.querySelectorAll("spell").forEach(m=>{const x=parseInt(m.getAttribute("start")||"0"),c=parseInt(m.getAttribute("end")||"0");d.push({start:x,end:c})}),n.push({id:o,label:l,attributes:u,spells:d})}),n}function Y(t,r){const n=[];return t.querySelectorAll("edge").forEach(a=>{const o=a.getAttribute("id"),l=a.getAttribute("source"),u=a.getAttribute("target"),h=parseFloat(a.getAttribute("weight")||"1");if(!o||!l||!u)return;const d={};a.querySelectorAll("attvalue").forEach(c=>{const p=c.getAttribute("for"),y=c.getAttribute("value");if(p&&y!==null){const s=r[p];s&&(d[s.title]=E(y,s.type))}});const m=[];a.querySelectorAll("spell").forEach(c=>{const p=parseInt(c.getAttribute("start")||"0"),y=parseInt(c.getAttribute("end")||"0");m.push({start:p,end:y})}),n.push({id:o,source:l,target:u,weight:h,attributes:d,spells:m})}),n}function E(t,r){switch(r){case"integer":return parseInt(t,10);case"double":case"float":return parseFloat(t);case"boolean":return t.toLowerCase()==="true";default:return t}}function L(t,r){let n=1/0,i=-1/0;return[...t,...r].forEach(a=>{a.spells.forEach(o=>{n=Math.min(n,o.start),i=Math.max(i,o.end)})}),{start:n===1/0?0:n,end:i===-1/0?0:i}}function N(t,r){return t.some(n=>r>=n.start&&r<=n.end)}function K(t){return{id:t.id,label:t.label,...t.attributes}}function M(t){return{source:t.source,target:t.target,value:t.weight,...t.attributes}}function $(){return{nodes:[{id:"NYC",label:"New York City",region:"Northeast",population:8336817,latitude:40.7128,longitude:-74.006,economic_index:.95},{id:"LA",label:"Los Angeles",region:"West Coast",population:3971883,latitude:34.0522,longitude:-118.2437,economic_index:.88},{id:"CHI",label:"Chicago",region:"Midwest",population:2746388,latitude:41.8781,longitude:-87.6298,economic_index:.82},{id:"HOU",label:"Houston",region:"South",population:2320268,latitude:29.7604,longitude:-95.3698,economic_index:.78},{id:"PHX",label:"Phoenix",region:"Southwest",population:1608139,latitude:33.4484,longitude:-112.074,economic_index:.75}],edges:[{source:"NYC",target:"LA",value:12500,migration_type:"economic",distance_km:3944,economic_factor:.15},{source:"LA",target:"NYC",value:8900,migration_type:"economic",distance_km:3944,economic_factor:.12},{source:"CHI",target:"NYC",value:15200,migration_type:"career",distance_km:1266,economic_factor:.18},{source:"HOU",target:"DAL",value:18700,migration_type:"economic",distance_km:239,economic_factor:.08},{source:"PHX",target:"LA",value:11200,migration_type:"lifestyle",distance_km:373,economic_factor:.1}]}}function H({gexfUrl:t}){const[r,n]=b.useState(2020),[i,a]=b.useState([]),[o,l]=b.useState(!1),[u,h]=b.useState(null),[d,v]=b.useState({start:2020,end:2024}),m=b.useRef(null);b.useEffect(()=>{x()},[t]);const x=async()=>{l(!0),h(null);try{let s;if(t){const g=await R(t);s=F(g),v(g.timeRange)}else{const g=$();s=[{nodes:g.nodes,edges:g.edges,timestamp:2020}],v({start:2020,end:2020})}a(s),n(d.start)}catch(s){h(s instanceof Error?s.message:"Failed to load data")}finally{l(!1)}},c=i.find(s=>s.timestamp===r),p=s=>{n(s);const g=i.find(f=>f.timestamp===s);g&&m.current&&m.current.updateData(g.nodes,g.edges)},y=()=>{let s=d.start;const g=setInterval(()=>{if(s<=d.end){n(s);const f=i.find(j=>j.timestamp===s);f&&m.current&&m.current.updateData(f.nodes,f.edges),s++}else clearInterval(g)},1e3)};return o?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-lg",children:"Loading GEXF data..."})}):u?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-red-600",children:["Error: ",u]})}):e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Kriskogram Demo"}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year:"}),e.jsx("input",{type:"range",min:d.start,max:d.end,value:r,onChange:s=>p(parseInt(s.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-lg font-mono w-16",children:r})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Play Animation"}),e.jsx("button",{onClick:()=>n(d.start),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Reset"})]})]}),c&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Current Snapshot (",r,")"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nodes:"})," ",c.nodes.length]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Edges:"})," ",c.edges.length]})]})]}),e.jsx("div",{className:"border-2 border-gray-200 rounded-lg p-4",children:c?e.jsxs("div",{children:[e.jsx(D,{ref:m,nodes:c.nodes,edges:c.edges,width:1e3,height:600,margin:{top:60,right:40,bottom:60,left:40},accessors:{nodeOrder:s=>s.id,nodeColor:s=>s.economic_index?`hsl(${s.economic_index*120}, 70%, 50%)`:"#555",nodeRadius:s=>s.population?Math.sqrt(s.population)/1e3:6,edgeWidth:s=>Math.sqrt(s.value)/10,edgeColor:(s,g)=>{const f=c.edges.map(I=>I.value),j=Math.min(...f),w=Math.max(...f),S=(s.value-j)/(w-j),_=200,k=70,C=75-S*50;return`hsl(${_}, ${k}%, ${C}%)`}}}),e.jsxs("details",{className:"mt-4 text-left",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium",children:"Debug Data"}),e.jsx("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-auto max-h-40",children:JSON.stringify(c,null,2)})]})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No data available for year ",r]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Usage Instructions"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Use the slider to navigate through different years"}),e.jsx("li",{children:'• Click "Play Animation" to see the temporal changes'}),e.jsx("li",{children:"• The data includes migration flows between major US cities"}),e.jsx("li",{children:"• Each edge represents migration volume and includes attributes like distance and economic factors"})]})]})]})})}const P=H;export{P as component};
