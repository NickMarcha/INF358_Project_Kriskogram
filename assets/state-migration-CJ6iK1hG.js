import{r as u,j as e,K as P}from"./main-C1uW_bER.js";import{l as q,p as Y,R as W,D as Z}from"./csv-parser-BH7H656y.js";function E(x){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(x);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function O(x,a,j){x/=255,a/=255,j/=255;const f=Math.max(x,a,j),N=Math.min(x,a,j);let b=0,C=0;const p=(f+N)/2;if(f!==N){const y=f-N;switch(C=p>.5?y/(2-f-N):y/(f+N),f){case x:b=((a-j)/y+(a<j?6:0))/6;break;case a:b=((j-x)/y+2)/6;break;case j:b=((x-a)/y+4)/6;break}}return{h:b*360,s:C*100,l:p*100}}function J({csvUrl:x="/INF358_Project_Kriskogram/data/State_to_State_Migrations_Table_2021.csv"}){const[a,j]=u.useState(null),[f,N]=u.useState(!0),[b,C]=u.useState(null),[p,y]=u.useState(5e3),[M,z]=u.useState(2e5),[$,B]=u.useState(200),[v,D]=u.useState("grayscale"),[S,T]=u.useState("alphabetical"),[V,G]=u.useState(.6),w=u.useRef(null);u.useEffect(()=>{U()},[x]);const U=async()=>{N(!0),C(null);try{const s=await q(x),o=Y(s);j(o)}catch(s){C(s instanceof Error?s.message:"Failed to load CSV data")}finally{N(!1)}},h=a?a.edges.filter(s=>s.value>=p&&s.value<=M).sort((s,o)=>o.value-s.value).slice(0,$):[],I=new Set;for(const s of h)I.add(s.source),I.add(s.target);const R=a?a.nodes.filter(s=>I.has(s.id)):[],F=s=>{const o=Math.min(s,M);if(y(o),w.current&&a){const l=a.edges.filter(n=>n.value>=o&&n.value<=M).sort((n,c)=>c.value-n.value).slice(0,$),r=new Set;for(const n of l)r.add(n.source),r.add(n.target);const t=a.nodes.filter(n=>r.has(n.id));w.current.updateData(t,l)}},_=s=>{const o=Math.max(s,p);if(z(o),w.current&&a){const l=a.edges.filter(n=>n.value>=p&&n.value<=o).sort((n,c)=>c.value-n.value).slice(0,$),r=new Set;for(const n of l)r.add(n.source),r.add(n.target);const t=a.nodes.filter(n=>r.has(n.id));w.current.updateData(t,l)}},K=s=>{if(B(s),w.current&&a){const o=a.edges.filter(t=>t.value>=p&&t.value<=M).sort((t,n)=>n.value-t.value).slice(0,s),l=new Set;for(const t of o)l.add(t.source),l.add(t.target);const r=a.nodes.filter(t=>l.has(t.id));w.current.updateData(r,o)}};if(f)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-lg",children:"Loading state migration data..."})});if(b)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-red-600",children:["Error: ",b]})});if(!a)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:"No data available"})});const H=a.edges.reduce((s,o)=>s+o.value,0)/a.edges.length,A=Math.max(...a.edges.map(s=>s.value));return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"State-to-State Migration Data (2021)"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Source: U.S. Census Bureau - American Community Survey 1-Year Estimates"}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total States"}),e.jsx("div",{className:"text-2xl font-bold",children:a.nodes.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Migration Flows"}),e.jsx("div",{className:"text-2xl font-bold",children:a.edges.length.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Visible Nodes"}),e.jsx("div",{className:"text-2xl font-bold",children:R.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Visible Edges"}),e.jsx("div",{className:"text-2xl font-bold",children:h.length})]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Arc Color Mode"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorMode",value:"grayscale",checked:v==="grayscale",onChange:s=>D(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Grayscale"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorMode",value:"region",checked:v==="region",onChange:s=>D(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Region (4 regions)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorMode",value:"division",checked:v==="division",onChange:s=>D(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Division (9 divisions)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Node Ordering (Horizontal Axis)"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"orderMode",value:"alphabetical",checked:S==="alphabetical",onChange:s=>T(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Alphabetical"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"orderMode",value:"region",checked:S==="region",onChange:s=>T(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"By Region"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"orderMode",value:"division",checked:S==="division",onChange:s=>T(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"By Division"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Minimum Migration Threshold: ",p.toLocaleString()," people"]}),e.jsx("button",{onClick:()=>{F(0),_(Math.round(A))},className:"text-xs text-blue-600 hover:text-blue-800",children:"Show All"})]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:0,max:2e5,step:1e3,value:p,onChange:s=>F(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"0"}),e.jsxs("span",{children:["Average: ",Math.round(H).toLocaleString()]}),e.jsx("span",{className:"font-semibold",children:"200,000"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Maximum Migration Threshold: ",M.toLocaleString()," people"]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:0,max:2e5,step:1e3,value:M,onChange:s=>_(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"0"}),e.jsxs("span",{children:["Max in data: ",Math.round(A).toLocaleString()]}),e.jsx("span",{className:"font-semibold",children:"200,000"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Max Edges to Display: ",$]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:10,max:500,step:10,value:$,onChange:s=>K(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"Min: 10"}),e.jsx("span",{children:"250"}),e.jsx("span",{className:"font-semibold",children:"Max: 500"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Arc Opacity: ",Math.round(V*100),"%"]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:0,max:1,step:.05,value:V,onChange:s=>G(parseFloat(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"0% (Transparent)"}),e.jsx("span",{children:"50%"}),e.jsx("span",{className:"font-semibold",children:"100% (Opaque)"})]})]})]})]}),e.jsx("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-white",children:R.length>0&&h.length>0?e.jsxs("div",{children:[e.jsx(P,{ref:w,nodes:R,edges:h,width:1200,height:700,margin:{top:80,right:40,bottom:120,left:40},arcOpacity:V,accessors:{nodeOrder:s=>S==="region"?`${s.region||"ZZZ"}_${s.label||s.id}`:S==="division"?`${s.division||"ZZZ"}_${s.label||s.id}`:s.label||s.id,nodeColor:()=>"#2563eb",nodeRadius:()=>5,edgeWidth:s=>.5+Math.log(s.value+1)/Math.log(A+1)*(15-.5),edgeColor:s=>{const o=s.value/A,l=v==="division"?[85,55,25]:[85,70,55,40,25],r=1/l.length,t=Math.min(Math.floor(o/r),l.length-1),n=l[t];if(v==="grayscale")return`hsl(0, 0%, ${n}%)`;if(v==="region"){const c=a==null?void 0:a.nodes.find(i=>i.id===s.source),d=a==null?void 0:a.nodes.find(i=>i.id===s.target);if(c!=null&&c.region&&(d!=null&&d.region)&&c.region===d.region){const i=W[c.region],m=E(i);if(m){const g=O(m.r,m.g,m.b);return`hsl(${g.h}, ${g.s}%, ${n}%)`}return i}else return`hsl(0, 0%, ${n}%)`}else{const c=a==null?void 0:a.nodes.find(i=>i.id===s.source),d=a==null?void 0:a.nodes.find(i=>i.id===s.target);if(c!=null&&c.division&&(d!=null&&d.division)&&c.division===d.division){const i=Z[c.division],m=E(i);if(m){const g=O(m.r,m.g,m.b);return`hsl(${g.h}, ${g.s}%, ${n}%)`}return i}else return`hsl(0, 0%, ${n}%)`}}}},`kriskogram-${v}-${S}-${V}`),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Legend"}),v==="grayscale"?e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx("div",{className:"text-gray-700 font-semibold mb-2",children:"All Flows (grayscale with weight-based luminosity):"}),e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const s=Math.min(...h.map(t=>t.value)),l=Math.max(...h.map(t=>t.value))-s,r=[85,70,55,40,25];return r.map((t,n)=>{const c=l/r.length,d=Math.round(s+n*c),i=Math.round(s+(n+1)*c);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-3 border border-gray-300",style:{backgroundColor:`hsl(0, 0%, ${t}%)`}}),e.jsxs("span",{className:"text-[10px] text-gray-600",children:[d.toLocaleString()," - ",i.toLocaleString()," people"]})]},n)})})()}),e.jsx("div",{className:"text-gray-600 mt-2",children:"Edge width = log-scaled volume"})]}):v==="region"?e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx("div",{className:"text-gray-700 font-semibold",children:"Same-Region Flows (colored by region):"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(W).map(([s,o])=>{const l=E(o),r=l?O(l.r,l.g,l.b):null,t=Math.min(...h.map(i=>i.value)),c=Math.max(...h.map(i=>i.value))-t,d=[85,70,55,40,25];return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex flex-col gap-0.5",children:r&&d.map((i,m)=>{const g=c/d.length,k=Math.round(t+m*g),L=Math.round(t+(m+1)*g);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-12 h-2",style:{backgroundColor:`hsl(${r.h}, ${r.s}%, ${i}%)`}}),e.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap",children:[k.toLocaleString(),"-",L.toLocaleString()]})]},m)})})})]},s)})}),e.jsxs("div",{className:"pt-2 border-t border-gray-300",children:[e.jsx("div",{className:"text-gray-700 font-semibold mb-1",children:"Cross-Region Flows (grayscale):"}),e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const s=Math.min(...h.map(t=>t.value)),l=Math.max(...h.map(t=>t.value))-s,r=[85,55,25];return r.map((t,n)=>{const c=l/r.length,d=Math.round(s+n*c),i=Math.round(s+(n+1)*c);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-12 h-2 border border-gray-300",style:{backgroundColor:`hsl(0, 0%, ${t}%)`}}),e.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap",children:[d.toLocaleString(),"-",i.toLocaleString()]})]},n)})})()})]})]}):e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx("div",{className:"text-gray-700 font-semibold",children:"Same-Division Flows (colored by division):"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(Z).map(([s,o])=>{const l=E(o),r=l?O(l.r,l.g,l.b):null,t=Math.min(...h.map(i=>i.value)),c=Math.max(...h.map(i=>i.value))-t,d=[85,55,25];return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-[10px]",children:s}),e.jsx("div",{className:"flex flex-col gap-0.5",children:r&&d.map((i,m)=>{const g=c/d.length,k=Math.round(t+m*g),L=Math.round(t+(m+1)*g);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-6 h-2",style:{backgroundColor:`hsl(${r.h}, ${r.s}%, ${i}%)`}}),e.jsxs("span",{className:"text-[8px] text-gray-600 whitespace-nowrap",children:[k>999?`${Math.round(k/1e3)}k`:k,"-",L>999?`${Math.round(L/1e3)}k`:L]})]},m)})})]},s)})}),e.jsxs("div",{className:"pt-2 border-t border-gray-300",children:[e.jsx("div",{className:"text-gray-700 font-semibold mb-1",children:"Cross-Division Flows (grayscale):"}),e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const s=Math.min(...h.map(t=>t.value)),l=Math.max(...h.map(t=>t.value))-s,r=[85,55,25];return r.map((t,n)=>{const c=l/r.length,d=Math.round(s+n*c),i=Math.round(s+(n+1)*c);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-12 h-2 border border-gray-300",style:{backgroundColor:`hsl(0, 0%, ${t}%)`}}),e.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap",children:[d>999?`${Math.round(d/1e3)}k`:d,"-",i>999?`${Math.round(i/1e3)}k`:i]})]},n)})})()})]})]})]})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No migration data meets the current threshold range (",p.toLocaleString()," - ",M.toLocaleString(),"). Try adjusting the thresholds."]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"About This Visualization"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Each state is represented as a node along the baseline"}),e.jsx("li",{children:"• Arcs represent migration flows between states in 2021"}),e.jsx("li",{children:"• Arc thickness indicates migration volume (log-scaled for visibility)"}),e.jsx("li",{children:"• Arc luminosity (darkness) shows migration volume - darker arcs = higher migration"}),e.jsx("li",{children:e.jsx("strong",{children:"Color Modes:"})}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Grayscale:"})," All arcs in grayscale with weight-based luminosity"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Region:"})," Same-region migrations colored by 4 U.S. regions (Northeast=Blue, Midwest=Amber, South=Red, West=Green)"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Division:"})," Same-division migrations colored by 9 U.S. Census divisions for finer granularity"]}),e.jsx("li",{children:e.jsx("strong",{children:"Node Ordering:"})}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Alphabetical:"})," States sorted A-Z"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"By Region:"})," States grouped by region (Northeast, Midwest, South, West)"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"By Division:"})," States grouped by census division (New England, Mid-Atlantic, etc.)"]}),e.jsx("li",{children:"• Use the min/max threshold sliders to focus on a specific range of migration volumes"}),e.jsx("li",{children:"• Adjust max edges to limit visual complexity"}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Arc Opacity slider:"})," Control transparency to see overlapping migration patterns (lower = more transparent)"]})]})]}),e.jsxs("details",{className:"mt-6",children:[e.jsx("summary",{className:"cursor-pointer font-semibold text-gray-900 p-2 bg-gray-100 rounded hover:bg-gray-200",children:"Top 20 Migration Flows"}),e.jsx("div",{className:"mt-2 overflow-auto max-h-96",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"From"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"To"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Migrants"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"MOE (±)"})]})}),e.jsx("tbody",{children:a.edges.sort((s,o)=>o.value-s.value).slice(0,20).map((s,o)=>{const l=a.nodes.find(t=>t.id===s.source),r=a.nodes.find(t=>t.id===s.target);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:(l==null?void 0:l.label)||s.source}),e.jsx("td",{className:"px-4 py-2",children:(r==null?void 0:r.label)||s.target}),e.jsx("td",{className:"px-4 py-2 text-right font-mono",children:s.value.toLocaleString()}),e.jsx("td",{className:"px-4 py-2 text-right font-mono text-gray-500",children:s.moe?s.moe.toLocaleString():"-"})]},o)})})]})})]})]})})}function se(){return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(J,{})})}export{se as component};
