import{c as cs,r as v,j as r,s as Pe,o as tr,a as Ot,z as Sr,i as wr,C as _r,G as Cr,u as Nr,b as jr,d as Mr,K as Rr,e as an,f as Fr,p as lt,g as Hn,n as ln,h as Er}from"./main-CgEF5joP.js";import{p as ns,l as vn}from"./csv-parser-BH7H656y.js";import{p as $r,g as nr,l as Ir}from"./gexf-parser-ChiJebeW.js";import{S as Ar,a as As}from"./stateMigrationFiles-CyfipyKt.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Vr=cs("ChevronDown",Pr);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Dr=cs("ChevronUp",kr);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ps=cs("Settings",Lr);function Tr(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}var Vs=Math.abs,Gn=Math.cos,Bn=Math.sin,sr=Math.PI,yn=sr/2,ks=sr*2,Ds=Math.max,Un=1e-12;function Ls(e,n){return Array.from({length:n-e},(t,s)=>e+s)}function Or(e){return function(n,t){return e(n.source.value+n.target.value,t.source.value+t.target.value)}}function zr(){return Hr(!1)}function Hr(e,n){var t=0,s=null,o=null,a=null;function l(i){var u=i.length,c=new Array(u),d=Ls(0,u),p=new Array(u*u),f=new Array(u),m=0,w;i=Float64Array.from({length:u*u},(_,S)=>i[S/u|0][S%u]);for(let _=0;_<u;++_){let S=0;for(let h=0;h<u;++h)S+=i[_*u+h]+e*i[h*u+_];m+=c[_]=S}m=Ds(0,ks-t*u)/m,w=m?t:ks/u;{let _=0;s&&d.sort((S,h)=>s(c[S],c[h]));for(const S of d){const h=_;{const y=Ls(0,u).filter(x=>i[S*u+x]||i[x*u+S]);o&&y.sort((x,C)=>o(i[S*u+x],i[S*u+C]));for(const x of y){let C;if(S<x?(C=p[S*u+x]||(p[S*u+x]={source:null,target:null}),C.source={index:S,startAngle:_,endAngle:_+=i[S*u+x]*m,value:i[S*u+x]}):(C=p[x*u+S]||(p[x*u+S]={source:null,target:null}),C.target={index:S,startAngle:_,endAngle:_+=i[S*u+x]*m,value:i[S*u+x]},S===x&&(C.source=C.target)),C.source&&C.target&&C.source.value<C.target.value){const E=C.source;C.source=C.target,C.target=E}}f[S]={index:S,startAngle:h,endAngle:_,value:c[S]}}_+=w}}return p=Object.values(p),p.groups=f,a?p.sort(a):p}return l.padAngle=function(i){return arguments.length?(t=Ds(0,i),l):t},l.sortGroups=function(i){return arguments.length?(s=i,l):s},l.sortSubgroups=function(i){return arguments.length?(o=i,l):o},l.sortChords=function(i){return arguments.length?(i==null?a=null:(a=Or(i))._=i,l):a&&a._},l}const ss=Math.PI,rs=2*ss,Lt=1e-6,Gr=rs-Lt;function rr(e){this._+=e[0];for(let n=1,t=e.length;n<t;++n)this._+=arguments[n]+e[n]}function Br(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return rr;const t=10**n;return function(s){this._+=s[0];for(let o=1,a=s.length;o<a;++o)this._+=Math.round(arguments[o]*t)/t+s[o]}}class gs{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?rr:Br(n)}moveTo(n,t){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,t){this._append`L${this._x1=+n},${this._y1=+t}`}quadraticCurveTo(n,t,s,o){this._append`Q${+n},${+t},${this._x1=+s},${this._y1=+o}`}bezierCurveTo(n,t,s,o,a,l){this._append`C${+n},${+t},${+s},${+o},${this._x1=+a},${this._y1=+l}`}arcTo(n,t,s,o,a){if(n=+n,t=+t,s=+s,o=+o,a=+a,a<0)throw new Error(`negative radius: ${a}`);let l=this._x1,i=this._y1,u=s-n,c=o-t,d=l-n,p=i-t,f=d*d+p*p;if(this._x1===null)this._append`M${this._x1=n},${this._y1=t}`;else if(f>Lt)if(!(Math.abs(p*u-c*d)>Lt)||!a)this._append`L${this._x1=n},${this._y1=t}`;else{let m=s-l,w=o-i,_=u*u+c*c,S=m*m+w*w,h=Math.sqrt(_),y=Math.sqrt(f),x=a*Math.tan((ss-Math.acos((_+f-S)/(2*h*y)))/2),C=x/y,E=x/h;Math.abs(C-1)>Lt&&this._append`L${n+C*d},${t+C*p}`,this._append`A${a},${a},0,0,${+(p*m>d*w)},${this._x1=n+E*u},${this._y1=t+E*c}`}}arc(n,t,s,o,a,l){if(n=+n,t=+t,s=+s,l=!!l,s<0)throw new Error(`negative radius: ${s}`);let i=s*Math.cos(o),u=s*Math.sin(o),c=n+i,d=t+u,p=1^l,f=l?o-a:a-o;this._x1===null?this._append`M${c},${d}`:(Math.abs(this._x1-c)>Lt||Math.abs(this._y1-d)>Lt)&&this._append`L${c},${d}`,s&&(f<0&&(f=f%rs+rs),f>Gr?this._append`A${s},${s},0,1,${p},${n-i},${t-u}A${s},${s},0,1,${p},${this._x1=c},${this._y1=d}`:f>Lt&&this._append`A${s},${s},0,${+(f>=ss)},${p},${this._x1=n+s*Math.cos(a)},${this._y1=t+s*Math.sin(a)}`)}rect(n,t,s,o){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+t}h${s=+s}v${+o}h${-s}Z`}toString(){return this._}}function ms(){return new gs}ms.prototype=gs.prototype;var Ur=Array.prototype.slice;function Zt(e){return function(){return e}}function qr(e){return e.source}function Wr(e){return e.target}function Ts(e){return e.radius}function Kr(e){return e.startAngle}function Yr(e){return e.endAngle}function Xr(){return 0}function Zr(e){var n=qr,t=Wr,s=Ts,o=Ts,a=Kr,l=Yr,i=Xr,u=null;function c(){var d,p=n.apply(this,arguments),f=t.apply(this,arguments),m=i.apply(this,arguments)/2,w=Ur.call(arguments),_=+s.apply(this,(w[0]=p,w)),S=a.apply(this,w)-yn,h=l.apply(this,w)-yn,y=+o.apply(this,(w[0]=f,w)),x=a.apply(this,w)-yn,C=l.apply(this,w)-yn;if(u||(u=d=ms()),m>Un&&(Vs(h-S)>m*2+Un?h>S?(S+=m,h-=m):(S-=m,h+=m):S=h=(S+h)/2,Vs(C-x)>m*2+Un?C>x?(x+=m,C-=m):(x-=m,C+=m):x=C=(x+C)/2),u.moveTo(_*Gn(S),_*Bn(S)),u.arc(0,0,_,S,h),(S!==x||h!==C)&&(u.quadraticCurveTo(0,0,y*Gn(x),y*Bn(x)),u.arc(0,0,y,x,C)),u.quadraticCurveTo(0,0,_*Gn(S),_*Bn(S)),u.closePath(),d)return u=null,d+""||null}return c.radius=function(d){return arguments.length?(s=o=typeof d=="function"?d:Zt(+d),c):s},c.sourceRadius=function(d){return arguments.length?(s=typeof d=="function"?d:Zt(+d),c):s},c.targetRadius=function(d){return arguments.length?(o=typeof d=="function"?d:Zt(+d),c):o},c.startAngle=function(d){return arguments.length?(a=typeof d=="function"?d:Zt(+d),c):a},c.endAngle=function(d){return arguments.length?(l=typeof d=="function"?d:Zt(+d),c):l},c.padAngle=function(d){return arguments.length?(i=typeof d=="function"?d:Zt(+d),c):i},c.source=function(d){return arguments.length?(n=d,c):n},c.target=function(d){return arguments.length?(t=d,c):t},c.context=function(d){return arguments.length?(u=d??null,c):u},c}function Qr(){return Zr()}function Jr(e){for(var n=e.length/6|0,t=new Array(n),s=0;s<n;)t[s]="#"+e.slice(s*6,++s*6);return t}const or=Jr("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function Ct(e){return function(){return e}}const Os=Math.abs,Ue=Math.atan2,kt=Math.cos,eo=Math.max,qn=Math.min,ht=Math.sin,Jt=Math.sqrt,Xe=1e-12,dn=Math.PI,Nn=dn/2,to=2*dn;function no(e){return e>1?0:e<-1?dn:Math.acos(e)}function zs(e){return e>=1?Nn:e<=-1?-Nn:Math.asin(e)}function so(e){let n=3;return e.digits=function(t){if(!arguments.length)return n;if(t==null)n=null;else{const s=Math.floor(t);if(!(s>=0))throw new RangeError(`invalid digits: ${t}`);n=s}return e},()=>new gs(n)}function ro(e){return e.innerRadius}function oo(e){return e.outerRadius}function ao(e){return e.startAngle}function io(e){return e.endAngle}function lo(e){return e&&e.padAngle}function uo(e,n,t,s,o,a,l,i){var u=t-e,c=s-n,d=l-o,p=i-a,f=p*u-d*c;if(!(f*f<Xe))return f=(d*(n-a)-p*(e-o))/f,[e+f*u,n+f*c]}function bn(e,n,t,s,o,a,l){var i=e-t,u=n-s,c=(l?a:-a)/Jt(i*i+u*u),d=c*u,p=-c*i,f=e+d,m=n+p,w=t+d,_=s+p,S=(f+w)/2,h=(m+_)/2,y=w-f,x=_-m,C=y*y+x*x,E=o-a,N=f*_-w*m,L=(x<0?-1:1)*Jt(eo(0,E*E*C-N*N)),A=(N*x-y*L)/C,V=(-N*y-x*L)/C,Z=(N*x+y*L)/C,T=(-N*y+x*L)/C,te=A-S,F=V-h,W=Z-S,Q=T-h;return te*te+F*F>W*W+Q*Q&&(A=Z,V=T),{cx:A,cy:V,x01:-d,y01:-p,x11:A*(o/E-1),y11:V*(o/E-1)}}function co(){var e=ro,n=oo,t=Ct(0),s=null,o=ao,a=io,l=lo,i=null,u=so(c);function c(){var d,p,f=+e.apply(this,arguments),m=+n.apply(this,arguments),w=o.apply(this,arguments)-Nn,_=a.apply(this,arguments)-Nn,S=Os(_-w),h=_>w;if(i||(i=d=u()),m<f&&(p=m,m=f,f=p),!(m>Xe))i.moveTo(0,0);else if(S>to-Xe)i.moveTo(m*kt(w),m*ht(w)),i.arc(0,0,m,w,_,!h),f>Xe&&(i.moveTo(f*kt(_),f*ht(_)),i.arc(0,0,f,_,w,h));else{var y=w,x=_,C=w,E=_,N=S,L=S,A=l.apply(this,arguments)/2,V=A>Xe&&(s?+s.apply(this,arguments):Jt(f*f+m*m)),Z=qn(Os(m-f)/2,+t.apply(this,arguments)),T=Z,te=Z,F,W;if(V>Xe){var Q=zs(V/f*ht(A)),he=zs(V/m*ht(A));(N-=Q*2)>Xe?(Q*=h?1:-1,C+=Q,E-=Q):(N=0,C=E=(w+_)/2),(L-=he*2)>Xe?(he*=h?1:-1,y+=he,x-=he):(L=0,y=x=(w+_)/2)}var ne=m*kt(y),be=m*ht(y),Fe=f*kt(E),j=f*ht(E);if(Z>Xe){var k=m*kt(x),je=m*ht(x),se=f*kt(C),Ze=f*ht(C),H;if(S<dn)if(H=uo(ne,be,se,Ze,k,je,Fe,j)){var Le=ne-H[0],B=be-H[1],He=k-H[0],Me=je-H[1],Ke=1/ht(no((Le*He+B*Me)/(Jt(Le*Le+B*B)*Jt(He*He+Me*Me)))/2),Ve=Jt(H[0]*H[0]+H[1]*H[1]);T=qn(Z,(f-Ve)/(Ke-1)),te=qn(Z,(m-Ve)/(Ke+1))}else T=te=0}L>Xe?te>Xe?(F=bn(se,Ze,ne,be,m,te,h),W=bn(k,je,Fe,j,m,te,h),i.moveTo(F.cx+F.x01,F.cy+F.y01),te<Z?i.arc(F.cx,F.cy,te,Ue(F.y01,F.x01),Ue(W.y01,W.x01),!h):(i.arc(F.cx,F.cy,te,Ue(F.y01,F.x01),Ue(F.y11,F.x11),!h),i.arc(0,0,m,Ue(F.cy+F.y11,F.cx+F.x11),Ue(W.cy+W.y11,W.cx+W.x11),!h),i.arc(W.cx,W.cy,te,Ue(W.y11,W.x11),Ue(W.y01,W.x01),!h))):(i.moveTo(ne,be),i.arc(0,0,m,y,x,!h)):i.moveTo(ne,be),!(f>Xe)||!(N>Xe)?i.lineTo(Fe,j):T>Xe?(F=bn(Fe,j,k,je,f,-T,h),W=bn(ne,be,se,Ze,f,-T,h),i.lineTo(F.cx+F.x01,F.cy+F.y01),T<Z?i.arc(F.cx,F.cy,T,Ue(F.y01,F.x01),Ue(W.y01,W.x01),!h):(i.arc(F.cx,F.cy,T,Ue(F.y01,F.x01),Ue(F.y11,F.x11),!h),i.arc(0,0,f,Ue(F.cy+F.y11,F.cx+F.x11),Ue(W.cy+W.y11,W.cx+W.x11),h),i.arc(W.cx,W.cy,T,Ue(W.y11,W.x11),Ue(W.y01,W.x01),!h))):i.arc(0,0,f,E,C,h)}if(i.closePath(),d)return i=null,d+""||null}return c.centroid=function(){var d=(+e.apply(this,arguments)+ +n.apply(this,arguments))/2,p=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-dn/2;return[kt(p)*d,ht(p)*d]},c.innerRadius=function(d){return arguments.length?(e=typeof d=="function"?d:Ct(+d),c):e},c.outerRadius=function(d){return arguments.length?(n=typeof d=="function"?d:Ct(+d),c):n},c.cornerRadius=function(d){return arguments.length?(t=typeof d=="function"?d:Ct(+d),c):t},c.padRadius=function(d){return arguments.length?(s=d==null?null:typeof d=="function"?d:Ct(+d),c):s},c.startAngle=function(d){return arguments.length?(o=typeof d=="function"?d:Ct(+d),c):o},c.endAngle=function(d){return arguments.length?(a=typeof d=="function"?d:Ct(+d),c):a},c.padAngle=function(d){return arguments.length?(l=typeof d=="function"?d:Ct(+d),c):l},c.context=function(d){return arguments.length?(i=d??null,c):i},c}const go="/INF358_Project_Kriskogram/assets/state_to_state_migration_table_2022_t13_updated_2024_06_27_2022-D7hzY5-5.csv",mo="/INF358_Project_Kriskogram/assets/state_to_state_migration_table_2023_t13_2023-Da-tSzHC.csv",fo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2005_2005-5D0dAV6T.csv",po="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2005_2007_2005-2007-C2gBOjzD.csv",ho="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2005_2009_2005-2009-oSLcshdC.csv",xo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2006_2006-C-EFanec.csv",vo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2006_2008_2006-2008-Cp1NRBpc.csv",yo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2007_2007-BXoQRRMn.csv",bo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2007_2009_2007-2009-Qdd3KwND.csv",So="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2008_2008--00JWAqc.csv",wo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2009_2009-5yGj8NCd.csv",_o="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2010_2010-CSB90FrU.csv",Co="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2011_2011-BzRnLs5h.csv",No="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2012_2012-DrbWwk1R.csv",jo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2013_2013-CTsYcw-F.csv",Mo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2014_2014-D8ze7hKk.csv",Ro="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2015_2015-Sg6Ir2qO.csv",Fo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2016_2016-C26kP0Bk.csv",Eo="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2017_2017-BNMbL_en.csv",$o="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2018_2018-DTnLPVgj.csv",Io="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2019_2019-Bd1nphS1.csv",Ao="/INF358_Project_Kriskogram/assets/State_to_State_Migrations_Table_2021-N7RTh5uH.csv";function Tt(e){const n=new Set,t=new Set,s=new Set,o=new Set,a=new Set,l=new Set;return e.nodes.forEach(i=>{Object.keys(i).forEach(u=>{if(u!=="id"&&u!=="label"){n.add(u);const c=i[u];typeof c=="number"?s.add(u):typeof c=="string"&&a.add(u)}})}),e.edges.forEach(i=>{Object.keys(i).forEach(u=>{if(u!=="source"&&u!=="target"&&u!=="value"){t.add(u);const c=i[u];typeof c=="number"?o.add(u):typeof c=="string"&&l.add(u)}})}),{nodeProperties:Array.from(n),edgeProperties:Array.from(t),hasNumericProperties:{nodes:Array.from(s),edges:Array.from(o)},hasCategoricalProperties:{nodes:Array.from(a),edges:Array.from(l)}}}const Po="kriskogram-db",Vo=1,ut="datasets";function cn(){return new Promise((e,n)=>{const t=indexedDB.open(Po,Vo);t.onupgradeneeded=()=>{const s=t.result;s.objectStoreNames.contains(ut)||s.createObjectStore(ut,{keyPath:"id"})},t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)})}async function jt(e){const n=await cn();return new Promise((t,s)=>{const o=n.transaction(ut,"readwrite");o.objectStore(ut).put(e),o.oncomplete=()=>t(),o.onerror=()=>s(o.error),o.onabort=()=>s(o.error)})}async function Mt(e){const n=await cn();return new Promise((t,s)=>{const l=n.transaction(ut,"readonly").objectStore(ut).get(e);l.onsuccess=()=>t(l.result),l.onerror=()=>s(l.error)})}async function ko(){const e=await cn();return new Promise((n,t)=>{const a=e.transaction(ut,"readonly").objectStore(ut).getAll();a.onsuccess=()=>n(a.result||[]),a.onerror=()=>t(a.error)})}async function os(e){const n=await cn();return new Promise((t,s)=>{const o=n.transaction(ut,"readwrite");o.objectStore(ut).delete(e),o.oncomplete=()=>t(),o.onerror=()=>s(o.error)})}async function Do(e){const n=await Mt(e);if(!n)throw new Error(`Dataset ${e} not found`);const t={...n,id:`${n.type}-${Date.now()}`,name:`${n.name} (Copy)`,createdAt:Date.now()};return await jt(t),t}async function Lo(){const e=await cn();return new Promise((n,t)=>{const s=e.transaction(ut,"readwrite");s.objectStore(ut).clear(),s.oncomplete=()=>n(),s.onerror=()=>t(s.error)})}async function To(){if("storage"in navigator&&"persist"in navigator.storage)try{return await navigator.storage.persist()}catch{return!1}return!1}function Hs(e){const n=[];let t="",s=!1;for(let o=0;o<e.length;o++){const a=e[o];a==='"'?s=!s:a===","&&!s?(n.push(t),t=""):t+=a}return n.push(t),n}function Gs(e){const n=e.trim().split(`
`).filter(o=>o.trim());if(n.length===0)throw new Error("CSV file is empty");const t=Hs(n[0]).map(o=>o.trim()),s=n.slice(1).map(Hs);return{headers:t,rows:s}}function Wn(e){const n=e.replace(/[",]/g,"").trim(),t=Number.parseFloat(n);return Number.isNaN(t)?n:t}function ar(e){var E;const{headers:n,rows:t}=Gs(e.nodesFile.content),s=n.map(N=>N.toLowerCase().trim()),o=e.nodesFile.idField.toLowerCase().trim(),a=((E=e.nodesFile.labelField)==null?void 0:E.toLowerCase().trim())||o,l=s.indexOf(o),i=e.nodesFile.labelField?s.indexOf(a):l;if(l===-1)throw new Error(`ID field "${e.nodesFile.idField}" not found in nodes file. Available fields: ${n.join(", ")}`);const u=t.map(N=>{const L={id:String(N[l]||"").trim(),label:i>=0?String(N[i]||"").trim():String(N[l]||"").trim()},A=n[l],V=e.nodesFile.labelField?n[i]:A;return n.forEach((Z,T)=>{var te;if(Z!==A&&Z!==V){const F=((te=N[T])==null?void 0:te.trim())||"";L[Z]=Wn(F)}}),L}).filter(N=>N.id),c=new Map(u.map(N=>[N.id,N])),{headers:d,rows:p}=Gs(e.edgesFile.content),f=d.map(N=>N.toLowerCase().trim()),m=e.edgesFile.sourceField.toLowerCase().trim(),w=e.edgesFile.targetField.toLowerCase().trim(),_=e.edgesFile.valueField.toLowerCase().trim(),S=f.indexOf(m),h=f.indexOf(w),y=f.indexOf(_);if(S===-1)throw new Error(`Source field "${e.edgesFile.sourceField}" not found in edges file. Available fields: ${d.join(", ")}`);if(h===-1)throw new Error(`Target field "${e.edgesFile.targetField}" not found in edges file. Available fields: ${d.join(", ")}`);if(y===-1)throw new Error(`Value field "${e.edgesFile.valueField}" not found in edges file. Available fields: ${d.join(", ")}`);const x=p.map(N=>{const L=String(N[S]||"").trim(),A=String(N[h]||"").trim(),V=String(N[y]||"").trim(),Z=Wn(V);if(!L||!A||typeof Z!="number"||Z<=0)return null;(!c.has(L)||!c.has(A))&&console.warn(`Edge references missing node: ${L} -> ${A}`);const T={source:L,target:A,value:Z},te=d[S],F=d[h],W=d[y];return d.forEach((Q,he)=>{var ne;if(Q!==te&&Q!==F&&Q!==W){const be=((ne=N[he])==null?void 0:ne.trim())||"";T[Q]=Wn(be)}}),T}).filter(N=>N!==null&&c.has(N.source)&&c.has(N.target)),C=new Set;return x.forEach(N=>{C.add(N.source),C.add(N.target)}),C.forEach(N=>{c.has(N)||u.push({id:N,label:N})}),{nodes:u,edges:x}}function Oo({onClose:e,onImport:n,fileInputRef:t,onFilesSelected:s,existingFile:o}){const[a,l]=v.useState(""),[i,u]=v.useState(""),[c,d]=v.useState(!1),[p,f]=v.useState({}),[m,w]=v.useState(!1),[_,S]=v.useState(null),[h,y]=v.useState([]),[x,C]=v.useState([]),[E,N]=v.useState(null),L=v.useRef(null),A=v.useRef(null),[V,Z]=v.useState(null),[T,te]=v.useState(null),[F,W]=v.useState([]),[Q,he]=v.useState([]),[ne,be]=v.useState(""),[Fe,j]=v.useState(""),[k,je]=v.useState(""),[se,Ze]=v.useState(""),[H,Le]=v.useState(""),[B,He]=v.useState(null);function Me(M){let P=M.replace(/\.(csv|gexf)$/i,"");return P=P.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/[_-]/g," ").replace(/[^a-zA-Z0-9\s]/g," ").replace(/\s+/g," ").trim(),P.split(" ").map(G=>G.charAt(0).toUpperCase()+G.slice(1).toLowerCase()).join(" ")}v.useEffect(()=>{var M;if(o!=null&&o.parsedData){He(o.parsedData);const P=((M=o.files[0])==null?void 0:M.name)||"";l(Me(P)),u(o.files.map(G=>G.name).join(", "))}},[o]),v.useEffect(()=>{var M;if(!o&&h.length>0){if(!a||a===Me(((M=h[0])==null?void 0:M.name)||"")){const P=h[0].name;l(Me(P))}i||u(h.map(P=>P.name).join(", "))}},[h]);function Ke(M){const P=[];let G="",xe=!1;for(let J=0;J<M.length;J++){const ie=M[J];ie==='"'?xe=!xe:ie===","&&!xe?(P.push(G),G=""):G+=ie}return P.push(G),P}function Ve(M){const P=M.trim().split(`
`);if(P.length===0)return[];const G=P[0];return Ke(G).map(xe=>xe.trim().replace(/^"|"$/g,""))}async function zt(M){const P=Array.from(M.target.files||[]);if(P.length===0)return;y(P);const G=await Promise.all(P.map(J=>J.text()));C(G);const xe=P[0].name.toLowerCase();if(xe.endsWith(".gexf")){N("gexf"),S("single");try{const J=$r(G[0]),ie=nr(J);He({nodes:ie.length>0?ie[0].nodes:[],edges:ie.length>0?ie[0].edges:[],timeRange:J.timeRange}),l(P[0].name.replace(".gexf",""))}catch(J){f({general:J instanceof Error?J.message:"Failed to parse GEXF"})}}else if(xe.endsWith(".csv")){if(N("csv"),P.length===1){S("single");try{const J=ns(G[0]);He({nodes:J.nodes,edges:J.edges,timeRange:{start:2021,end:2021}}),l(P[0].name.replace(".csv",""))}catch{S("two-file");const ie=Ve(G[0]);W(ie),he(ie),Z(0);const Se=ie.find(ke=>ke.toLowerCase()==="id"||ke.toLowerCase()==="node"||ke.toLowerCase()==="name"),rt=ie.find(ke=>ke.toLowerCase()==="source"||ke.toLowerCase()==="origin"||ke.toLowerCase()==="from"),Et=ie.find(ke=>ke.toLowerCase()==="target"||ke.toLowerCase()==="dest"||ke.toLowerCase()==="destination"||ke.toLowerCase()==="to"),ot=ie.find(ke=>ke.toLowerCase()==="value"||ke.toLowerCase()==="count"||ke.toLowerCase()==="weight");Se&&be(Se),rt&&je(rt),Et&&Ze(Et),ot&&Le(ot),f({general:"Could not parse as state migration format. Please select which file contains nodes and which contains edges."})}}else if(P.length===2){S("two-file");const J=Ve(G[0]),ie=Ve(G[1]);W(J),he(ie),Z(0),te(1);const Se=J.find(Te=>Te.toLowerCase()==="id"),rt=J.find(Te=>Te.toLowerCase()==="name"||Te.toLowerCase()==="label");Se&&be(Se),rt&&j(rt);const Et=ie.find(Te=>Te.toLowerCase()==="source"||Te.toLowerCase()==="origin"||Te.toLowerCase()==="from"),ot=ie.find(Te=>Te.toLowerCase()==="target"||Te.toLowerCase()==="dest"||Te.toLowerCase()==="destination"||Te.toLowerCase()==="to"),ke=ie.find(Te=>Te.toLowerCase()==="value"||Te.toLowerCase()==="count"||Te.toLowerCase()==="weight");Et&&je(Et),ot&&Ze(ot),ke&&Le(ke),nt()}}t.current&&(t.current.value="")}function nt(){if(V===null||T===null||!ne||!k||!se||!H){f({general:"Please select all required fields"}),He(null);return}try{const M=ar({nodesFile:{content:x[V],idField:ne,labelField:Fe||ne},edgesFile:{content:x[T],sourceField:k,targetField:se,valueField:H}});He({nodes:M.nodes,edges:M.edges,timeRange:{start:2016,end:2016}}),f({})}catch(M){f({general:M instanceof Error?M.message:"Failed to parse two-file CSV"}),He(null)}}v.useEffect(()=>{_==="two-file"&&V!==null&&T!==null&&nt()},[ne,Fe,k,se,H,V,T]);function gn(){const M={},P=[];if(a.trim()||(M.name="Dataset name is required"),_==="two-file"&&(V===null&&(M.nodesFile="Please select which file contains nodes"),T===null&&(M.edgesFile="Please select which file contains edges"),V!==null&&!ne&&(M.nodeIdField="Please select the ID field for nodes"),T!==null&&!k&&(M.edgeSourceField="Please select the source field for edges"),T!==null&&!se&&(M.edgeTargetField="Please select the target field for edges"),T!==null&&!H&&(M.edgeValueField="Please select the value field for edges")),!B)return M.general="Data parsing failed - please check file format and field selections",M;B.nodes.length===0&&P.push("No nodes found in dataset"),B.edges.length===0&&P.push("No edges found in dataset");const G=new Set(B.nodes.map(J=>J.id));G.size!==B.nodes.length&&P.push(`${B.nodes.length-G.size} duplicate node IDs found`);const xe=B.edges.filter(J=>!G.has(J.source)||!G.has(J.target));return xe.length>0&&P.push(`${xe.length} edges reference non-existent nodes`),P.length>0&&(M.summary=P.join("; ")),M}function st(){p.name&&L.current?(L.current.scrollIntoView({behavior:"smooth",block:"center"}),L.current.focus()):p.summary&&A.current&&A.current.scrollIntoView({behavior:"smooth",block:"center"})}async function mn(){const M=gn();if(f(M),Object.keys(M).filter(G=>G!=="summary").length>0||!B){setTimeout(()=>st(),100);return}d(!0);try{const G=B.timeRange||{start:2021,end:2021},xe={timestamp:G.start,nodes:B.nodes,edges:B.edges},J=Tt(xe),ie=[xe],Se={name:a.trim(),filename:h.map(rt=>rt.name).join(", "),notes:i.trim()||void 0,type:_==="two-file"?"csv":E||"csv",timeRange:G,snapshots:ie,metadata:J};await n(Se,{nodes:B.nodes,edges:B.edges,snapshots:ie,metadata:J})}catch(G){console.error("Import error:",G),f({general:G instanceof Error?G.message:"Failed to import dataset"}),d(!1),setTimeout(()=>st(),100)}}return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold",children:"Import Dataset"}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.jsxs("div",{className:"space-y-6",children:[!_&&r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Files ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("button",{onClick:()=>{var M;return(M=t.current)==null?void 0:M.click()},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Choose Files"}),r.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Select 1 file (GEXF or CSV) or 2 files (CSV nodes + CSV edges)"}),r.jsx("input",{ref:t,type:"file",accept:".csv,.gexf",multiple:!0,onChange:zt,className:"hidden"})]})]}),h.length>0&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selected Files"}),r.jsxs("div",{className:"space-y-2",children:[h.map((M,P)=>r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded",children:[r.jsx("span",{className:"text-sm",children:M.name}),r.jsx("button",{onClick:()=>{const G=[...h];G.splice(P,1),y(G);const xe=[...x];xe.splice(P,1),C(xe),_==="two-file"&&(V===P&&Z(null),T===P&&te(null),V&&V>P&&Z(V-1),T&&T>P&&te(T-1))},className:"text-red-600 text-sm hover:text-red-800",children:"Remove"})]},P)),r.jsx("button",{type:"button",onClick:()=>{const M=document.createElement("input");M.type="file",M.accept=".csv,.gexf",M.multiple=!0,M.onchange=async P=>{const G=P.target,xe=Array.from(G.files||[]);if(xe.length>0){const J=await Promise.all(xe.map(Se=>Se.text()));y([...h,...xe]),C([...x,...J]);const ie=[...h,...xe];ie.length===2&&ie.every(Se=>Se.name.toLowerCase().endsWith(".csv"))&&(S("two-file"),N("csv"))}},M.click()},className:"text-sm text-blue-600 hover:text-blue-800",children:"+ Add More Files"})]})]}),_==="two-file"&&h.length>0&&r.jsxs("div",{className:"border-t pt-4 space-y-4","data-file-select":!0,children:[r.jsx("h3",{className:"font-semibold",children:"Map Files and Fields"}),r.jsxs("div",{"data-field-select":!0,children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nodes File (Locations) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{value:V??"",onChange:M=>{const P=parseInt(M.target.value);Z(P);const G=Ve(x[P]);W(G);const xe=G.find(J=>J.toLowerCase()==="id");if(xe&&be(xe),p.nodesFile){const J={...p};delete J.nodesFile,f(J)}},className:`w-full px-3 py-2 border rounded-md ${p.nodesFile?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select file..."}),h.map((M,P)=>r.jsx("option",{value:P,children:M.name},P))]}),p.nodesFile&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.nodesFile}),V!==null&&F.length>0&&r.jsxs("div",{className:"mt-2 space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"ID Field *"}),r.jsxs("select",{value:ne,onChange:M=>{if(be(M.target.value),p.nodeIdField){const P={...p};delete P.nodeIdField,f(P)}},className:`w-full px-2 py-1 border rounded text-sm ${p.nodeIdField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),F.map(M=>r.jsx("option",{value:M,children:M},M))]}),p.nodeIdField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:p.nodeIdField})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Label Field (optional)"}),r.jsxs("select",{value:Fe,onChange:M=>j(M.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[r.jsx("option",{value:"",children:"Use ID field"}),F.map(M=>r.jsx("option",{value:M,children:M},M))]})]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Edges File (Flows) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{value:T??"",onChange:M=>{const P=parseInt(M.target.value);te(P);const G=Ve(x[P]);he(G);const xe=G.find(Se=>Se.toLowerCase()==="source"||Se.toLowerCase()==="origin"||Se.toLowerCase()==="from"),J=G.find(Se=>Se.toLowerCase()==="target"||Se.toLowerCase()==="dest"||Se.toLowerCase()==="to"),ie=G.find(Se=>Se.toLowerCase()==="value"||Se.toLowerCase()==="count"||Se.toLowerCase()==="weight");if(xe&&je(xe),J&&Ze(J),ie&&Le(ie),p.edgesFile){const Se={...p};delete Se.edgesFile,f(Se)}},className:`w-full px-3 py-2 border rounded-md ${p.edgesFile?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select file..."}),h.map((M,P)=>r.jsx("option",{value:P,children:M.name},P))]}),p.edgesFile&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.edgesFile}),T!==null&&Q.length>0&&r.jsxs("div",{className:"mt-2 space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Source Field *"}),r.jsxs("select",{value:k,onChange:M=>{if(je(M.target.value),p.edgeSourceField){const P={...p};delete P.edgeSourceField,f(P)}},className:`w-full px-2 py-1 border rounded text-sm ${p.edgeSourceField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),Q.map(M=>r.jsx("option",{value:M,children:M},M))]}),p.edgeSourceField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:p.edgeSourceField})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Target Field *"}),r.jsxs("select",{value:se,onChange:M=>{if(Ze(M.target.value),p.edgeTargetField){const P={...p};delete P.edgeTargetField,f(P)}},className:`w-full px-2 py-1 border rounded text-sm ${p.edgeTargetField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),Q.map(M=>r.jsx("option",{value:M,children:M},M))]}),p.edgeTargetField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:p.edgeTargetField})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Value Field *"}),r.jsxs("select",{value:H,onChange:M=>{if(Le(M.target.value),p.edgeValueField){const P={...p};delete P.edgeValueField,f(P)}},className:`w-full px-2 py-1 border rounded text-sm ${p.edgeValueField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),Q.map(M=>r.jsx("option",{value:M,children:M},M))]}),p.edgeValueField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:p.edgeValueField})]})]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Dataset Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{ref:L,type:"text",value:a,onChange:M=>{if(l(M.target.value),p.name){const P={...p};delete P.name,f(P)}},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${p.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,placeholder:"Enter a name for this dataset"}),p.name&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:p.name})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),r.jsx("textarea",{value:i,onChange:M=>u(M.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add any notes about this dataset..."})]}),p.general&&r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[r.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"Error:"}),r.jsx("p",{className:"text-sm text-red-700",children:p.general})]}),B&&r.jsxs("div",{ref:A,className:"bg-blue-50 border border-blue-200 rounded p-3",children:[r.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Data Summary"}),r.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Nodes:"})," ",B.nodes.length]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Edges:"})," ",B.edges.length]}),B.timeRange&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Time Range:"})," ",B.timeRange.start,B.timeRange.end!==B.timeRange.start?` – ${B.timeRange.end}`:""]}),B.nodes.length>0&&r.jsxs("div",{className:"mt-2 text-xs",children:[r.jsx("span",{className:"font-medium",children:"Sample node properties:"})," ",Object.keys(B.nodes[0]).slice(0,5).join(", "),Object.keys(B.nodes[0]).length>5&&"..."]}),p.summary&&r.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-300",children:[r.jsx("span",{className:"font-medium text-orange-700",children:"Warnings:"})," ",r.jsx("span",{className:"text-orange-600",children:p.summary})]})]})]})]})}),r.jsxs("div",{className:"p-6 border-t flex justify-end gap-3",children:[r.jsx("button",{onClick:e,type:"button",disabled:c,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:mn,type:"button",disabled:c||(Object.keys(p).filter(P=>P!=="summary").length>0||!B),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors",children:c?"Importing...":"Import Dataset"})]})]})})}/**
   * table-core
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function Rt(e,n){return typeof e=="function"?e(n):e}function tt(e,n){return t=>{n.setState(s=>({...s,[e]:Rt(t,s[e])}))}}function jn(e){return e instanceof Function}function zo(e){return Array.isArray(e)&&e.every(n=>typeof n=="number")}function Ho(e,n){const t=[],s=o=>{o.forEach(a=>{t.push(a);const l=n(a);l!=null&&l.length&&s(l)})};return s(e),t}function U(e,n,t){let s=[],o;return a=>{let l;t.key&&t.debug&&(l=Date.now());const i=e(a);if(!(i.length!==s.length||i.some((d,p)=>s[p]!==d)))return o;s=i;let c;if(t.key&&t.debug&&(c=Date.now()),o=n(...i),t==null||t.onChange==null||t.onChange(o),t.key&&t.debug&&t!=null&&t.debug()){const d=Math.round((Date.now()-l)*100)/100,p=Math.round((Date.now()-c)*100)/100,f=p/16,m=(w,_)=>{for(w=String(w);w.length<_;)w=" "+w;return w};console.info(`%c⏱ ${m(p,5)} /${m(d,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*f,120))}deg 100% 31%);`,t==null?void 0:t.key)}return o}}function q(e,n,t,s){return{debug:()=>{var o;return(o=e==null?void 0:e.debugAll)!=null?o:e[n]},key:!1,onChange:s}}function Go(e,n,t,s){const o=()=>{var l;return(l=a.getValue())!=null?l:e.options.renderFallbackValue},a={id:`${n.id}_${t.id}`,row:n,column:t,getValue:()=>n.getValue(s),renderValue:o,getContext:U(()=>[e,t,n,a],(l,i,u,c)=>({table:l,column:i,row:u,cell:c,getValue:c.getValue,renderValue:c.renderValue}),q(e.options,"debugCells"))};return e._features.forEach(l=>{l.createCell==null||l.createCell(a,t,n,e)},{}),a}function Bo(e,n,t,s){var o,a;const i={...e._getDefaultColumnDef(),...n},u=i.accessorKey;let c=(o=(a=i.id)!=null?a:u?typeof String.prototype.replaceAll=="function"?u.replaceAll(".","_"):u.replace(/\./g,"_"):void 0)!=null?o:typeof i.header=="string"?i.header:void 0,d;if(i.accessorFn?d=i.accessorFn:u&&(u.includes(".")?d=f=>{let m=f;for(const _ of u.split(".")){var w;m=(w=m)==null?void 0:w[_]}return m}:d=f=>f[i.accessorKey]),!c)throw new Error;let p={id:`${String(c)}`,accessorFn:d,parent:s,depth:t,columnDef:i,columns:[],getFlatColumns:U(()=>[!0],()=>{var f;return[p,...(f=p.columns)==null?void 0:f.flatMap(m=>m.getFlatColumns())]},q(e.options,"debugColumns")),getLeafColumns:U(()=>[e._getOrderColumnsFn()],f=>{var m;if((m=p.columns)!=null&&m.length){let w=p.columns.flatMap(_=>_.getLeafColumns());return f(w)}return[p]},q(e.options,"debugColumns"))};for(const f of e._features)f.createColumn==null||f.createColumn(p,e);return p}const qe="debugHeaders";function Bs(e,n,t){var s;let a={id:(s=t.id)!=null?s:n.id,column:n,index:t.index,isPlaceholder:!!t.isPlaceholder,placeholderId:t.placeholderId,depth:t.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const l=[],i=u=>{u.subHeaders&&u.subHeaders.length&&u.subHeaders.map(i),l.push(u)};return i(a),l},getContext:()=>({table:e,header:a,column:n})};return e._features.forEach(l=>{l.createHeader==null||l.createHeader(a,e)}),a}const Uo={createTable:e=>{e.getHeaderGroups=U(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,s,o)=>{var a,l;const i=(a=s==null?void 0:s.map(p=>t.find(f=>f.id===p)).filter(Boolean))!=null?a:[],u=(l=o==null?void 0:o.map(p=>t.find(f=>f.id===p)).filter(Boolean))!=null?l:[],c=t.filter(p=>!(s!=null&&s.includes(p.id))&&!(o!=null&&o.includes(p.id)));return Sn(n,[...i,...c,...u],e)},q(e.options,qe)),e.getCenterHeaderGroups=U(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,s,o)=>(t=t.filter(a=>!(s!=null&&s.includes(a.id))&&!(o!=null&&o.includes(a.id))),Sn(n,t,e,"center")),q(e.options,qe)),e.getLeftHeaderGroups=U(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(n,t,s)=>{var o;const a=(o=s==null?void 0:s.map(l=>t.find(i=>i.id===l)).filter(Boolean))!=null?o:[];return Sn(n,a,e,"left")},q(e.options,qe)),e.getRightHeaderGroups=U(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(n,t,s)=>{var o;const a=(o=s==null?void 0:s.map(l=>t.find(i=>i.id===l)).filter(Boolean))!=null?o:[];return Sn(n,a,e,"right")},q(e.options,qe)),e.getFooterGroups=U(()=>[e.getHeaderGroups()],n=>[...n].reverse(),q(e.options,qe)),e.getLeftFooterGroups=U(()=>[e.getLeftHeaderGroups()],n=>[...n].reverse(),q(e.options,qe)),e.getCenterFooterGroups=U(()=>[e.getCenterHeaderGroups()],n=>[...n].reverse(),q(e.options,qe)),e.getRightFooterGroups=U(()=>[e.getRightHeaderGroups()],n=>[...n].reverse(),q(e.options,qe)),e.getFlatHeaders=U(()=>[e.getHeaderGroups()],n=>n.map(t=>t.headers).flat(),q(e.options,qe)),e.getLeftFlatHeaders=U(()=>[e.getLeftHeaderGroups()],n=>n.map(t=>t.headers).flat(),q(e.options,qe)),e.getCenterFlatHeaders=U(()=>[e.getCenterHeaderGroups()],n=>n.map(t=>t.headers).flat(),q(e.options,qe)),e.getRightFlatHeaders=U(()=>[e.getRightHeaderGroups()],n=>n.map(t=>t.headers).flat(),q(e.options,qe)),e.getCenterLeafHeaders=U(()=>[e.getCenterFlatHeaders()],n=>n.filter(t=>{var s;return!((s=t.subHeaders)!=null&&s.length)}),q(e.options,qe)),e.getLeftLeafHeaders=U(()=>[e.getLeftFlatHeaders()],n=>n.filter(t=>{var s;return!((s=t.subHeaders)!=null&&s.length)}),q(e.options,qe)),e.getRightLeafHeaders=U(()=>[e.getRightFlatHeaders()],n=>n.filter(t=>{var s;return!((s=t.subHeaders)!=null&&s.length)}),q(e.options,qe)),e.getLeafHeaders=U(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(n,t,s)=>{var o,a,l,i,u,c;return[...(o=(a=n[0])==null?void 0:a.headers)!=null?o:[],...(l=(i=t[0])==null?void 0:i.headers)!=null?l:[],...(u=(c=s[0])==null?void 0:c.headers)!=null?u:[]].map(d=>d.getLeafHeaders()).flat()},q(e.options,qe))}};function Sn(e,n,t,s){var o,a;let l=0;const i=function(f,m){m===void 0&&(m=1),l=Math.max(l,m),f.filter(w=>w.getIsVisible()).forEach(w=>{var _;(_=w.columns)!=null&&_.length&&i(w.columns,m+1)},0)};i(e);let u=[];const c=(f,m)=>{const w={depth:m,id:[s,`${m}`].filter(Boolean).join("_"),headers:[]},_=[];f.forEach(S=>{const h=[..._].reverse()[0],y=S.column.depth===w.depth;let x,C=!1;if(y&&S.column.parent?x=S.column.parent:(x=S.column,C=!0),h&&(h==null?void 0:h.column)===x)h.subHeaders.push(S);else{const E=Bs(t,x,{id:[s,m,x.id,S==null?void 0:S.id].filter(Boolean).join("_"),isPlaceholder:C,placeholderId:C?`${_.filter(N=>N.column===x).length}`:void 0,depth:m,index:_.length});E.subHeaders.push(S),_.push(E)}w.headers.push(S),S.headerGroup=w}),u.push(w),m>0&&c(_,m-1)},d=n.map((f,m)=>Bs(t,f,{depth:l,index:m}));c(d,l-1),u.reverse();const p=f=>f.filter(w=>w.column.getIsVisible()).map(w=>{let _=0,S=0,h=[0];w.subHeaders&&w.subHeaders.length?(h=[],p(w.subHeaders).forEach(x=>{let{colSpan:C,rowSpan:E}=x;_+=C,h.push(E)})):_=1;const y=Math.min(...h);return S=S+y,w.colSpan=_,w.rowSpan=S,{colSpan:_,rowSpan:S}});return p((o=(a=u[0])==null?void 0:a.headers)!=null?o:[]),u}const qo=(e,n,t,s,o,a,l)=>{let i={id:n,index:s,original:t,depth:o,parentId:l,_valuesCache:{},_uniqueValuesCache:{},getValue:u=>{if(i._valuesCache.hasOwnProperty(u))return i._valuesCache[u];const c=e.getColumn(u);if(c!=null&&c.accessorFn)return i._valuesCache[u]=c.accessorFn(i.original,s),i._valuesCache[u]},getUniqueValues:u=>{if(i._uniqueValuesCache.hasOwnProperty(u))return i._uniqueValuesCache[u];const c=e.getColumn(u);if(c!=null&&c.accessorFn)return c.columnDef.getUniqueValues?(i._uniqueValuesCache[u]=c.columnDef.getUniqueValues(i.original,s),i._uniqueValuesCache[u]):(i._uniqueValuesCache[u]=[i.getValue(u)],i._uniqueValuesCache[u])},renderValue:u=>{var c;return(c=i.getValue(u))!=null?c:e.options.renderFallbackValue},subRows:[],getLeafRows:()=>Ho(i.subRows,u=>u.subRows),getParentRow:()=>i.parentId?e.getRow(i.parentId,!0):void 0,getParentRows:()=>{let u=[],c=i;for(;;){const d=c.getParentRow();if(!d)break;u.push(d),c=d}return u.reverse()},getAllCells:U(()=>[e.getAllLeafColumns()],u=>u.map(c=>Go(e,i,c,c.id)),q(e.options,"debugRows")),_getAllCellsByColumnId:U(()=>[i.getAllCells()],u=>u.reduce((c,d)=>(c[d.column.id]=d,c),{}),q(e.options,"debugRows"))};for(let u=0;u<e._features.length;u++){const c=e._features[u];c==null||c.createRow==null||c.createRow(i,e)}return i},Wo={createColumn:(e,n)=>{e._getFacetedRowModel=n.options.getFacetedRowModel&&n.options.getFacetedRowModel(n,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():n.getPreFilteredRowModel(),e._getFacetedUniqueValues=n.options.getFacetedUniqueValues&&n.options.getFacetedUniqueValues(n,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=n.options.getFacetedMinMaxValues&&n.options.getFacetedMinMaxValues(n,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},ir=(e,n,t)=>{var s,o;const a=t==null||(s=t.toString())==null?void 0:s.toLowerCase();return!!(!((o=e.getValue(n))==null||(o=o.toString())==null||(o=o.toLowerCase())==null)&&o.includes(a))};ir.autoRemove=e=>mt(e);const lr=(e,n,t)=>{var s;return!!(!((s=e.getValue(n))==null||(s=s.toString())==null)&&s.includes(t))};lr.autoRemove=e=>mt(e);const ur=(e,n,t)=>{var s;return((s=e.getValue(n))==null||(s=s.toString())==null?void 0:s.toLowerCase())===(t==null?void 0:t.toLowerCase())};ur.autoRemove=e=>mt(e);const dr=(e,n,t)=>{var s;return(s=e.getValue(n))==null?void 0:s.includes(t)};dr.autoRemove=e=>mt(e);const cr=(e,n,t)=>!t.some(s=>{var o;return!((o=e.getValue(n))!=null&&o.includes(s))});cr.autoRemove=e=>mt(e)||!(e!=null&&e.length);const gr=(e,n,t)=>t.some(s=>{var o;return(o=e.getValue(n))==null?void 0:o.includes(s)});gr.autoRemove=e=>mt(e)||!(e!=null&&e.length);const mr=(e,n,t)=>e.getValue(n)===t;mr.autoRemove=e=>mt(e);const fr=(e,n,t)=>e.getValue(n)==t;fr.autoRemove=e=>mt(e);const fs=(e,n,t)=>{let[s,o]=t;const a=e.getValue(n);return a>=s&&a<=o};fs.resolveFilterValue=e=>{let[n,t]=e,s=typeof n!="number"?parseFloat(n):n,o=typeof t!="number"?parseFloat(t):t,a=n===null||Number.isNaN(s)?-1/0:s,l=t===null||Number.isNaN(o)?1/0:o;if(a>l){const i=a;a=l,l=i}return[a,l]};fs.autoRemove=e=>mt(e)||mt(e[0])&&mt(e[1]);const yt={includesString:ir,includesStringSensitive:lr,equalsString:ur,arrIncludes:dr,arrIncludesAll:cr,arrIncludesSome:gr,equals:mr,weakEquals:fr,inNumberRange:fs};function mt(e){return e==null||e===""}const Ko={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:tt("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,n)=>{e.getAutoFilterFn=()=>{const t=n.getCoreRowModel().flatRows[0],s=t==null?void 0:t.getValue(e.id);return typeof s=="string"?yt.includesString:typeof s=="number"?yt.inNumberRange:typeof s=="boolean"||s!==null&&typeof s=="object"?yt.equals:Array.isArray(s)?yt.arrIncludes:yt.weakEquals},e.getFilterFn=()=>{var t,s;return jn(e.columnDef.filterFn)?e.columnDef.filterFn:e.columnDef.filterFn==="auto"?e.getAutoFilterFn():(t=(s=n.options.filterFns)==null?void 0:s[e.columnDef.filterFn])!=null?t:yt[e.columnDef.filterFn]},e.getCanFilter=()=>{var t,s,o;return((t=e.columnDef.enableColumnFilter)!=null?t:!0)&&((s=n.options.enableColumnFilters)!=null?s:!0)&&((o=n.options.enableFilters)!=null?o:!0)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var t;return(t=n.getState().columnFilters)==null||(t=t.find(s=>s.id===e.id))==null?void 0:t.value},e.getFilterIndex=()=>{var t,s;return(t=(s=n.getState().columnFilters)==null?void 0:s.findIndex(o=>o.id===e.id))!=null?t:-1},e.setFilterValue=t=>{n.setColumnFilters(s=>{const o=e.getFilterFn(),a=s==null?void 0:s.find(d=>d.id===e.id),l=Rt(t,a?a.value:void 0);if(Us(o,l,e)){var i;return(i=s==null?void 0:s.filter(d=>d.id!==e.id))!=null?i:[]}const u={id:e.id,value:l};if(a){var c;return(c=s==null?void 0:s.map(d=>d.id===e.id?u:d))!=null?c:[]}return s!=null&&s.length?[...s,u]:[u]})}},createRow:(e,n)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=n=>{const t=e.getAllLeafColumns(),s=o=>{var a;return(a=Rt(n,o))==null?void 0:a.filter(l=>{const i=t.find(u=>u.id===l.id);if(i){const u=i.getFilterFn();if(Us(u,l.value,i))return!1}return!0})};e.options.onColumnFiltersChange==null||e.options.onColumnFiltersChange(s)},e.resetColumnFilters=n=>{var t,s;e.setColumnFilters(n?[]:(t=(s=e.initialState)==null?void 0:s.columnFilters)!=null?t:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel())}};function Us(e,n,t){return(e&&e.autoRemove?e.autoRemove(n,t):!1)||typeof n>"u"||typeof n=="string"&&!n}const Yo=(e,n,t)=>t.reduce((s,o)=>{const a=o.getValue(e);return s+(typeof a=="number"?a:0)},0),Xo=(e,n,t)=>{let s;return t.forEach(o=>{const a=o.getValue(e);a!=null&&(s>a||s===void 0&&a>=a)&&(s=a)}),s},Zo=(e,n,t)=>{let s;return t.forEach(o=>{const a=o.getValue(e);a!=null&&(s<a||s===void 0&&a>=a)&&(s=a)}),s},Qo=(e,n,t)=>{let s,o;return t.forEach(a=>{const l=a.getValue(e);l!=null&&(s===void 0?l>=l&&(s=o=l):(s>l&&(s=l),o<l&&(o=l)))}),[s,o]},Jo=(e,n)=>{let t=0,s=0;if(n.forEach(o=>{let a=o.getValue(e);a!=null&&(a=+a)>=a&&(++t,s+=a)}),t)return s/t},ea=(e,n)=>{if(!n.length)return;const t=n.map(a=>a.getValue(e));if(!zo(t))return;if(t.length===1)return t[0];const s=Math.floor(t.length/2),o=t.sort((a,l)=>a-l);return t.length%2!==0?o[s]:(o[s-1]+o[s])/2},ta=(e,n)=>Array.from(new Set(n.map(t=>t.getValue(e))).values()),na=(e,n)=>new Set(n.map(t=>t.getValue(e))).size,sa=(e,n)=>n.length,Kn={sum:Yo,min:Xo,max:Zo,extent:Qo,mean:Jo,median:ea,unique:ta,uniqueCount:na,count:sa},ra={getDefaultColumnDef:()=>({aggregatedCell:e=>{var n,t;return(n=(t=e.getValue())==null||t.toString==null?void 0:t.toString())!=null?n:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:tt("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,n)=>{e.toggleGrouping=()=>{n.setGrouping(t=>t!=null&&t.includes(e.id)?t.filter(s=>s!==e.id):[...t??[],e.id])},e.getCanGroup=()=>{var t,s;return((t=e.columnDef.enableGrouping)!=null?t:!0)&&((s=n.options.enableGrouping)!=null?s:!0)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var t;return(t=n.getState().grouping)==null?void 0:t.includes(e.id)},e.getGroupedIndex=()=>{var t;return(t=n.getState().grouping)==null?void 0:t.indexOf(e.id)},e.getToggleGroupingHandler=()=>{const t=e.getCanGroup();return()=>{t&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{const t=n.getCoreRowModel().flatRows[0],s=t==null?void 0:t.getValue(e.id);if(typeof s=="number")return Kn.sum;if(Object.prototype.toString.call(s)==="[object Date]")return Kn.extent},e.getAggregationFn=()=>{var t,s;if(!e)throw new Error;return jn(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:e.columnDef.aggregationFn==="auto"?e.getAutoAggregationFn():(t=(s=n.options.aggregationFns)==null?void 0:s[e.columnDef.aggregationFn])!=null?t:Kn[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=n=>e.options.onGroupingChange==null?void 0:e.options.onGroupingChange(n),e.resetGrouping=n=>{var t,s;e.setGrouping(n?[]:(t=(s=e.initialState)==null?void 0:s.grouping)!=null?t:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())},createRow:(e,n)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=t=>{if(e._groupingValuesCache.hasOwnProperty(t))return e._groupingValuesCache[t];const s=n.getColumn(t);return s!=null&&s.columnDef.getGroupingValue?(e._groupingValuesCache[t]=s.columnDef.getGroupingValue(e.original),e._groupingValuesCache[t]):e.getValue(t)},e._groupingValuesCache={}},createCell:(e,n,t,s)=>{e.getIsGrouped=()=>n.getIsGrouped()&&n.id===t.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&n.getIsGrouped(),e.getIsAggregated=()=>{var o;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!((o=t.subRows)!=null&&o.length)}}};function oa(e,n,t){if(!(n!=null&&n.length)||!t)return e;const s=e.filter(a=>!n.includes(a.id));return t==="remove"?s:[...n.map(a=>e.find(l=>l.id===a)).filter(Boolean),...s]}const aa={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:tt("columnOrder",e)}),createColumn:(e,n)=>{e.getIndex=U(t=>[un(n,t)],t=>t.findIndex(s=>s.id===e.id),q(n.options,"debugColumns")),e.getIsFirstColumn=t=>{var s;return((s=un(n,t)[0])==null?void 0:s.id)===e.id},e.getIsLastColumn=t=>{var s;const o=un(n,t);return((s=o[o.length-1])==null?void 0:s.id)===e.id}},createTable:e=>{e.setColumnOrder=n=>e.options.onColumnOrderChange==null?void 0:e.options.onColumnOrderChange(n),e.resetColumnOrder=n=>{var t;e.setColumnOrder(n?[]:(t=e.initialState.columnOrder)!=null?t:[])},e._getOrderColumnsFn=U(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(n,t,s)=>o=>{let a=[];if(!(n!=null&&n.length))a=o;else{const l=[...n],i=[...o];for(;i.length&&l.length;){const u=l.shift(),c=i.findIndex(d=>d.id===u);c>-1&&a.push(i.splice(c,1)[0])}a=[...a,...i]}return oa(a,t,s)},q(e.options,"debugTable"))}},Yn=()=>({left:[],right:[]}),ia={getInitialState:e=>({columnPinning:Yn(),...e}),getDefaultOptions:e=>({onColumnPinningChange:tt("columnPinning",e)}),createColumn:(e,n)=>{e.pin=t=>{const s=e.getLeafColumns().map(o=>o.id).filter(Boolean);n.setColumnPinning(o=>{var a,l;if(t==="right"){var i,u;return{left:((i=o==null?void 0:o.left)!=null?i:[]).filter(p=>!(s!=null&&s.includes(p))),right:[...((u=o==null?void 0:o.right)!=null?u:[]).filter(p=>!(s!=null&&s.includes(p))),...s]}}if(t==="left"){var c,d;return{left:[...((c=o==null?void 0:o.left)!=null?c:[]).filter(p=>!(s!=null&&s.includes(p))),...s],right:((d=o==null?void 0:o.right)!=null?d:[]).filter(p=>!(s!=null&&s.includes(p)))}}return{left:((a=o==null?void 0:o.left)!=null?a:[]).filter(p=>!(s!=null&&s.includes(p))),right:((l=o==null?void 0:o.right)!=null?l:[]).filter(p=>!(s!=null&&s.includes(p)))}})},e.getCanPin=()=>e.getLeafColumns().some(s=>{var o,a,l;return((o=s.columnDef.enablePinning)!=null?o:!0)&&((a=(l=n.options.enableColumnPinning)!=null?l:n.options.enablePinning)!=null?a:!0)}),e.getIsPinned=()=>{const t=e.getLeafColumns().map(i=>i.id),{left:s,right:o}=n.getState().columnPinning,a=t.some(i=>s==null?void 0:s.includes(i)),l=t.some(i=>o==null?void 0:o.includes(i));return a?"left":l?"right":!1},e.getPinnedIndex=()=>{var t,s;const o=e.getIsPinned();return o?(t=(s=n.getState().columnPinning)==null||(s=s[o])==null?void 0:s.indexOf(e.id))!=null?t:-1:0}},createRow:(e,n)=>{e.getCenterVisibleCells=U(()=>[e._getAllVisibleCells(),n.getState().columnPinning.left,n.getState().columnPinning.right],(t,s,o)=>{const a=[...s??[],...o??[]];return t.filter(l=>!a.includes(l.column.id))},q(n.options,"debugRows")),e.getLeftVisibleCells=U(()=>[e._getAllVisibleCells(),n.getState().columnPinning.left],(t,s)=>(s??[]).map(a=>t.find(l=>l.column.id===a)).filter(Boolean).map(a=>({...a,position:"left"})),q(n.options,"debugRows")),e.getRightVisibleCells=U(()=>[e._getAllVisibleCells(),n.getState().columnPinning.right],(t,s)=>(s??[]).map(a=>t.find(l=>l.column.id===a)).filter(Boolean).map(a=>({...a,position:"right"})),q(n.options,"debugRows"))},createTable:e=>{e.setColumnPinning=n=>e.options.onColumnPinningChange==null?void 0:e.options.onColumnPinningChange(n),e.resetColumnPinning=n=>{var t,s;return e.setColumnPinning(n?Yn():(t=(s=e.initialState)==null?void 0:s.columnPinning)!=null?t:Yn())},e.getIsSomeColumnsPinned=n=>{var t;const s=e.getState().columnPinning;if(!n){var o,a;return!!((o=s.left)!=null&&o.length||(a=s.right)!=null&&a.length)}return!!((t=s[n])!=null&&t.length)},e.getLeftLeafColumns=U(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(n,t)=>(t??[]).map(s=>n.find(o=>o.id===s)).filter(Boolean),q(e.options,"debugColumns")),e.getRightLeafColumns=U(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(n,t)=>(t??[]).map(s=>n.find(o=>o.id===s)).filter(Boolean),q(e.options,"debugColumns")),e.getCenterLeafColumns=U(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,s)=>{const o=[...t??[],...s??[]];return n.filter(a=>!o.includes(a.id))},q(e.options,"debugColumns"))}};function la(e){return e||(typeof document<"u"?document:null)}const wn={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},Xn=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),ua={getDefaultColumnDef:()=>wn,getInitialState:e=>({columnSizing:{},columnSizingInfo:Xn(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:tt("columnSizing",e),onColumnSizingInfoChange:tt("columnSizingInfo",e)}),createColumn:(e,n)=>{e.getSize=()=>{var t,s,o;const a=n.getState().columnSizing[e.id];return Math.min(Math.max((t=e.columnDef.minSize)!=null?t:wn.minSize,(s=a??e.columnDef.size)!=null?s:wn.size),(o=e.columnDef.maxSize)!=null?o:wn.maxSize)},e.getStart=U(t=>[t,un(n,t),n.getState().columnSizing],(t,s)=>s.slice(0,e.getIndex(t)).reduce((o,a)=>o+a.getSize(),0),q(n.options,"debugColumns")),e.getAfter=U(t=>[t,un(n,t),n.getState().columnSizing],(t,s)=>s.slice(e.getIndex(t)+1).reduce((o,a)=>o+a.getSize(),0),q(n.options,"debugColumns")),e.resetSize=()=>{n.setColumnSizing(t=>{let{[e.id]:s,...o}=t;return o})},e.getCanResize=()=>{var t,s;return((t=e.columnDef.enableResizing)!=null?t:!0)&&((s=n.options.enableColumnResizing)!=null?s:!0)},e.getIsResizing=()=>n.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,n)=>{e.getSize=()=>{let t=0;const s=o=>{if(o.subHeaders.length)o.subHeaders.forEach(s);else{var a;t+=(a=o.column.getSize())!=null?a:0}};return s(e),t},e.getStart=()=>{if(e.index>0){const t=e.headerGroup.headers[e.index-1];return t.getStart()+t.getSize()}return 0},e.getResizeHandler=t=>{const s=n.getColumn(e.column.id),o=s==null?void 0:s.getCanResize();return a=>{if(!s||!o||(a.persist==null||a.persist(),Zn(a)&&a.touches&&a.touches.length>1))return;const l=e.getSize(),i=e?e.getLeafHeaders().map(h=>[h.column.id,h.column.getSize()]):[[s.id,s.getSize()]],u=Zn(a)?Math.round(a.touches[0].clientX):a.clientX,c={},d=(h,y)=>{typeof y=="number"&&(n.setColumnSizingInfo(x=>{var C,E;const N=n.options.columnResizeDirection==="rtl"?-1:1,L=(y-((C=x==null?void 0:x.startOffset)!=null?C:0))*N,A=Math.max(L/((E=x==null?void 0:x.startSize)!=null?E:0),-.999999);return x.columnSizingStart.forEach(V=>{let[Z,T]=V;c[Z]=Math.round(Math.max(T+T*A,0)*100)/100}),{...x,deltaOffset:L,deltaPercentage:A}}),(n.options.columnResizeMode==="onChange"||h==="end")&&n.setColumnSizing(x=>({...x,...c})))},p=h=>d("move",h),f=h=>{d("end",h),n.setColumnSizingInfo(y=>({...y,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},m=la(t),w={moveHandler:h=>p(h.clientX),upHandler:h=>{m==null||m.removeEventListener("mousemove",w.moveHandler),m==null||m.removeEventListener("mouseup",w.upHandler),f(h.clientX)}},_={moveHandler:h=>(h.cancelable&&(h.preventDefault(),h.stopPropagation()),p(h.touches[0].clientX),!1),upHandler:h=>{var y;m==null||m.removeEventListener("touchmove",_.moveHandler),m==null||m.removeEventListener("touchend",_.upHandler),h.cancelable&&(h.preventDefault(),h.stopPropagation()),f((y=h.touches[0])==null?void 0:y.clientX)}},S=da()?{passive:!1}:!1;Zn(a)?(m==null||m.addEventListener("touchmove",_.moveHandler,S),m==null||m.addEventListener("touchend",_.upHandler,S)):(m==null||m.addEventListener("mousemove",w.moveHandler,S),m==null||m.addEventListener("mouseup",w.upHandler,S)),n.setColumnSizingInfo(h=>({...h,startOffset:u,startSize:l,deltaOffset:0,deltaPercentage:0,columnSizingStart:i,isResizingColumn:s.id}))}}},createTable:e=>{e.setColumnSizing=n=>e.options.onColumnSizingChange==null?void 0:e.options.onColumnSizingChange(n),e.setColumnSizingInfo=n=>e.options.onColumnSizingInfoChange==null?void 0:e.options.onColumnSizingInfoChange(n),e.resetColumnSizing=n=>{var t;e.setColumnSizing(n?{}:(t=e.initialState.columnSizing)!=null?t:{})},e.resetHeaderSizeInfo=n=>{var t;e.setColumnSizingInfo(n?Xn():(t=e.initialState.columnSizingInfo)!=null?t:Xn())},e.getTotalSize=()=>{var n,t;return(n=(t=e.getHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0},e.getLeftTotalSize=()=>{var n,t;return(n=(t=e.getLeftHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0},e.getCenterTotalSize=()=>{var n,t;return(n=(t=e.getCenterHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0},e.getRightTotalSize=()=>{var n,t;return(n=(t=e.getRightHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0}}};let _n=null;function da(){if(typeof _n=="boolean")return _n;let e=!1;try{const n={get passive(){return e=!0,!1}},t=()=>{};window.addEventListener("test",t,n),window.removeEventListener("test",t)}catch{e=!1}return _n=e,_n}function Zn(e){return e.type==="touchstart"}const ca={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:tt("columnVisibility",e)}),createColumn:(e,n)=>{e.toggleVisibility=t=>{e.getCanHide()&&n.setColumnVisibility(s=>({...s,[e.id]:t??!e.getIsVisible()}))},e.getIsVisible=()=>{var t,s;const o=e.columns;return(t=o.length?o.some(a=>a.getIsVisible()):(s=n.getState().columnVisibility)==null?void 0:s[e.id])!=null?t:!0},e.getCanHide=()=>{var t,s;return((t=e.columnDef.enableHiding)!=null?t:!0)&&((s=n.options.enableHiding)!=null?s:!0)},e.getToggleVisibilityHandler=()=>t=>{e.toggleVisibility==null||e.toggleVisibility(t.target.checked)}},createRow:(e,n)=>{e._getAllVisibleCells=U(()=>[e.getAllCells(),n.getState().columnVisibility],t=>t.filter(s=>s.column.getIsVisible()),q(n.options,"debugRows")),e.getVisibleCells=U(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(t,s,o)=>[...t,...s,...o],q(n.options,"debugRows"))},createTable:e=>{const n=(t,s)=>U(()=>[s(),s().filter(o=>o.getIsVisible()).map(o=>o.id).join("_")],o=>o.filter(a=>a.getIsVisible==null?void 0:a.getIsVisible()),q(e.options,"debugColumns"));e.getVisibleFlatColumns=n("getVisibleFlatColumns",()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=n("getVisibleLeafColumns",()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=n("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=n("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=n("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),e.setColumnVisibility=t=>e.options.onColumnVisibilityChange==null?void 0:e.options.onColumnVisibilityChange(t),e.resetColumnVisibility=t=>{var s;e.setColumnVisibility(t?{}:(s=e.initialState.columnVisibility)!=null?s:{})},e.toggleAllColumnsVisible=t=>{var s;t=(s=t)!=null?s:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((o,a)=>({...o,[a.id]:t||!(a.getCanHide!=null&&a.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(t=>!(t.getIsVisible!=null&&t.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(t=>t.getIsVisible==null?void 0:t.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>t=>{var s;e.toggleAllColumnsVisible((s=t.target)==null?void 0:s.checked)}}};function un(e,n){return n?n==="center"?e.getCenterVisibleLeafColumns():n==="left"?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}const ga={createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},ma={getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:tt("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:n=>{var t;const s=(t=e.getCoreRowModel().flatRows[0])==null||(t=t._getAllCellsByColumnId()[n.id])==null?void 0:t.getValue();return typeof s=="string"||typeof s=="number"}}),createColumn:(e,n)=>{e.getCanGlobalFilter=()=>{var t,s,o,a;return((t=e.columnDef.enableGlobalFilter)!=null?t:!0)&&((s=n.options.enableGlobalFilter)!=null?s:!0)&&((o=n.options.enableFilters)!=null?o:!0)&&((a=n.options.getColumnCanGlobalFilter==null?void 0:n.options.getColumnCanGlobalFilter(e))!=null?a:!0)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>yt.includesString,e.getGlobalFilterFn=()=>{var n,t;const{globalFilterFn:s}=e.options;return jn(s)?s:s==="auto"?e.getGlobalAutoFilterFn():(n=(t=e.options.filterFns)==null?void 0:t[s])!=null?n:yt[s]},e.setGlobalFilter=n=>{e.options.onGlobalFilterChange==null||e.options.onGlobalFilterChange(n)},e.resetGlobalFilter=n=>{e.setGlobalFilter(n?void 0:e.initialState.globalFilter)}}},fa={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:tt("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let n=!1,t=!1;e._autoResetExpanded=()=>{var s,o;if(!n){e._queue(()=>{n=!0});return}if((s=(o=e.options.autoResetAll)!=null?o:e.options.autoResetExpanded)!=null?s:!e.options.manualExpanding){if(t)return;t=!0,e._queue(()=>{e.resetExpanded(),t=!1})}},e.setExpanded=s=>e.options.onExpandedChange==null?void 0:e.options.onExpandedChange(s),e.toggleAllRowsExpanded=s=>{s??!e.getIsAllRowsExpanded()?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=s=>{var o,a;e.setExpanded(s?{}:(o=(a=e.initialState)==null?void 0:a.expanded)!=null?o:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(s=>s.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>s=>{s.persist==null||s.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{const s=e.getState().expanded;return s===!0||Object.values(s).some(Boolean)},e.getIsAllRowsExpanded=()=>{const s=e.getState().expanded;return typeof s=="boolean"?s===!0:!(!Object.keys(s).length||e.getRowModel().flatRows.some(o=>!o.getIsExpanded()))},e.getExpandedDepth=()=>{let s=0;return(e.getState().expanded===!0?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(a=>{const l=a.split(".");s=Math.max(s,l.length)}),s},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())},createRow:(e,n)=>{e.toggleExpanded=t=>{n.setExpanded(s=>{var o;const a=s===!0?!0:!!(s!=null&&s[e.id]);let l={};if(s===!0?Object.keys(n.getRowModel().rowsById).forEach(i=>{l[i]=!0}):l=s,t=(o=t)!=null?o:!a,!a&&t)return{...l,[e.id]:!0};if(a&&!t){const{[e.id]:i,...u}=l;return u}return s})},e.getIsExpanded=()=>{var t;const s=n.getState().expanded;return!!((t=n.options.getIsRowExpanded==null?void 0:n.options.getIsRowExpanded(e))!=null?t:s===!0||s!=null&&s[e.id])},e.getCanExpand=()=>{var t,s,o;return(t=n.options.getRowCanExpand==null?void 0:n.options.getRowCanExpand(e))!=null?t:((s=n.options.enableExpanding)!=null?s:!0)&&!!((o=e.subRows)!=null&&o.length)},e.getIsAllParentsExpanded=()=>{let t=!0,s=e;for(;t&&s.parentId;)s=n.getRow(s.parentId,!0),t=s.getIsExpanded();return t},e.getToggleExpandedHandler=()=>{const t=e.getCanExpand();return()=>{t&&e.toggleExpanded()}}}},as=0,is=10,Qn=()=>({pageIndex:as,pageSize:is}),pa={getInitialState:e=>({...e,pagination:{...Qn(),...e==null?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:tt("pagination",e)}),createTable:e=>{let n=!1,t=!1;e._autoResetPageIndex=()=>{var s,o;if(!n){e._queue(()=>{n=!0});return}if((s=(o=e.options.autoResetAll)!=null?o:e.options.autoResetPageIndex)!=null?s:!e.options.manualPagination){if(t)return;t=!0,e._queue(()=>{e.resetPageIndex(),t=!1})}},e.setPagination=s=>{const o=a=>Rt(s,a);return e.options.onPaginationChange==null?void 0:e.options.onPaginationChange(o)},e.resetPagination=s=>{var o;e.setPagination(s?Qn():(o=e.initialState.pagination)!=null?o:Qn())},e.setPageIndex=s=>{e.setPagination(o=>{let a=Rt(s,o.pageIndex);const l=typeof e.options.pageCount>"u"||e.options.pageCount===-1?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return a=Math.max(0,Math.min(a,l)),{...o,pageIndex:a}})},e.resetPageIndex=s=>{var o,a;e.setPageIndex(s?as:(o=(a=e.initialState)==null||(a=a.pagination)==null?void 0:a.pageIndex)!=null?o:as)},e.resetPageSize=s=>{var o,a;e.setPageSize(s?is:(o=(a=e.initialState)==null||(a=a.pagination)==null?void 0:a.pageSize)!=null?o:is)},e.setPageSize=s=>{e.setPagination(o=>{const a=Math.max(1,Rt(s,o.pageSize)),l=o.pageSize*o.pageIndex,i=Math.floor(l/a);return{...o,pageIndex:i,pageSize:a}})},e.setPageCount=s=>e.setPagination(o=>{var a;let l=Rt(s,(a=e.options.pageCount)!=null?a:-1);return typeof l=="number"&&(l=Math.max(-1,l)),{...o,pageCount:l}}),e.getPageOptions=U(()=>[e.getPageCount()],s=>{let o=[];return s&&s>0&&(o=[...new Array(s)].fill(null).map((a,l)=>l)),o},q(e.options,"debugTable")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{const{pageIndex:s}=e.getState().pagination,o=e.getPageCount();return o===-1?!0:o===0?!1:s<o-1},e.previousPage=()=>e.setPageIndex(s=>s-1),e.nextPage=()=>e.setPageIndex(s=>s+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),e.getPageCount=()=>{var s;return(s=e.options.pageCount)!=null?s:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var s;return(s=e.options.rowCount)!=null?s:e.getPrePaginationRowModel().rows.length}}},Jn=()=>({top:[],bottom:[]}),ha={getInitialState:e=>({rowPinning:Jn(),...e}),getDefaultOptions:e=>({onRowPinningChange:tt("rowPinning",e)}),createRow:(e,n)=>{e.pin=(t,s,o)=>{const a=s?e.getLeafRows().map(u=>{let{id:c}=u;return c}):[],l=o?e.getParentRows().map(u=>{let{id:c}=u;return c}):[],i=new Set([...l,e.id,...a]);n.setRowPinning(u=>{var c,d;if(t==="bottom"){var p,f;return{top:((p=u==null?void 0:u.top)!=null?p:[]).filter(_=>!(i!=null&&i.has(_))),bottom:[...((f=u==null?void 0:u.bottom)!=null?f:[]).filter(_=>!(i!=null&&i.has(_))),...Array.from(i)]}}if(t==="top"){var m,w;return{top:[...((m=u==null?void 0:u.top)!=null?m:[]).filter(_=>!(i!=null&&i.has(_))),...Array.from(i)],bottom:((w=u==null?void 0:u.bottom)!=null?w:[]).filter(_=>!(i!=null&&i.has(_)))}}return{top:((c=u==null?void 0:u.top)!=null?c:[]).filter(_=>!(i!=null&&i.has(_))),bottom:((d=u==null?void 0:u.bottom)!=null?d:[]).filter(_=>!(i!=null&&i.has(_)))}})},e.getCanPin=()=>{var t;const{enableRowPinning:s,enablePinning:o}=n.options;return typeof s=="function"?s(e):(t=s??o)!=null?t:!0},e.getIsPinned=()=>{const t=[e.id],{top:s,bottom:o}=n.getState().rowPinning,a=t.some(i=>s==null?void 0:s.includes(i)),l=t.some(i=>o==null?void 0:o.includes(i));return a?"top":l?"bottom":!1},e.getPinnedIndex=()=>{var t,s;const o=e.getIsPinned();if(!o)return-1;const a=(t=o==="top"?n.getTopRows():n.getBottomRows())==null?void 0:t.map(l=>{let{id:i}=l;return i});return(s=a==null?void 0:a.indexOf(e.id))!=null?s:-1}},createTable:e=>{e.setRowPinning=n=>e.options.onRowPinningChange==null?void 0:e.options.onRowPinningChange(n),e.resetRowPinning=n=>{var t,s;return e.setRowPinning(n?Jn():(t=(s=e.initialState)==null?void 0:s.rowPinning)!=null?t:Jn())},e.getIsSomeRowsPinned=n=>{var t;const s=e.getState().rowPinning;if(!n){var o,a;return!!((o=s.top)!=null&&o.length||(a=s.bottom)!=null&&a.length)}return!!((t=s[n])!=null&&t.length)},e._getPinnedRows=(n,t,s)=>{var o;return((o=e.options.keepPinnedRows)==null||o?(t??[]).map(l=>{const i=e.getRow(l,!0);return i.getIsAllParentsExpanded()?i:null}):(t??[]).map(l=>n.find(i=>i.id===l))).filter(Boolean).map(l=>({...l,position:s}))},e.getTopRows=U(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(n,t)=>e._getPinnedRows(n,t,"top"),q(e.options,"debugRows")),e.getBottomRows=U(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(n,t)=>e._getPinnedRows(n,t,"bottom"),q(e.options,"debugRows")),e.getCenterRows=U(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(n,t,s)=>{const o=new Set([...t??[],...s??[]]);return n.filter(a=>!o.has(a.id))},q(e.options,"debugRows"))}},xa={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:tt("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=n=>e.options.onRowSelectionChange==null?void 0:e.options.onRowSelectionChange(n),e.resetRowSelection=n=>{var t;return e.setRowSelection(n?{}:(t=e.initialState.rowSelection)!=null?t:{})},e.toggleAllRowsSelected=n=>{e.setRowSelection(t=>{n=typeof n<"u"?n:!e.getIsAllRowsSelected();const s={...t},o=e.getPreGroupedRowModel().flatRows;return n?o.forEach(a=>{a.getCanSelect()&&(s[a.id]=!0)}):o.forEach(a=>{delete s[a.id]}),s})},e.toggleAllPageRowsSelected=n=>e.setRowSelection(t=>{const s=typeof n<"u"?n:!e.getIsAllPageRowsSelected(),o={...t};return e.getRowModel().rows.forEach(a=>{ls(o,a.id,s,!0,e)}),o}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=U(()=>[e.getState().rowSelection,e.getCoreRowModel()],(n,t)=>Object.keys(n).length?es(e,t):{rows:[],flatRows:[],rowsById:{}},q(e.options,"debugTable")),e.getFilteredSelectedRowModel=U(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(n,t)=>Object.keys(n).length?es(e,t):{rows:[],flatRows:[],rowsById:{}},q(e.options,"debugTable")),e.getGroupedSelectedRowModel=U(()=>[e.getState().rowSelection,e.getSortedRowModel()],(n,t)=>Object.keys(n).length?es(e,t):{rows:[],flatRows:[],rowsById:{}},q(e.options,"debugTable")),e.getIsAllRowsSelected=()=>{const n=e.getFilteredRowModel().flatRows,{rowSelection:t}=e.getState();let s=!!(n.length&&Object.keys(t).length);return s&&n.some(o=>o.getCanSelect()&&!t[o.id])&&(s=!1),s},e.getIsAllPageRowsSelected=()=>{const n=e.getPaginationRowModel().flatRows.filter(o=>o.getCanSelect()),{rowSelection:t}=e.getState();let s=!!n.length;return s&&n.some(o=>!t[o.id])&&(s=!1),s},e.getIsSomeRowsSelected=()=>{var n;const t=Object.keys((n=e.getState().rowSelection)!=null?n:{}).length;return t>0&&t<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{const n=e.getPaginationRowModel().flatRows;return e.getIsAllPageRowsSelected()?!1:n.filter(t=>t.getCanSelect()).some(t=>t.getIsSelected()||t.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>n=>{e.toggleAllRowsSelected(n.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>n=>{e.toggleAllPageRowsSelected(n.target.checked)}},createRow:(e,n)=>{e.toggleSelected=(t,s)=>{const o=e.getIsSelected();n.setRowSelection(a=>{var l;if(t=typeof t<"u"?t:!o,e.getCanSelect()&&o===t)return a;const i={...a};return ls(i,e.id,t,(l=s==null?void 0:s.selectChildren)!=null?l:!0,n),i})},e.getIsSelected=()=>{const{rowSelection:t}=n.getState();return ps(e,t)},e.getIsSomeSelected=()=>{const{rowSelection:t}=n.getState();return us(e,t)==="some"},e.getIsAllSubRowsSelected=()=>{const{rowSelection:t}=n.getState();return us(e,t)==="all"},e.getCanSelect=()=>{var t;return typeof n.options.enableRowSelection=="function"?n.options.enableRowSelection(e):(t=n.options.enableRowSelection)!=null?t:!0},e.getCanSelectSubRows=()=>{var t;return typeof n.options.enableSubRowSelection=="function"?n.options.enableSubRowSelection(e):(t=n.options.enableSubRowSelection)!=null?t:!0},e.getCanMultiSelect=()=>{var t;return typeof n.options.enableMultiRowSelection=="function"?n.options.enableMultiRowSelection(e):(t=n.options.enableMultiRowSelection)!=null?t:!0},e.getToggleSelectedHandler=()=>{const t=e.getCanSelect();return s=>{var o;t&&e.toggleSelected((o=s.target)==null?void 0:o.checked)}}}},ls=(e,n,t,s,o)=>{var a;const l=o.getRow(n,!0);t?(l.getCanMultiSelect()||Object.keys(e).forEach(i=>delete e[i]),l.getCanSelect()&&(e[n]=!0)):delete e[n],s&&(a=l.subRows)!=null&&a.length&&l.getCanSelectSubRows()&&l.subRows.forEach(i=>ls(e,i.id,t,s,o))};function es(e,n){const t=e.getState().rowSelection,s=[],o={},a=function(l,i){return l.map(u=>{var c;const d=ps(u,t);if(d&&(s.push(u),o[u.id]=u),(c=u.subRows)!=null&&c.length&&(u={...u,subRows:a(u.subRows)}),d)return u}).filter(Boolean)};return{rows:a(n.rows),flatRows:s,rowsById:o}}function ps(e,n){var t;return(t=n[e.id])!=null?t:!1}function us(e,n,t){var s;if(!((s=e.subRows)!=null&&s.length))return!1;let o=!0,a=!1;return e.subRows.forEach(l=>{if(!(a&&!o)&&(l.getCanSelect()&&(ps(l,n)?a=!0:o=!1),l.subRows&&l.subRows.length)){const i=us(l,n);i==="all"?a=!0:(i==="some"&&(a=!0),o=!1)}}),o?"all":a?"some":!1}const ds=/([0-9]+)/gm,va=(e,n,t)=>pr(Ft(e.getValue(t)).toLowerCase(),Ft(n.getValue(t)).toLowerCase()),ya=(e,n,t)=>pr(Ft(e.getValue(t)),Ft(n.getValue(t))),ba=(e,n,t)=>hs(Ft(e.getValue(t)).toLowerCase(),Ft(n.getValue(t)).toLowerCase()),Sa=(e,n,t)=>hs(Ft(e.getValue(t)),Ft(n.getValue(t))),wa=(e,n,t)=>{const s=e.getValue(t),o=n.getValue(t);return s>o?1:s<o?-1:0},_a=(e,n,t)=>hs(e.getValue(t),n.getValue(t));function hs(e,n){return e===n?0:e>n?1:-1}function Ft(e){return typeof e=="number"?isNaN(e)||e===1/0||e===-1/0?"":String(e):typeof e=="string"?e:""}function pr(e,n){const t=e.split(ds).filter(Boolean),s=n.split(ds).filter(Boolean);for(;t.length&&s.length;){const o=t.shift(),a=s.shift(),l=parseInt(o,10),i=parseInt(a,10),u=[l,i].sort();if(isNaN(u[0])){if(o>a)return 1;if(a>o)return-1;continue}if(isNaN(u[1]))return isNaN(l)?-1:1;if(l>i)return 1;if(i>l)return-1}return t.length-s.length}const on={alphanumeric:va,alphanumericCaseSensitive:ya,text:ba,textCaseSensitive:Sa,datetime:wa,basic:_a},Ca={getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:tt("sorting",e),isMultiSortEvent:n=>n.shiftKey}),createColumn:(e,n)=>{e.getAutoSortingFn=()=>{const t=n.getFilteredRowModel().flatRows.slice(10);let s=!1;for(const o of t){const a=o==null?void 0:o.getValue(e.id);if(Object.prototype.toString.call(a)==="[object Date]")return on.datetime;if(typeof a=="string"&&(s=!0,a.split(ds).length>1))return on.alphanumeric}return s?on.text:on.basic},e.getAutoSortDir=()=>{const t=n.getFilteredRowModel().flatRows[0];return typeof(t==null?void 0:t.getValue(e.id))=="string"?"asc":"desc"},e.getSortingFn=()=>{var t,s;if(!e)throw new Error;return jn(e.columnDef.sortingFn)?e.columnDef.sortingFn:e.columnDef.sortingFn==="auto"?e.getAutoSortingFn():(t=(s=n.options.sortingFns)==null?void 0:s[e.columnDef.sortingFn])!=null?t:on[e.columnDef.sortingFn]},e.toggleSorting=(t,s)=>{const o=e.getNextSortingOrder(),a=typeof t<"u"&&t!==null;n.setSorting(l=>{const i=l==null?void 0:l.find(m=>m.id===e.id),u=l==null?void 0:l.findIndex(m=>m.id===e.id);let c=[],d,p=a?t:o==="desc";if(l!=null&&l.length&&e.getCanMultiSort()&&s?i?d="toggle":d="add":l!=null&&l.length&&u!==l.length-1?d="replace":i?d="toggle":d="replace",d==="toggle"&&(a||o||(d="remove")),d==="add"){var f;c=[...l,{id:e.id,desc:p}],c.splice(0,c.length-((f=n.options.maxMultiSortColCount)!=null?f:Number.MAX_SAFE_INTEGER))}else d==="toggle"?c=l.map(m=>m.id===e.id?{...m,desc:p}:m):d==="remove"?c=l.filter(m=>m.id!==e.id):c=[{id:e.id,desc:p}];return c})},e.getFirstSortDir=()=>{var t,s;return((t=(s=e.columnDef.sortDescFirst)!=null?s:n.options.sortDescFirst)!=null?t:e.getAutoSortDir()==="desc")?"desc":"asc"},e.getNextSortingOrder=t=>{var s,o;const a=e.getFirstSortDir(),l=e.getIsSorted();return l?l!==a&&((s=n.options.enableSortingRemoval)==null||s)&&(!(t&&(o=n.options.enableMultiRemove)!=null)||o)?!1:l==="desc"?"asc":"desc":a},e.getCanSort=()=>{var t,s;return((t=e.columnDef.enableSorting)!=null?t:!0)&&((s=n.options.enableSorting)!=null?s:!0)&&!!e.accessorFn},e.getCanMultiSort=()=>{var t,s;return(t=(s=e.columnDef.enableMultiSort)!=null?s:n.options.enableMultiSort)!=null?t:!!e.accessorFn},e.getIsSorted=()=>{var t;const s=(t=n.getState().sorting)==null?void 0:t.find(o=>o.id===e.id);return s?s.desc?"desc":"asc":!1},e.getSortIndex=()=>{var t,s;return(t=(s=n.getState().sorting)==null?void 0:s.findIndex(o=>o.id===e.id))!=null?t:-1},e.clearSorting=()=>{n.setSorting(t=>t!=null&&t.length?t.filter(s=>s.id!==e.id):[])},e.getToggleSortingHandler=()=>{const t=e.getCanSort();return s=>{t&&(s.persist==null||s.persist(),e.toggleSorting==null||e.toggleSorting(void 0,e.getCanMultiSort()?n.options.isMultiSortEvent==null?void 0:n.options.isMultiSortEvent(s):!1))}}},createTable:e=>{e.setSorting=n=>e.options.onSortingChange==null?void 0:e.options.onSortingChange(n),e.resetSorting=n=>{var t,s;e.setSorting(n?[]:(t=(s=e.initialState)==null?void 0:s.sorting)!=null?t:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())}},Na=[Uo,ca,aa,ia,Wo,Ko,ga,ma,Ca,ra,fa,pa,ha,xa,ua];function ja(e){var n,t;const s=[...Na,...(n=e._features)!=null?n:[]];let o={_features:s};const a=o._features.reduce((f,m)=>Object.assign(f,m.getDefaultOptions==null?void 0:m.getDefaultOptions(o)),{}),l=f=>o.options.mergeOptions?o.options.mergeOptions(a,f):{...a,...f};let u={...{},...(t=e.initialState)!=null?t:{}};o._features.forEach(f=>{var m;u=(m=f.getInitialState==null?void 0:f.getInitialState(u))!=null?m:u});const c=[];let d=!1;const p={_features:s,options:{...a,...e},initialState:u,_queue:f=>{c.push(f),d||(d=!0,Promise.resolve().then(()=>{for(;c.length;)c.shift()();d=!1}).catch(m=>setTimeout(()=>{throw m})))},reset:()=>{o.setState(o.initialState)},setOptions:f=>{const m=Rt(f,o.options);o.options=l(m)},getState:()=>o.options.state,setState:f=>{o.options.onStateChange==null||o.options.onStateChange(f)},_getRowId:(f,m,w)=>{var _;return(_=o.options.getRowId==null?void 0:o.options.getRowId(f,m,w))!=null?_:`${w?[w.id,m].join("."):m}`},getCoreRowModel:()=>(o._getCoreRowModel||(o._getCoreRowModel=o.options.getCoreRowModel(o)),o._getCoreRowModel()),getRowModel:()=>o.getPaginationRowModel(),getRow:(f,m)=>{let w=(m?o.getPrePaginationRowModel():o.getRowModel()).rowsById[f];if(!w&&(w=o.getCoreRowModel().rowsById[f],!w))throw new Error;return w},_getDefaultColumnDef:U(()=>[o.options.defaultColumn],f=>{var m;return f=(m=f)!=null?m:{},{header:w=>{const _=w.header.column.columnDef;return _.accessorKey?_.accessorKey:_.accessorFn?_.id:null},cell:w=>{var _,S;return(_=(S=w.renderValue())==null||S.toString==null?void 0:S.toString())!=null?_:null},...o._features.reduce((w,_)=>Object.assign(w,_.getDefaultColumnDef==null?void 0:_.getDefaultColumnDef()),{}),...f}},q(e,"debugColumns")),_getColumnDefs:()=>o.options.columns,getAllColumns:U(()=>[o._getColumnDefs()],f=>{const m=function(w,_,S){return S===void 0&&(S=0),w.map(h=>{const y=Bo(o,h,S,_),x=h;return y.columns=x.columns?m(x.columns,y,S+1):[],y})};return m(f)},q(e,"debugColumns")),getAllFlatColumns:U(()=>[o.getAllColumns()],f=>f.flatMap(m=>m.getFlatColumns()),q(e,"debugColumns")),_getAllFlatColumnsById:U(()=>[o.getAllFlatColumns()],f=>f.reduce((m,w)=>(m[w.id]=w,m),{}),q(e,"debugColumns")),getAllLeafColumns:U(()=>[o.getAllColumns(),o._getOrderColumnsFn()],(f,m)=>{let w=f.flatMap(_=>_.getLeafColumns());return m(w)},q(e,"debugColumns")),getColumn:f=>o._getAllFlatColumnsById()[f]};Object.assign(o,p);for(let f=0;f<o._features.length;f++){const m=o._features[f];m==null||m.createTable==null||m.createTable(o)}return o}function qs(){return e=>U(()=>[e.options.data],n=>{const t={rows:[],flatRows:[],rowsById:{}},s=function(o,a,l){a===void 0&&(a=0);const i=[];for(let c=0;c<o.length;c++){const d=qo(e,e._getRowId(o[c],c,l),o[c],c,a,void 0,l==null?void 0:l.id);if(t.flatRows.push(d),t.rowsById[d.id]=d,i.push(d),e.options.getSubRows){var u;d.originalSubRows=e.options.getSubRows(o[c],c),(u=d.originalSubRows)!=null&&u.length&&(d.subRows=s(d.originalSubRows,a+1,d))}}return i};return t.rows=s(n),t},q(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))}function Ma(e){const n=[],t=s=>{var o;n.push(s),(o=s.subRows)!=null&&o.length&&s.getIsExpanded()&&s.subRows.forEach(t)};return e.rows.forEach(t),{rows:n,flatRows:e.flatRows,rowsById:e.rowsById}}function Ws(e){return n=>U(()=>[n.getState().pagination,n.getPrePaginationRowModel(),n.options.paginateExpandedRows?void 0:n.getState().expanded],(t,s)=>{if(!s.rows.length)return s;const{pageSize:o,pageIndex:a}=t;let{rows:l,flatRows:i,rowsById:u}=s;const c=o*a,d=c+o;l=l.slice(c,d);let p;n.options.paginateExpandedRows?p={rows:l,flatRows:i,rowsById:u}:p=Ma({rows:l,flatRows:i,rowsById:u}),p.flatRows=[];const f=m=>{p.flatRows.push(m),m.subRows.length&&m.subRows.forEach(f)};return p.rows.forEach(f),p},q(n.options,"debugTable"))}function Ks(){return e=>U(()=>[e.getState().sorting,e.getPreSortedRowModel()],(n,t)=>{if(!t.rows.length||!(n!=null&&n.length))return t;const s=e.getState().sorting,o=[],a=s.filter(u=>{var c;return(c=e.getColumn(u.id))==null?void 0:c.getCanSort()}),l={};a.forEach(u=>{const c=e.getColumn(u.id);c&&(l[u.id]={sortUndefined:c.columnDef.sortUndefined,invertSorting:c.columnDef.invertSorting,sortingFn:c.getSortingFn()})});const i=u=>{const c=u.map(d=>({...d}));return c.sort((d,p)=>{for(let m=0;m<a.length;m+=1){var f;const w=a[m],_=l[w.id],S=_.sortUndefined,h=(f=w==null?void 0:w.desc)!=null?f:!1;let y=0;if(S){const x=d.getValue(w.id),C=p.getValue(w.id),E=x===void 0,N=C===void 0;if(E||N){if(S==="first")return E?-1:1;if(S==="last")return E?1:-1;y=E&&N?0:E?S:-S}}if(y===0&&(y=_.sortingFn(d,p,w.id)),y!==0)return h&&(y*=-1),_.invertSorting&&(y*=-1),y}return d.index-p.index}),c.forEach(d=>{var p;o.push(d),(p=d.subRows)!=null&&p.length&&(d.subRows=i(d.subRows))}),c};return{rows:i(t.rows),flatRows:o,rowsById:t.rowsById}},q(e.options,"debugTable","getSortedRowModel",()=>e._autoResetPageIndex()))}/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function Ys(e,n){return e?Ra(e)?v.createElement(e,n):e:null}function Ra(e){return Fa(e)||typeof e=="function"||Ea(e)}function Fa(e){return typeof e=="function"&&(()=>{const n=Object.getPrototypeOf(e);return n.prototype&&n.prototype.isReactComponent})()}function Ea(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function Xs(e){const n={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[t]=v.useState(()=>({current:ja(n)})),[s,o]=v.useState(()=>t.current.initialState);return t.current.setOptions(a=>({...a,...e,state:{...s,...e.state},onStateChange:l=>{o(l),e.onStateChange==null||e.onStateChange(l)}})),t.current}function hr({nodes:e,edges:n,onNodesChange:t,onEdgesChange:s,onBlur:o,editable:a=!1}){const[l,i]=v.useState("nodes"),[u,c]=v.useState(e),[d,p]=v.useState(n),f=v.useRef(new Map),m=v.useRef(new Map);v.useEffect(()=>{c([...e]),p([...n]),f.current.clear(),m.current.clear()},[e,n]);const w=v.useMemo(()=>{if(e.length===0)return[];const x=new Set;e.forEach(N=>{Object.keys(N).forEach(L=>{L==="_totalIncoming"||L==="_totalOutgoing"||x.add(L)})});const C=Array.from(x);return[...C.includes("id")?["id"]:[],...C.includes("label")?["label"]:[],...C.filter(N=>N!=="id"&&N!=="label")].map(N=>({header:N.charAt(0).toUpperCase()+N.slice(1).replace(/_/g," "),accessorKey:N,cell:L=>{var V;const A=L.getValue();if(a&&N!=="id"){const T=L.row.original.id,te=u.findIndex(Q=>Q.id===T);if(te===-1)return r.jsx("span",{children:"-"});const F=((V=u[te])==null?void 0:V[N])??A,W=`${T}-${N}`;return r.jsx(ts,{id:W,type:typeof F=="number"?"number":"text",initialValue:F==null?"":String(F),isNumber:typeof F=="number",onBlur:Q=>{const he=[...u],ne=typeof F=="number"?parseFloat(Q)||0:Q;he[te]={...he[te],[N]:ne},c(he),t==null||t(he),o==null||o()}},W)}return A==null?"-":typeof A=="number"?A.toLocaleString():String(A)}}))},[e,a]),_=v.useMemo(()=>{if(n.length===0)return[];const x=new Set;n.forEach(N=>{Object.keys(N).forEach(L=>x.add(L))});const C=Array.from(x);return[...C.includes("source")?["source"]:[],...C.includes("target")?["target"]:[],...C.includes("value")?["value"]:[],...C.filter(N=>N!=="source"&&N!=="target"&&N!=="value")].map(N=>({header:N.charAt(0).toUpperCase()+N.slice(1).replace(/_/g," "),accessorKey:N,cell:L=>{var V,Z;const A=L.getValue();if(a&&N!=="source"&&N!=="target"){const T=L.row.original,te=d.findIndex(Q=>Q.source===T.source&&Q.target===T.target&&Q.value===T.value);if(te===-1){const Q=d.findIndex(be=>be.source===T.source&&be.target===T.target);if(Q===-1)return r.jsx("span",{children:"-"});const he=((V=d[Q])==null?void 0:V[N])??A,ne=`${T.source}-${T.target}-${N}-fallback`;return r.jsx(ts,{id:ne,type:typeof he=="number"?"number":"text",initialValue:he==null?"":String(he),isNumber:typeof he=="number",onBlur:be=>{const Fe=[...d],j=typeof he=="number"?parseFloat(be)||0:be;Fe[Q]={...Fe[Q],[N]:j},p(Fe),s==null||s(Fe),o==null||o()}},ne)}const F=((Z=d[te])==null?void 0:Z[N])??A,W=`${T.source}-${T.target}-${N}`;return r.jsx(ts,{id:W,type:typeof F=="number"?"number":"text",initialValue:F==null?"":String(F),isNumber:typeof F=="number",onBlur:Q=>{const he=[...d],ne=typeof F=="number"?parseFloat(Q)||0:Q;he[te]={...he[te],[N]:ne},p(he),s==null||s(he),o==null||o()}},W)}return A==null?"-":typeof A=="number"?A.toLocaleString():String(A)}}))},[n,a]),S=Xs({data:a?u:e,columns:w,getCoreRowModel:qs(),getSortedRowModel:Ks(),getPaginationRowModel:Ws(),initialState:{pagination:{pageSize:25}}}),h=Xs({data:a?d:n,columns:_,getCoreRowModel:qs(),getSortedRowModel:Ks(),getPaginationRowModel:Ws(),initialState:{pagination:{pageSize:25}}}),y=l==="nodes"?S:h;return r.jsxs("div",{className:"h-full w-full flex flex-col",style:{height:"100%",maxHeight:"100%"},children:[r.jsxs("div",{className:"flex border-b mb-4 flex-shrink-0",children:[r.jsxs("button",{onClick:()=>i("nodes"),className:`px-4 py-2 font-medium text-sm transition-colors ${l==="nodes"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Nodes (",e.length,")"]}),r.jsxs("button",{onClick:()=>i("edges"),className:`px-4 py-2 font-medium text-sm transition-colors ${l==="edges"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Edges (",n.length,")"]})]}),r.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:r.jsxs("div",{className:"overflow-auto flex-1 min-h-0",children:[r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 border-b sticky top-0 z-10",children:y.getHeaderGroups().map(x=>r.jsx("tr",{children:x.headers.map(C=>r.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700 bg-gray-50",children:C.isPlaceholder?null:r.jsxs("div",{className:C.column.getCanSort()?"cursor-pointer select-none hover:text-blue-600":"",onClick:C.column.getToggleSortingHandler(),children:[Ys(C.column.columnDef.header,C.getContext()),{asc:" ↑",desc:" ↓"}[C.column.getIsSorted()]??null]})},C.id))},x.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:y.getRowModel().rows.map(x=>r.jsx("tr",{className:"hover:bg-gray-50",children:x.getVisibleCells().map(C=>r.jsx("td",{className:"px-4 py-2",children:Ys(C.column.columnDef.cell,C.getContext())},C.id))},x.id))})]}),y.getRowModel().rows.length===0&&r.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No ",l," to display"]})]})}),r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-white flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-700",children:"Show"}),r.jsx("select",{value:y.getState().pagination.pageSize,onChange:x=>{y.setPageSize(Number(x.target.value))},className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[10,25,50,100].map(x=>r.jsx("option",{value:x,children:x},x))}),r.jsx("span",{className:"text-sm text-gray-700",children:"entries"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",y.getState().pagination.pageIndex+1," of"," ",y.getPageCount()]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>y.setPageIndex(0),disabled:!y.getCanPreviousPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"<<"}),r.jsx("button",{onClick:()=>y.previousPage(),disabled:!y.getCanPreviousPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"<"}),r.jsx("button",{onClick:()=>y.nextPage(),disabled:!y.getCanNextPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:">"}),r.jsx("button",{onClick:()=>y.setPageIndex(y.getPageCount()-1),disabled:!y.getCanNextPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:">>"})]})]})]})]})}function ts({id:e,type:n,initialValue:t,onBlur:s}){const o=v.useRef(null),[a,l]=v.useState(t);return v.useEffect(()=>{o.current&&document.activeElement!==o.current&&l(t)},[t]),r.jsx("input",{ref:o,id:e,type:n,value:a,onChange:i=>{l(i.target.value)},onBlur:i=>{s(i.target.value)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",autoComplete:"off"})}function $a({dataset:e,onClose:n,onSave:t,onDelete:s,onDuplicate:o}){const[a,l]=v.useState(e.name),[i,u]=v.useState(e.notes||""),[c,d]=v.useState(!1),[p,f]=v.useState(!1),[m,w]=v.useState(!1),[_,S]=v.useState("info"),[h,y]=v.useState(null),x=e.snapshots[0]||{timestamp:e.timeRange.start,nodes:[],edges:[]};v.useEffect(()=>{l(e.name),u(e.notes||""),y(null)},[e]);async function C(){d(!0);try{const A={...e,name:a.trim(),notes:i.trim()||void 0};if(h){A.snapshots=h.snapshots;const V=A.snapshots[0]||x;A.metadata=Tt(V)}await t(A),n()}catch(A){console.error("Save error:",A),alert("Failed to save dataset: "+(A instanceof Error?A.message:"Unknown error"))}finally{d(!1)}}async function E(){f(!0);try{await s(),n()}catch(A){console.error("Delete error:",A),alert("Failed to delete dataset: "+(A instanceof Error?A.message:"Unknown error"))}finally{f(!1),w(!1)}}function N(A,V){const Z={...x,nodes:A,edges:V};y({...e,snapshots:[Z]})}const L=a!==e.name||i!==(e.notes||"")||h!==null;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold",children:"Edit Dataset"}),r.jsx("button",{onClick:n,type:"button",className:"text-gray-400 hover:text-gray-600 text-2xl cursor-pointer transition-colors",children:"×"})]}),r.jsxs("div",{className:"border-b flex",children:[r.jsx("button",{onClick:()=>S("info"),type:"button",className:`px-6 py-3 font-medium cursor-pointer transition-colors ${_==="info"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Information"}),r.jsxs("button",{onClick:()=>S("data"),type:"button",className:`px-6 py-3 font-medium cursor-pointer transition-colors ${_==="data"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Data (",x.nodes.length," nodes, ",x.edges.length," edges)"]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:_==="info"?r.jsxs("div",{className:"space-y-6 max-w-2xl",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Dataset Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",value:a,onChange:A=>l(A.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter a name for this dataset"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),r.jsx("textarea",{value:i,onChange:A=>u(A.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add any notes about this dataset..."})]}),r.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[r.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Dataset Information"}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Type:"})," ",e.type.toUpperCase()]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Time Range:"})," ",e.timeRange.start,e.timeRange.end!==e.timeRange.start?` – ${e.timeRange.end}`:""]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Snapshots:"})," ",e.snapshots.length]}),e.filename&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Original File:"})," ",e.filename]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(e.createdAt).toLocaleDateString()]})]})]}),r.jsxs("div",{className:"border-t pt-4 space-y-3",children:[r.jsx("button",{onClick:o,type:"button",className:"w-full px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"Duplicate Dataset"}),r.jsx("button",{onClick:()=>w(!0),type:"button",className:"w-full px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 cursor-pointer transition-colors",children:"Delete Dataset"})]})]}):r.jsx("div",{className:"h-full",children:r.jsx(Ia,{nodes:x.nodes,edges:x.edges,onUpdate:N})})}),r.jsxs("div",{className:"p-6 border-t flex justify-end gap-3",children:[r.jsx("button",{onClick:n,type:"button",disabled:c||p,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:C,type:"button",disabled:c||p||!L&&_==="info"||!a.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors",children:c?"Saving...":h?"Save All Changes":"Save Changes"})]}),m&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-60",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold mb-2",children:"Delete Dataset?"}),r.jsxs("p",{className:"text-gray-600 mb-4",children:['Are you sure you want to delete "',e.name,'"? This action cannot be undone.']}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>w(!1),type:"button",disabled:p,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:E,type:"button",disabled:p,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 cursor-pointer transition-colors",children:p?"Deleting...":"Delete"})]})]})})]})})}function Ia({nodes:e,edges:n,onUpdate:t}){const[s,o]=v.useState(e),[a,l]=v.useState(n);v.useEffect(()=>{o([...e]),l([...n])},[e,n]);const i=v.useRef(s),u=v.useRef(a);v.useEffect(()=>{i.current=s,u.current=a},[s,a]);const c=v.useCallback(m=>{o(m),i.current=m},[]),d=v.useCallback(m=>{l(m),u.current=m},[]),p=v.useRef(!1),f=v.useCallback(()=>{p.current&&(t(i.current,u.current),p.current=!1)},[t]);return r.jsx("div",{className:"h-full",children:r.jsx(hr,{nodes:s,edges:a,onNodesChange:m=>{c(m),p.current=!0},onEdgesChange:m=>{d(m),p.current=!0},onBlur:f,editable:!0})})}class Nt extends v.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,t){var s,o;console.error("ErrorBoundary caught an error:",n,t),(o=(s=this.props).onError)==null||o.call(s,n,t)}render(){var n;return this.state.hasError?this.props.fallback?this.props.fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Something went wrong"}),r.jsx("p",{className:"text-sm text-red-700 mb-2",children:((n=this.state.error)==null?void 0:n.message)||"An error occurred"}),r.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 cursor-pointer transition-colors",children:"Try again"})]}):this.props.children}}function Aa({selectedId:e,onSelect:n,onRefresh:t}){const[s,o]=v.useState([]),[a,l]=v.useState(!1),[i,u]=v.useState(null),[c,d]=v.useState(!1),[p,f]=v.useState(null),m=v.useRef(null);v.useEffect(()=>{w()},[]);async function w(){const E=await ko();o(E)}async function _(E,N){try{const A=`${E.type||"csv"}-${Date.now()}`,V={...E,id:A,snapshots:N.snapshots,metadata:N.metadata,createdAt:Date.now()};await jt(V),await w(),l(!1),f(null),n(A)}catch(L){throw console.error("Import error:",L),L}finally{m.current&&(m.current.value="")}}async function S(E,N){N.stopPropagation();const L=await Mt(E);L&&u(L)}async function h(E){await jt(E),await w(),e===E.id&&(t==null||t())}async function y(){i&&(await os(i.id),await w(),e===i.id&&n(""),u(null))}async function x(){if(!i)return;const E=await Do(i.id);await w(),u(null),n(E.id)}async function C(){await Lo(),await w(),d(!1),n(""),window.location.reload()}return r.jsxs("aside",{className:"h-full overflow-y-auto flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b",children:[r.jsx("h2",{className:"text-lg font-bold",children:"Datasets"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Stored in your browser"}),r.jsx("button",{onClick:()=>l(!0),className:"mt-3 w-full px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Import Dataset"}),r.jsx("input",{ref:m,type:"file",accept:".csv,.gexf",multiple:!0,className:"hidden"}),a&&r.jsx(Nt,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"Import Panel Error"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"The import panel encountered an error."}),r.jsx("button",{onClick:()=>l(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 cursor-pointer transition-colors",children:"Close"})]})}),children:r.jsx(Oo,{onClose:()=>{l(!1),f(null),m.current&&(m.current.value="")},onImport:_,fileInputRef:m,onFilesSelected:f,existingFile:p})})]}),r.jsxs("ul",{className:"divide-y flex-1 overflow-y-auto",children:[s.map(E=>r.jsx("li",{children:r.jsxs("div",{className:`flex items-center group ${e===E.id?"bg-blue-50":""}`,children:[r.jsxs("button",{className:"flex-1 text-left p-3 hover:bg-gray-50",onClick:()=>n(E.id),children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:E.name}),r.jsxs("div",{className:"text-xs text-gray-500",children:[E.type.toUpperCase()," · ",E.timeRange.start,E.timeRange.end!==E.timeRange.start?`–${E.timeRange.end}`:""]})]})}),E.notes&&r.jsx("div",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:E.notes})]}),r.jsx("button",{onClick:N=>S(E.id,N),className:"px-2 py-1 text-gray-400 hover:text-blue-600 hover:bg-gray-100 rounded transition-all mr-2 cursor-pointer",title:"Edit dataset",type:"button",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})},E.id)),s.length===0&&r.jsx("li",{className:"p-3 text-sm text-gray-500",children:"No datasets yet"})]}),r.jsxs("div",{className:"p-4 border-t",children:[r.jsx("button",{onClick:()=>d(!0),type:"button",className:"w-full px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 cursor-pointer transition-colors",children:"Reset All Data"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Delete all datasets and reload defaults"})]}),i&&r.jsx(Nt,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"Edit Panel Error"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"The edit panel encountered an error."}),r.jsx("button",{onClick:()=>u(null),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 cursor-pointer transition-colors",children:"Close"})]})}),children:r.jsx($a,{dataset:i,onClose:()=>u(null),onSave:h,onDelete:y,onDuplicate:x})}),c&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-60",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold mb-2",children:"Reset All Data?"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"This will delete all datasets and reload the default test data. This action cannot be undone."}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>d(!1),type:"button",className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:C,type:"button",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 cursor-pointer transition-colors",children:"Reset All Data"})]})]})})]})}function Pa({nodes:e,edges:n,width:t=1200,height:s=800}){const o=v.useRef(null),[a,l]=v.useState(null),[i,u]=v.useState(null);return v.useEffect(()=>{var be,Fe;if(!o.current||n.length===0||e.length===0){o.current&&Pe(o.current).selectAll("*").remove();return}Pe(o.current).selectAll("*").remove();const c=new Map;e.forEach(j=>{c.set(j.id,{id:j.id,label:j.label||j.id,outgoing:0,incoming:0})}),n.forEach(j=>{const k=c.get(j.source),je=c.get(j.target);k&&(k.outgoing+=j.value),je&&(je.incoming+=j.value)});const d=Array.from(c.values()).filter(j=>j.outgoing>0||j.incoming>0);if(d.length===0){Pe(o.current).append("text").attr("x",t/2).attr("y",s/2).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#666").text("No active nodes with flows");return}d.sort((j,k)=>k.outgoing+k.incoming-(j.outgoing+j.incoming));const p=50,f=t-50,m=20,w=15,_=2,S=5,h=d.reduce((j,k)=>j+k.outgoing,0),y=d.reduce((j,k)=>j+k.incoming,0),x=Math.max(s-2*m,400);let C=m;d.forEach(j=>{const k=h>0?Math.max(S,j.outgoing/h*x):Math.max(S,x/d.length);C+=k+_});let E=m;d.forEach(j=>{const k=y>0?Math.max(S,j.incoming/y*x):Math.max(S,x/d.length);E+=k+_});const N=Math.max(s,Math.max(C,E)+100),L=N-2*m,A=Pe(o.current).attr("width",t).attr("height",N).style("font","12px sans-serif");let V=m;const Z=d.map((j,k)=>{const je=h>0?Math.max(S,j.outgoing/h*L):Math.max(S,L/d.length),se=V;return V+=je+_,{node:j,x:p,y:se,height:Math.max(S,je-_),side:"left",index:k}});V=m;const T=d.map((j,k)=>{const je=y>0?Math.max(S,j.incoming/y*L):Math.max(S,L/d.length),se=V;return V+=je+_,{node:j,x:f,y:se,height:Math.max(S,je-_),side:"right",index:k}});let te=[];a&&i&&(i==="left"?te=n.filter(j=>j.source===a&&j.source!==j.target):te=n.filter(j=>j.target===a&&j.source!==j.target));const F=tr(or);if(te.length>0){const j=te.map(H=>{const Le=Z.find(Ke=>Ke.node.id===H.source),B=T.find(Ke=>Ke.node.id===H.target);if(!Le||!B)return null;const He=Le.y+Le.height/2,Me=B.y+B.height/2;return{edge:H,sourceX:Le.x+w,sourceY:He,targetX:B.x,targetY:Me,value:H.value,leftIndex:Le.index,rightIndex:B.index}}).filter(H=>H!==null),k=Math.max(...j.map(H=>H.value),1),je=2,se=20,Ze=A.append("g").attr("class","links");j.forEach(H=>{const Le=je+H.value/k*(se-je),B=`gradient-${H.leftIndex}-${H.rightIndex}`,He=A.append("defs").append("linearGradient").attr("id",B).attr("gradientUnits","userSpaceOnUse").attr("x1",H.sourceX).attr("x2",H.targetX).attr("y1",H.sourceY).attr("y2",H.targetY);He.append("stop").attr("offset","0%").attr("stop-color",F(String(H.leftIndex))).attr("stop-opacity",.6),He.append("stop").attr("offset","100%").attr("stop-color",F(String(H.rightIndex))).attr("stop-opacity",.6);const Me=ms(),Ke=(H.sourceX+H.targetX)/2;Me.moveTo(H.sourceX,H.sourceY),Me.bezierCurveTo(Ke,H.sourceY,Ke,H.targetY,H.targetX,H.targetY),Ze.append("path").attr("d",Me.toString()).attr("stroke",`url(#${B})`).attr("stroke-width",Le).attr("fill","none").attr("stroke-opacity",.6).style("cursor","pointer").on("mouseover",function(Ve){Pe(this).attr("stroke-opacity",1).attr("stroke-width",Le+2),Pe("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("pointer-events","none").style("opacity",0).html(`${H.edge.source} → ${H.edge.target}<br/>${H.value.toLocaleString()}`).style("opacity",1)}).on("mousemove",function(Ve){Pe(".tooltip").style("left",`${Ve.pageX+10}px`).style("top",`${Ve.pageY-10}px`)}).on("mouseout",function(){Pe(this).attr("stroke-opacity",.6).attr("stroke-width",Le),Pe(".tooltip").remove()})})}const Q=A.append("g").attr("class","left-nodes").selectAll("g.node").data(Z).join("g").attr("class","node").attr("transform",j=>`translate(${j.x}, ${j.y})`).style("cursor","pointer").on("click",function(j,k){j.stopPropagation(),a===k.node.id&&i==="left"?(l(null),u(null)):(l(k.node.id),u("left"))});Q.append("rect").attr("width",w).attr("height",j=>j.height).attr("fill",(j,k)=>F(String(k))).attr("stroke",(j,k)=>Ot(F(String(k))).darker().formatHex()).attr("stroke-width",j=>a===j.node.id&&i==="left"?3:1).attr("opacity",j=>a&&i==="left"&&a!==j.node.id?.3:1).on("mouseover",function(j,k){Pe(this).attr("fill",Ot(F(String(k.index))).brighter(.5).formatHex())}).on("mouseout",function(j,k){Pe(this).attr("fill",F(String(k.index)))}),Q.append("text").attr("x",w+6).attr("y",j=>j.height/2).attr("dy","0.35em").attr("text-anchor","start").text(j=>`${j.node.label} (${j.node.outgoing.toLocaleString()})`).style("font-size","11px").style("font-weight","500").style("fill","#333").attr("opacity",j=>a&&i==="left"&&a!==j.node.id?.3:1);const ne=A.append("g").attr("class","right-nodes").selectAll("g.node").data(T).join("g").attr("class","node").attr("transform",j=>`translate(${j.x}, ${j.y})`).style("cursor","pointer").on("click",function(j,k){j.stopPropagation(),a===k.node.id&&i==="right"?(l(null),u(null)):(l(k.node.id),u("right"))});ne.append("rect").attr("x",-w).attr("width",w).attr("height",j=>j.height).attr("fill",(j,k)=>F(String(k))).attr("stroke",(j,k)=>Ot(F(String(k))).darker().formatHex()).attr("stroke-width",j=>a===j.node.id&&i==="right"?3:1).attr("opacity",j=>a&&i==="right"&&a!==j.node.id?.3:1).on("mouseover",function(j,k){Pe(this).attr("fill",Ot(F(String(k.index))).brighter(.5).formatHex())}).on("mouseout",function(j,k){Pe(this).attr("fill",F(String(k.index)))}),ne.append("text").attr("x",-w-6).attr("y",j=>j.height/2).attr("dy","0.35em").attr("text-anchor","end").text(j=>`${j.node.label} (${j.node.incoming.toLocaleString()})`).style("font-size","11px").style("font-weight","500").style("fill","#333").attr("opacity",j=>a&&i==="right"&&a!==j.node.id?.3:1),a?A.append("text").attr("x",t/2).attr("y",20).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#333").text(i==="left"?`Showing outgoing flows from ${(be=Z.find(j=>j.node.id===a))==null?void 0:be.node.label}`:`Showing incoming flows to ${(Fe=T.find(j=>j.node.id===a))==null?void 0:Fe.node.label}`):A.append("text").attr("x",t/2).attr("y",20).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#666").text("Click a node to see its connections"),A.append("text").attr("x",p+w/2).attr("y",N-10).attr("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold").attr("fill","#333").text("Outgoing"),A.append("text").attr("x",f-w/2).attr("y",N-10).attr("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold").attr("fill","#333").text("Incoming"),A.on("click",function(j){(j.target===o.current||j.target.tagName==="svg")&&(l(null),u(null))})},[e,n,t,s,a,i]),r.jsxs("div",{className:"w-full h-full flex flex-col min-h-0",children:[r.jsxs("div",{className:"text-center text-xs text-gray-500 mb-2 flex-shrink-0",children:["Interaction design inspired by"," ",r.jsx("a",{href:"https://peoplemov.in/#f_AF",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"peoplemov.in by Carlo Zapponi"})]}),r.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:r.jsx("svg",{ref:o,className:"border border-gray-200 rounded bg-white"})})]})}function Va(e,n){const t=e.length,s=new Map;e.forEach((l,i)=>{s.set(l.id,i)});const o=Array(t).fill(null).map(()=>Array(t).fill(0));n.forEach(l=>{const i=s.get(l.source),u=s.get(l.target);i!==void 0&&u!==void 0&&(o[i][u]+=l.value)});const a=e.map(l=>l.label||l.id);return{matrix:o,labels:a,nodes:e}}function Zs(e,n,t){return!t||t==="all"?e:e.filter(s=>{const o=s[n];return Array.isArray(o)?o.includes(t):o===t})}function ka(e,n){const t=new Set;return e.forEach(s=>{const o=s[n];o!=null&&(Array.isArray(o)?o.forEach(a=>t.add(a)):t.add(o))}),Array.from(t).sort((s,o)=>typeof s=="number"&&typeof o=="number"?s-o:String(s).localeCompare(String(o)))}function Da({nodes:e,edges:n,width:t=1e3,height:s=800}){const o=v.useRef(null);return v.useEffect(()=>{if(!o.current||n.length===0||e.length===0){o.current&&Pe(o.current).selectAll("*").remove();return}Pe(o.current).selectAll("*").remove();const a=Va(e,n),l=Pe(o.current).attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${t} ${s}`).attr("preserveAspectRatio","xMidYMid meet"),i=Math.min(t,s)*.5-40,u=i-20,c=Sr().scaleExtent([.1,4]).on("zoom",function(y){_.attr("transform",y.transform.toString())});l.call(c);const d=l.append("g").attr("class","reset-button").style("cursor","pointer").attr("transform",`translate(${t-120}, 10)`).on("click",function(){l.transition().duration(750).call(c.transform,wr)});d.append("rect").attr("width",110).attr("height",30).attr("rx",4).attr("fill","white").attr("stroke","#ccc").attr("stroke-width",1),d.append("text").attr("x",55).attr("y",20).attr("text-anchor","middle").attr("font-size","12px").attr("fill","#333").text("Reset View");const f=zr().padAngle(.05).sortSubgroups(Tr)(a.matrix),m=Qr().radius(u),w=tr(or),_=l.append("g").attr("class","zoom-group"),S=_.append("g").attr("transform",`translate(${t/2}, ${s/2})`),h=S.append("g").selectAll("g").data(f.groups).join("g");h.append("path").attr("fill",y=>w(String(y.index))).attr("stroke",y=>Ot(w(String(y.index))).darker().formatHex()).attr("d",co().innerRadius(u).outerRadius(i)).on("mouseover",function(y,x){Pe(this).attr("fill",Ot(w(String(x.index))).brighter(1).formatHex()),S.selectAll("path.chord").style("opacity",C=>C.source.index===x.index||C.target.index===x.index?1:.2)}).on("mouseout",function(){Pe(this).attr("fill",y=>w(String(y.index))),S.selectAll("path.chord").style("opacity",1)}),h.append("text").attr("dy",".35em").attr("transform",y=>`
        rotate(${(y.startAngle+y.endAngle)/2*180/Math.PI-90})
        translate(${i+10})
        ${(y.startAngle+y.endAngle)/2>Math.PI?"rotate(180)":""}
      `).attr("text-anchor",y=>(y.startAngle+y.endAngle)/2>Math.PI?"end":"start").text(y=>a.labels[y.index]).style("font-size","12px").style("font-weight","500"),S.append("g").attr("fill-opacity",.67).selectAll("path").data(f).join("path").attr("class","chord").attr("d",y=>m(y)??"").attr("fill",y=>w(String(y.source.index))).attr("stroke",y=>Ot(w(String(y.source.index))).darker().formatHex()).style("stroke-width","1px").on("mouseover",function(y,x){Pe(this).attr("fill-opacity",1).style("stroke-width","2px"),Pe("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("pointer-events","none").style("opacity",0).style("transition","opacity 0.2s").html(`${a.labels[x.source.index]} → ${a.labels[x.target.index]}: ${x.source.value.toLocaleString()}`).style("opacity",1)}).on("mousemove",function(y){Pe(".tooltip").style("left",`${y.pageX+10}px`).style("top",`${y.pageY-10}px`)}).on("mouseout",function(){Pe(this).attr("fill-opacity",.67).style("stroke-width","1px"),Pe(".tooltip").remove()})},[e,n,t,s]),r.jsx("div",{className:"w-full h-full",children:r.jsx("svg",{ref:o,className:"border border-gray-200 rounded bg-white"})})}const La=200,Ta=600,Oa=384,Qs=4;function za({isCollapsed:e,onToggle:n,onResize:t,children:s,title:o="Settings",bottomContent:a}){const[l,i]=v.useState(Oa),[u,c]=v.useState(!1),d=v.useRef(null),p=v.useRef(null);return v.useEffect(()=>{if(!u)return;const f=w=>{var _;if(!e&&((_=d.current)==null?void 0:_.getBoundingClientRect())){const h=Math.max(La,Math.min(Ta,window.innerWidth-w.clientX));i(h),t==null||t(h)}},m=()=>{c(!1)};return document.addEventListener("mousemove",f),document.addEventListener("mouseup",m),()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",m)}},[u,e,t]),r.jsxs("div",{ref:d,className:"bg-white border-l border-gray-200 flex flex-col transition-all duration-300  overflow-hidden relative",style:{minHeight:"100vh",width:e?`${Qs}px`:`${l}px`},children:[e&&r.jsxs(r.Fragment,{children:[r.jsx("div",{onClick:n,className:"w-full h-full bg-gray-100 hover:bg-blue-400 cursor-pointer transition-colors",style:{width:`${Qs}px`},title:"Click to expand settings"}),r.jsx("button",{onClick:n,className:"fixed bottom-4 right-4 z-50 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg cursor-pointer transition-all hover:scale-110 flex items-center justify-center",style:{width:"48px",height:"48px"},title:"Open visualization settings","aria-label":"Open visualization settings",children:r.jsx(Ps,{className:"w-5 h-5"})})]}),!e&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:s}),a&&r.jsx("div",{className:"flex-shrink-0 border-t border-gray-200 bg-white",children:a}),r.jsxs("button",{onClick:n,className:"w-full flex items-center justify-between p-2 border-t border-gray-200 flex-shrink-0 bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Collapse settings",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx(Ps,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:o})]}),r.jsx(_r,{className:"w-4 h-4 text-gray-600 flex-shrink-0"})]}),r.jsx("div",{ref:p,onMouseDown:f=>{f.preventDefault(),c(!0)},className:"absolute top-0 left-0 w-1 h-full cursor-col-resize hover:bg-blue-400 bg-gray-300 transition-colors z-10",style:{touchAction:"none"},children:r.jsx("div",{className:"absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-0.5",children:r.jsx(Cr,{className:"w-3 h-6 text-gray-500"})})})]})]})}const xr=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],Ha=new Set(xr),Ga=xr.length,Js=Ar.reduce((e,n)=>(e[n]=n===2020?"ACS 1-year state-to-state migration flows for 2020 were not released by the Census Bureau due to pandemic-related data quality concerns.":"State-to-state migration data is unavailable for this year in the ACS 1-year series.",e),{});function Qt({title:e,subtitle:n,children:t,defaultOpen:s=!1,onReset:o}){const[a,l]=v.useState(s);return r.jsxs("div",{className:"border border-gray-200 rounded-md",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("button",{onClick:()=>l(!a),className:"flex-1 flex items-center justify-between p-3 hover:bg-gray-50 transition-colors text-left",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-semibold text-sm",children:e}),n&&r.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:n})]}),a?r.jsx(Dr,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}):r.jsx(Vr,{className:"w-4 h-4 text-gray-600 flex-shrink-0"})]}),o&&r.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),o()},className:"pr-3 text-[11px] font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"Reset"})]}),a&&r.jsx("div",{className:"p-3 pt-0 border-t border-gray-200",children:t})]})}const er=an(["kriskogram","table","sankey","chord"]),Dt=e=>{const n=e!==void 0?ln().default(e):ln().optional();return lt(t=>{if(t==null||t==="")return e;const s=typeof t=="string"?parseFloat(t):Number(t);return Number.isNaN(s)?e:s},n)},Cn=e=>lt(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1}return e},Er().default(e));Fr({dataset:Hn().optional(),view:lt(e=>typeof e=="string"&&er.safeParse(e).success?e:"kriskogram",er.default("kriskogram")),year:Dt(void 0),minThreshold:Dt(0),maxThreshold:Dt(2e5),maxEdges:Dt(500),edgeWeightScale:lt(e=>{if(typeof e!="string")return"linear";const n=e.toLowerCase();return["linear","sqrt","log"].includes(n)?n:"linear"},an(["linear","sqrt","log"]).default("linear")),egoNodeId:lt(e=>e==null||e===""||e==="null"?null:typeof e=="string"?e:void 0,Hn().nullable().optional()),egoNeighborSteps:lt(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseInt(e,10):Number(e);return Number.isNaN(n)||n<1?1:Math.max(1,Math.round(n))},ln().min(1).default(1)),egoStepColoring:Cn(!1),edgeType:lt(e=>e==="null"||e===""?null:typeof e=="string"?e:void 0,Hn().nullable().optional()),showAllNodes:Cn(!1),temporalOverlay:Cn(!1),temporalOverlayEdgeStyle:lt(e=>{if(typeof e=="string"){const n=e.toLowerCase();if(["segmented","filled","outline"].includes(n))return n}return"filled"},an(["segmented","filled","outline"]).default("filled")),temporalOverlayNodeStyle:lt(e=>{if(typeof e=="string"){const n=e.toLowerCase();if(["filled","outline"].includes(n))return n}return"filled"},an(["filled","outline"]).default("filled")),temporalOverlayYears:lt(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseInt(e,10):Number(e);return Number.isNaN(n)||n<1?1:Math.max(1,Math.round(n))},ln().min(1).default(1)),edgeSegmentLength:Dt(8),edgeSegmentGap:Dt(4),edgeSegmentAnimate:Cn(!1),edgeSegmentOffset:Dt(0),edgeSegmentCap:lt(e=>{if(typeof e=="string"){const n=e.toLowerCase();if(["round","butt"].includes(n))return n}return"round"},an(["round","butt"]).default("round")),edgeOutlineGap:lt(e=>{if(e==null||e==="")return 3;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?3:Math.max(.5,n)},ln().min(.5).default(3))});function Xa(){const e=Nr({from:"/explorer"}),n=jr(),{leftSidebarCollapsed:t,leftSidebarWidth:s,setSidebarContent:o}=Mr(),[a,l]=v.useState(e.dataset),[i,u]=v.useState(void 0),[c,d]=v.useState(e.year),[p,f]=v.useState(!1),[m,w]=v.useState(null),[_,S]=v.useState(0),[h,y]=v.useState(e.minThreshold??0),[x,C]=v.useState(e.maxThreshold??2e5),[E,N]=v.useState(e.maxEdges??500),[L,A]=v.useState(e.edgeType??null),[V,Z]=v.useState(e.view),[T,te]=v.useState(e.showAllNodes??!1),[F,W]=v.useState(e.egoNodeId??null),[Q,he]=v.useState(e.egoNeighborSteps??1),[ne,be]=v.useState(e.egoStepColoring??!1),[Fe,j]=v.useState(e.edgeWeightScale??"linear"),[k,je]=v.useState(e.temporalOverlay??!1),[se,Ze]=v.useState(e.temporalOverlayEdgeStyle??"filled"),[H,Le]=v.useState(e.temporalOverlayNodeStyle??"filled"),[B,He]=v.useState(e.edgeSegmentLength??8),[Me,Ke]=v.useState(e.edgeSegmentGap??4),[Ve,zt]=v.useState(e.edgeSegmentAnimate??!1),[nt,gn]=v.useState(e.edgeSegmentOffset??0),[st,mn]=v.useState(e.edgeSegmentCap??"round"),[M,P]=v.useState(Math.max(.5,e.edgeOutlineGap??3)),[G,xe]=v.useState(e.temporalOverlayYears??1),J=v.useRef(null),[ie,Se]=v.useState(!1),[rt,Et]=v.useState(384),[ot,ke]=v.useState({width:typeof window<"u"?window.innerWidth:1200,height:typeof window<"u"?window.innerHeight:800});v.useEffect(()=>(o(r.jsx(Nt,{fallback:r.jsxs("div",{className:"p-4",children:[r.jsx("h2",{className:"text-lg font-bold text-red-800 mb-2",children:"Dataset Sidebar Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The dataset sidebar encountered an error."})]}),children:r.jsx(Aa,{selectedId:a,onSelect:g=>{l(g),K({dataset:g})},onRefresh:()=>S(g=>g+1)})})),()=>{o(null)}),[a,_]),v.useEffect(()=>{if(typeof window>"u")return;const g=()=>{ke({width:window.innerWidth,height:window.innerHeight})};return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),v.useEffect(()=>{typeof window<"u"&&setTimeout(()=>{ke({width:window.innerWidth,height:window.innerHeight})},100)},[t,ie,s,rt]);const[Te,xs]=v.useState("alphabetical"),[Mn,vs]=v.useState(.85),[$t,Rn]=v.useState("weight"),[en,ys]=v.useState(!1),[Re,It]=v.useState("direction"),[Ht,Fn]=v.useState(null),[bt,En]=v.useState("weight"),[tn,$n]=v.useState(null),[In,An]=v.useState(.6),[Pn,bs]=v.useState(!0),[at,Ss]=v.useState("none"),[At,ws]=v.useState(2),[Vn,_s]=v.useState("single"),[Gt,Cs]=v.useState(null),[Qe,Ns]=v.useState("fixed"),[fn,js]=v.useState(null),[Bt,kn]=v.useState("pan"),[Ms,Rs]=v.useState(80),[Fs,Es]=v.useState({x:0,y:0}),K=v.useMemo(()=>g=>{n({to:"/explorer",search:b=>({view:b.view??"kriskogram",...b,...g}),replace:!0})},[n]),vr=v.useMemo(()=>i&&i.timeRange.start!==i.timeRange.end,[i]);v.useMemo(()=>{var $,X;if(!i)return 0;const g=($=i.timeRange)==null?void 0:$.start,b=(X=i.timeRange)==null?void 0:X.end;return typeof g!="number"||typeof b!="number"?0:Math.max(0,b-g)},[i]);const xt=v.useRef(!0);v.useEffect(()=>{To().catch(()=>{}),Ba().then(g=>{const b=e.dataset||g;b&&(l(b),!e.dataset&&xt.current&&K({dataset:b})),xt.current=!1}).catch(g=>w(g instanceof Error?g.message:"Failed to preload datasets"))},[]),v.useEffect(()=>{if(!a){u(void 0);return}f(!0),w(null),Mt(a).then(g=>{u(g),g&&(d(g.timeRange.start),y(0),N(500))}).catch(g=>w(g instanceof Error?g.message:"Failed to load dataset")).finally(()=>f(!1))},[a,_]);const _e=v.useMemo(()=>{if(!(!i||c===void 0))return i.snapshots.find(g=>(typeof g.timestamp=="string"?parseInt(g.timestamp,10):g.timestamp)===c)},[i,c]);v.useMemo(()=>{if(!i)return new Map;const g=new Map;return i.snapshots.forEach(b=>{const $=typeof b.timestamp=="string"?parseInt(b.timestamp,10):b.timestamp;Number.isFinite($)&&g.set($,b)}),g},[i]);const Ee=v.useMemo(()=>{if(!i)return null;let g=1/0,b=-1/0,$=0;return i.snapshots.forEach(X=>{const oe=Array.isArray(X==null?void 0:X.edges)?X.edges:[];let le=0;oe.forEach(de=>{if(de!=null&&de.source&&de.source===de.target)return;const re=Number(de==null?void 0:de.value);Number.isFinite(re)&&(le+=1,re<g&&(g=re),re>b&&(b=re))}),le>$&&($=le)}),g===1/0||b===-1/0?{min:0,max:0,maxEdgesCount:$}:{min:g,max:b,maxEdgesCount:$}},[i]),Ut=v.useMemo(()=>{if(!i)return null;let g=1/0,b=-1/0;return i.snapshots.forEach($=>{const X=new Map,oe=new Map;(Array.isArray($==null?void 0:$.edges)?$.edges:[]).forEach(re=>{const ve=oe.get(re.source)||0;oe.set(re.source,ve+re.value);const Ie=X.get(re.target)||0;X.set(re.target,Ie+re.value)}),(Array.isArray($==null?void 0:$.nodes)?$.nodes:[]).forEach(re=>{const ve=(X.get(re.id)||0)-(oe.get(re.id)||0);ve<g&&(g=ve),ve>b&&(b=ve)})}),g===1/0||b===-1/0?{min:0,max:0}:{min:g,max:b}},[i]),qt=v.useMemo(()=>{if(!i)return null;let g=0,b=0;return i.snapshots.forEach($=>{const X=new Map,oe=new Map;(Array.isArray($==null?void 0:$.edges)?$.edges:[]).forEach(re=>{const ve=oe.get(re.source)||0;oe.set(re.source,ve+re.value);const Ie=X.get(re.target)||0;X.set(re.target,Ie+re.value)}),(Array.isArray($==null?void 0:$.nodes)?$.nodes:[]).forEach(re=>{const ve=X.get(re.id)||0,Ie=oe.get(re.id)||0;ve>g&&(g=ve),Ie>b&&(b=Ie)})}),{maxIncoming:g,maxOutgoing:b}},[i]),Wt=v.useMemo(()=>{if(!i)return null;let g=0;return i.snapshots.forEach(b=>{const $=Array.isArray(b==null?void 0:b.edges)?b.edges:[],X=new Map;$.forEach(oe=>{if(oe!=null&&oe.source&&oe.source===oe.target){const le=Number(oe.value);if(!Number.isFinite(le)||le<=0)return;const de=X.get(oe.source)||0;X.set(oe.source,de+le)}}),X.forEach(oe=>{oe>g&&(g=oe)})}),{max:g}},[i]);v.useEffect(()=>{if(!Ee)return;const{min:g,max:b,maxEdgesCount:$}=Ee;if(!Number.isFinite(g)||!Number.isFinite(b))return;const X=(ve,Ie,Je)=>Je<Ie||!Number.isFinite(ve)||ve<Ie?Ie:ve>Je?Je:ve,oe=X(h,g,b);let le=X(x,g,b);le<oe&&(le=oe);const de=Math.max(1,$),re=Math.max(1,Math.min(E,de));oe!==h&&y(oe),le!==x&&C(le),re!==E&&N(re)},[Ee,h,x,E]);const ft=v.useMemo(()=>{if(!_e||!(i!=null&&i.metadata))return null;const b=["migration_type","type","category","edge_type"].find(X=>{var oe,le;return((oe=i.metadata)==null?void 0:oe.edgeProperties.includes(X))||((le=i.metadata)==null?void 0:le.hasCategoricalProperties.edges.includes(X))});if(!b)return null;const $=ka(_e.edges,b);return{property:b,values:$.map(X=>String(X))}},[_e,i]);v.useEffect(()=>{A(null)},[a]),v.useEffect(()=>{_e&&F&&(_e.nodes.some(b=>b.id===F)||(W(null),ne&&be(!1),K({egoNodeId:null,egoStepColoring:!1})))},[_e,F,ne,K]);const O=v.useMemo(()=>{if(!i||!_e)return{nodes:[],edges:[],baseEdges:[],overlayEdges:[],egoStepMax:0,overlayMeta:{hasPast:!1,hasFuture:!1,maxDelta:0}};const g=typeof c=="number"?c:null,b=new Map,$=new Map,X=new Map;_e.edges.forEach(I=>{const ge=$.get(I.source)||0;$.set(I.source,ge+I.value);const fe=b.get(I.target)||0;if(b.set(I.target,fe+I.value),I.source===I.target){const ye=X.get(I.source)||0;X.set(I.source,ye+I.value)}});const oe=(I,ge)=>{if(at==="none")return I;const fe=new Map(ge.map(ye=>[ye.id,ye]));return I.filter(ye=>{const Ce=fe.get(ye.source),we=fe.get(ye.target);return!Ce||!we?!1:at==="region"?Ce.region&&we.region&&Ce.region===we.region:at==="division"?Ce.division&&we.division&&Ce.division===we.division:at==="interRegion"?Ce.region&&we.region&&Ce.region!==we.region:at==="interDivision"?Ce.division&&we.division&&Ce.division!==we.division:!0})};let le=Zs(_e.edges,(ft==null?void 0:ft.property)||"",L);le=oe(le,_e.nodes),le=le.filter(I=>(I==null?void 0:I.source)!==(I==null?void 0:I.target));const re=le.filter(I=>I.value>=h&&I.value<=x).sort((I,ge)=>ge.value-I.value).slice(0,E).map((I,ge)=>({edge:I,idx:ge}));let ve=re;const Ie=new Map;let Je=0;if(V==="kriskogram"&&F){const I=Math.max(1,Math.round(Q)),ge=new Set;let fe=new Set;const ye=new Set;fe.add(F),ye.add(F);for(let Ce=1;Ce<=I&&fe.size>0;Ce+=1){const we=new Set;re.forEach(({edge:R,idx:Y})=>{if(fe.has(R.source)||fe.has(R.target)){ge.add(Y);const ae=Ie.get(Y);(ae===void 0||Ce<ae)&&Ie.set(Y,Ce),ye.has(R.source)||(ye.add(R.source),we.add(R.source)),ye.has(R.target)||(ye.add(R.target),we.add(R.target))}}),fe=we}ve=re.filter(({idx:Ce})=>ge.has(Ce)),Ie.forEach(Ce=>{Ce>Je&&(Je=Ce)})}const Ae=se,ze=se==="segmented"?`${Math.max(1,B)} ${Math.max(.5,Me)}`:null,Oe=se==="segmented"?Math.max(0,nt):0,me=se==="segmented"?st:"round",$e=ve.map(({edge:I,idx:ge})=>{const fe=Ie.get(ge),ye={...I,__isOverlay:!1,__displayYear:g,__temporalDelta:0,_overlayType:void 0,_overlayYear:g,__overlayStyle:Ae,__overlayDash:ze,__overlayDashOffset:Oe,__overlayLineCap:me,__segmentCycle:se==="segmented"?Math.max(1,B+Me):0,__segmentAnimate:se==="segmented"&&Ve,__outlineGap:M};return fe!==void 0&&(ye._egoStep=fe),ye}),Ye=new Set;$e.forEach(I=>{Ye.add(I.source),Ye.add(I.target)}),F&&Ye.add(F);const et=new Map,vt=new Map;$e.forEach(I=>{const ge=vt.get(I.source)||0;vt.set(I.source,ge+I.value);const fe=et.get(I.target)||0;et.set(I.target,fe+I.value)});const ct=[],St=new Map,wt=new Map;let pt=0,Yt=!1,pn=!1;const hn=new Map;if(i&&i.snapshots.forEach(I=>{const ge=typeof I.timestamp=="string"?parseInt(I.timestamp,10):I.timestamp;Number.isFinite(ge)&&hn.set(ge,I)}),k&&i&&typeof c=="number"&&i.timeRange.start!==i.timeRange.end){const I=Math.max(1,Math.round(G));for(let ge=-I;ge<=I;ge+=1){if(ge===0)continue;const fe=c+ge,ye=hn.get(fe);if(!ye)continue;const Ce=Array.isArray(ye.edges)?ye.edges:[];let we=Zs(Ce,(ft==null?void 0:ft.property)||"",L);if(at!=="none"){const z=new Map(ye.nodes.map(D=>[D.id,D]));at==="region"?we=we.filter(D=>{const ee=z.get(D.source),pe=z.get(D.target);return ee&&pe&&ee.region&&pe.region&&ee.region===pe.region}):at==="division"?we=we.filter(D=>{const ee=z.get(D.source),pe=z.get(D.target);return ee&&pe&&ee.division&&pe.division&&ee.division===pe.division}):at==="interRegion"?we=we.filter(D=>{const ee=z.get(D.source),pe=z.get(D.target);return ee&&pe&&ee.region&&pe.region&&ee.region!==pe.region}):at==="interDivision"&&(we=we.filter(D=>{const ee=z.get(D.source),pe=z.get(D.target);return ee&&pe&&ee.division&&pe.division&&ee.division!==pe.division}))}const R=se==="segmented"?`${Math.max(1,B)} ${Math.max(.5,Me)}`:null,Y=se==="segmented"?Math.max(0,nt):0,ae=se==="segmented"?st:"round";we.filter(z=>z.value>=h&&z.value<=x).sort((z,D)=>D.value-z.value).slice(0,E).map(z=>({...z,_overlayType:ge<0?"past":"future",_overlayYear:fe,__isOverlay:!0,__displayYear:fe,__temporalDelta:ge,__overlayStyle:se,__overlayDash:R,__overlayDashOffset:Y,__overlayLineCap:ae,__segmentCycle:se==="segmented"?Math.max(1,B+Me):0,__segmentAnimate:se==="segmented"&&Ve,__outlineGap:M})).forEach(z=>{if(ct.push(z),z._overlayType==="past"){Yt=!0;const D=St.get(z.source)||0;St.set(z.source,D+z.value);const ee=St.get(z.target)||0;St.set(z.target,ee+z.value)}else{pn=!0;const D=wt.get(z.source)||0;wt.set(z.source,D+z.value);const ee=wt.get(z.target)||0;wt.set(z.target,ee+z.value)}})}}ct.length>0&&ct.forEach(I=>{Ye.add(I.source),Ye.add(I.target)});const rn=(V==="kriskogram"&&T?_e.nodes:_e.nodes.filter(I=>Ye.has(I.id))).map(I=>{const ge=et.get(I.id)||0,fe=vt.get(I.id)||0,ye=b.get(I.id)||0,Ce=$.get(I.id)||0,we=ge-fe,R=ye-Ce,Y=X.get(I.id)||0,ae=St.get(I.id)||0,ce=wt.get(I.id)||0,z=ce-ae;return Math.abs(z)>pt&&(pt=Math.abs(z)),{...I,_totalIncoming:ge,_totalOutgoing:fe,total_incoming_visible:ge,total_outgoing_visible:fe,total_incoming_year:ye,total_outgoing_year:Ce,net_flow_visible:we,net_flow_year:R,self_flow_year:Y,temporal_overlay_past_total:ae,temporal_overlay_future_total:ce,temporal_overlay_delta:z,_overlayPastTotal:ae,_overlayFutureTotal:ce,_overlayDelta:z}});k?rn.forEach(I=>{const ge=I._overlayDelta??0;if(pt>0&&ge!==0){const fe=Math.max(0,Math.min(1,Math.abs(ge)/pt));I._overlayStrokeWidth=1.5+fe*3,I._overlayStrokeColor=ge>0?"hsl(0, 75%, 55%)":"hsl(210, 75%, 55%)"}else pt>0?(I._overlayStrokeWidth=1.5,I._overlayStrokeColor="#cbd5f5"):(I._overlayStrokeWidth=2,I._overlayStrokeColor="#fff")}):rn.forEach(I=>{I._overlayStrokeWidth=2,I._overlayStrokeColor="#fff"});const Xt=k?{hasPast:Yt,hasFuture:pn,nodeDeltaAbsMax:pt,style:se,edgeSegmentLength:B,edgeSegmentGap:Me,edgeSegmentOffset:nt,edgeSegmentCap:st,edgeSegmentAnimate:Ve,edgeOutlineGap:M}:null,xn=k&&ct.length>0?[...$e,...ct]:$e;return{nodes:rn,baseEdges:$e,edges:xn,currentEdgeCount:$e.length,egoStepMax:Je,temporalOverlay:Xt}},[_e,h,x,E,L,ft,at,T,V,F,Q,Fe,k,se,H,G,B,Me,nt,st,Ve,M,i]),it=v.useMemo(()=>{if(!_e)return null;const g=_e.edges.length,b=_e.nodes.length,$=_e.edges.reduce((le,de)=>le+de.value,0),X=g>0?$/g:0,oe=g>0?Math.max(..._e.edges.map(le=>le.value)):0;return{totalNodes:b,totalEdges:g,visibleNodes:O.nodes.length,visibleEdges:O.currentEdgeCount??O.edges.filter(le=>!le._overlayType).length,avgValue:X,maxValue:oe}},[_e,O]),dt=(Ee==null?void 0:Ee.min)??0,nn=(Ee==null?void 0:Ee.max)??(it==null?void 0:it.maxValue)??dt,Kt=Math.max(dt,nn),yr=Math.max(Kt,1),$s=Math.max(1,Math.floor(yr/1e3)),Dn=(Ee==null?void 0:Ee.maxEdgesCount)??(it==null?void 0:it.totalEdges)??0,Ln=Math.max(500,Dn),Tn=v.useMemo(()=>{if(!O||O.currentEdgeCount===0)return;const g=O.edges.filter(b=>!b._overlayType);if(g.length!==0)return Math.min(...g.map(b=>b.value))},[O]),Pt=v.useMemo(()=>O.nodes.some(g=>g&&g.region),[O]),Vt=v.useMemo(()=>O.nodes.some(g=>g&&g.division),[O]);v.useEffect(()=>{!Pt&&Re==="region"&&It("direction"),!Vt&&Re==="division"&&It("direction")},[Pt,Vt,Re]);const On=v.useMemo(()=>{if(!O||O.currentEdgeCount===0)return;const g=O.edges.filter(b=>!b._overlayType);if(g.length!==0)return Math.max(...g.map(b=>b.value))},[O]);v.useEffect(()=>{V==="kriskogram"&&O.nodes.length>0&&J.current&&J.current.updateData(O.nodes,O.edges)},[O,V]);const br=g=>{d(g),xt.current||K({year:g})};return v.useEffect(()=>{xt.current||K({minThreshold:h,maxThreshold:x,maxEdges:E})},[h,x,E]),v.useEffect(()=>{xt.current||K({view:V})},[V]),v.useEffect(()=>{xt.current||K({edgeType:L})},[L]),v.useEffect(()=>{!xt.current&&a&&K({dataset:a})},[a]),v.useEffect(()=>{xt.current},[]),v.useEffect(()=>{_e&&F&&(_e.nodes.some(b=>b.id===F)||(W(null),ne&&be(!1),K({egoNodeId:null,egoStepColoring:!1})))},[_e,F,ne,K]),v.useEffect(()=>{(!i||i.timeRange.start===i.timeRange.end||typeof c!="number")&&k&&(je(!1),K({temporalOverlay:!1,temporalOverlayEdgeStyle:se,temporalOverlayNodeStyle:H,edgeSegmentLength:B,edgeSegmentGap:Me,edgeSegmentOffset:nt,edgeSegmentCap:st,edgeSegmentAnimate:Ve,edgeOutlineGap:M}))},[i,c,k,se,H,B,Me,nt,st,Ve,M,K]),v.useEffect(()=>{xt.current||K({temporalOverlay:k,temporalOverlayYears:G,temporalOverlayEdgeStyle:se,temporalOverlayNodeStyle:H,edgeSegmentLength:B,edgeSegmentGap:Me,edgeSegmentOffset:nt,edgeSegmentCap:st,edgeSegmentAnimate:Ve,edgeOutlineGap:M})},[k,G,se,H,B,Me,nt,st,Ve,M,K]),r.jsx(Nt,{fallback:r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-lg mx-4",children:[r.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"Explorer Error"}),r.jsx("p",{className:"text-gray-700 mb-4",children:"The explorer page encountered an error. Please refresh the page."}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer transition-colors",children:"Reload Page"})]})}),children:r.jsxs("div",{className:"flex flex-1 h-full overflow-hidden",children:[r.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden h-full relative",children:[p&&r.jsx("div",{className:"p-4 bg-yellow-50 text-yellow-800",children:"Loading…"}),m&&r.jsx("div",{className:"p-4 bg-red-50 text-red-600",children:m}),i?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex-1 flex flex-col overflow-hidden bg-white",children:r.jsx("div",{className:`flex-1 overflow-hidden ${V==="table"?"":"p-4"}`,children:O.nodes.length>0&&O.baseEdges.length>0?r.jsxs(r.Fragment,{children:[V==="kriskogram"&&r.jsx(Nt,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Kriskogram Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The Kriskogram visualization encountered an error."})]}),children:r.jsx("div",{className:"w-full h-full",children:r.jsx(Rr,{ref:J,nodes:O.nodes,edges:O.edges,width:Math.max(800,ot.width-(t?64:s)-(ie?4:rt)-40),height:Math.max(600,ot.height-80),margin:{top:60,right:40,bottom:60,left:40},arcOpacity:Mn,title:i.name,accessors:(()=>{const g=O.baseEdges.map(R=>R.value),b=g.length>0?Math.min(...g):0,$=g.length>0?Math.max(...g):1,X=(Ee==null?void 0:Ee.min)??b,oe=(Ee==null?void 0:Ee.max)??$,le=Math.max(oe-X,0),de=O.egoStepMax??0,re=!!(F&&ne&&de>0),ve=R=>{if(de<=1)return"hsl(210, 80%, 55%)";const Y=Math.max(1,Math.min(R,de)),ae=de<=1?0:(Y-1)/(de-1),ce=210-ae*150,z=60-ae*20;return`hsl(${Math.round(ce)}, 80%, ${Math.round(z)}%)`},Ie=R=>{if(!Number.isFinite(R)||le<=0)return 0;const ae=Math.min(Math.max(R,X),oe)-X;switch(Fe){case"sqrt":{const ce=Math.sqrt(le);return ce<=0?0:Math.max(0,Math.min(1,Math.sqrt(ae)/ce))}case"log":{const ce=Math.log10(le+1);return!Number.isFinite(ce)||ce<=0?0:Math.max(0,Math.min(1,Math.log10(ae+1)/ce))}case"linear":default:{const ce=le;return ce<=0?0:Math.max(0,Math.min(1,ae/ce))}}},Je=O.nodes.map(R=>R.total_outgoing_visible||R._totalOutgoing||0),Ae=O.nodes.map(R=>R.total_incoming_visible||R._totalIncoming||0),ze=O.nodes.map(R=>R.total_outgoing_year||0),Oe=O.nodes.map(R=>R.total_incoming_year||0),me=O.nodes.map(R=>R.net_flow_visible||0),$e=O.nodes.map(R=>R.net_flow_year||0),Ye=Je.length>0?Math.max(...Je):1,et=Ae.length>0?Math.max(...Ae):1,vt=ze.length>0?Math.max(...ze):1,ct=Oe.length>0?Math.max(...Oe):1,St=me.length>0?Math.max(...me.map(R=>Math.abs(R))):1,wt=$e.length>0?Math.max(...$e.map(R=>Math.abs(R))):1,pt=(qt==null?void 0:qt.maxOutgoing)??vt,Yt=(qt==null?void 0:qt.maxIncoming)??ct,pn=(Ut==null?void 0:Ut.min)??-wt,hn=(Ut==null?void 0:Ut.max)??wt,sn=Math.max(Math.abs(pn),Math.abs(hn))||1,Is=(R,Y,ae)=>{const ce=Array.from(new Set(O.nodes.map(D=>D[R]).filter(D=>D!=null))),z=new Map;return ce.forEach((D,ee)=>{z.set(D,ae[ee%ae.length])}),z.get(Y)||ae[0]},rn=["#3b82f6","#f59e0b","#ef4444","#10b981","#8b5cf6","#ec4899","#14b8a6","#f97316"],Xt=O.temporalOverlay,xn=!!Xt,I=se,fe=H==="outline",ye=(Xt==null?void 0:Xt.nodeDeltaAbsMax)??0,Ce=R=>{if(R===0)return"#6b7280";const Y=Math.max(-ye,Math.min(ye,R)),ce=65-(ye>0?Math.abs(Y)/ye:.5)*20;return R<0?`hsl(210, 75%, ${Math.round(ce)}%)`:`hsl(0, 75%, ${Math.round(ce)}%)`},we=R=>{var z;const Y=(D,ee)=>!Number.isFinite(D)||ee<=0?0:Math.max(0,Math.min(1,D/ee)),ae=(D,ee,pe)=>{const Ge=85-Math.max(0,Math.min(1,pe))*45;return`hsl(${D}, ${ee}%, ${Ge}%)`},ce=D=>{if(!Number.isFinite(D)||sn<=0)return"#6b7280";if(Math.abs(D)<1e-6)return"#9ca3af";const pe=85-Math.max(0,Math.min(1,Math.abs(D)/sn))*45;return D>=0?`hsl(0, 75%, ${pe}%)`:`hsl(210, 75%, ${pe}%)`};switch(Vn){case"single":return"#2563eb";case"outgoing":case"visible_outgoing":{const D=Y(R.total_outgoing_visible||R._totalOutgoing||0,Ye);return ae(24,85,D)}case"incoming":case"visible_incoming":{const D=Y(R.total_incoming_visible||R._totalIncoming||0,et);return ae(160,70,D)}case"year_outgoing":{const D=Y(R.total_outgoing_year||0,pt);return ae(24,85,D)}case"year_incoming":{const D=Y(R.total_incoming_year||0,Yt);return ae(160,70,D)}case"net_year":return ce(R.net_flow_year||0);case"self_year":{const D=Y(R.self_flow_year||0,(Wt==null?void 0:Wt.max)??0);return ae(280,70,D)}case"attribute":{if(!Gt)return"#2563eb";const D=R[Gt];if(D==null)return"#9ca3af";if((z=i==null?void 0:i.metadata)!=null&&z.hasNumericProperties.nodes.includes(Gt)){const ee=O.nodes.map(Be=>Be[Gt]).filter(Be=>typeof Be=="number");if(ee.length===0)return"#2563eb";const pe=Math.min(...ee),Ge=Math.max(...ee)-pe||1,ue=(Number(D)-pe)/Ge;return`hsl(${120-Math.max(0,Math.min(1,ue))*120}, 70%, 50%)`}return Is(Gt,D,rn)}default:return"#2563eb"}};return{nodeOrder:R=>{if(Te==="alphabetical")return R.label||R.id;const Y=R[Te];return Y==null?`ZZZ_${R.label||R.id}`:typeof Y=="number"?`${String(1e6-Y).padStart(10,"0")}_${R.label||R.id}`:`${String(Y)}_${R.label||R.id}`},nodeColor:R=>{const Y=we(R);return R.__baseFillColor=Y,fe?"transparent":Y},nodeRadius:R=>{const Y=R.total_outgoing_visible||R._totalOutgoing||0,ae=R.total_incoming_visible||R._totalIncoming||0,ce=R.total_outgoing_year||0,z=R.total_incoming_year||0,D=Math.abs(R.net_flow_visible||0),ee=Math.abs(R.net_flow_year||0),pe=R.self_flow_year||0,We=Ge=>3+Math.max(0,Math.min(1,Ge))*9;if(Qe==="fixed")return 6;if(Qe==="visible_outgoing"||Qe==="outgoing")return We(Ye>0?Y/Ye:0);if(Qe==="visible_incoming"||Qe==="incoming")return We(et>0?ae/et:0);if(Qe==="year_outgoing")return We(pt>0?ce/pt:0);if(Qe==="year_incoming")return We(Yt>0?z/Yt:0);if(Qe==="net_visible"){const Ge=St>0?St:1;return We(D/Ge)}if(Qe==="net_year"){const Ge=sn>0?sn:1;return We(ee/Ge)}if(Qe==="self_year"){const Ge=(Wt==null?void 0:Wt.max)??0,ue=Ge>0?pe/Ge:0;return We(ue)}if(Qe==="attribute"&&fn){const Ge=R[fn];if(typeof Ge!="number")return 6;const ue=O.nodes.map(_t=>_t[fn]).filter(_t=>typeof _t=="number");if(ue.length===0)return 6;const De=Math.min(...ue),Ne=Math.max(...ue)-De||1,gt=(Ge-De)/Ne;return We(gt)}return 6},edgeWidth:R=>{const Y=(R==null?void 0:R.__overlayStyle)??I,ae=Ie(R.value),ce=$t==="weight"?.5+ae*(Y==="segmented"?12:15):At;return Y==="outline"?Math.max(2.5,At):Y==="segmented"?$t==="weight"?ce:Math.max(At,2):ce},edgeColor:(R,Y)=>{var We,Ge;const ae=R==null?void 0:R.__temporalDelta;if(xn&&ae)return Ce(ae);if(re){const ue=(R==null?void 0:R._egoStep)??0;if(ue>0)return ve(ue)}const ce=Ie(R.value),z=["#3b82f6","#f59e0b","#ef4444","#10b981","#8b5cf6","#ec4899","#14b8a6","#f97316"];if(!en&&Re==="direction")return Y?"#1f77b4":"#d62728";let D="#2563eb";if(Re==="direction")D=Y?"#1f77b4":"#d62728";else if(Re==="region"){const ue=O.nodes.find(Ne=>Ne.id===R.source),De=Array.from(new Set(O.nodes.map(Ne=>Ne.region).filter(Boolean))),Be=new Map(De.map((Ne,gt)=>[Ne,z[gt%z.length]]));D=ue&&ue.region&&Be.get(ue.region)||"#2563eb"}else if(Re==="division"){const ue=O.nodes.find(Ne=>Ne.id===R.source),De=Array.from(new Set(O.nodes.map(Ne=>Ne.division).filter(Boolean))),Be=new Map(De.map((Ne,gt)=>[Ne,z[gt%z.length]]));D=ue&&ue.division&&Be.get(ue.division)||"#2563eb"}else if(Re==="attribute"&&Ht){const ue=R[Ht];if(ue!=null)if((We=i==null?void 0:i.metadata)!=null&&We.hasNumericProperties.edges.includes(Ht)){const De=O.baseEdges.map(zn=>zn[Ht]).filter(zn=>typeof zn=="number"),Be=Math.min(...De),gt=Math.max(...De)-Be||1;D=`hsl(${120-(Number(ue)-Be)/gt*120}, 70%, 50%)`}else{const De=Array.from(new Set(O.baseEdges.map(Ne=>Ne[Ht]).filter(Ne=>Ne!=null)));D=new Map(De.map((Ne,gt)=>[Ne,z[gt%z.length]])).get(ue)||"#2563eb"}}else Re==="single"&&(D="#2563eb");let ee=.6;if(bt==="weight")ee=Math.max(0,Math.min(1,ce));else if(bt==="attribute"&&tn){const ue=R[tn];if(ue!=null&&((Ge=i==null?void 0:i.metadata)!=null&&Ge.hasNumericProperties.edges.includes(tn))){const De=O.baseEdges.map(_t=>_t[tn]).filter(_t=>typeof _t=="number"),Be=Math.min(...De),gt=Math.max(...De)-Be||1;ee=Math.max(0,Math.min(1,(Number(ue)-Be)/gt))}}else bt==="constant"&&(ee=Math.max(0,Math.min(1,In)));if(Pn&&(Re==="region"||Re==="division")){const ue=O.nodes.find(Ne=>Ne.id===R.source),De=O.nodes.find(Ne=>Ne.id===R.target);if(!(Re==="region"?(ue==null?void 0:ue.region)&&ue.region===(De==null?void 0:De.region):(ue==null?void 0:ue.division)&&ue.division===(De==null?void 0:De.division)))return`hsl(0, 0%, ${80-ee*50}%)`}const pe=80-ee*55;return Re==="direction"?`hsl(${Y?0:200}, 70%, ${Math.round(pe)}%)`:Re==="single"?`hsl(210, 70%, ${Math.round(pe)}%)`:D},nodeStroke:R=>{const Y=R.temporal_overlay_delta??0,ae=R.__baseFillColor??we(R);if(!xn||ye<=0)return{color:fe?ae:"#fff",width:fe?2.5:2};if(!Y)return{color:fe?ae:"#d1d5db",width:fe?2.5:1.5};const ce=Math.min(1,Math.abs(Y)/ye);if(fe){const pe=2.5+ce*1.5;return{color:ae,width:pe}}const z=Y>=0?0:210,D=70-ce*25,ee=2+ce*2;return{color:`hsl(${Math.round(z)}, 75%, ${Math.round(D)}%)`,width:ee}}}})(),legend:(()=>{const g=O.temporalOverlay;if(g&&(g.hasPast||g.hasFuture)){const Ae=[];return g.hasPast&&Ae.push({label:"Past years",color:"hsl(210, 75%, 55%)"}),g.hasFuture&&Ae.push({label:"Future years",color:"hsl(0, 75%, 55%)"}),{type:"temporalOverlay",entries:Ae}}const b=O.egoStepMax??0;if(!!(F&&ne&&b>0)){const Ae=Oe=>{if(b<=1)return"hsl(210, 80%, 55%)";const me=Math.max(1,Math.min(Oe,b)),$e=b<=1?0:(me-1)/(b-1),Ye=210-$e*150,et=60-$e*20;return`hsl(${Math.round(Ye)}, 80%, ${Math.round(et)}%)`};return{type:"egoSteps",entries:Array.from({length:b},(Oe,me)=>({step:me+1,color:Ae(me+1)}))}}const X=O.baseEdges.map(Ae=>Ae.value),oe=X.length>0?Math.min(...X):0,le=X.length>0?Math.max(...X):1,de=(Ee==null?void 0:Ee.min)??oe,re=(Ee==null?void 0:Ee.max)??le,ve=Math.max(re-de,0),Ie=Ae=>{if(!Number.isFinite(Ae)||ve<=0)return 0;const Oe=Math.min(Math.max(Ae,de),re)-de;switch(Fe){case"sqrt":{const me=Math.sqrt(ve);return me<=0?0:Math.max(0,Math.min(1,Math.sqrt(Oe)/me))}case"log":{const me=Math.log10(ve+1);return!Number.isFinite(me)||me<=0?0:Math.max(0,Math.min(1,Math.log10(Oe+1)/me))}case"linear":default:return ve<=0?0:Math.max(0,Math.min(1,Oe/ve))}},Je=Ae=>{if(ve<=0)return de;const ze=Math.max(0,Math.min(1,Ae));switch(Fe){case"sqrt":return de+Math.pow(ze,2)*ve;case"log":{const Oe=Math.log10(ve+1);if(!Number.isFinite(Oe)||Oe<=0)return de;const me=Math.pow(10,ze*Oe)-1;return de+me}case"linear":default:return de+ze*ve}};if(en){if(Re==="region"&&Pt){const Ae=Array.from(new Set(O.nodes.map(me=>me.region).filter(Boolean))),ze=["#3b82f6","#f59e0b","#ef4444","#10b981","#8b5cf6","#ec4899","#14b8a6","#f97316"];return{type:"categorical",title:"Regions",entries:Ae.slice(0,10).map((me,$e)=>({label:me,color:ze[$e%ze.length]})),interNote:Pn?"Inter edges: grayscale by intensity":void 0}}if(Re==="division"&&Vt){const Ae=Array.from(new Set(O.nodes.map(me=>me.division).filter(Boolean))),ze=["#3b82f6","#f59e0b","#ef4444","#10b981","#8b5cf6","#ec4899","#14b8a6","#f97316"];return{type:"categorical",title:"Divisions",entries:Ae.slice(0,10).map((me,$e)=>({label:me,color:ze[$e%ze.length]})),interNote:Pn?"Inter edges: grayscale by intensity":void 0}}if(Re==="single"&&bt==="weight"){const ze=[0,.5,1].map(Oe=>{const me=Je(Oe),$e=Ie(me),et=80-$e*55,vt=`hsl(210, 70%, ${Math.round(et)}%)`,ct=$t==="weight"?.5+$e*15:At;return{fraction:$e,value:me,color:vt,width:ct}});return{type:"weight",color:"#1f77b4",scale:Fe,min:de,max:re,samples:ze}}}else{if(Re==="direction")return{type:"direction"};if(Re==="single"&&bt==="weight"){const ze=[0,.5,1].map(Oe=>{const me=Je(Oe),$e=Ie(me),et=80-$e*55,vt=`hsl(210, 70%, ${Math.round(et)}%)`,ct=$t==="weight"?.5+$e*15:At;return{fraction:$e,value:me,color:vt,width:ct}});return{type:"weight",color:"#1f77b4",scale:Fe,min:de,max:re,samples:ze}}}})(),lens:{enabled:Bt==="lens",x:Fs.x,y:Fs.y,radius:Ms},onMouseMoveInCanvas:g=>{Bt==="lens"&&Es(g)},onWheelInCanvas:g=>{Bt==="lens"&&Rs(b=>Math.max(20,Math.min(300,b+(g>0?-10:10))))}})})}),V==="table"&&r.jsx(Nt,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Table View Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The table view encountered an error."})]}),children:r.jsx("div",{className:"h-full w-full flex flex-col min-h-0",children:r.jsx(hr,{nodes:O.nodes,edges:O.baseEdges})})}),V==="sankey"&&r.jsx(Nt,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Sankey Diagram Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The Sankey diagram encountered an error."})]}),children:r.jsx("div",{className:"h-full min-h-0",children:r.jsx(Pa,{nodes:O.nodes,edges:O.baseEdges,width:Math.max(800,ot.width-(t?64:s)-(ie?4:rt)-40),height:Math.max(600,ot.height-80)})})}),V==="chord"&&r.jsx(Nt,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Chord Diagram Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The chord diagram encountered an error."})]}),children:r.jsx(Da,{nodes:O.nodes,edges:O.baseEdges,width:Math.max(800,ot.width-(t?64:s)-(ie?4:rt)-40),height:Math.max(600,ot.height-80)})})]}):_e?r.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No data meets the current threshold range (",h.toLocaleString()," - ",x.toLocaleString(),"). Try adjusting the filters."]}):r.jsx("div",{className:"px-6 py-8 text-center text-gray-600 space-y-3",children:typeof c=="number"&&Js[c]?r.jsxs(r.Fragment,{children:[r.jsxs("p",{className:"text-lg font-semibold text-gray-700",children:["No state-to-state migration snapshot for ",c]}),r.jsx("p",{className:"text-sm leading-relaxed",children:Js[c]})]}):r.jsx("p",{children:"No snapshot to display."})})})}),V==="kriskogram"&&r.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center gap-2 bg-white/90 backdrop-blur px-3 py-2 rounded shadow border border-gray-200",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Mode:"}),r.jsx("button",{type:"button",onClick:()=>kn("pan"),className:["text-xs px-2 py-1 rounded border",Bt==="pan"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"].join(" "),children:"Pan"}),r.jsx("button",{type:"button",onClick:()=>kn("lens"),className:["text-xs px-2 py-1 rounded border",Bt==="lens"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"].join(" "),children:"Edge Lens"}),Bt==="lens"&&r.jsxs("span",{className:"text-[10px] text-gray-600",children:["Wheel: radius (",Ms,"px)"]})]})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-lg mb-2",children:"No dataset selected"}),r.jsx("p",{className:"text-sm",children:"Select a dataset from the sidebar to begin exploring"})]})})]}),i&&r.jsx(za,{isCollapsed:ie,onToggle:()=>Se(!ie),onResize:Et,title:"Visualization Settings",bottomContent:r.jsxs("div",{className:"p-3",children:[r.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-2",children:"Visualization Type"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx("button",{onClick:()=>{Z("kriskogram"),K({view:"kriskogram"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${V==="kriskogram"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Kriskogram"}),r.jsx("button",{onClick:()=>{Z("table"),K({view:"table"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${V==="table"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Table"}),r.jsx("button",{onClick:()=>{Z("sankey"),K({view:"sankey"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${V==="sankey"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Sankey"}),r.jsx("button",{onClick:()=>{Z("chord"),K({view:"chord"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${V==="chord"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Chord"})]})]}),children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs(Qt,{title:i.name,defaultOpen:!0,subtitle:`${i.type.toUpperCase()} · ${i.timeRange.start}${i.timeRange.end!==i.timeRange.start?`–${i.timeRange.end}`:""}`,children:[i.notes&&r.jsx("div",{className:"text-xs text-gray-600 mt-2 whitespace-pre-wrap",children:i.notes}),!i.notes&&r.jsx("div",{className:"text-xs text-gray-500 italic mt-2",children:"No description available"})]}),it&&r.jsxs("div",{className:"p-3 bg-gray-50 rounded grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-600",children:"Nodes"}),r.jsxs("div",{className:"text-lg font-bold",children:[it.visibleNodes,"/",it.totalNodes]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-600",children:"Edges"}),r.jsxs("div",{className:"text-lg font-bold",children:[it.visibleEdges.toLocaleString(),"/",it.totalEdges.toLocaleString()]})]})]}),r.jsx(Qt,{title:"General Settings",defaultOpen:!0,onReset:()=>{const g=Math.max(1,Dn);A(null),Ss("none"),y(dt),C(nn),N(g),K({edgeType:null,minThreshold:dt,maxThreshold:nn,maxEdges:g})},children:r.jsxs("div",{className:"space-y-4",children:[vr&&c!==void 0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium",children:["Year: ",c]}),r.jsx("input",{type:"range",min:i.timeRange.start,max:i.timeRange.end,value:c,onChange:g=>br(parseInt(g.target.value)),className:"w-full"})]}),ft&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium",children:["Edge Type (",ft.property,")"]}),r.jsxs("select",{value:L||"all",onChange:g=>{const b=g.target.value==="all"?null:g.target.value;A(b),K({edgeType:b})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"all",children:"All Types"}),ft.values.map(g=>r.jsx("option",{value:g,children:g},g))]})]}),(Pt||Vt)&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-medium",children:"Edge Scope"}),r.jsxs("select",{value:at,onChange:g=>Ss(g.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"none",children:"All"}),Pt&&r.jsx("option",{value:"region",children:"Intra Region"}),Vt&&r.jsx("option",{value:"division",children:"Intra Division"}),Pt&&r.jsx("option",{value:"interRegion",children:"Inter Region"}),Vt&&r.jsx("option",{value:"interDivision",children:"Inter Division"})]})]}),_e&&it&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[r.jsxs("span",{children:["Min: ",h.toLocaleString()]}),Tn!==void 0&&Tn>h&&r.jsxs("span",{className:"text-xs text-gray-400",children:["(actual ",Tn.toLocaleString(),")"]})]}),(()=>{const g=Math.max(1,Dn),b=h>dt||x<nn||E<g;return r.jsx("button",{onClick:()=>{y(dt),C(nn),N(g)},disabled:!b,type:"button",className:`text-xs transition-colors ${b?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,children:"Show All"})})()]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"range",min:dt,max:Kt||1,step:$s,value:h,onChange:g=>{const b=parseInt(g.target.value),$=Math.min(b,x);y($),K({minThreshold:$})},className:"w-full"}),r.jsx("input",{type:"number",min:dt,max:Kt||1,value:h,onChange:g=>{const b=Number.parseInt(g.target.value);if(Number.isNaN(b))return;const $=Math.max(dt,Math.min(b,x));y($),K({minThreshold:$})},className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded-md"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[r.jsxs("span",{children:["Max: ",x.toLocaleString()]}),On!==void 0&&On<x&&r.jsxs("span",{className:"text-xs text-gray-400",children:["(actual ",On.toLocaleString(),")"]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"range",min:dt,max:Kt||1,step:$s,value:x,onChange:g=>{const b=parseInt(g.target.value),$=Math.max(b,h);C($),K({maxThreshold:$})},className:"w-full"}),r.jsx("input",{type:"number",min:dt,max:Kt||1,value:x,onChange:g=>{const b=Number.parseInt(g.target.value);if(Number.isNaN(b))return;const $=Math.min(Kt||1,Math.max(b,h));C($),K({maxThreshold:$})},className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded-md"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium",children:["Max Edges: ",E]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"range",min:10,max:Ln,step:10,value:E,onChange:g=>{const b=parseInt(g.target.value);N(b),K({maxEdges:b})},className:"w-full"}),r.jsx("input",{type:"number",min:1,max:Ln,value:E,onChange:g=>{const b=Number.parseInt(g.target.value);if(Number.isNaN(b))return;const $=Math.max(1,Math.min(b,Ln));N($),K({maxEdges:$})},className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded-md"})]}),r.jsxs("p",{className:"text-xs text-gray-600 italic",children:["After filtering by thresholds and edge type, edges are sorted by value (highest first) and the top ",E," edges are displayed."]})]})]})]})}),V==="kriskogram"&&r.jsx(Qt,{title:"Kriskogram Settings",defaultOpen:!0,onReset:()=>{te(!1),xs("alphabetical"),vs(.85),Rn("weight"),ws(2),_s("single"),Cs(null),Ns("fixed"),js(null),ys(!1),It("direction"),Fn(null),bs(!0),En("weight"),$n(null),An(.6),kn("pan"),Rs(80),Es({x:0,y:0}),W(null),he(1),be(!1),j("linear"),je(!1),Ze("filled"),Le("filled"),xe(1),He(8),Ke(4),gn(0),mn("round"),zt(!1),P(3),K({showAllNodes:!1,egoNodeId:null,egoNeighborSteps:1,egoStepColoring:!1,temporalOverlay:!1,temporalOverlayYears:1,temporalOverlayEdgeStyle:"filled",temporalOverlayNodeStyle:"filled",edgeSegmentLength:8,edgeSegmentGap:4,edgeSegmentOffset:0,edgeSegmentCap:"round",edgeSegmentAnimate:!1,edgeWeightScale:"linear",edgeOutlineGap:3})},children:i!=null&&i.metadata?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-show-all-nodes",className:"text-sm font-medium text-gray-700",children:"Always show all nodes"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Keeps every location visible even if its edges fall outside the filters."})]}),r.jsx("input",{id:"kriskogram-show-all-nodes",type:"checkbox",className:"w-4 h-4",checked:T,onChange:g=>{const b=g.target.checked;te(b),K({showAllNodes:b})}})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Ego Focus"}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-ego-node",className:"text-xs font-medium text-gray-700",children:"Ego focus (optional)"}),r.jsxs("select",{id:"kriskogram-ego-node",value:F??"",onChange:g=>{const b=g.target.value,$=b===""?null:b;$===null?(W(null),ne&&be(!1),K({egoNodeId:null,egoStepColoring:!1})):(W($),K({egoNodeId:$}))},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"No ego focus (show all eligible edges)"}),((_e==null?void 0:_e.nodes)??[]).map(g=>r.jsx("option",{value:g.id,children:g.label||g.id},g.id))]}),r.jsx("p",{className:"mt-1 text-[11px] text-gray-500",children:"Limit the visualization to flows centered on a selected node."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-ego-steps",className:"text-xs font-medium text-gray-700",children:"Neighbor steps"}),r.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[r.jsx("input",{id:"kriskogram-ego-steps",type:"number",min:1,max:10,value:Q,disabled:!F,onChange:g=>{const b=Number.parseInt(g.target.value,10);if(Number.isNaN(b))return;const $=Math.max(1,Math.min(b,10));he($),K({egoNeighborSteps:$})},className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded-md disabled:bg-gray-100 disabled:text-gray-500"}),r.jsx("span",{className:"text-[11px] text-gray-500",children:"How many hops from the ego node to include (based on currently visible edges)."})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-ego-step-coloring",className:"text-xs font-medium text-gray-700",children:"Color edges by neighbor step"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Apply a step-based gradient for ego flows and show it in the legend."})]}),r.jsx("input",{id:"kriskogram-ego-step-coloring",type:"checkbox",className:"w-4 h-4",disabled:!F,checked:ne&&!!F,onChange:g=>{const b=g.target.checked&&!!F;be(b),K({egoStepColoring:b})}})]}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Edge and node styling options are available in the sections below."})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Temporal Overlay"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-temporal-overlay",children:"Show neighboring years"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Overlay edges from nearby years to compare past and future flows."})]}),r.jsx("input",{id:"kriskogram-temporal-overlay",type:"checkbox",className:"w-4 h-4",disabled:!i||i.timeRange.start===i.timeRange.end||typeof c!="number",checked:k&&(i==null?void 0:i.timeRange.start)!==(i==null?void 0:i.timeRange.end),onChange:g=>{const b=g.target.checked;je(b),K({temporalOverlay:b})}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-temporal-overlay-years",children:"Neighbor years"}),r.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[r.jsx("input",{id:"kriskogram-temporal-overlay-years",type:"number",min:1,max:10,value:G,disabled:!k,onChange:g=>{const b=Number.parseInt(g.target.value,10);if(Number.isNaN(b))return;const $=Math.max(1,Math.min(b,10));xe($),K({temporalOverlayYears:$})},className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded-md disabled:bg-gray-100 disabled:text-gray-500"}),r.jsx("span",{className:"text-[11px] text-gray-500",children:"Include the selected number of years before and after the current year."})]}),(!i||i.timeRange.start===i.timeRange.end)&&r.jsx("p",{className:"mt-2 text-[11px] text-gray-400 italic",children:"Temporal overlay is unavailable because this dataset has a single year."})]})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Node"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Node Ordering"}),r.jsxs("select",{value:Te,onChange:g=>xs(g.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"alphabetical",children:"Alphabetical"}),i.metadata.hasCategoricalProperties.nodes.map(g=>r.jsxs("option",{value:g,children:["By ",g]},g)),i.metadata.hasNumericProperties.nodes.map(g=>r.jsxs("option",{value:g,children:["By ",g]},g))]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Node Color"}),r.jsxs("select",{value:Vn,onChange:g=>_s(g.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"single",children:"Single Color"}),r.jsx("option",{value:"visible_outgoing",children:"Visible Outgoing Flow"}),r.jsx("option",{value:"visible_incoming",children:"Visible Incoming Flow"}),r.jsx("option",{value:"year_outgoing",children:"Year Outgoing Flow"}),r.jsx("option",{value:"year_incoming",children:"Year Incoming Flow"}),r.jsx("option",{value:"net_year",children:"Net Flow (year)"}),r.jsx("option",{value:"self_year",children:"Self Flow (year)"}),r.jsx("option",{value:"attribute",children:"By Attribute"})]}),Vn==="attribute"&&r.jsxs("select",{value:Gt||"",onChange:g=>Cs(g.target.value||null),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select..."}),i.metadata.hasCategoricalProperties.nodes.map(g=>r.jsx("option",{value:g,children:g},g)),i.metadata.hasNumericProperties.nodes.map(g=>r.jsx("option",{value:g,children:g},g))]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Node Size"}),r.jsxs("select",{value:Qe,onChange:g=>Ns(g.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"fixed",children:"Fixed"}),r.jsx("option",{value:"visible_outgoing",children:"Visible Outgoing Flow"}),r.jsx("option",{value:"visible_incoming",children:"Visible Incoming Flow"}),r.jsx("option",{value:"year_outgoing",children:"Year Outgoing Flow"}),r.jsx("option",{value:"year_incoming",children:"Year Incoming Flow"}),r.jsx("option",{value:"net_visible",children:"Net Flow (visible)"}),r.jsx("option",{value:"net_year",children:"Net Flow (year)"}),r.jsx("option",{value:"self_year",children:"Self Flow (year)"}),r.jsx("option",{value:"attribute",children:"By Attribute"})]}),Qe==="attribute"&&r.jsxs("select",{value:fn||"",onChange:g=>js(g.target.value||null),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select..."}),i.metadata.hasNumericProperties.nodes.map(g=>r.jsx("option",{value:g,children:g},g))]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-node-styling",children:"Node styling"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Control how nodes are rendered. Outline mode hides the fill and emphasizes the stroke."}),r.jsxs("select",{id:"kriskogram-node-styling",value:H,onChange:g=>{const b=g.target.value;Le(b),K({temporalOverlayNodeStyle:b})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"filled",children:"Filled nodes"}),r.jsx("option",{value:"outline",children:"Outline only"})]})]})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Edge"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Arc Opacity: ",Math.round(Mn*100),"%"]}),r.jsx("input",{type:"range",min:0,max:1,step:.05,value:Mn,onChange:g=>vs(parseFloat(g.target.value)),className:"w-full"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Edge Width"}),r.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeWidthMode",value:"weight",checked:$t==="weight",onChange:()=>Rn("weight"),className:"w-3.5 h-3.5"}),r.jsx("span",{children:"By Weight"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeWidthMode",value:"fixed",checked:$t==="fixed",onChange:()=>Rn("fixed"),className:"w-3.5 h-3.5"}),r.jsx("span",{children:"Fixed"})]})]}),$t==="fixed"&&r.jsxs("div",{className:"mt-2",children:[r.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Base Edge Width: ",At.toFixed(1),"px"]}),r.jsx("input",{type:"range",min:.5,max:8,step:.1,value:At,onChange:g=>ws(parseFloat(g.target.value)),className:"w-full"})]}),r.jsxs("div",{className:"mt-2 space-y-1",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Weight scaling"}),r.jsxs("select",{value:Fe,onChange:g=>{const b=g.target.value;j(b),K({edgeWeightScale:b})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"linear",children:"Linear (use raw weight differences)"}),r.jsx("option",{value:"sqrt",children:"Square root (compress extremes)"}),r.jsx("option",{value:"log",children:"Logarithmic (highlight small flows)"})]}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Applies to both edge widths and weight-based color intensity."})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-edge-style",children:"Line styling"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Choose how edges are drawn. Segmented uses dashed arcs; outline shows a thin perimeter."}),r.jsxs("select",{id:"kriskogram-edge-style",value:se,onChange:g=>{const b=g.target.value;Ze(b),K({temporalOverlayEdgeStyle:b})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"filled",children:"Filled (solid weight)"}),r.jsx("option",{value:"segmented",children:"Segmented (dashed)"}),r.jsx("option",{value:"outline",children:"Outline only"})]}),se==="segmented"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-xs mt-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Dash length (px)"}),r.jsx("input",{type:"number",min:1,step:.5,value:B,onChange:g=>{const b=Number.parseFloat(g.target.value);if(Number.isNaN(b))return;const $=Math.max(1,b);He($),K({edgeSegmentLength:$})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Gap length (px)"}),r.jsx("input",{type:"number",min:.5,step:.5,value:Me,onChange:g=>{const b=Number.parseFloat(g.target.value);if(Number.isNaN(b))return;const $=Math.max(.5,b);Ke($),K({edgeSegmentGap:$})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Initial gap (px)"}),r.jsx("input",{type:"number",min:0,step:.5,value:nt,onChange:g=>{const b=Number.parseFloat(g.target.value);if(Number.isNaN(b))return;const $=Math.max(0,b);gn($),K({edgeSegmentOffset:$})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),se==="segmented"&&r.jsxs("div",{className:"mt-2 space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-[11px] font-medium text-gray-600",htmlFor:"kriskogram-edge-cap",children:"Segment cap style"}),r.jsxs("select",{id:"kriskogram-edge-cap",value:st,onChange:g=>{const b=g.target.value;mn(b),K({edgeSegmentCap:b})},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"round",children:"Rounded segment ends"}),r.jsx("option",{value:"butt",children:"Sharp segment ends"})]})]}),r.jsxs("label",{className:"flex items-center justify-between text-[11px] font-medium text-gray-600",children:[r.jsx("span",{children:"Animate flow"}),r.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5",checked:Ve,onChange:g=>{const b=g.target.checked;zt(b),K({edgeSegmentAnimate:b})}})]})]}),se==="outline"&&r.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Outline thickness (px)"}),r.jsx("input",{type:"range",min:.5,max:12,step:.5,value:M,onChange:g=>{const b=Number.parseFloat(g.target.value);if(Number.isNaN(b))return;const $=Math.max(.5,b);P($),K({edgeOutlineGap:$})},className:"mt-1 w-full"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Precise value"}),r.jsx("input",{type:"number",min:.5,step:.5,value:M,onChange:g=>{const b=Number.parseFloat(g.target.value);if(Number.isNaN(b))return;const $=Math.max(.5,b);P($),K({edgeOutlineGap:$})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Edge Color"}),F&&ne&&r.jsx("span",{className:"text-[11px] text-gray-400",children:"(disabled by neighbor step coloring)"})]}),r.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-gray-600 cursor-pointer",children:[r.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5",disabled:!!(F&&ne),checked:en,onChange:g=>{const b=g.target.checked;F&&ne||(ys(b),b||(It("direction"),Fn(null),bs(!0),En("weight"),$n(null),An(.6)))}}),"Advanced"]})]}),!en&&!(F&&ne)&&r.jsxs("div",{className:"flex flex-col gap-1.5 text-xs",children:[r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeColorHueSimple",value:"direction",checked:Re==="direction",onChange:()=>It("direction"),className:"w-3.5 h-3.5"}),r.jsx("span",{children:"By Direction (Above/Below)"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeColorHueSimple",value:"single",checked:Re==="single",onChange:()=>It("single"),className:"w-3.5 h-3.5"}),r.jsx("span",{children:"Single Color"})]})]}),en&&!(F&&ne)&&r.jsxs("div",{className:"mt-2 space-y-3 border border-gray-200 rounded-md p-3 bg-gray-50/60",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Hue Source"}),r.jsxs("select",{value:Re,onChange:g=>It(g.target.value),className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"direction",children:"Direction (Above/Below)"}),r.jsx("option",{value:"single",children:"Single"}),r.jsx("option",{value:"region",disabled:!Pt,children:"Region"}),r.jsx("option",{value:"division",disabled:!Vt,children:"Division"}),r.jsx("option",{value:"attribute",children:"Attribute"})]}),Re==="attribute"&&(i==null?void 0:i.metadata)&&r.jsxs("div",{className:"mt-2",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Hue Attribute"}),r.jsxs("select",{className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:Ht||"",onChange:g=>Fn(g.target.value||null),children:[r.jsx("option",{value:"",children:"Select attribute…"}),i.metadata.hasCategoricalProperties.edges.concat(i.metadata.hasNumericProperties.edges).map(g=>r.jsx("option",{value:g,children:g},g))]})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Intensity Source"}),r.jsxs("select",{value:bt,onChange:g=>En(g.target.value),className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"weight",children:"Weight"}),r.jsx("option",{value:"constant",children:"Constant"}),r.jsx("option",{value:"attribute",children:"Attribute"})]}),bt==="constant"&&r.jsxs("div",{className:"mt-2",children:[r.jsxs("label",{className:"text-xs text-gray-600",children:["Constant Intensity: ",(In*100).toFixed(0),"%"]}),r.jsx("input",{type:"range",min:0,max:1,step:.01,value:In,onChange:g=>An(parseFloat(g.target.value)),className:"w-full"})]}),bt==="attribute"&&(i==null?void 0:i.metadata)&&r.jsxs("div",{className:"mt-2",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Intensity Attribute"}),r.jsxs("select",{className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:tn||"",onChange:g=>$n(g.target.value||null),children:[r.jsx("option",{value:"",children:"Select attribute…"}),i.metadata.hasNumericProperties.edges.map(g=>r.jsx("option",{value:g,children:g},g))]})]})]})]})]})]})]}):r.jsx("div",{className:"text-xs text-gray-500 italic",children:"No dataset metadata available"})}),V==="table"&&r.jsx(Qt,{title:"Table Settings",defaultOpen:!1,children:r.jsx("div",{className:"text-xs text-gray-500 italic",children:"Settings to be added"})}),V==="sankey"&&r.jsx(Qt,{title:"Sankey Settings",defaultOpen:!1,children:r.jsx("div",{className:"text-xs text-gray-500 italic",children:"Settings to be added"})}),V==="chord"&&r.jsx(Qt,{title:"Chord Settings",defaultOpen:!1,children:r.jsx("div",{className:"text-xs text-gray-500 italic",children:"Settings to be added"})})]})})]})})}async function Ba(){const e="csv-usa-pre-2020",n="csv-usa-post-2020",t="csv-2021",s="gexf-sample",o="swiss-2016";let a=await Mt(e),l=await Mt(n);const i=S=>S?S.snapshots.every(h=>{const y=new Set(h.nodes.map(x=>x.label));if(y.size!==Ga)return!1;for(const x of y)if(!Ha.has(x))return!1;return!0}):!1;(a?!i(a):!1)&&(await os(e).catch(()=>{}),a=void 0),(l?!i(l):!1)&&(await os(n).catch(()=>{}),l=void 0);let d=!!a,p=!!l;const f=await Mt(t),m=await Mt(s),w=await Mt(o),_=async S=>{const h=[];for(const y of S)try{const x=new URL(Object.assign({"../data/StateToStateMigrationUSCSV/state_to_state_migration_table_2022_t13_updated_2024_06_27_2022.csv":go,"../data/StateToStateMigrationUSCSV/state_to_state_migration_table_2023_t13_2023.csv":mo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2005_2005.csv":fo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2005_2007_2005-2007.csv":po,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2005_2009_2005-2009.csv":ho,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2006_2006.csv":xo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2006_2008_2006-2008.csv":vo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2007_2007.csv":yo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2007_2009_2007-2009.csv":bo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2008_2008.csv":So,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2009_2009.csv":wo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2010_2010.csv":_o,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2011_2011.csv":Co,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2012_2012.csv":No,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2013_2013.csv":jo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2014_2014.csv":Mo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2015_2015.csv":Ro,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2016_2016.csv":Fo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2017_2017.csv":Eo,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2018_2018.csv":$o,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2019_2019.csv":Io,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2021_2021.csv":Ao})[`../data/StateToStateMigrationUSCSV/${y.filename}`],import.meta.url),C=await vn(x.toString()),E=ns(C);h.push({timestamp:y.year,nodes:E.nodes,edges:E.edges})}catch(x){console.warn(`⚠️ Failed to load snapshot for ${y.filename}:`,x)}return h.sort((y,x)=>{const C=typeof y.timestamp=="string"?Number.parseInt(y.timestamp,10):y.timestamp,E=typeof x.timestamp=="string"?Number.parseInt(x.timestamp,10):x.timestamp;return C-E}),h};if(!a){const S=As.filter(y=>y.year<=2019),h=await _(S);if(h.length>0){const y=h[0],x=h[h.length-1],C=Tt(y),E={id:e,name:"US State-to-State Migration (2005-2019)",notes:"Tidy ACS 1-year state-to-state migration flows from 2005 through 2019. The Census Bureau did not release 2020 1-year migration flows, so the series stops before the pandemic.",type:"csv",timeRange:{start:typeof y.timestamp=="string"?Number.parseInt(y.timestamp,10):y.timestamp,end:typeof x.timestamp=="string"?Number.parseInt(x.timestamp,10):x.timestamp},snapshots:h,metadata:C,createdAt:Date.now()};await jt(E),d=!0}}if(!l){const S=As.filter(y=>y.year>=2021),h=await _(S);if(h.length>0){const y=h[0],x=h[h.length-1],C=Tt(y),E={id:n,name:"US State-to-State Migration (2021-2023)",notes:"Post-2020 ACS 1-year state-to-state migration flows. The 2022 release includes revised Connecticut flows per Census errata guidance.",type:"csv",timeRange:{start:typeof y.timestamp=="string"?Number.parseInt(y.timestamp,10):y.timestamp,end:typeof x.timestamp=="string"?Number.parseInt(x.timestamp,10):x.timestamp},snapshots:h,metadata:C,createdAt:Date.now()};await jt(E),p=!0}}if(!f){const S=new URL("/INF358_Project_Kriskogram/assets/State_to_State_Migrations_Table_2021-N7RTh5uH.csv",import.meta.url),h=await vn(S.toString()),y=ns(h),x={timestamp:2021,nodes:y.nodes,edges:y.edges},C=Tt(x),E={id:t,name:"US State-to-State Migration (2021)",notes:"Real U.S. Census Bureau data showing migration flows between all 50 states from the American Community Survey 1-Year Estimates.",type:"csv",timeRange:{start:2021,end:2021},snapshots:[x],metadata:C,createdAt:Date.now()};await jt(E)}if(!m){const S=new URL("/INF358_Project_Kriskogram/assets/sample-migration-data-Dify6Mt1.gexf",import.meta.url),h=await Ir(S.toString()),y=nr(h),x=y.length>0?Tt(y[0]):void 0,C={id:s,name:"Sample Migration (GEXF)",notes:"AI-generated sample network dataset in GEXF format demonstrating temporal migration patterns with multiple time slices. This example dataset includes economic, geographic, and migration type attributes for demonstration purposes.",type:"gexf",timeRange:h.timeRange,snapshots:y,metadata:x,createdAt:Date.now()};await jt(C)}if(!w){const S="/INF358_Project_Kriskogram/",h=`${S}data/Swiss_Relocations_2016_locations.csv`,y=`${S}data/Swiss_Relocations_2016_flows.csv`,x=await vn(h),C=await vn(y),E=ar({nodesFile:{content:x,idField:"id",labelField:"name"},edgesFile:{content:C,sourceField:"origin",targetField:"dest",valueField:"count"}}),N={timestamp:2016,nodes:E.nodes,edges:E.edges},L=Tt(N),A={id:o,name:"Swiss Relocations (2016)",notes:"Relocations between Swiss cantons in 2016. This dataset contains 521,510 trips and uses a two-file CSV format with separate files for locations (cantons) and flows (relocations). Created by Ilya Boyandin.",type:"csv-two-file",timeRange:{start:2016,end:2016},snapshots:[N],metadata:L,createdAt:Date.now()};await jt(A)}if(d)return e;if(p)return n;if(f)return t}export{Xa as component};
