const b={Connecticut:{region:"Northeast",division:"New England"},Maine:{region:"Northeast",division:"New England"},Massachusetts:{region:"Northeast",division:"New England"},"New Hampshire":{region:"Northeast",division:"New England"},"Rhode Island":{region:"Northeast",division:"New England"},Vermont:{region:"Northeast",division:"New England"},"New Jersey":{region:"Northeast",division:"Mid-Atlantic"},"New York":{region:"Northeast",division:"Mid-Atlantic"},Pennsylvania:{region:"Northeast",division:"Mid-Atlantic"},Delaware:{region:"Northeast",division:"Mid-Atlantic"},Maryland:{region:"Northeast",division:"Mid-Atlantic"},Illinois:{region:"Midwest",division:"East North Central"},Indiana:{region:"Midwest",division:"East North Central"},Michigan:{region:"Midwest",division:"East North Central"},Ohio:{region:"Midwest",division:"East North Central"},Wisconsin:{region:"Midwest",division:"East North Central"},Iowa:{region:"Midwest",division:"West North Central"},Kansas:{region:"Midwest",division:"West North Central"},Minnesota:{region:"Midwest",division:"West North Central"},Missouri:{region:"Midwest",division:"West North Central"},Nebraska:{region:"Midwest",division:"West North Central"},"North Dakota":{region:"Midwest",division:"West North Central"},"South Dakota":{region:"Midwest",division:"West North Central"},"District of Columbia":{region:"South",division:"South Atlantic"},Florida:{region:"South",division:"South Atlantic"},Georgia:{region:"South",division:"South Atlantic"},"North Carolina":{region:"South",division:"South Atlantic"},"South Carolina":{region:"South",division:"South Atlantic"},Virginia:{region:"South",division:"South Atlantic"},"West Virginia":{region:"South",division:"South Atlantic"},Alabama:{region:"South",division:"East South Central"},Kentucky:{region:"South",division:"East South Central"},Mississippi:{region:"South",division:"East South Central"},Tennessee:{region:"South",division:"East South Central"},Arkansas:{region:"South",division:"West South Central"},Louisiana:{region:"South",division:"West South Central"},Oklahoma:{region:"South",division:"West South Central"},Texas:{region:"South",division:"West South Central"},Arizona:{region:"West",division:"Mountain"},Colorado:{region:"West",division:"Mountain"},Idaho:{region:"West",division:"Mountain"},Montana:{region:"West",division:"Mountain"},Nevada:{region:"West",division:"Mountain"},"New Mexico":{region:"West",division:"Mountain"},Utah:{region:"West",division:"Mountain"},Wyoming:{region:"West",division:"Mountain"},Alaska:{region:"West",division:"Pacific"},California:{region:"West",division:"Pacific"},Hawaii:{region:"West",division:"Pacific"},Oregon:{region:"West",division:"Pacific"},Washington:{region:"West",division:"Pacific"}},L={Northeast:"#3b82f6",Midwest:"#f59e0b",South:"#ef4444",West:"#10b981"},y={"New England":"#60a5fa","Mid-Atlantic":"#3b82f6","East North Central":"#fbbf24","West North Central":"#f59e0b","South Atlantic":"#f87171","East South Central":"#ef4444","West South Central":"#dc2626",Mountain:"#34d399",Pacific:"#10b981"};function I(t){const i=t.trim().split(`
`);if(i.length<2)throw new Error("Invalid CSV format: not enough data");const n=W(i[0]).map(l=>l.toLowerCase());return n.includes("source_id")&&n.includes("destination_id")?V(i):O(i)}function O(t){var w,N,M;if(t.length<4)throw new Error("Invalid legacy CSV format: needs at least 4 lines (3 headers + data)");const i=t[1],n=W(i),l=[];for(let a=7;a<n.length;a+=2){const r=n[a].trim();r&&r!=="Total"&&!r.includes("year ago")&&l.push(r)}const c=[],h=[],S=new Set;for(let a=3;a<t.length;a++){const r=W(t[a]),v=(w=r[0])==null?void 0:w.trim();if(!v||v==="Puerto Rico")continue;const d=A(v);if(!S.has(d)){S.add(d);const o=b[v];c.push({id:d,label:v,region:o==null?void 0:o.region,division:o==null?void 0:o.division})}let s=0;for(let o=9;o<r.length&&s<l.length;o+=2){const g=l[s];if(s++,!g)continue;const u=A(g),C=(N=r[o])==null?void 0:N.trim(),f=(M=r[o+1])==null?void 0:M.trim();if(d===u)continue;if(!S.has(u)){S.add(u);const m=b[g];c.push({id:u,label:g,region:m==null?void 0:m.region,division:m==null?void 0:m.division})}const p=E(C);if(p<=0)continue;const e={source:d,target:u,value:p},x=E(f==null?void 0:f.replace("+/-",""));x>0&&(e.moe=x),h.push(e)}}return c.sort((a,r)=>a.label.localeCompare(r.label)),{nodes:c,edges:h}}function V(t){var r,v;const i=W(t[0]).map(d=>d.trim().toLowerCase()),n=i.indexOf("source_id"),l=i.indexOf("source_label"),c=i.indexOf("destination_id"),h=i.indexOf("destination_label"),S=i.indexOf("estimate"),w=i.indexOf("moe");if(l===-1||h===-1||S===-1)throw new Error("Invalid tidy CSV: missing required headers");const N=[],M=[],a=new Set;for(let d=1;d<t.length;d++){const s=W(t[d]);if(!s.length)continue;const o=(r=s[l])==null?void 0:r.trim(),g=(v=s[h])==null?void 0:v.trim();if(!o||!g)continue;const u=n>=0&&s[n]?s[n].trim():A(o),C=c>=0&&s[c]?s[c].trim():A(g),f=E(s[S]);if(!Number.isFinite(f)||f<=0)continue;if(!a.has(u)){a.add(u);const e=b[o];N.push({id:u,label:o,region:e==null?void 0:e.region,division:e==null?void 0:e.division})}if(!a.has(C)){a.add(C);const e=b[g];N.push({id:C,label:g,region:e==null?void 0:e.region,division:e==null?void 0:e.division})}const p={source:u,target:C,value:f};if(w!==-1){const e=E(s[w]);Number.isFinite(e)&&e>0&&(p.moe=e)}M.push(p)}return N.sort((d,s)=>d.label.localeCompare(s.label)),{nodes:N,edges:M}}function W(t){const i=[];let n="",l=!1;for(let c=0;c<t.length;c++){const h=t[c];h==='"'?l=!l:h===","&&!l?(i.push(n),n=""):n+=h}return i.push(n),i}function E(t){if(!t)return 0;const i=t.replace(/[",]/g,""),n=Number.parseFloat(i);return Number.isNaN(n)?0:n}function A(t){return t.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"").toUpperCase()}async function _(t){const i=await fetch(t);if(!i.ok)throw new Error(`Failed to load CSV: ${i.statusText}`);return i.text()}export{y as D,L as R,_ as l,I as p};
