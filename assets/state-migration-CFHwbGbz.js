import{r as p,j as e,K as Y}from"./main-BmmB7oxK.js";import{l as J,p as Q,R as z,D as K}from"./csv-parser-BH7H656y.js";const E=d=>({id:d.id,label:d.label,region:d.region,division:d.division}),T=d=>({source:d.source,target:d.target,value:d.value,...d.moe!==void 0?{moe:d.moe}:{}});function O(d){const a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null}function D(d,a,j){d/=255,a/=255,j/=255;const N=Math.max(d,a,j),b=Math.min(d,a,j);let y=0,k=0;const v=(N+b)/2;if(N!==b){const M=N-b;switch(k=v>.5?M/(2-N-b):M/(N+b),N){case d:y=((a-j)/M+(a<j?6:0))/6;break;case a:y=((j-d)/M+2)/6;break;case j:y=((d-a)/M+4)/6;break}}return{h:y*360,s:k*100,l:v*100}}function X({csvUrl:d="/INF358_Project_Kriskogram/data/State_to_State_Migrations_Table_2021.csv"}){const[a,j]=p.useState(null),[N,b]=p.useState(!0),[y,k]=p.useState(null),[v,M]=p.useState(5e3),[w,W]=p.useState(2e5),[$,G]=p.useState(200),[f,I]=p.useState("grayscale"),[C,R]=p.useState("alphabetical"),[V,U]=p.useState(.6),S=p.useRef(null);p.useEffect(()=>{H()},[d]);const H=async()=>{b(!0),k(null);try{const s=await J(d),n=Q(s);j(n)}catch(s){k(s instanceof Error?s.message:"Failed to load CSV data")}finally{b(!1)}},g=a?a.edges.filter(s=>s.value>=v&&s.value<=w).sort((s,n)=>n.value-s.value).slice(0,$):[],F=new Set;for(const s of g)F.add(s.source),F.add(s.target);const _=a?a.nodes.filter(s=>F.has(s.id)):[],Z=s=>{const n=Math.min(s,w);if(M(n),S.current&&a){const i=a.edges.filter(l=>l.value>=n&&l.value<=w).sort((l,m)=>m.value-l.value).slice(0,$),r=new Set;for(const l of i)r.add(l.source),r.add(l.target);const t=a.nodes.filter(l=>r.has(l.id));S.current.updateData(t.map(E),i.map(T))}},B=s=>{const n=Math.max(s,v);if(W(n),S.current&&a){const i=a.edges.filter(l=>l.value>=v&&l.value<=n).sort((l,m)=>m.value-l.value).slice(0,$),r=new Set;for(const l of i)r.add(l.source),r.add(l.target);const t=a.nodes.filter(l=>r.has(l.id));S.current.updateData(t.map(E),i.map(T))}},P=s=>{if(G(s),S.current&&a){const n=a.edges.filter(t=>t.value>=v&&t.value<=w).sort((t,l)=>l.value-t.value).slice(0,s),i=new Set;for(const t of n)i.add(t.source),i.add(t.target);const r=a.nodes.filter(t=>i.has(t.id));S.current.updateData(r.map(E),n.map(T))}};if(N)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-lg",children:"Loading state migration data..."})});if(y)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-red-600",children:["Error: ",y]})});if(!a)return e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"text-gray-500",children:"No data available"})});const q=a.edges.reduce((s,n)=>s+n.value,0)/a.edges.length,A=Math.max(...a.edges.map(s=>s.value));return e.jsx("div",{className:"p-6 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"State-to-State Migration Data (2021)"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Source: U.S. Census Bureau - American Community Survey 1-Year Estimates"}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total States"}),e.jsx("div",{className:"text-2xl font-bold",children:a.nodes.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Migration Flows"}),e.jsx("div",{className:"text-2xl font-bold",children:a.edges.length.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Visible Nodes"}),e.jsx("div",{className:"text-2xl font-bold",children:_.length})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Visible Edges"}),e.jsx("div",{className:"text-2xl font-bold",children:g.length})]})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Arc Color Mode"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorMode",value:"grayscale",checked:f==="grayscale",onChange:s=>I(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Grayscale"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorMode",value:"region",checked:f==="region",onChange:s=>I(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Region (4 regions)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"colorMode",value:"division",checked:f==="division",onChange:s=>I(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Division (9 divisions)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Node Ordering (Horizontal Axis)"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"orderMode",value:"alphabetical",checked:C==="alphabetical",onChange:s=>R(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"Alphabetical"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"orderMode",value:"region",checked:C==="region",onChange:s=>R(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"By Region"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"orderMode",value:"division",checked:C==="division",onChange:s=>R(s.target.value),className:"w-4 h-4"}),e.jsx("span",{children:"By Division"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Minimum Migration Threshold: ",v.toLocaleString()," people"]}),e.jsx("button",{onClick:()=>{Z(0),B(Math.round(A))},className:"text-xs text-blue-600 hover:text-blue-800",children:"Show All"})]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:0,max:2e5,step:1e3,value:v,onChange:s=>Z(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"0"}),e.jsxs("span",{children:["Average: ",Math.round(q).toLocaleString()]}),e.jsx("span",{className:"font-semibold",children:"200,000"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Maximum Migration Threshold: ",w.toLocaleString()," people"]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:0,max:2e5,step:1e3,value:w,onChange:s=>B(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"0"}),e.jsxs("span",{children:["Max in data: ",Math.round(A).toLocaleString()]}),e.jsx("span",{className:"font-semibold",children:"200,000"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Max Edges to Display: ",$]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:10,max:500,step:10,value:$,onChange:s=>P(parseInt(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"Min: 10"}),e.jsx("span",{children:"250"}),e.jsx("span",{className:"font-semibold",children:"Max: 500"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Arc Opacity: ",Math.round(V*100),"%"]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsx("input",{type:"range",min:0,max:1,step:.05,value:V,onChange:s=>U(parseFloat(s.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{className:"font-semibold",children:"0% (Transparent)"}),e.jsx("span",{children:"50%"}),e.jsx("span",{className:"font-semibold",children:"100% (Opaque)"})]})]})]})]}),e.jsx("div",{className:"border-2 border-gray-200 rounded-lg p-4 bg-white",children:_.length>0&&g.length>0?e.jsxs("div",{children:[e.jsx(Y,{ref:S,nodes:_.map(E),edges:g.map(T),width:1200,height:700,margin:{top:80,right:40,bottom:120,left:40},arcOpacity:V,accessors:{nodeOrder:s=>{const n=s;return C==="region"?`${n.region||"ZZZ"}_${n.label||n.id}`:C==="division"?`${n.division||"ZZZ"}_${n.label||n.id}`:n.label||n.id},nodeColor:()=>"#2563eb",nodeRadius:()=>5,edgeWidth:s=>{const n=s,i=.5,r=15,t=Math.log(n.value+1)/Math.log(A+1);return i+t*(r-i)},edgeColor:s=>{const n=s,i=n.value/A,r=f==="division"?[85,55,25]:[85,70,55,40,25],t=1/r.length,l=Math.min(Math.floor(i/t),r.length-1),m=r[l];if(f==="grayscale")return`hsl(0, 0%, ${m}%)`;if(f==="region"){const c=a==null?void 0:a.nodes.find(h=>h.id===n.source),o=a==null?void 0:a.nodes.find(h=>h.id===n.target);if(c!=null&&c.region&&(o!=null&&o.region)&&c.region===o.region){const h=z[c.region],x=O(h);if(x){const u=D(x.r,x.g,x.b);return`hsl(${u.h}, ${u.s}%, ${m}%)`}return h}else return`hsl(0, 0%, ${m}%)`}else{const c=a==null?void 0:a.nodes.find(h=>h.id===n.source),o=a==null?void 0:a.nodes.find(h=>h.id===n.target);if(c!=null&&c.division&&(o!=null&&o.division)&&c.division===o.division){const h=K[c.division],x=O(h);if(x){const u=D(x.r,x.g,x.b);return`hsl(${u.h}, ${u.s}%, ${m}%)`}return h}else return`hsl(0, 0%, ${m}%)`}}}},`kriskogram-${f}-${C}-${V}`),e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Legend"}),f==="grayscale"?e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx("div",{className:"text-gray-700 font-semibold mb-2",children:"All Flows (grayscale with weight-based luminosity):"}),e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const s=Math.min(...g.map(t=>t.value)),i=Math.max(...g.map(t=>t.value))-s,r=[85,70,55,40,25];return r.map((t,l)=>{const m=i/r.length,c=Math.round(s+l*m),o=Math.round(s+(l+1)*m);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 h-3 border border-gray-300",style:{backgroundColor:`hsl(0, 0%, ${t}%)`}}),e.jsxs("span",{className:"text-[10px] text-gray-600",children:[c.toLocaleString()," - ",o.toLocaleString()," people"]})]},l)})})()}),e.jsx("div",{className:"text-gray-600 mt-2",children:"Edge width = log-scaled volume"})]}):f==="region"?e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx("div",{className:"text-gray-700 font-semibold",children:"Same-Region Flows (colored by region):"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(z).map(([s,n])=>{const i=O(n),r=i?D(i.r,i.g,i.b):null,t=Math.min(...g.map(o=>o.value)),m=Math.max(...g.map(o=>o.value))-t,c=[85,70,55,40,25];return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:s}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex flex-col gap-0.5",children:r&&c.map((o,h)=>{const x=m/c.length,u=Math.round(t+h*x),L=Math.round(t+(h+1)*x);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-12 h-2",style:{backgroundColor:`hsl(${r.h}, ${r.s}%, ${o}%)`}}),e.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap",children:[u.toLocaleString(),"-",L.toLocaleString()]})]},h)})})})]},s)})}),e.jsxs("div",{className:"pt-2 border-t border-gray-300",children:[e.jsx("div",{className:"text-gray-700 font-semibold mb-1",children:"Cross-Region Flows (grayscale):"}),e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const s=Math.min(...g.map(t=>t.value)),i=Math.max(...g.map(t=>t.value))-s,r=[85,55,25];return r.map((t,l)=>{const m=i/r.length,c=Math.round(s+l*m),o=Math.round(s+(l+1)*m);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-12 h-2 border border-gray-300",style:{backgroundColor:`hsl(0, 0%, ${t}%)`}}),e.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap",children:[c.toLocaleString(),"-",o.toLocaleString()]})]},l)})})()})]})]}):e.jsxs("div",{className:"space-y-3 text-xs",children:[e.jsx("div",{className:"text-gray-700 font-semibold",children:"Same-Division Flows (colored by division):"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(K).map(([s,n])=>{const i=O(n),r=i?D(i.r,i.g,i.b):null,t=Math.min(...g.map(o=>o.value)),m=Math.max(...g.map(o=>o.value))-t,c=[85,55,25];return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-[10px]",children:s}),e.jsx("div",{className:"flex flex-col gap-0.5",children:r&&c.map((o,h)=>{const x=m/c.length,u=Math.round(t+h*x),L=Math.round(t+(h+1)*x);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-6 h-2",style:{backgroundColor:`hsl(${r.h}, ${r.s}%, ${o}%)`}}),e.jsxs("span",{className:"text-[8px] text-gray-600 whitespace-nowrap",children:[u>999?`${Math.round(u/1e3)}k`:u,"-",L>999?`${Math.round(L/1e3)}k`:L]})]},h)})})]},s)})}),e.jsxs("div",{className:"pt-2 border-t border-gray-300",children:[e.jsx("div",{className:"text-gray-700 font-semibold mb-1",children:"Cross-Division Flows (grayscale):"}),e.jsx("div",{className:"flex flex-col gap-1",children:(()=>{const s=Math.min(...g.map(t=>t.value)),i=Math.max(...g.map(t=>t.value))-s,r=[85,55,25];return r.map((t,l)=>{const m=i/r.length,c=Math.round(s+l*m),o=Math.round(s+(l+1)*m);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-12 h-2 border border-gray-300",style:{backgroundColor:`hsl(0, 0%, ${t}%)`}}),e.jsxs("span",{className:"text-[9px] text-gray-600 whitespace-nowrap",children:[c>999?`${Math.round(c/1e3)}k`:c,"-",o>999?`${Math.round(o/1e3)}k`:o]})]},l)})})()})]})]})]})]}):e.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No migration data meets the current threshold range (",v.toLocaleString()," - ",w.toLocaleString(),"). Try adjusting the thresholds."]})}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"About This Visualization"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Each state is represented as a node along the baseline"}),e.jsx("li",{children:"• Arcs represent migration flows between states in 2021"}),e.jsx("li",{children:"• Arc thickness indicates migration volume (log-scaled for visibility)"}),e.jsx("li",{children:"• Arc luminosity (darkness) shows migration volume - darker arcs = higher migration"}),e.jsx("li",{children:e.jsx("strong",{children:"Color Modes:"})}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Grayscale:"})," All arcs in grayscale with weight-based luminosity"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Region:"})," Same-region migrations colored by 4 U.S. regions (Northeast=Blue, Midwest=Amber, South=Red, West=Green)"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Division:"})," Same-division migrations colored by 9 U.S. Census divisions for finer granularity"]}),e.jsx("li",{children:e.jsx("strong",{children:"Node Ordering:"})}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"Alphabetical:"})," States sorted A-Z"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"By Region:"})," States grouped by region (Northeast, Midwest, South, West)"]}),e.jsxs("li",{className:"ml-4",children:["◦ ",e.jsx("strong",{children:"By Division:"})," States grouped by census division (New England, Mid-Atlantic, etc.)"]}),e.jsx("li",{children:"• Use the min/max threshold sliders to focus on a specific range of migration volumes"}),e.jsx("li",{children:"• Adjust max edges to limit visual complexity"}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Arc Opacity slider:"})," Control transparency to see overlapping migration patterns (lower = more transparent)"]})]})]}),e.jsxs("details",{className:"mt-6",children:[e.jsx("summary",{className:"cursor-pointer font-semibold text-gray-900 p-2 bg-gray-100 rounded hover:bg-gray-200",children:"Top 20 Migration Flows"}),e.jsx("div",{className:"mt-2 overflow-auto max-h-96",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"From"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"To"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Migrants"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"MOE (±)"})]})}),e.jsx("tbody",{children:a.edges.sort((s,n)=>n.value-s.value).slice(0,20).map((s,n)=>{const i=a.nodes.find(t=>t.id===s.source),r=a.nodes.find(t=>t.id===s.target);return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:(i==null?void 0:i.label)||s.source}),e.jsx("td",{className:"px-4 py-2",children:(r==null?void 0:r.label)||s.target}),e.jsx("td",{className:"px-4 py-2 text-right font-mono",children:s.value.toLocaleString()}),e.jsx("td",{className:"px-4 py-2 text-right font-mono text-gray-500",children:s.moe?s.moe.toLocaleString():"-"})]},n)})})]})})]})]})})}function te(){return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx(X,{})})}export{te as component};
