import{c as ys,r as p,j as r,i as Gs,f as Bs,s as De,o as fo,a as gn,z as To,b as Lo,C as zo,G as Ho,u as Go,d as Bo,e as Wo,K as Uo,g as Kr,h as cn,k as qo,p as Ee,l as mn,n as lt,m as Ko,q as Yo}from"./main-BmmB7oxK.js";import{p as us,l as Sr}from"./csv-parser-BH7H656y.js";import{p as Xo,g as po,l as Zo}from"./gexf-parser-ChiJebeW.js";import{S as Qo,a as Ws}from"./stateMigrationFiles-CyfipyKt.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jo=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ea=ys("ChevronDown",Jo);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],na=ys("ChevronUp",ta);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Us=ys("Settings",ra);function sa(e,n){return e==null||n==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}var qs=Math.abs,Yr=Math.cos,Xr=Math.sin,ho=Math.PI,wr=ho/2,Ks=ho*2,Ys=Math.max,Zr=1e-12;function Xs(e,n){return Array.from({length:n-e},(t,s)=>e+s)}function oa(e){return function(n,t){return e(n.source.value+n.target.value,t.source.value+t.target.value)}}function aa(){return ia(!1)}function ia(e,n){var t=0,s=null,o=null,a=null;function u(i){var d=i.length,m=new Array(d),g=Xs(0,d),y=new Array(d*d),x=new Array(d),f=0,w;i=Float64Array.from({length:d*d},(C,S)=>i[S/d|0][S%d]);for(let C=0;C<d;++C){let S=0;for(let v=0;v<d;++v)S+=i[C*d+v]+e*i[v*d+C];f+=m[C]=S}f=Ys(0,Ks-t*d)/f,w=f?t:Ks/d;{let C=0;s&&g.sort((S,v)=>s(m[S],m[v]));for(const S of g){const v=C;{const _=Xs(0,d).filter(b=>i[S*d+b]||i[b*d+S]);o&&_.sort((b,$)=>o(i[S*d+b],i[S*d+$]));for(const b of _){let $;if(S<b?($=y[S*d+b]||(y[S*d+b]={source:null,target:null}),$.source={index:S,startAngle:C,endAngle:C+=i[S*d+b]*f,value:i[S*d+b]}):($=y[b*d+S]||(y[b*d+S]={source:null,target:null}),$.target={index:S,startAngle:C,endAngle:C+=i[S*d+b]*f,value:i[S*d+b]},S===b&&($.source=$.target)),$.source&&$.target&&$.source.value<$.target.value){const R=$.source;$.source=$.target,$.target=R}}x[S]={index:S,startAngle:v,endAngle:C,value:m[S]}}C+=w}}return y=Object.values(y),y.groups=x,a?y.sort(a):y}return u.padAngle=function(i){return arguments.length?(t=Ys(0,i),u):t},u.sortGroups=function(i){return arguments.length?(s=i,u):s},u.sortSubgroups=function(i){return arguments.length?(o=i,u):o},u.sortChords=function(i){return arguments.length?(i==null?a=null:(a=oa(i))._=i,u):a&&a._},u}const cs=Math.PI,ds=2*cs,un=1e-6,la=ds-un;function xo(e){this._+=e[0];for(let n=1,t=e.length;n<t;++n)this._+=arguments[n]+e[n]}function ua(e){let n=Math.floor(e);if(!(n>=0))throw new Error(`invalid digits: ${e}`);if(n>15)return xo;const t=10**n;return function(s){this._+=s[0];for(let o=1,a=s.length;o<a;++o)this._+=Math.round(arguments[o]*t)/t+s[o]}}class vs{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?xo:ua(n)}moveTo(n,t){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,t){this._append`L${this._x1=+n},${this._y1=+t}`}quadraticCurveTo(n,t,s,o){this._append`Q${+n},${+t},${this._x1=+s},${this._y1=+o}`}bezierCurveTo(n,t,s,o,a,u){this._append`C${+n},${+t},${+s},${+o},${this._x1=+a},${this._y1=+u}`}arcTo(n,t,s,o,a){if(n=+n,t=+t,s=+s,o=+o,a=+a,a<0)throw new Error(`negative radius: ${a}`);let u=this._x1,i=this._y1,d=s-n,m=o-t,g=u-n,y=i-t,x=g*g+y*y;if(this._x1===null)this._append`M${this._x1=n},${this._y1=t}`;else if(x>un)if(!(Math.abs(y*d-m*g)>un)||!a)this._append`L${this._x1=n},${this._y1=t}`;else{let f=s-u,w=o-i,C=d*d+m*m,S=f*f+w*w,v=Math.sqrt(C),_=Math.sqrt(x),b=a*Math.tan((cs-Math.acos((C+x-S)/(2*v*_)))/2),$=b/_,R=b/v;Math.abs($-1)>un&&this._append`L${n+$*g},${t+$*y}`,this._append`A${a},${a},0,0,${+(y*f>g*w)},${this._x1=n+R*d},${this._y1=t+R*m}`}}arc(n,t,s,o,a,u){if(n=+n,t=+t,s=+s,u=!!u,s<0)throw new Error(`negative radius: ${s}`);let i=s*Math.cos(o),d=s*Math.sin(o),m=n+i,g=t+d,y=1^u,x=u?o-a:a-o;this._x1===null?this._append`M${m},${g}`:(Math.abs(this._x1-m)>un||Math.abs(this._y1-g)>un)&&this._append`L${m},${g}`,s&&(x<0&&(x=x%ds+ds),x>la?this._append`A${s},${s},0,1,${y},${n-i},${t-d}A${s},${s},0,1,${y},${this._x1=m},${this._y1=g}`:x>un&&this._append`A${s},${s},0,${+(x>=cs)},${y},${this._x1=n+s*Math.cos(a)},${this._y1=t+s*Math.sin(a)}`)}rect(n,t,s,o){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+t}h${s=+s}v${+o}h${-s}Z`}toString(){return this._}}function bs(){return new vs}bs.prototype=vs.prototype;var ca=Array.prototype.slice;function Fn(e){return function(){return e}}function da(e){return e.source}function ga(e){return e.target}function Zs(e){return e.radius}function ma(e){return e.startAngle}function fa(e){return e.endAngle}function pa(){return 0}function ha(e){var n=da,t=ga,s=Zs,o=Zs,a=ma,u=fa,i=pa,d=null;function m(){var g,y=n.apply(this,arguments),x=t.apply(this,arguments),f=i.apply(this,arguments)/2,w=ca.call(arguments),C=+s.apply(this,(w[0]=y,w)),S=a.apply(this,w)-wr,v=u.apply(this,w)-wr,_=+o.apply(this,(w[0]=x,w)),b=a.apply(this,w)-wr,$=u.apply(this,w)-wr;if(d||(d=g=bs()),f>Zr&&(qs(v-S)>f*2+Zr?v>S?(S+=f,v-=f):(S-=f,v+=f):S=v=(S+v)/2,qs($-b)>f*2+Zr?$>b?(b+=f,$-=f):(b-=f,$+=f):b=$=(b+$)/2),d.moveTo(C*Yr(S),C*Xr(S)),d.arc(0,0,C,S,v),(S!==b||v!==$)&&(d.quadraticCurveTo(0,0,_*Yr(b),_*Xr(b)),d.arc(0,0,_,b,$)),d.quadraticCurveTo(0,0,C*Yr(S),C*Xr(S)),d.closePath(),g)return d=null,g+""||null}return m.radius=function(g){return arguments.length?(s=o=typeof g=="function"?g:Fn(+g),m):s},m.sourceRadius=function(g){return arguments.length?(s=typeof g=="function"?g:Fn(+g),m):s},m.targetRadius=function(g){return arguments.length?(o=typeof g=="function"?g:Fn(+g),m):o},m.startAngle=function(g){return arguments.length?(a=typeof g=="function"?g:Fn(+g),m):a},m.endAngle=function(g){return arguments.length?(u=typeof g=="function"?g:Fn(+g),m):u},m.padAngle=function(g){return arguments.length?(i=typeof g=="function"?g:Fn(+g),m):i},m.source=function(g){return arguments.length?(n=g,m):n},m.target=function(g){return arguments.length?(t=g,m):t},m.context=function(g){return arguments.length?(d=g??null,m):d},m}function xa(){return ha()}function ya(e){for(var n=e.length/6|0,t=new Array(n),s=0;s<n;)t[s]="#"+e.slice(s*6,++s*6);return t}const yo=ya("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function Gt(e){return function(){return e}}const Qs=Math.abs,Xe=Math.atan2,on=Math.cos,va=Math.max,Qr=Math.min,jt=Math.sin,$n=Math.sqrt,st=1e-12,Kn=Math.PI,Fr=Kn/2,ba=2*Kn;function Sa(e){return e>1?0:e<-1?Kn:Math.acos(e)}function Js(e){return e>=1?Fr:e<=-1?-Fr:Math.asin(e)}function wa(e){let n=3;return e.digits=function(t){if(!arguments.length)return n;if(t==null)n=null;else{const s=Math.floor(t);if(!(s>=0))throw new RangeError(`invalid digits: ${t}`);n=s}return e},()=>new vs(n)}function _a(e){return e.innerRadius}function Ca(e){return e.outerRadius}function Na(e){return e.startAngle}function ja(e){return e.endAngle}function Ma(e){return e&&e.padAngle}function Fa(e,n,t,s,o,a,u,i){var d=t-e,m=s-n,g=u-o,y=i-a,x=y*d-g*m;if(!(x*x<st))return x=(g*(n-a)-y*(e-o))/x,[e+x*d,n+x*m]}function _r(e,n,t,s,o,a,u){var i=e-t,d=n-s,m=(u?a:-a)/$n(i*i+d*d),g=m*d,y=-m*i,x=e+g,f=n+y,w=t+g,C=s+y,S=(x+w)/2,v=(f+C)/2,_=w-x,b=C-f,$=_*_+b*b,R=o-a,I=x*C-w*f,X=(b<0?-1:1)*$n(va(0,R*R*$-I*I)),K=(I*b-_*X)/$,A=(-I*_-b*X)/$,oe=(I*b+_*X)/$,Q=(-I*_+b*X)/$,me=K-S,z=A-v,re=oe-S,J=Q-v;return me*me+z*z>re*re+J*J&&(K=oe,A=Q),{cx:K,cy:A,x01:-g,y01:-y,x11:K*(o/R-1),y11:A*(o/R-1)}}function Ra(){var e=_a,n=Ca,t=Gt(0),s=null,o=Na,a=ja,u=Ma,i=null,d=wa(m);function m(){var g,y,x=+e.apply(this,arguments),f=+n.apply(this,arguments),w=o.apply(this,arguments)-Fr,C=a.apply(this,arguments)-Fr,S=Qs(C-w),v=C>w;if(i||(i=g=d()),f<x&&(y=f,f=x,x=y),!(f>st))i.moveTo(0,0);else if(S>ba-st)i.moveTo(f*on(w),f*jt(w)),i.arc(0,0,f,w,C,!v),x>st&&(i.moveTo(x*on(C),x*jt(C)),i.arc(0,0,x,C,w,v));else{var _=w,b=C,$=w,R=C,I=S,X=S,K=u.apply(this,arguments)/2,A=K>st&&(s?+s.apply(this,arguments):$n(x*x+f*f)),oe=Qr(Qs(f-x)/2,+t.apply(this,arguments)),Q=oe,me=oe,z,re;if(A>st){var J=Js(A/x*jt(K)),be=Js(A/f*jt(K));(I-=J*2)>st?(J*=v?1:-1,$+=J,R-=J):(I=0,$=R=(w+C)/2),(X-=be*2)>st?(be*=v?1:-1,_+=be,b-=be):(X=0,_=b=(w+C)/2)}var _e=f*on(_),fe=f*jt(_),ge=x*on(R),F=x*jt(R);if(oe>st){var B=f*on(b),Ce=f*jt(b),Te=x*on($),ot=x*jt($),L;if(S<Kn)if(L=Fa(_e,fe,Te,ot,B,Ce,ge,F)){var Le=_e-L[0],G=fe-L[1],Be=B-L[0],ke=Ce-L[1],Qe=1/jt(Sa((Le*Be+G*ke)/($n(Le*Le+G*G)*$n(Be*Be+ke*ke)))/2),Pe=$n(L[0]*L[0]+L[1]*L[1]);Q=Qr(oe,(x-Pe)/(Qe-1)),me=Qr(oe,(f-Pe)/(Qe+1))}else Q=me=0}X>st?me>st?(z=_r(Te,ot,_e,fe,f,me,v),re=_r(B,Ce,ge,F,f,me,v),i.moveTo(z.cx+z.x01,z.cy+z.y01),me<oe?i.arc(z.cx,z.cy,me,Xe(z.y01,z.x01),Xe(re.y01,re.x01),!v):(i.arc(z.cx,z.cy,me,Xe(z.y01,z.x01),Xe(z.y11,z.x11),!v),i.arc(0,0,f,Xe(z.cy+z.y11,z.cx+z.x11),Xe(re.cy+re.y11,re.cx+re.x11),!v),i.arc(re.cx,re.cy,me,Xe(re.y11,re.x11),Xe(re.y01,re.x01),!v))):(i.moveTo(_e,fe),i.arc(0,0,f,_,b,!v)):i.moveTo(_e,fe),!(x>st)||!(I>st)?i.lineTo(ge,F):Q>st?(z=_r(ge,F,B,Ce,x,-Q,v),re=_r(_e,fe,Te,ot,x,-Q,v),i.lineTo(z.cx+z.x01,z.cy+z.y01),Q<oe?i.arc(z.cx,z.cy,Q,Xe(z.y01,z.x01),Xe(re.y01,re.x01),!v):(i.arc(z.cx,z.cy,Q,Xe(z.y01,z.x01),Xe(z.y11,z.x11),!v),i.arc(0,0,x,Xe(z.cy+z.y11,z.cx+z.x11),Xe(re.cy+re.y11,re.cx+re.x11),v),i.arc(re.cx,re.cy,Q,Xe(re.y11,re.x11),Xe(re.y01,re.x01),!v))):i.arc(0,0,x,R,$,v)}if(i.closePath(),g)return i=null,g+""||null}return m.centroid=function(){var g=(+e.apply(this,arguments)+ +n.apply(this,arguments))/2,y=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Kn/2;return[on(y)*g,jt(y)*g]},m.innerRadius=function(g){return arguments.length?(e=typeof g=="function"?g:Gt(+g),m):e},m.outerRadius=function(g){return arguments.length?(n=typeof g=="function"?g:Gt(+g),m):n},m.cornerRadius=function(g){return arguments.length?(t=typeof g=="function"?g:Gt(+g),m):t},m.padRadius=function(g){return arguments.length?(s=g==null?null:typeof g=="function"?g:Gt(+g),m):s},m.startAngle=function(g){return arguments.length?(o=typeof g=="function"?g:Gt(+g),m):o},m.endAngle=function(g){return arguments.length?(a=typeof g=="function"?g:Gt(+g),m):a},m.padAngle=function(g){return arguments.length?(u=typeof g=="function"?g:Gt(+g),m):u},m.context=function(g){return arguments.length?(i=g??null,m):i},m}const $a="/INF358_Project_Kriskogram/assets/state_to_state_migration_table_2022_t13_updated_2024_06_27_2022-D7hzY5-5.csv",Ea="/INF358_Project_Kriskogram/assets/state_to_state_migration_table_2023_t13_2023-Da-tSzHC.csv",Ia="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2005_2005-5D0dAV6T.csv",Aa="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2005_2007_2005-2007-C2gBOjzD.csv",ka="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2005_2009_2005-2009-oSLcshdC.csv",Pa="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2006_2006-C-EFanec.csv",Va="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2006_2008_2006-2008-Cp1NRBpc.csv",Oa="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2007_2007-BXoQRRMn.csv",Da="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2007_2009_2007-2009-Qdd3KwND.csv",Ta="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2008_2008--00JWAqc.csv",La="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2009_2009-5yGj8NCd.csv",za="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2010_2010-CSB90FrU.csv",Ha="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2011_2011-BzRnLs5h.csv",Ga="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2012_2012-DrbWwk1R.csv",Ba="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2013_2013-CTsYcw-F.csv",Wa="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2014_2014-D8ze7hKk.csv",Ua="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2015_2015-Sg6Ir2qO.csv",qa="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2016_2016-C26kP0Bk.csv",Ka="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2017_2017-BNMbL_en.csv",Ya="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2018_2018-DTnLPVgj.csv",Xa="/INF358_Project_Kriskogram/assets/state_to_state_migrations_table_2019_2019-Bd1nphS1.csv",Za="/INF358_Project_Kriskogram/assets/State_to_State_Migrations_Table_2021-N7RTh5uH.csv";function dn(e){const n=new Set,t=new Set,s=new Set,o=new Set,a=new Set,u=new Set;return e.nodes.forEach(i=>{Object.keys(i).forEach(d=>{if(d!=="id"&&d!=="label"){n.add(d);const m=i[d];typeof m=="number"?s.add(d):typeof m=="string"&&a.add(d)}})}),e.edges.forEach(i=>{Object.keys(i).forEach(d=>{if(d!=="source"&&d!=="target"&&d!=="value"){t.add(d);const m=i[d];typeof m=="number"?o.add(d):typeof m=="string"&&u.add(d)}})}),{nodeProperties:Array.from(n),edgeProperties:Array.from(t),hasNumericProperties:{nodes:Array.from(s),edges:Array.from(o)},hasCategoricalProperties:{nodes:Array.from(a),edges:Array.from(u)}}}const Qa="kriskogram-db",Ja=1,pt="datasets";function Yn(){return new Promise((e,n)=>{const t=indexedDB.open(Qa,Ja);t.onupgradeneeded=()=>{const s=t.result;s.objectStoreNames.contains(pt)||s.createObjectStore(pt,{keyPath:"id"})},t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)})}async function qt(e){const n=await Yn();return new Promise((t,s)=>{const o=n.transaction(pt,"readwrite");o.objectStore(pt).put(e),o.oncomplete=()=>t(),o.onerror=()=>s(o.error),o.onabort=()=>s(o.error)})}async function Kt(e){const n=await Yn();return new Promise((t,s)=>{const u=n.transaction(pt,"readonly").objectStore(pt).get(e);u.onsuccess=()=>t(u.result),u.onerror=()=>s(u.error)})}async function ei(){const e=await Yn();return new Promise((n,t)=>{const a=e.transaction(pt,"readonly").objectStore(pt).getAll();a.onsuccess=()=>n(a.result||[]),a.onerror=()=>t(a.error)})}async function gs(e){const n=await Yn();return new Promise((t,s)=>{const o=n.transaction(pt,"readwrite");o.objectStore(pt).delete(e),o.oncomplete=()=>t(),o.onerror=()=>s(o.error)})}async function ti(e){const n=await Kt(e);if(!n)throw new Error(`Dataset ${e} not found`);const t={...n,id:`${n.type}-${Date.now()}`,name:`${n.name} (Copy)`,createdAt:Date.now()};return await qt(t),t}async function ni(){const e=await Yn();return new Promise((n,t)=>{const s=e.transaction(pt,"readwrite");s.objectStore(pt).clear(),s.oncomplete=()=>n(),s.onerror=()=>t(s.error)})}async function ri(){if("storage"in navigator&&"persist"in navigator.storage)try{return await navigator.storage.persist()}catch{return!1}return!1}function eo(e){const n=[];let t="",s=!1;for(let o=0;o<e.length;o++){const a=e[o];a==='"'?s=!s:a===","&&!s?(n.push(t),t=""):t+=a}return n.push(t),n}function to(e){const n=e.trim().split(`
`).filter(o=>o.trim());if(n.length===0)throw new Error("CSV file is empty");const t=eo(n[0]).map(o=>o.trim()),s=n.slice(1).map(eo);return{headers:t,rows:s}}function Jr(e){const n=e.replace(/[",]/g,"").trim(),t=Number.parseFloat(n);return Number.isNaN(t)?n:t}function vo(e){var R;const{headers:n,rows:t}=to(e.nodesFile.content),s=n.map(I=>I.toLowerCase().trim()),o=e.nodesFile.idField.toLowerCase().trim(),a=((R=e.nodesFile.labelField)==null?void 0:R.toLowerCase().trim())||o,u=s.indexOf(o),i=e.nodesFile.labelField?s.indexOf(a):u;if(u===-1)throw new Error(`ID field "${e.nodesFile.idField}" not found in nodes file. Available fields: ${n.join(", ")}`);const d=t.map(I=>{const X={id:String(I[u]||"").trim(),label:i>=0?String(I[i]||"").trim():String(I[u]||"").trim()},K=n[u],A=e.nodesFile.labelField?n[i]:K;return n.forEach((oe,Q)=>{var me;if(oe!==K&&oe!==A){const z=((me=I[Q])==null?void 0:me.trim())||"";X[oe]=Jr(z)}}),X}).filter(I=>I.id),m=new Map(d.map(I=>[I.id,I])),{headers:g,rows:y}=to(e.edgesFile.content),x=g.map(I=>I.toLowerCase().trim()),f=e.edgesFile.sourceField.toLowerCase().trim(),w=e.edgesFile.targetField.toLowerCase().trim(),C=e.edgesFile.valueField.toLowerCase().trim(),S=x.indexOf(f),v=x.indexOf(w),_=x.indexOf(C);if(S===-1)throw new Error(`Source field "${e.edgesFile.sourceField}" not found in edges file. Available fields: ${g.join(", ")}`);if(v===-1)throw new Error(`Target field "${e.edgesFile.targetField}" not found in edges file. Available fields: ${g.join(", ")}`);if(_===-1)throw new Error(`Value field "${e.edgesFile.valueField}" not found in edges file. Available fields: ${g.join(", ")}`);const b=y.map(I=>{const X=String(I[S]||"").trim(),K=String(I[v]||"").trim(),A=String(I[_]||"").trim(),oe=Jr(A);if(!X||!K||typeof oe!="number"||oe<=0)return null;(!m.has(X)||!m.has(K))&&console.warn(`Edge references missing node: ${X} -> ${K}`);const Q={source:X,target:K,value:oe},me=g[S],z=g[v],re=g[_];return g.forEach((J,be)=>{var _e;if(J!==me&&J!==z&&J!==re){const fe=((_e=I[be])==null?void 0:_e.trim())||"";Q[J]=Jr(fe)}}),Q}).filter(I=>I!==null),$=new Set;for(const I of b)$.add(I.source),$.add(I.target);for(const I of $)if(!m.has(I)){const X={id:I,label:I};d.push(X),m.set(I,X)}return{nodes:d,edges:b}}function si({onClose:e,onImport:n,fileInputRef:t,onFilesSelected:s,existingFile:o}){const[a,u]=p.useState(""),[i,d]=p.useState(""),[m,g]=p.useState(!1),[y,x]=p.useState({}),[f,w]=p.useState(!1),[C,S]=p.useState(null),[v,_]=p.useState([]),[b,$]=p.useState([]),[R,I]=p.useState(null),X=p.useRef(null),K=p.useRef(null),[A,oe]=p.useState(null),[Q,me]=p.useState(null),[z,re]=p.useState([]),[J,be]=p.useState([]),[_e,fe]=p.useState(""),[ge,F]=p.useState(""),[B,Ce]=p.useState(""),[Te,ot]=p.useState(""),[L,Le]=p.useState(""),[G,Be]=p.useState(null);function ke(E){let D=E.replace(/\.(csv|gexf)$/i,"");return D=D.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/[_-]/g," ").replace(/[^a-zA-Z0-9\s]/g," ").replace(/\s+/g," ").trim(),D.split(" ").map(se=>se.charAt(0).toUpperCase()+se.slice(1).toLowerCase()).join(" ")}p.useEffect(()=>{var E;if(o!=null&&o.parsedData){Be(o.parsedData);const D=((E=o.files[0])==null?void 0:E.name)||"";u(ke(D)),d(o.files.map(se=>se.name).join(", "))}},[o]),p.useEffect(()=>{var E;if(!o&&v.length>0){if(!a||a===ke(((E=v[0])==null?void 0:E.name)||"")){const D=v[0].name;u(ke(D))}i||d(v.map(D=>D.name).join(", "))}},[v]);function Qe(E){const D=[];let se="",Se=!1;for(let ce=0;ce<E.length;ce++){const ve=E[ce];ve==='"'?Se=!Se:ve===","&&!Se?(D.push(se),se=""):se+=ve}return D.push(se),D}function Pe(E){const D=E.trim().split(`
`);if(D.length===0)return[];const se=D[0];return Qe(se).map(Se=>Se.trim().replace(/^"|"$/g,""))}async function fn(E){const D=Array.from(E.target.files||[]);if(D.length===0)return;_(D);const se=await Promise.all(D.map(ce=>ce.text()));$(se);const Se=D[0].name.toLowerCase();if(Se.endsWith(".gexf")){I("gexf"),S("single");try{const ce=Xo(se[0]),ve=po(ce);Be({nodes:ve.length>0?ve[0].nodes:[],edges:ve.length>0?ve[0].edges:[],timeRange:ce.timeRange}),u(D[0].name.replace(".gexf",""))}catch(ce){x({general:ce instanceof Error?ce.message:"Failed to parse GEXF"})}}else if(Se.endsWith(".csv")){if(I("csv"),D.length===1){S("single");try{const ce=us(se[0]);Be({nodes:ce.nodes,edges:ce.edges,timeRange:{start:2021,end:2021}}),u(D[0].name.replace(".csv",""))}catch{S("two-file");const ve=Pe(se[0]);re(ve),be(ve),oe(0);const pe=ve.find(Me=>Me.toLowerCase()==="id"||Me.toLowerCase()==="node"||Me.toLowerCase()==="name"),_t=ve.find(Me=>Me.toLowerCase()==="source"||Me.toLowerCase()==="origin"||Me.toLowerCase()==="from"),qe=ve.find(Me=>Me.toLowerCase()==="target"||Me.toLowerCase()==="dest"||Me.toLowerCase()==="destination"||Me.toLowerCase()==="to"),Mt=ve.find(Me=>Me.toLowerCase()==="value"||Me.toLowerCase()==="count"||Me.toLowerCase()==="weight");pe&&fe(pe),_t&&Ce(_t),qe&&ot(qe),Mt&&Le(Mt),x({general:"Could not parse as state migration format. Please select which file contains nodes and which contains edges."})}}else if(D.length===2){S("two-file");const ce=Pe(se[0]),ve=Pe(se[1]);re(ce),be(ve),oe(0),me(1);const pe=ce.find(ze=>ze.toLowerCase()==="id"),_t=ce.find(ze=>ze.toLowerCase()==="name"||ze.toLowerCase()==="label");pe&&fe(pe),_t&&F(_t);const qe=ve.find(ze=>ze.toLowerCase()==="source"||ze.toLowerCase()==="origin"||ze.toLowerCase()==="from"),Mt=ve.find(ze=>ze.toLowerCase()==="target"||ze.toLowerCase()==="dest"||ze.toLowerCase()==="destination"||ze.toLowerCase()==="to"),Me=ve.find(ze=>ze.toLowerCase()==="value"||ze.toLowerCase()==="count"||ze.toLowerCase()==="weight");qe&&Ce(qe),Mt&&ot(Mt),Me&&Le(Me),Je()}}t.current&&(t.current.value="")}function Je(){if(A===null||Q===null||!_e||!B||!Te||!L){x({general:"Please select all required fields"}),Be(null);return}try{const E=vo({nodesFile:{content:b[A],idField:_e,labelField:ge||_e},edgesFile:{content:b[Q],sourceField:B,targetField:Te,valueField:L}});Be({nodes:E.nodes,edges:E.edges,timeRange:{start:2016,end:2016}}),x({})}catch(E){x({general:E instanceof Error?E.message:"Failed to parse two-file CSV"}),Be(null)}}p.useEffect(()=>{C==="two-file"&&A!==null&&Q!==null&&Je()},[_e,ge,B,Te,L,A,Q]);function Xn(){const E={},D=[];if(a.trim()||(E.name="Dataset name is required"),C==="two-file"&&(A===null&&(E.nodesFile="Please select which file contains nodes"),Q===null&&(E.edgesFile="Please select which file contains edges"),A!==null&&!_e&&(E.nodeIdField="Please select the ID field for nodes"),Q!==null&&!B&&(E.edgeSourceField="Please select the source field for edges"),Q!==null&&!Te&&(E.edgeTargetField="Please select the target field for edges"),Q!==null&&!L&&(E.edgeValueField="Please select the value field for edges")),!G)return E.general="Data parsing failed - please check file format and field selections",E;G.nodes.length===0&&D.push("No nodes found in dataset"),G.edges.length===0&&D.push("No edges found in dataset");const se=new Set(G.nodes.map(ce=>ce.id));se.size!==G.nodes.length&&D.push(`${G.nodes.length-se.size} duplicate node IDs found`);const Se=G.edges.filter(ce=>!se.has(ce.source)||!se.has(ce.target));return Se.length>0&&D.push(`${Se.length} edges reference non-existent nodes`),D.length>0&&(E.summary=D.join("; ")),E}function ct(){y.name&&X.current?(X.current.scrollIntoView({behavior:"smooth",block:"center"}),X.current.focus()):y.summary&&K.current&&K.current.scrollIntoView({behavior:"smooth",block:"center"})}async function Zn(){const E=Xn();if(x(E),Object.keys(E).filter(se=>se!=="summary").length>0||!G){setTimeout(()=>ct(),100);return}g(!0);try{const se=G.timeRange||{start:2021,end:2021},Se={timestamp:se.start,nodes:G.nodes,edges:G.edges},ce=dn(Se),ve=[Se],pe={name:a.trim(),filename:v.map(_t=>_t.name).join(", "),notes:i.trim()||void 0,type:C==="two-file"?"csv":R||"csv",timeRange:se,snapshots:ve,metadata:ce};await n(pe,{nodes:G.nodes,edges:G.edges,snapshots:ve,metadata:ce})}catch(se){console.error("Import error:",se),x({general:se instanceof Error?se.message:"Failed to import dataset"}),g(!1),setTimeout(()=>ct(),100)}}return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold",children:"Import Dataset"}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:r.jsxs("div",{className:"space-y-6",children:[!C&&r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Select Files ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[r.jsx("button",{onClick:()=>{var E;return(E=t.current)==null?void 0:E.click()},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Choose Files"}),r.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Select 1 file (GEXF or CSV) or 2 files (CSV nodes + CSV edges)"}),r.jsx("input",{ref:t,type:"file",accept:".csv,.gexf",multiple:!0,onChange:fn,className:"hidden"})]})]}),v.length>0&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selected Files"}),r.jsxs("div",{className:"space-y-2",children:[v.map((E,D)=>r.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded",children:[r.jsx("span",{className:"text-sm",children:E.name}),r.jsx("button",{onClick:()=>{const se=[...v];se.splice(D,1),_(se);const Se=[...b];Se.splice(D,1),$(Se),C==="two-file"&&(A===D&&oe(null),Q===D&&me(null),A&&A>D&&oe(A-1),Q&&Q>D&&me(Q-1))},className:"text-red-600 text-sm hover:text-red-800",children:"Remove"})]},D)),r.jsx("button",{type:"button",onClick:()=>{const E=document.createElement("input");E.type="file",E.accept=".csv,.gexf",E.multiple=!0,E.onchange=async D=>{const se=D.target,Se=Array.from(se.files||[]);if(Se.length>0){const ce=await Promise.all(Se.map(pe=>pe.text()));_([...v,...Se]),$([...b,...ce]);const ve=[...v,...Se];ve.length===2&&ve.every(pe=>pe.name.toLowerCase().endsWith(".csv"))&&(S("two-file"),I("csv"))}},E.click()},className:"text-sm text-blue-600 hover:text-blue-800",children:"+ Add More Files"})]})]}),C==="two-file"&&v.length>0&&r.jsxs("div",{className:"border-t pt-4 space-y-4","data-file-select":!0,children:[r.jsx("h3",{className:"font-semibold",children:"Map Files and Fields"}),r.jsxs("div",{"data-field-select":!0,children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nodes File (Locations) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{value:A??"",onChange:E=>{const D=parseInt(E.target.value);oe(D);const se=Pe(b[D]);re(se);const Se=se.find(ce=>ce.toLowerCase()==="id");if(Se&&fe(Se),y.nodesFile){const ce={...y};delete ce.nodesFile,x(ce)}},className:`w-full px-3 py-2 border rounded-md ${y.nodesFile?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select file..."}),v.map((E,D)=>r.jsx("option",{value:D,children:E.name},D))]}),y.nodesFile&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:y.nodesFile}),A!==null&&z.length>0&&r.jsxs("div",{className:"mt-2 space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"ID Field *"}),r.jsxs("select",{value:_e,onChange:E=>{if(fe(E.target.value),y.nodeIdField){const D={...y};delete D.nodeIdField,x(D)}},className:`w-full px-2 py-1 border rounded text-sm ${y.nodeIdField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),z.map(E=>r.jsx("option",{value:E,children:E},E))]}),y.nodeIdField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:y.nodeIdField})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Label Field (optional)"}),r.jsxs("select",{value:ge,onChange:E=>F(E.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[r.jsx("option",{value:"",children:"Use ID field"}),z.map(E=>r.jsx("option",{value:E,children:E},E))]})]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Edges File (Flows) ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{value:Q??"",onChange:E=>{const D=parseInt(E.target.value);me(D);const se=Pe(b[D]);be(se);const Se=se.find(pe=>pe.toLowerCase()==="source"||pe.toLowerCase()==="origin"||pe.toLowerCase()==="from"),ce=se.find(pe=>pe.toLowerCase()==="target"||pe.toLowerCase()==="dest"||pe.toLowerCase()==="to"),ve=se.find(pe=>pe.toLowerCase()==="value"||pe.toLowerCase()==="count"||pe.toLowerCase()==="weight");if(Se&&Ce(Se),ce&&ot(ce),ve&&Le(ve),y.edgesFile){const pe={...y};delete pe.edgesFile,x(pe)}},className:`w-full px-3 py-2 border rounded-md ${y.edgesFile?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select file..."}),v.map((E,D)=>r.jsx("option",{value:D,children:E.name},D))]}),y.edgesFile&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:y.edgesFile}),Q!==null&&J.length>0&&r.jsxs("div",{className:"mt-2 space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Source Field *"}),r.jsxs("select",{value:B,onChange:E=>{if(Ce(E.target.value),y.edgeSourceField){const D={...y};delete D.edgeSourceField,x(D)}},className:`w-full px-2 py-1 border rounded text-sm ${y.edgeSourceField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),J.map(E=>r.jsx("option",{value:E,children:E},E))]}),y.edgeSourceField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:y.edgeSourceField})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Target Field *"}),r.jsxs("select",{value:Te,onChange:E=>{if(ot(E.target.value),y.edgeTargetField){const D={...y};delete D.edgeTargetField,x(D)}},className:`w-full px-2 py-1 border rounded text-sm ${y.edgeTargetField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),J.map(E=>r.jsx("option",{value:E,children:E},E))]}),y.edgeTargetField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:y.edgeTargetField})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Value Field *"}),r.jsxs("select",{value:L,onChange:E=>{if(Le(E.target.value),y.edgeValueField){const D={...y};delete D.edgeValueField,x(D)}},className:`w-full px-2 py-1 border rounded text-sm ${y.edgeValueField?"border-red-500":"border-gray-300"}`,children:[r.jsx("option",{value:"",children:"Select field..."}),J.map(E=>r.jsx("option",{value:E,children:E},E))]}),y.edgeValueField&&r.jsx("p",{className:"mt-1 text-xs text-red-600",children:y.edgeValueField})]})]})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Dataset Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{ref:X,type:"text",value:a,onChange:E=>{if(u(E.target.value),y.name){const D={...y};delete D.name,x(D)}},className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${y.name?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,placeholder:"Enter a name for this dataset"}),y.name&&r.jsx("p",{className:"mt-1 text-sm text-red-600",children:y.name})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (optional)"}),r.jsx("textarea",{value:i,onChange:E=>d(E.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add any notes about this dataset..."})]}),y.general&&r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[r.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"Error:"}),r.jsx("p",{className:"text-sm text-red-700",children:y.general})]}),G&&r.jsxs("div",{ref:K,className:"bg-blue-50 border border-blue-200 rounded p-3",children:[r.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Data Summary"}),r.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Nodes:"})," ",G.nodes.length]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Edges:"})," ",G.edges.length]}),G.timeRange&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Time Range:"})," ",G.timeRange.start,G.timeRange.end!==G.timeRange.start?` – ${G.timeRange.end}`:""]}),G.nodes.length>0&&r.jsxs("div",{className:"mt-2 text-xs",children:[r.jsx("span",{className:"font-medium",children:"Sample node properties:"})," ",Object.keys(G.nodes[0]).slice(0,5).join(", "),Object.keys(G.nodes[0]).length>5&&"..."]}),y.summary&&r.jsxs("div",{className:"mt-2 pt-2 border-t border-blue-300",children:[r.jsx("span",{className:"font-medium text-orange-700",children:"Warnings:"})," ",r.jsx("span",{className:"text-orange-600",children:y.summary})]})]})]})]})}),r.jsxs("div",{className:"p-6 border-t flex justify-end gap-3",children:[r.jsx("button",{onClick:e,type:"button",disabled:m,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:Zn,type:"button",disabled:m||(Object.keys(y).filter(D=>D!=="summary").length>0||!G),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors",children:m?"Importing...":"Import Dataset"})]})]})})}/**
   * table-core
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function Yt(e,n){return typeof e=="function"?e(n):e}function ut(e,n){return t=>{n.setState(s=>({...s,[e]:Yt(t,s[e])}))}}function Rr(e){return e instanceof Function}function oi(e){return Array.isArray(e)&&e.every(n=>typeof n=="number")}function ai(e,n){const t=[],s=o=>{o.forEach(a=>{t.push(a);const u=n(a);u!=null&&u.length&&s(u)})};return s(e),t}function ie(e,n,t){let s=[],o;return a=>{let u;t.key&&t.debug&&(u=Date.now());const i=e(a);if(!(i.length!==s.length||i.some((g,y)=>s[y]!==g)))return o;s=i;let m;if(t.key&&t.debug&&(m=Date.now()),o=n(...i),t==null||t.onChange==null||t.onChange(o),t.key&&t.debug&&t!=null&&t.debug()){const g=Math.round((Date.now()-u)*100)/100,y=Math.round((Date.now()-m)*100)/100,x=y/16,f=(w,C)=>{for(w=String(w);w.length<C;)w=" "+w;return w};console.info(`%c⏱ ${f(y,5)} /${f(g,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*x,120))}deg 100% 31%);`,t==null?void 0:t.key)}return o}}function le(e,n,t,s){return{debug:()=>{var o;return(o=e==null?void 0:e.debugAll)!=null?o:e[n]},key:!1,onChange:s}}function ii(e,n,t,s){const o=()=>{var u;return(u=a.getValue())!=null?u:e.options.renderFallbackValue},a={id:`${n.id}_${t.id}`,row:n,column:t,getValue:()=>n.getValue(s),renderValue:o,getContext:ie(()=>[e,t,n,a],(u,i,d,m)=>({table:u,column:i,row:d,cell:m,getValue:m.getValue,renderValue:m.renderValue}),le(e.options,"debugCells"))};return e._features.forEach(u=>{u.createCell==null||u.createCell(a,t,n,e)},{}),a}function li(e,n,t,s){var o,a;const i={...e._getDefaultColumnDef(),...n},d=i.accessorKey;let m=(o=(a=i.id)!=null?a:d?typeof String.prototype.replaceAll=="function"?d.replaceAll(".","_"):d.replace(/\./g,"_"):void 0)!=null?o:typeof i.header=="string"?i.header:void 0,g;if(i.accessorFn?g=i.accessorFn:d&&(d.includes(".")?g=x=>{let f=x;for(const C of d.split(".")){var w;f=(w=f)==null?void 0:w[C]}return f}:g=x=>x[i.accessorKey]),!m)throw new Error;let y={id:`${String(m)}`,accessorFn:g,parent:s,depth:t,columnDef:i,columns:[],getFlatColumns:ie(()=>[!0],()=>{var x;return[y,...(x=y.columns)==null?void 0:x.flatMap(f=>f.getFlatColumns())]},le(e.options,"debugColumns")),getLeafColumns:ie(()=>[e._getOrderColumnsFn()],x=>{var f;if((f=y.columns)!=null&&f.length){let w=y.columns.flatMap(C=>C.getLeafColumns());return x(w)}return[y]},le(e.options,"debugColumns"))};for(const x of e._features)x.createColumn==null||x.createColumn(y,e);return y}const Ze="debugHeaders";function no(e,n,t){var s;let a={id:(s=t.id)!=null?s:n.id,column:n,index:t.index,isPlaceholder:!!t.isPlaceholder,placeholderId:t.placeholderId,depth:t.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const u=[],i=d=>{d.subHeaders&&d.subHeaders.length&&d.subHeaders.map(i),u.push(d)};return i(a),u},getContext:()=>({table:e,header:a,column:n})};return e._features.forEach(u=>{u.createHeader==null||u.createHeader(a,e)}),a}const ui={createTable:e=>{e.getHeaderGroups=ie(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,s,o)=>{var a,u;const i=(a=s==null?void 0:s.map(y=>t.find(x=>x.id===y)).filter(Boolean))!=null?a:[],d=(u=o==null?void 0:o.map(y=>t.find(x=>x.id===y)).filter(Boolean))!=null?u:[],m=t.filter(y=>!(s!=null&&s.includes(y.id))&&!(o!=null&&o.includes(y.id)));return Cr(n,[...i,...m,...d],e)},le(e.options,Ze)),e.getCenterHeaderGroups=ie(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,s,o)=>(t=t.filter(a=>!(s!=null&&s.includes(a.id))&&!(o!=null&&o.includes(a.id))),Cr(n,t,e,"center")),le(e.options,Ze)),e.getLeftHeaderGroups=ie(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(n,t,s)=>{var o;const a=(o=s==null?void 0:s.map(u=>t.find(i=>i.id===u)).filter(Boolean))!=null?o:[];return Cr(n,a,e,"left")},le(e.options,Ze)),e.getRightHeaderGroups=ie(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(n,t,s)=>{var o;const a=(o=s==null?void 0:s.map(u=>t.find(i=>i.id===u)).filter(Boolean))!=null?o:[];return Cr(n,a,e,"right")},le(e.options,Ze)),e.getFooterGroups=ie(()=>[e.getHeaderGroups()],n=>[...n].reverse(),le(e.options,Ze)),e.getLeftFooterGroups=ie(()=>[e.getLeftHeaderGroups()],n=>[...n].reverse(),le(e.options,Ze)),e.getCenterFooterGroups=ie(()=>[e.getCenterHeaderGroups()],n=>[...n].reverse(),le(e.options,Ze)),e.getRightFooterGroups=ie(()=>[e.getRightHeaderGroups()],n=>[...n].reverse(),le(e.options,Ze)),e.getFlatHeaders=ie(()=>[e.getHeaderGroups()],n=>n.map(t=>t.headers).flat(),le(e.options,Ze)),e.getLeftFlatHeaders=ie(()=>[e.getLeftHeaderGroups()],n=>n.map(t=>t.headers).flat(),le(e.options,Ze)),e.getCenterFlatHeaders=ie(()=>[e.getCenterHeaderGroups()],n=>n.map(t=>t.headers).flat(),le(e.options,Ze)),e.getRightFlatHeaders=ie(()=>[e.getRightHeaderGroups()],n=>n.map(t=>t.headers).flat(),le(e.options,Ze)),e.getCenterLeafHeaders=ie(()=>[e.getCenterFlatHeaders()],n=>n.filter(t=>{var s;return!((s=t.subHeaders)!=null&&s.length)}),le(e.options,Ze)),e.getLeftLeafHeaders=ie(()=>[e.getLeftFlatHeaders()],n=>n.filter(t=>{var s;return!((s=t.subHeaders)!=null&&s.length)}),le(e.options,Ze)),e.getRightLeafHeaders=ie(()=>[e.getRightFlatHeaders()],n=>n.filter(t=>{var s;return!((s=t.subHeaders)!=null&&s.length)}),le(e.options,Ze)),e.getLeafHeaders=ie(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(n,t,s)=>{var o,a,u,i,d,m;return[...(o=(a=n[0])==null?void 0:a.headers)!=null?o:[],...(u=(i=t[0])==null?void 0:i.headers)!=null?u:[],...(d=(m=s[0])==null?void 0:m.headers)!=null?d:[]].map(g=>g.getLeafHeaders()).flat()},le(e.options,Ze))}};function Cr(e,n,t,s){var o,a;let u=0;const i=function(x,f){f===void 0&&(f=1),u=Math.max(u,f),x.filter(w=>w.getIsVisible()).forEach(w=>{var C;(C=w.columns)!=null&&C.length&&i(w.columns,f+1)},0)};i(e);let d=[];const m=(x,f)=>{const w={depth:f,id:[s,`${f}`].filter(Boolean).join("_"),headers:[]},C=[];x.forEach(S=>{const v=[...C].reverse()[0],_=S.column.depth===w.depth;let b,$=!1;if(_&&S.column.parent?b=S.column.parent:(b=S.column,$=!0),v&&(v==null?void 0:v.column)===b)v.subHeaders.push(S);else{const R=no(t,b,{id:[s,f,b.id,S==null?void 0:S.id].filter(Boolean).join("_"),isPlaceholder:$,placeholderId:$?`${C.filter(I=>I.column===b).length}`:void 0,depth:f,index:C.length});R.subHeaders.push(S),C.push(R)}w.headers.push(S),S.headerGroup=w}),d.push(w),f>0&&m(C,f-1)},g=n.map((x,f)=>no(t,x,{depth:u,index:f}));m(g,u-1),d.reverse();const y=x=>x.filter(w=>w.column.getIsVisible()).map(w=>{let C=0,S=0,v=[0];w.subHeaders&&w.subHeaders.length?(v=[],y(w.subHeaders).forEach(b=>{let{colSpan:$,rowSpan:R}=b;C+=$,v.push(R)})):C=1;const _=Math.min(...v);return S=S+_,w.colSpan=C,w.rowSpan=S,{colSpan:C,rowSpan:S}});return y((o=(a=d[0])==null?void 0:a.headers)!=null?o:[]),d}const ci=(e,n,t,s,o,a,u)=>{let i={id:n,index:s,original:t,depth:o,parentId:u,_valuesCache:{},_uniqueValuesCache:{},getValue:d=>{if(i._valuesCache.hasOwnProperty(d))return i._valuesCache[d];const m=e.getColumn(d);if(m!=null&&m.accessorFn)return i._valuesCache[d]=m.accessorFn(i.original,s),i._valuesCache[d]},getUniqueValues:d=>{if(i._uniqueValuesCache.hasOwnProperty(d))return i._uniqueValuesCache[d];const m=e.getColumn(d);if(m!=null&&m.accessorFn)return m.columnDef.getUniqueValues?(i._uniqueValuesCache[d]=m.columnDef.getUniqueValues(i.original,s),i._uniqueValuesCache[d]):(i._uniqueValuesCache[d]=[i.getValue(d)],i._uniqueValuesCache[d])},renderValue:d=>{var m;return(m=i.getValue(d))!=null?m:e.options.renderFallbackValue},subRows:[],getLeafRows:()=>ai(i.subRows,d=>d.subRows),getParentRow:()=>i.parentId?e.getRow(i.parentId,!0):void 0,getParentRows:()=>{let d=[],m=i;for(;;){const g=m.getParentRow();if(!g)break;d.push(g),m=g}return d.reverse()},getAllCells:ie(()=>[e.getAllLeafColumns()],d=>d.map(m=>ii(e,i,m,m.id)),le(e.options,"debugRows")),_getAllCellsByColumnId:ie(()=>[i.getAllCells()],d=>d.reduce((m,g)=>(m[g.column.id]=g,m),{}),le(e.options,"debugRows"))};for(let d=0;d<e._features.length;d++){const m=e._features[d];m==null||m.createRow==null||m.createRow(i,e)}return i},di={createColumn:(e,n)=>{e._getFacetedRowModel=n.options.getFacetedRowModel&&n.options.getFacetedRowModel(n,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():n.getPreFilteredRowModel(),e._getFacetedUniqueValues=n.options.getFacetedUniqueValues&&n.options.getFacetedUniqueValues(n,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=n.options.getFacetedMinMaxValues&&n.options.getFacetedMinMaxValues(n,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},bo=(e,n,t)=>{var s,o;const a=t==null||(s=t.toString())==null?void 0:s.toLowerCase();return!!(!((o=e.getValue(n))==null||(o=o.toString())==null||(o=o.toLowerCase())==null)&&o.includes(a))};bo.autoRemove=e=>wt(e);const So=(e,n,t)=>{var s;return!!(!((s=e.getValue(n))==null||(s=s.toString())==null)&&s.includes(t))};So.autoRemove=e=>wt(e);const wo=(e,n,t)=>{var s;return((s=e.getValue(n))==null||(s=s.toString())==null?void 0:s.toLowerCase())===(t==null?void 0:t.toLowerCase())};wo.autoRemove=e=>wt(e);const _o=(e,n,t)=>{var s;return(s=e.getValue(n))==null?void 0:s.includes(t)};_o.autoRemove=e=>wt(e);const Co=(e,n,t)=>!t.some(s=>{var o;return!((o=e.getValue(n))!=null&&o.includes(s))});Co.autoRemove=e=>wt(e)||!(e!=null&&e.length);const No=(e,n,t)=>t.some(s=>{var o;return(o=e.getValue(n))==null?void 0:o.includes(s)});No.autoRemove=e=>wt(e)||!(e!=null&&e.length);const jo=(e,n,t)=>e.getValue(n)===t;jo.autoRemove=e=>wt(e);const Mo=(e,n,t)=>e.getValue(n)==t;Mo.autoRemove=e=>wt(e);const Ss=(e,n,t)=>{let[s,o]=t;const a=e.getValue(n);return a>=s&&a<=o};Ss.resolveFilterValue=e=>{let[n,t]=e,s=typeof n!="number"?parseFloat(n):n,o=typeof t!="number"?parseFloat(t):t,a=n===null||Number.isNaN(s)?-1/0:s,u=t===null||Number.isNaN(o)?1/0:o;if(a>u){const i=a;a=u,u=i}return[a,u]};Ss.autoRemove=e=>wt(e)||wt(e[0])&&wt(e[1]);const It={includesString:bo,includesStringSensitive:So,equalsString:wo,arrIncludes:_o,arrIncludesAll:Co,arrIncludesSome:No,equals:jo,weakEquals:Mo,inNumberRange:Ss};function wt(e){return e==null||e===""}const gi={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:ut("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,n)=>{e.getAutoFilterFn=()=>{const t=n.getCoreRowModel().flatRows[0],s=t==null?void 0:t.getValue(e.id);return typeof s=="string"?It.includesString:typeof s=="number"?It.inNumberRange:typeof s=="boolean"||s!==null&&typeof s=="object"?It.equals:Array.isArray(s)?It.arrIncludes:It.weakEquals},e.getFilterFn=()=>{var t,s;return Rr(e.columnDef.filterFn)?e.columnDef.filterFn:e.columnDef.filterFn==="auto"?e.getAutoFilterFn():(t=(s=n.options.filterFns)==null?void 0:s[e.columnDef.filterFn])!=null?t:It[e.columnDef.filterFn]},e.getCanFilter=()=>{var t,s,o;return((t=e.columnDef.enableColumnFilter)!=null?t:!0)&&((s=n.options.enableColumnFilters)!=null?s:!0)&&((o=n.options.enableFilters)!=null?o:!0)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var t;return(t=n.getState().columnFilters)==null||(t=t.find(s=>s.id===e.id))==null?void 0:t.value},e.getFilterIndex=()=>{var t,s;return(t=(s=n.getState().columnFilters)==null?void 0:s.findIndex(o=>o.id===e.id))!=null?t:-1},e.setFilterValue=t=>{n.setColumnFilters(s=>{const o=e.getFilterFn(),a=s==null?void 0:s.find(g=>g.id===e.id),u=Yt(t,a?a.value:void 0);if(ro(o,u,e)){var i;return(i=s==null?void 0:s.filter(g=>g.id!==e.id))!=null?i:[]}const d={id:e.id,value:u};if(a){var m;return(m=s==null?void 0:s.map(g=>g.id===e.id?d:g))!=null?m:[]}return s!=null&&s.length?[...s,d]:[d]})}},createRow:(e,n)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=n=>{const t=e.getAllLeafColumns(),s=o=>{var a;return(a=Yt(n,o))==null?void 0:a.filter(u=>{const i=t.find(d=>d.id===u.id);if(i){const d=i.getFilterFn();if(ro(d,u.value,i))return!1}return!0})};e.options.onColumnFiltersChange==null||e.options.onColumnFiltersChange(s)},e.resetColumnFilters=n=>{var t,s;e.setColumnFilters(n?[]:(t=(s=e.initialState)==null?void 0:s.columnFilters)!=null?t:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel())}};function ro(e,n,t){return(e&&e.autoRemove?e.autoRemove(n,t):!1)||typeof n>"u"||typeof n=="string"&&!n}const mi=(e,n,t)=>t.reduce((s,o)=>{const a=o.getValue(e);return s+(typeof a=="number"?a:0)},0),fi=(e,n,t)=>{let s;return t.forEach(o=>{const a=o.getValue(e);a!=null&&(s>a||s===void 0&&a>=a)&&(s=a)}),s},pi=(e,n,t)=>{let s;return t.forEach(o=>{const a=o.getValue(e);a!=null&&(s<a||s===void 0&&a>=a)&&(s=a)}),s},hi=(e,n,t)=>{let s,o;return t.forEach(a=>{const u=a.getValue(e);u!=null&&(s===void 0?u>=u&&(s=o=u):(s>u&&(s=u),o<u&&(o=u)))}),[s,o]},xi=(e,n)=>{let t=0,s=0;if(n.forEach(o=>{let a=o.getValue(e);a!=null&&(a=+a)>=a&&(++t,s+=a)}),t)return s/t},yi=(e,n)=>{if(!n.length)return;const t=n.map(a=>a.getValue(e));if(!oi(t))return;if(t.length===1)return t[0];const s=Math.floor(t.length/2),o=t.sort((a,u)=>a-u);return t.length%2!==0?o[s]:(o[s-1]+o[s])/2},vi=(e,n)=>Array.from(new Set(n.map(t=>t.getValue(e))).values()),bi=(e,n)=>new Set(n.map(t=>t.getValue(e))).size,Si=(e,n)=>n.length,es={sum:mi,min:fi,max:pi,extent:hi,mean:xi,median:yi,unique:vi,uniqueCount:bi,count:Si},wi={getDefaultColumnDef:()=>({aggregatedCell:e=>{var n,t;return(n=(t=e.getValue())==null||t.toString==null?void 0:t.toString())!=null?n:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:ut("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,n)=>{e.toggleGrouping=()=>{n.setGrouping(t=>t!=null&&t.includes(e.id)?t.filter(s=>s!==e.id):[...t??[],e.id])},e.getCanGroup=()=>{var t,s;return((t=e.columnDef.enableGrouping)!=null?t:!0)&&((s=n.options.enableGrouping)!=null?s:!0)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var t;return(t=n.getState().grouping)==null?void 0:t.includes(e.id)},e.getGroupedIndex=()=>{var t;return(t=n.getState().grouping)==null?void 0:t.indexOf(e.id)},e.getToggleGroupingHandler=()=>{const t=e.getCanGroup();return()=>{t&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{const t=n.getCoreRowModel().flatRows[0],s=t==null?void 0:t.getValue(e.id);if(typeof s=="number")return es.sum;if(Object.prototype.toString.call(s)==="[object Date]")return es.extent},e.getAggregationFn=()=>{var t,s;if(!e)throw new Error;return Rr(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:e.columnDef.aggregationFn==="auto"?e.getAutoAggregationFn():(t=(s=n.options.aggregationFns)==null?void 0:s[e.columnDef.aggregationFn])!=null?t:es[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=n=>e.options.onGroupingChange==null?void 0:e.options.onGroupingChange(n),e.resetGrouping=n=>{var t,s;e.setGrouping(n?[]:(t=(s=e.initialState)==null?void 0:s.grouping)!=null?t:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())},createRow:(e,n)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=t=>{if(e._groupingValuesCache.hasOwnProperty(t))return e._groupingValuesCache[t];const s=n.getColumn(t);return s!=null&&s.columnDef.getGroupingValue?(e._groupingValuesCache[t]=s.columnDef.getGroupingValue(e.original),e._groupingValuesCache[t]):e.getValue(t)},e._groupingValuesCache={}},createCell:(e,n,t,s)=>{e.getIsGrouped=()=>n.getIsGrouped()&&n.id===t.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&n.getIsGrouped(),e.getIsAggregated=()=>{var o;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!((o=t.subRows)!=null&&o.length)}}};function _i(e,n,t){if(!(n!=null&&n.length)||!t)return e;const s=e.filter(a=>!n.includes(a.id));return t==="remove"?s:[...n.map(a=>e.find(u=>u.id===a)).filter(Boolean),...s]}const Ci={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:ut("columnOrder",e)}),createColumn:(e,n)=>{e.getIndex=ie(t=>[qn(n,t)],t=>t.findIndex(s=>s.id===e.id),le(n.options,"debugColumns")),e.getIsFirstColumn=t=>{var s;return((s=qn(n,t)[0])==null?void 0:s.id)===e.id},e.getIsLastColumn=t=>{var s;const o=qn(n,t);return((s=o[o.length-1])==null?void 0:s.id)===e.id}},createTable:e=>{e.setColumnOrder=n=>e.options.onColumnOrderChange==null?void 0:e.options.onColumnOrderChange(n),e.resetColumnOrder=n=>{var t;e.setColumnOrder(n?[]:(t=e.initialState.columnOrder)!=null?t:[])},e._getOrderColumnsFn=ie(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(n,t,s)=>o=>{let a=[];if(!(n!=null&&n.length))a=o;else{const u=[...n],i=[...o];for(;i.length&&u.length;){const d=u.shift(),m=i.findIndex(g=>g.id===d);m>-1&&a.push(i.splice(m,1)[0])}a=[...a,...i]}return _i(a,t,s)},le(e.options,"debugTable"))}},ts=()=>({left:[],right:[]}),Ni={getInitialState:e=>({columnPinning:ts(),...e}),getDefaultOptions:e=>({onColumnPinningChange:ut("columnPinning",e)}),createColumn:(e,n)=>{e.pin=t=>{const s=e.getLeafColumns().map(o=>o.id).filter(Boolean);n.setColumnPinning(o=>{var a,u;if(t==="right"){var i,d;return{left:((i=o==null?void 0:o.left)!=null?i:[]).filter(y=>!(s!=null&&s.includes(y))),right:[...((d=o==null?void 0:o.right)!=null?d:[]).filter(y=>!(s!=null&&s.includes(y))),...s]}}if(t==="left"){var m,g;return{left:[...((m=o==null?void 0:o.left)!=null?m:[]).filter(y=>!(s!=null&&s.includes(y))),...s],right:((g=o==null?void 0:o.right)!=null?g:[]).filter(y=>!(s!=null&&s.includes(y)))}}return{left:((a=o==null?void 0:o.left)!=null?a:[]).filter(y=>!(s!=null&&s.includes(y))),right:((u=o==null?void 0:o.right)!=null?u:[]).filter(y=>!(s!=null&&s.includes(y)))}})},e.getCanPin=()=>e.getLeafColumns().some(s=>{var o,a,u;return((o=s.columnDef.enablePinning)!=null?o:!0)&&((a=(u=n.options.enableColumnPinning)!=null?u:n.options.enablePinning)!=null?a:!0)}),e.getIsPinned=()=>{const t=e.getLeafColumns().map(i=>i.id),{left:s,right:o}=n.getState().columnPinning,a=t.some(i=>s==null?void 0:s.includes(i)),u=t.some(i=>o==null?void 0:o.includes(i));return a?"left":u?"right":!1},e.getPinnedIndex=()=>{var t,s;const o=e.getIsPinned();return o?(t=(s=n.getState().columnPinning)==null||(s=s[o])==null?void 0:s.indexOf(e.id))!=null?t:-1:0}},createRow:(e,n)=>{e.getCenterVisibleCells=ie(()=>[e._getAllVisibleCells(),n.getState().columnPinning.left,n.getState().columnPinning.right],(t,s,o)=>{const a=[...s??[],...o??[]];return t.filter(u=>!a.includes(u.column.id))},le(n.options,"debugRows")),e.getLeftVisibleCells=ie(()=>[e._getAllVisibleCells(),n.getState().columnPinning.left],(t,s)=>(s??[]).map(a=>t.find(u=>u.column.id===a)).filter(Boolean).map(a=>({...a,position:"left"})),le(n.options,"debugRows")),e.getRightVisibleCells=ie(()=>[e._getAllVisibleCells(),n.getState().columnPinning.right],(t,s)=>(s??[]).map(a=>t.find(u=>u.column.id===a)).filter(Boolean).map(a=>({...a,position:"right"})),le(n.options,"debugRows"))},createTable:e=>{e.setColumnPinning=n=>e.options.onColumnPinningChange==null?void 0:e.options.onColumnPinningChange(n),e.resetColumnPinning=n=>{var t,s;return e.setColumnPinning(n?ts():(t=(s=e.initialState)==null?void 0:s.columnPinning)!=null?t:ts())},e.getIsSomeColumnsPinned=n=>{var t;const s=e.getState().columnPinning;if(!n){var o,a;return!!((o=s.left)!=null&&o.length||(a=s.right)!=null&&a.length)}return!!((t=s[n])!=null&&t.length)},e.getLeftLeafColumns=ie(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(n,t)=>(t??[]).map(s=>n.find(o=>o.id===s)).filter(Boolean),le(e.options,"debugColumns")),e.getRightLeafColumns=ie(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(n,t)=>(t??[]).map(s=>n.find(o=>o.id===s)).filter(Boolean),le(e.options,"debugColumns")),e.getCenterLeafColumns=ie(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(n,t,s)=>{const o=[...t??[],...s??[]];return n.filter(a=>!o.includes(a.id))},le(e.options,"debugColumns"))}};function ji(e){return e||(typeof document<"u"?document:null)}const Nr={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},ns=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),Mi={getDefaultColumnDef:()=>Nr,getInitialState:e=>({columnSizing:{},columnSizingInfo:ns(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:ut("columnSizing",e),onColumnSizingInfoChange:ut("columnSizingInfo",e)}),createColumn:(e,n)=>{e.getSize=()=>{var t,s,o;const a=n.getState().columnSizing[e.id];return Math.min(Math.max((t=e.columnDef.minSize)!=null?t:Nr.minSize,(s=a??e.columnDef.size)!=null?s:Nr.size),(o=e.columnDef.maxSize)!=null?o:Nr.maxSize)},e.getStart=ie(t=>[t,qn(n,t),n.getState().columnSizing],(t,s)=>s.slice(0,e.getIndex(t)).reduce((o,a)=>o+a.getSize(),0),le(n.options,"debugColumns")),e.getAfter=ie(t=>[t,qn(n,t),n.getState().columnSizing],(t,s)=>s.slice(e.getIndex(t)+1).reduce((o,a)=>o+a.getSize(),0),le(n.options,"debugColumns")),e.resetSize=()=>{n.setColumnSizing(t=>{let{[e.id]:s,...o}=t;return o})},e.getCanResize=()=>{var t,s;return((t=e.columnDef.enableResizing)!=null?t:!0)&&((s=n.options.enableColumnResizing)!=null?s:!0)},e.getIsResizing=()=>n.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,n)=>{e.getSize=()=>{let t=0;const s=o=>{if(o.subHeaders.length)o.subHeaders.forEach(s);else{var a;t+=(a=o.column.getSize())!=null?a:0}};return s(e),t},e.getStart=()=>{if(e.index>0){const t=e.headerGroup.headers[e.index-1];return t.getStart()+t.getSize()}return 0},e.getResizeHandler=t=>{const s=n.getColumn(e.column.id),o=s==null?void 0:s.getCanResize();return a=>{if(!s||!o||(a.persist==null||a.persist(),rs(a)&&a.touches&&a.touches.length>1))return;const u=e.getSize(),i=e?e.getLeafHeaders().map(v=>[v.column.id,v.column.getSize()]):[[s.id,s.getSize()]],d=rs(a)?Math.round(a.touches[0].clientX):a.clientX,m={},g=(v,_)=>{typeof _=="number"&&(n.setColumnSizingInfo(b=>{var $,R;const I=n.options.columnResizeDirection==="rtl"?-1:1,X=(_-(($=b==null?void 0:b.startOffset)!=null?$:0))*I,K=Math.max(X/((R=b==null?void 0:b.startSize)!=null?R:0),-.999999);return b.columnSizingStart.forEach(A=>{let[oe,Q]=A;m[oe]=Math.round(Math.max(Q+Q*K,0)*100)/100}),{...b,deltaOffset:X,deltaPercentage:K}}),(n.options.columnResizeMode==="onChange"||v==="end")&&n.setColumnSizing(b=>({...b,...m})))},y=v=>g("move",v),x=v=>{g("end",v),n.setColumnSizingInfo(_=>({..._,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},f=ji(t),w={moveHandler:v=>y(v.clientX),upHandler:v=>{f==null||f.removeEventListener("mousemove",w.moveHandler),f==null||f.removeEventListener("mouseup",w.upHandler),x(v.clientX)}},C={moveHandler:v=>(v.cancelable&&(v.preventDefault(),v.stopPropagation()),y(v.touches[0].clientX),!1),upHandler:v=>{var _;f==null||f.removeEventListener("touchmove",C.moveHandler),f==null||f.removeEventListener("touchend",C.upHandler),v.cancelable&&(v.preventDefault(),v.stopPropagation()),x((_=v.touches[0])==null?void 0:_.clientX)}},S=Fi()?{passive:!1}:!1;rs(a)?(f==null||f.addEventListener("touchmove",C.moveHandler,S),f==null||f.addEventListener("touchend",C.upHandler,S)):(f==null||f.addEventListener("mousemove",w.moveHandler,S),f==null||f.addEventListener("mouseup",w.upHandler,S)),n.setColumnSizingInfo(v=>({...v,startOffset:d,startSize:u,deltaOffset:0,deltaPercentage:0,columnSizingStart:i,isResizingColumn:s.id}))}}},createTable:e=>{e.setColumnSizing=n=>e.options.onColumnSizingChange==null?void 0:e.options.onColumnSizingChange(n),e.setColumnSizingInfo=n=>e.options.onColumnSizingInfoChange==null?void 0:e.options.onColumnSizingInfoChange(n),e.resetColumnSizing=n=>{var t;e.setColumnSizing(n?{}:(t=e.initialState.columnSizing)!=null?t:{})},e.resetHeaderSizeInfo=n=>{var t;e.setColumnSizingInfo(n?ns():(t=e.initialState.columnSizingInfo)!=null?t:ns())},e.getTotalSize=()=>{var n,t;return(n=(t=e.getHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0},e.getLeftTotalSize=()=>{var n,t;return(n=(t=e.getLeftHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0},e.getCenterTotalSize=()=>{var n,t;return(n=(t=e.getCenterHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0},e.getRightTotalSize=()=>{var n,t;return(n=(t=e.getRightHeaderGroups()[0])==null?void 0:t.headers.reduce((s,o)=>s+o.getSize(),0))!=null?n:0}}};let jr=null;function Fi(){if(typeof jr=="boolean")return jr;let e=!1;try{const n={get passive(){return e=!0,!1}},t=()=>{};window.addEventListener("test",t,n),window.removeEventListener("test",t)}catch{e=!1}return jr=e,jr}function rs(e){return e.type==="touchstart"}const Ri={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:ut("columnVisibility",e)}),createColumn:(e,n)=>{e.toggleVisibility=t=>{e.getCanHide()&&n.setColumnVisibility(s=>({...s,[e.id]:t??!e.getIsVisible()}))},e.getIsVisible=()=>{var t,s;const o=e.columns;return(t=o.length?o.some(a=>a.getIsVisible()):(s=n.getState().columnVisibility)==null?void 0:s[e.id])!=null?t:!0},e.getCanHide=()=>{var t,s;return((t=e.columnDef.enableHiding)!=null?t:!0)&&((s=n.options.enableHiding)!=null?s:!0)},e.getToggleVisibilityHandler=()=>t=>{e.toggleVisibility==null||e.toggleVisibility(t.target.checked)}},createRow:(e,n)=>{e._getAllVisibleCells=ie(()=>[e.getAllCells(),n.getState().columnVisibility],t=>t.filter(s=>s.column.getIsVisible()),le(n.options,"debugRows")),e.getVisibleCells=ie(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(t,s,o)=>[...t,...s,...o],le(n.options,"debugRows"))},createTable:e=>{const n=(t,s)=>ie(()=>[s(),s().filter(o=>o.getIsVisible()).map(o=>o.id).join("_")],o=>o.filter(a=>a.getIsVisible==null?void 0:a.getIsVisible()),le(e.options,"debugColumns"));e.getVisibleFlatColumns=n("getVisibleFlatColumns",()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=n("getVisibleLeafColumns",()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=n("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=n("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=n("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),e.setColumnVisibility=t=>e.options.onColumnVisibilityChange==null?void 0:e.options.onColumnVisibilityChange(t),e.resetColumnVisibility=t=>{var s;e.setColumnVisibility(t?{}:(s=e.initialState.columnVisibility)!=null?s:{})},e.toggleAllColumnsVisible=t=>{var s;t=(s=t)!=null?s:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((o,a)=>({...o,[a.id]:t||!(a.getCanHide!=null&&a.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(t=>!(t.getIsVisible!=null&&t.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(t=>t.getIsVisible==null?void 0:t.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>t=>{var s;e.toggleAllColumnsVisible((s=t.target)==null?void 0:s.checked)}}};function qn(e,n){return n?n==="center"?e.getCenterVisibleLeafColumns():n==="left"?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}const $i={createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},Ei={getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:ut("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:n=>{var t;const s=(t=e.getCoreRowModel().flatRows[0])==null||(t=t._getAllCellsByColumnId()[n.id])==null?void 0:t.getValue();return typeof s=="string"||typeof s=="number"}}),createColumn:(e,n)=>{e.getCanGlobalFilter=()=>{var t,s,o,a;return((t=e.columnDef.enableGlobalFilter)!=null?t:!0)&&((s=n.options.enableGlobalFilter)!=null?s:!0)&&((o=n.options.enableFilters)!=null?o:!0)&&((a=n.options.getColumnCanGlobalFilter==null?void 0:n.options.getColumnCanGlobalFilter(e))!=null?a:!0)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>It.includesString,e.getGlobalFilterFn=()=>{var n,t;const{globalFilterFn:s}=e.options;return Rr(s)?s:s==="auto"?e.getGlobalAutoFilterFn():(n=(t=e.options.filterFns)==null?void 0:t[s])!=null?n:It[s]},e.setGlobalFilter=n=>{e.options.onGlobalFilterChange==null||e.options.onGlobalFilterChange(n)},e.resetGlobalFilter=n=>{e.setGlobalFilter(n?void 0:e.initialState.globalFilter)}}},Ii={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:ut("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let n=!1,t=!1;e._autoResetExpanded=()=>{var s,o;if(!n){e._queue(()=>{n=!0});return}if((s=(o=e.options.autoResetAll)!=null?o:e.options.autoResetExpanded)!=null?s:!e.options.manualExpanding){if(t)return;t=!0,e._queue(()=>{e.resetExpanded(),t=!1})}},e.setExpanded=s=>e.options.onExpandedChange==null?void 0:e.options.onExpandedChange(s),e.toggleAllRowsExpanded=s=>{s??!e.getIsAllRowsExpanded()?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=s=>{var o,a;e.setExpanded(s?{}:(o=(a=e.initialState)==null?void 0:a.expanded)!=null?o:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(s=>s.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>s=>{s.persist==null||s.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{const s=e.getState().expanded;return s===!0||Object.values(s).some(Boolean)},e.getIsAllRowsExpanded=()=>{const s=e.getState().expanded;return typeof s=="boolean"?s===!0:!(!Object.keys(s).length||e.getRowModel().flatRows.some(o=>!o.getIsExpanded()))},e.getExpandedDepth=()=>{let s=0;return(e.getState().expanded===!0?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(a=>{const u=a.split(".");s=Math.max(s,u.length)}),s},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())},createRow:(e,n)=>{e.toggleExpanded=t=>{n.setExpanded(s=>{var o;const a=s===!0?!0:!!(s!=null&&s[e.id]);let u={};if(s===!0?Object.keys(n.getRowModel().rowsById).forEach(i=>{u[i]=!0}):u=s,t=(o=t)!=null?o:!a,!a&&t)return{...u,[e.id]:!0};if(a&&!t){const{[e.id]:i,...d}=u;return d}return s})},e.getIsExpanded=()=>{var t;const s=n.getState().expanded;return!!((t=n.options.getIsRowExpanded==null?void 0:n.options.getIsRowExpanded(e))!=null?t:s===!0||s!=null&&s[e.id])},e.getCanExpand=()=>{var t,s,o;return(t=n.options.getRowCanExpand==null?void 0:n.options.getRowCanExpand(e))!=null?t:((s=n.options.enableExpanding)!=null?s:!0)&&!!((o=e.subRows)!=null&&o.length)},e.getIsAllParentsExpanded=()=>{let t=!0,s=e;for(;t&&s.parentId;)s=n.getRow(s.parentId,!0),t=s.getIsExpanded();return t},e.getToggleExpandedHandler=()=>{const t=e.getCanExpand();return()=>{t&&e.toggleExpanded()}}}},ms=0,fs=10,ss=()=>({pageIndex:ms,pageSize:fs}),Ai={getInitialState:e=>({...e,pagination:{...ss(),...e==null?void 0:e.pagination}}),getDefaultOptions:e=>({onPaginationChange:ut("pagination",e)}),createTable:e=>{let n=!1,t=!1;e._autoResetPageIndex=()=>{var s,o;if(!n){e._queue(()=>{n=!0});return}if((s=(o=e.options.autoResetAll)!=null?o:e.options.autoResetPageIndex)!=null?s:!e.options.manualPagination){if(t)return;t=!0,e._queue(()=>{e.resetPageIndex(),t=!1})}},e.setPagination=s=>{const o=a=>Yt(s,a);return e.options.onPaginationChange==null?void 0:e.options.onPaginationChange(o)},e.resetPagination=s=>{var o;e.setPagination(s?ss():(o=e.initialState.pagination)!=null?o:ss())},e.setPageIndex=s=>{e.setPagination(o=>{let a=Yt(s,o.pageIndex);const u=typeof e.options.pageCount>"u"||e.options.pageCount===-1?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return a=Math.max(0,Math.min(a,u)),{...o,pageIndex:a}})},e.resetPageIndex=s=>{var o,a;e.setPageIndex(s?ms:(o=(a=e.initialState)==null||(a=a.pagination)==null?void 0:a.pageIndex)!=null?o:ms)},e.resetPageSize=s=>{var o,a;e.setPageSize(s?fs:(o=(a=e.initialState)==null||(a=a.pagination)==null?void 0:a.pageSize)!=null?o:fs)},e.setPageSize=s=>{e.setPagination(o=>{const a=Math.max(1,Yt(s,o.pageSize)),u=o.pageSize*o.pageIndex,i=Math.floor(u/a);return{...o,pageIndex:i,pageSize:a}})},e.setPageCount=s=>e.setPagination(o=>{var a;let u=Yt(s,(a=e.options.pageCount)!=null?a:-1);return typeof u=="number"&&(u=Math.max(-1,u)),{...o,pageCount:u}}),e.getPageOptions=ie(()=>[e.getPageCount()],s=>{let o=[];return s&&s>0&&(o=[...new Array(s)].fill(null).map((a,u)=>u)),o},le(e.options,"debugTable")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{const{pageIndex:s}=e.getState().pagination,o=e.getPageCount();return o===-1?!0:o===0?!1:s<o-1},e.previousPage=()=>e.setPageIndex(s=>s-1),e.nextPage=()=>e.setPageIndex(s=>s+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),e.getPageCount=()=>{var s;return(s=e.options.pageCount)!=null?s:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var s;return(s=e.options.rowCount)!=null?s:e.getPrePaginationRowModel().rows.length}}},os=()=>({top:[],bottom:[]}),ki={getInitialState:e=>({rowPinning:os(),...e}),getDefaultOptions:e=>({onRowPinningChange:ut("rowPinning",e)}),createRow:(e,n)=>{e.pin=(t,s,o)=>{const a=s?e.getLeafRows().map(d=>{let{id:m}=d;return m}):[],u=o?e.getParentRows().map(d=>{let{id:m}=d;return m}):[],i=new Set([...u,e.id,...a]);n.setRowPinning(d=>{var m,g;if(t==="bottom"){var y,x;return{top:((y=d==null?void 0:d.top)!=null?y:[]).filter(C=>!(i!=null&&i.has(C))),bottom:[...((x=d==null?void 0:d.bottom)!=null?x:[]).filter(C=>!(i!=null&&i.has(C))),...Array.from(i)]}}if(t==="top"){var f,w;return{top:[...((f=d==null?void 0:d.top)!=null?f:[]).filter(C=>!(i!=null&&i.has(C))),...Array.from(i)],bottom:((w=d==null?void 0:d.bottom)!=null?w:[]).filter(C=>!(i!=null&&i.has(C)))}}return{top:((m=d==null?void 0:d.top)!=null?m:[]).filter(C=>!(i!=null&&i.has(C))),bottom:((g=d==null?void 0:d.bottom)!=null?g:[]).filter(C=>!(i!=null&&i.has(C)))}})},e.getCanPin=()=>{var t;const{enableRowPinning:s,enablePinning:o}=n.options;return typeof s=="function"?s(e):(t=s??o)!=null?t:!0},e.getIsPinned=()=>{const t=[e.id],{top:s,bottom:o}=n.getState().rowPinning,a=t.some(i=>s==null?void 0:s.includes(i)),u=t.some(i=>o==null?void 0:o.includes(i));return a?"top":u?"bottom":!1},e.getPinnedIndex=()=>{var t,s;const o=e.getIsPinned();if(!o)return-1;const a=(t=o==="top"?n.getTopRows():n.getBottomRows())==null?void 0:t.map(u=>{let{id:i}=u;return i});return(s=a==null?void 0:a.indexOf(e.id))!=null?s:-1}},createTable:e=>{e.setRowPinning=n=>e.options.onRowPinningChange==null?void 0:e.options.onRowPinningChange(n),e.resetRowPinning=n=>{var t,s;return e.setRowPinning(n?os():(t=(s=e.initialState)==null?void 0:s.rowPinning)!=null?t:os())},e.getIsSomeRowsPinned=n=>{var t;const s=e.getState().rowPinning;if(!n){var o,a;return!!((o=s.top)!=null&&o.length||(a=s.bottom)!=null&&a.length)}return!!((t=s[n])!=null&&t.length)},e._getPinnedRows=(n,t,s)=>{var o;return((o=e.options.keepPinnedRows)==null||o?(t??[]).map(u=>{const i=e.getRow(u,!0);return i.getIsAllParentsExpanded()?i:null}):(t??[]).map(u=>n.find(i=>i.id===u))).filter(Boolean).map(u=>({...u,position:s}))},e.getTopRows=ie(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(n,t)=>e._getPinnedRows(n,t,"top"),le(e.options,"debugRows")),e.getBottomRows=ie(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(n,t)=>e._getPinnedRows(n,t,"bottom"),le(e.options,"debugRows")),e.getCenterRows=ie(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(n,t,s)=>{const o=new Set([...t??[],...s??[]]);return n.filter(a=>!o.has(a.id))},le(e.options,"debugRows"))}},Pi={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:ut("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=n=>e.options.onRowSelectionChange==null?void 0:e.options.onRowSelectionChange(n),e.resetRowSelection=n=>{var t;return e.setRowSelection(n?{}:(t=e.initialState.rowSelection)!=null?t:{})},e.toggleAllRowsSelected=n=>{e.setRowSelection(t=>{n=typeof n<"u"?n:!e.getIsAllRowsSelected();const s={...t},o=e.getPreGroupedRowModel().flatRows;return n?o.forEach(a=>{a.getCanSelect()&&(s[a.id]=!0)}):o.forEach(a=>{delete s[a.id]}),s})},e.toggleAllPageRowsSelected=n=>e.setRowSelection(t=>{const s=typeof n<"u"?n:!e.getIsAllPageRowsSelected(),o={...t};return e.getRowModel().rows.forEach(a=>{ps(o,a.id,s,!0,e)}),o}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=ie(()=>[e.getState().rowSelection,e.getCoreRowModel()],(n,t)=>Object.keys(n).length?as(e,t):{rows:[],flatRows:[],rowsById:{}},le(e.options,"debugTable")),e.getFilteredSelectedRowModel=ie(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(n,t)=>Object.keys(n).length?as(e,t):{rows:[],flatRows:[],rowsById:{}},le(e.options,"debugTable")),e.getGroupedSelectedRowModel=ie(()=>[e.getState().rowSelection,e.getSortedRowModel()],(n,t)=>Object.keys(n).length?as(e,t):{rows:[],flatRows:[],rowsById:{}},le(e.options,"debugTable")),e.getIsAllRowsSelected=()=>{const n=e.getFilteredRowModel().flatRows,{rowSelection:t}=e.getState();let s=!!(n.length&&Object.keys(t).length);return s&&n.some(o=>o.getCanSelect()&&!t[o.id])&&(s=!1),s},e.getIsAllPageRowsSelected=()=>{const n=e.getPaginationRowModel().flatRows.filter(o=>o.getCanSelect()),{rowSelection:t}=e.getState();let s=!!n.length;return s&&n.some(o=>!t[o.id])&&(s=!1),s},e.getIsSomeRowsSelected=()=>{var n;const t=Object.keys((n=e.getState().rowSelection)!=null?n:{}).length;return t>0&&t<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{const n=e.getPaginationRowModel().flatRows;return e.getIsAllPageRowsSelected()?!1:n.filter(t=>t.getCanSelect()).some(t=>t.getIsSelected()||t.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>n=>{e.toggleAllRowsSelected(n.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>n=>{e.toggleAllPageRowsSelected(n.target.checked)}},createRow:(e,n)=>{e.toggleSelected=(t,s)=>{const o=e.getIsSelected();n.setRowSelection(a=>{var u;if(t=typeof t<"u"?t:!o,e.getCanSelect()&&o===t)return a;const i={...a};return ps(i,e.id,t,(u=s==null?void 0:s.selectChildren)!=null?u:!0,n),i})},e.getIsSelected=()=>{const{rowSelection:t}=n.getState();return ws(e,t)},e.getIsSomeSelected=()=>{const{rowSelection:t}=n.getState();return hs(e,t)==="some"},e.getIsAllSubRowsSelected=()=>{const{rowSelection:t}=n.getState();return hs(e,t)==="all"},e.getCanSelect=()=>{var t;return typeof n.options.enableRowSelection=="function"?n.options.enableRowSelection(e):(t=n.options.enableRowSelection)!=null?t:!0},e.getCanSelectSubRows=()=>{var t;return typeof n.options.enableSubRowSelection=="function"?n.options.enableSubRowSelection(e):(t=n.options.enableSubRowSelection)!=null?t:!0},e.getCanMultiSelect=()=>{var t;return typeof n.options.enableMultiRowSelection=="function"?n.options.enableMultiRowSelection(e):(t=n.options.enableMultiRowSelection)!=null?t:!0},e.getToggleSelectedHandler=()=>{const t=e.getCanSelect();return s=>{var o;t&&e.toggleSelected((o=s.target)==null?void 0:o.checked)}}}},ps=(e,n,t,s,o)=>{var a;const u=o.getRow(n,!0);t?(u.getCanMultiSelect()||Object.keys(e).forEach(i=>delete e[i]),u.getCanSelect()&&(e[n]=!0)):delete e[n],s&&(a=u.subRows)!=null&&a.length&&u.getCanSelectSubRows()&&u.subRows.forEach(i=>ps(e,i.id,t,s,o))};function as(e,n){const t=e.getState().rowSelection,s=[],o={},a=function(u,i){return u.map(d=>{var m;const g=ws(d,t);if(g&&(s.push(d),o[d.id]=d),(m=d.subRows)!=null&&m.length&&(d={...d,subRows:a(d.subRows)}),g)return d}).filter(Boolean)};return{rows:a(n.rows),flatRows:s,rowsById:o}}function ws(e,n){var t;return(t=n[e.id])!=null?t:!1}function hs(e,n,t){var s;if(!((s=e.subRows)!=null&&s.length))return!1;let o=!0,a=!1;return e.subRows.forEach(u=>{if(!(a&&!o)&&(u.getCanSelect()&&(ws(u,n)?a=!0:o=!1),u.subRows&&u.subRows.length)){const i=hs(u,n);i==="all"?a=!0:(i==="some"&&(a=!0),o=!1)}}),o?"all":a?"some":!1}const xs=/([0-9]+)/gm,Vi=(e,n,t)=>Fo(Xt(e.getValue(t)).toLowerCase(),Xt(n.getValue(t)).toLowerCase()),Oi=(e,n,t)=>Fo(Xt(e.getValue(t)),Xt(n.getValue(t))),Di=(e,n,t)=>_s(Xt(e.getValue(t)).toLowerCase(),Xt(n.getValue(t)).toLowerCase()),Ti=(e,n,t)=>_s(Xt(e.getValue(t)),Xt(n.getValue(t))),Li=(e,n,t)=>{const s=e.getValue(t),o=n.getValue(t);return s>o?1:s<o?-1:0},zi=(e,n,t)=>_s(e.getValue(t),n.getValue(t));function _s(e,n){return e===n?0:e>n?1:-1}function Xt(e){return typeof e=="number"?isNaN(e)||e===1/0||e===-1/0?"":String(e):typeof e=="string"?e:""}function Fo(e,n){const t=e.split(xs).filter(Boolean),s=n.split(xs).filter(Boolean);for(;t.length&&s.length;){const o=t.shift(),a=s.shift(),u=parseInt(o,10),i=parseInt(a,10),d=[u,i].sort();if(isNaN(d[0])){if(o>a)return 1;if(a>o)return-1;continue}if(isNaN(d[1]))return isNaN(u)?-1:1;if(u>i)return 1;if(i>u)return-1}return t.length-s.length}const Wn={alphanumeric:Vi,alphanumericCaseSensitive:Oi,text:Di,textCaseSensitive:Ti,datetime:Li,basic:zi},Hi={getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:ut("sorting",e),isMultiSortEvent:n=>n.shiftKey}),createColumn:(e,n)=>{e.getAutoSortingFn=()=>{const t=n.getFilteredRowModel().flatRows.slice(10);let s=!1;for(const o of t){const a=o==null?void 0:o.getValue(e.id);if(Object.prototype.toString.call(a)==="[object Date]")return Wn.datetime;if(typeof a=="string"&&(s=!0,a.split(xs).length>1))return Wn.alphanumeric}return s?Wn.text:Wn.basic},e.getAutoSortDir=()=>{const t=n.getFilteredRowModel().flatRows[0];return typeof(t==null?void 0:t.getValue(e.id))=="string"?"asc":"desc"},e.getSortingFn=()=>{var t,s;if(!e)throw new Error;return Rr(e.columnDef.sortingFn)?e.columnDef.sortingFn:e.columnDef.sortingFn==="auto"?e.getAutoSortingFn():(t=(s=n.options.sortingFns)==null?void 0:s[e.columnDef.sortingFn])!=null?t:Wn[e.columnDef.sortingFn]},e.toggleSorting=(t,s)=>{const o=e.getNextSortingOrder(),a=typeof t<"u"&&t!==null;n.setSorting(u=>{const i=u==null?void 0:u.find(f=>f.id===e.id),d=u==null?void 0:u.findIndex(f=>f.id===e.id);let m=[],g,y=a?t:o==="desc";if(u!=null&&u.length&&e.getCanMultiSort()&&s?i?g="toggle":g="add":u!=null&&u.length&&d!==u.length-1?g="replace":i?g="toggle":g="replace",g==="toggle"&&(a||o||(g="remove")),g==="add"){var x;m=[...u,{id:e.id,desc:y}],m.splice(0,m.length-((x=n.options.maxMultiSortColCount)!=null?x:Number.MAX_SAFE_INTEGER))}else g==="toggle"?m=u.map(f=>f.id===e.id?{...f,desc:y}:f):g==="remove"?m=u.filter(f=>f.id!==e.id):m=[{id:e.id,desc:y}];return m})},e.getFirstSortDir=()=>{var t,s;return((t=(s=e.columnDef.sortDescFirst)!=null?s:n.options.sortDescFirst)!=null?t:e.getAutoSortDir()==="desc")?"desc":"asc"},e.getNextSortingOrder=t=>{var s,o;const a=e.getFirstSortDir(),u=e.getIsSorted();return u?u!==a&&((s=n.options.enableSortingRemoval)==null||s)&&(!(t&&(o=n.options.enableMultiRemove)!=null)||o)?!1:u==="desc"?"asc":"desc":a},e.getCanSort=()=>{var t,s;return((t=e.columnDef.enableSorting)!=null?t:!0)&&((s=n.options.enableSorting)!=null?s:!0)&&!!e.accessorFn},e.getCanMultiSort=()=>{var t,s;return(t=(s=e.columnDef.enableMultiSort)!=null?s:n.options.enableMultiSort)!=null?t:!!e.accessorFn},e.getIsSorted=()=>{var t;const s=(t=n.getState().sorting)==null?void 0:t.find(o=>o.id===e.id);return s?s.desc?"desc":"asc":!1},e.getSortIndex=()=>{var t,s;return(t=(s=n.getState().sorting)==null?void 0:s.findIndex(o=>o.id===e.id))!=null?t:-1},e.clearSorting=()=>{n.setSorting(t=>t!=null&&t.length?t.filter(s=>s.id!==e.id):[])},e.getToggleSortingHandler=()=>{const t=e.getCanSort();return s=>{t&&(s.persist==null||s.persist(),e.toggleSorting==null||e.toggleSorting(void 0,e.getCanMultiSort()?n.options.isMultiSortEvent==null?void 0:n.options.isMultiSortEvent(s):!1))}}},createTable:e=>{e.setSorting=n=>e.options.onSortingChange==null?void 0:e.options.onSortingChange(n),e.resetSorting=n=>{var t,s;e.setSorting(n?[]:(t=(s=e.initialState)==null?void 0:s.sorting)!=null?t:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())}},Gi=[ui,Ri,Ci,Ni,di,gi,$i,Ei,Hi,wi,Ii,Ai,ki,Pi,Mi];function Bi(e){var n,t;const s=[...Gi,...(n=e._features)!=null?n:[]];let o={_features:s};const a=o._features.reduce((x,f)=>Object.assign(x,f.getDefaultOptions==null?void 0:f.getDefaultOptions(o)),{}),u=x=>o.options.mergeOptions?o.options.mergeOptions(a,x):{...a,...x};let d={...{},...(t=e.initialState)!=null?t:{}};o._features.forEach(x=>{var f;d=(f=x.getInitialState==null?void 0:x.getInitialState(d))!=null?f:d});const m=[];let g=!1;const y={_features:s,options:{...a,...e},initialState:d,_queue:x=>{m.push(x),g||(g=!0,Promise.resolve().then(()=>{for(;m.length;)m.shift()();g=!1}).catch(f=>setTimeout(()=>{throw f})))},reset:()=>{o.setState(o.initialState)},setOptions:x=>{const f=Yt(x,o.options);o.options=u(f)},getState:()=>o.options.state,setState:x=>{o.options.onStateChange==null||o.options.onStateChange(x)},_getRowId:(x,f,w)=>{var C;return(C=o.options.getRowId==null?void 0:o.options.getRowId(x,f,w))!=null?C:`${w?[w.id,f].join("."):f}`},getCoreRowModel:()=>(o._getCoreRowModel||(o._getCoreRowModel=o.options.getCoreRowModel(o)),o._getCoreRowModel()),getRowModel:()=>o.getPaginationRowModel(),getRow:(x,f)=>{let w=(f?o.getPrePaginationRowModel():o.getRowModel()).rowsById[x];if(!w&&(w=o.getCoreRowModel().rowsById[x],!w))throw new Error;return w},_getDefaultColumnDef:ie(()=>[o.options.defaultColumn],x=>{var f;return x=(f=x)!=null?f:{},{header:w=>{const C=w.header.column.columnDef;return C.accessorKey?C.accessorKey:C.accessorFn?C.id:null},cell:w=>{var C,S;return(C=(S=w.renderValue())==null||S.toString==null?void 0:S.toString())!=null?C:null},...o._features.reduce((w,C)=>Object.assign(w,C.getDefaultColumnDef==null?void 0:C.getDefaultColumnDef()),{}),...x}},le(e,"debugColumns")),_getColumnDefs:()=>o.options.columns,getAllColumns:ie(()=>[o._getColumnDefs()],x=>{const f=function(w,C,S){return S===void 0&&(S=0),w.map(v=>{const _=li(o,v,S,C),b=v;return _.columns=b.columns?f(b.columns,_,S+1):[],_})};return f(x)},le(e,"debugColumns")),getAllFlatColumns:ie(()=>[o.getAllColumns()],x=>x.flatMap(f=>f.getFlatColumns()),le(e,"debugColumns")),_getAllFlatColumnsById:ie(()=>[o.getAllFlatColumns()],x=>x.reduce((f,w)=>(f[w.id]=w,f),{}),le(e,"debugColumns")),getAllLeafColumns:ie(()=>[o.getAllColumns(),o._getOrderColumnsFn()],(x,f)=>{let w=x.flatMap(C=>C.getLeafColumns());return f(w)},le(e,"debugColumns")),getColumn:x=>o._getAllFlatColumnsById()[x]};Object.assign(o,y);for(let x=0;x<o._features.length;x++){const f=o._features[x];f==null||f.createTable==null||f.createTable(o)}return o}function so(){return e=>ie(()=>[e.options.data],n=>{const t={rows:[],flatRows:[],rowsById:{}},s=function(o,a,u){a===void 0&&(a=0);const i=[];for(let m=0;m<o.length;m++){const g=ci(e,e._getRowId(o[m],m,u),o[m],m,a,void 0,u==null?void 0:u.id);if(t.flatRows.push(g),t.rowsById[g.id]=g,i.push(g),e.options.getSubRows){var d;g.originalSubRows=e.options.getSubRows(o[m],m),(d=g.originalSubRows)!=null&&d.length&&(g.subRows=s(g.originalSubRows,a+1,g))}}return i};return t.rows=s(n),t},le(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))}function Wi(e){const n=[],t=s=>{var o;n.push(s),(o=s.subRows)!=null&&o.length&&s.getIsExpanded()&&s.subRows.forEach(t)};return e.rows.forEach(t),{rows:n,flatRows:e.flatRows,rowsById:e.rowsById}}function oo(e){return n=>ie(()=>[n.getState().pagination,n.getPrePaginationRowModel(),n.options.paginateExpandedRows?void 0:n.getState().expanded],(t,s)=>{if(!s.rows.length)return s;const{pageSize:o,pageIndex:a}=t;let{rows:u,flatRows:i,rowsById:d}=s;const m=o*a,g=m+o;u=u.slice(m,g);let y;n.options.paginateExpandedRows?y={rows:u,flatRows:i,rowsById:d}:y=Wi({rows:u,flatRows:i,rowsById:d}),y.flatRows=[];const x=f=>{y.flatRows.push(f),f.subRows.length&&f.subRows.forEach(x)};return y.rows.forEach(x),y},le(n.options,"debugTable"))}function ao(){return e=>ie(()=>[e.getState().sorting,e.getPreSortedRowModel()],(n,t)=>{if(!t.rows.length||!(n!=null&&n.length))return t;const s=e.getState().sorting,o=[],a=s.filter(d=>{var m;return(m=e.getColumn(d.id))==null?void 0:m.getCanSort()}),u={};a.forEach(d=>{const m=e.getColumn(d.id);m&&(u[d.id]={sortUndefined:m.columnDef.sortUndefined,invertSorting:m.columnDef.invertSorting,sortingFn:m.getSortingFn()})});const i=d=>{const m=d.map(g=>({...g}));return m.sort((g,y)=>{for(let f=0;f<a.length;f+=1){var x;const w=a[f],C=u[w.id],S=C.sortUndefined,v=(x=w==null?void 0:w.desc)!=null?x:!1;let _=0;if(S){const b=g.getValue(w.id),$=y.getValue(w.id),R=b===void 0,I=$===void 0;if(R||I){if(S==="first")return R?-1:1;if(S==="last")return R?1:-1;_=R&&I?0:R?S:-S}}if(_===0&&(_=C.sortingFn(g,y,w.id)),_!==0)return v&&(_*=-1),C.invertSorting&&(_*=-1),_}return g.index-y.index}),m.forEach(g=>{var y;o.push(g),(y=g.subRows)!=null&&y.length&&(g.subRows=i(g.subRows))}),m};return{rows:i(t.rows),flatRows:o,rowsById:t.rowsById}},le(e.options,"debugTable","getSortedRowModel",()=>e._autoResetPageIndex()))}/**
   * react-table
   *
   * Copyright (c) TanStack
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE.md file in the root directory of this source tree.
   *
   * @license MIT
   */function io(e,n){return e?Ui(e)?p.createElement(e,n):e:null}function Ui(e){return qi(e)||typeof e=="function"||Ki(e)}function qi(e){return typeof e=="function"&&(()=>{const n=Object.getPrototypeOf(e);return n.prototype&&n.prototype.isReactComponent})()}function Ki(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function lo(e){const n={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[t]=p.useState(()=>({current:Bi(n)})),[s,o]=p.useState(()=>t.current.initialState);return t.current.setOptions(a=>({...a,...e,state:{...s,...e.state},onStateChange:u=>{o(u),e.onStateChange==null||e.onStateChange(u)}})),t.current}function Ro({nodes:e,edges:n,onNodesChange:t,onEdgesChange:s,onBlur:o,editable:a=!1}){const[u,i]=p.useState("nodes"),[d,m]=p.useState(e),[g,y]=p.useState(n),x=p.useRef(new Map),f=p.useRef(new Map);p.useEffect(()=>{m([...e]),y([...n]),x.current.clear(),f.current.clear()},[e,n]);const w=p.useMemo(()=>{const R=a?d:e;if(R.length===0)return[];const I=new Set;R.forEach(A=>{Object.keys(A).forEach(oe=>{Gs(oe)||I.add(oe)})});const X=Array.from(I);return[...X.includes("id")?["id"]:[],...X.includes("label")?["label"]:[],...X.filter(A=>A!=="id"&&A!=="label")].map(A=>({header:Bs(A),accessorKey:A,cell:oe=>{var me;const Q=oe.getValue();if(a&&A!=="id"){const re=oe.row.original.id,J=d.findIndex(fe=>fe.id===re);if(J===-1)return r.jsx("span",{children:"-"});const be=((me=d[J])==null?void 0:me[A])??Q,_e=`${re}-${A}`;return r.jsx(is,{id:_e,type:typeof be=="number"?"number":"text",initialValue:be==null?"":String(be),isNumber:typeof be=="number",onBlur:fe=>{const ge=[...d],F=typeof be=="number"?parseFloat(fe)||0:fe;ge[J]={...ge[J],[A]:F},m(ge),t==null||t(ge),o==null||o()}},_e)}return Q==null?"-":typeof Q=="number"?Q.toLocaleString():String(Q)}}))},[e,d,a]),C=p.useMemo(()=>{const R=(a?g:n).filter(A=>!(A!=null&&A._overlayType)&&!(A!=null&&A.__isOverlay));if(R.length===0)return[];const I=new Set;R.forEach(A=>{Object.keys(A).forEach(oe=>{Gs(oe)||I.add(oe)})});const X=Array.from(I);return[...X.includes("source")?["source"]:[],...X.includes("target")?["target"]:[],...X.includes("value")?["value"]:[],...X.filter(A=>A!=="source"&&A!=="target"&&A!=="value")].map(A=>({header:Bs(A),accessorKey:A,cell:oe=>{var me,z;const Q=oe.getValue();if(a&&A!=="source"&&A!=="target"){const re=oe.row.original,J=g.findIndex(fe=>fe.source===re.source&&fe.target===re.target&&fe.value===re.value);if(J===-1){const fe=g.findIndex(B=>B.source===re.source&&B.target===re.target);if(fe===-1)return r.jsx("span",{children:"-"});const ge=((me=g[fe])==null?void 0:me[A])??Q,F=`${re.source}-${re.target}-${A}-fallback`;return r.jsx(is,{id:F,type:typeof ge=="number"?"number":"text",initialValue:ge==null?"":String(ge),isNumber:typeof ge=="number",onBlur:B=>{const Ce=[...g],Te=typeof ge=="number"?parseFloat(B)||0:B;Ce[fe]={...Ce[fe],[A]:Te},y(Ce),s==null||s(Ce),o==null||o()}},F)}const be=((z=g[J])==null?void 0:z[A])??Q,_e=`${re.source}-${re.target}-${A}`;return r.jsx(is,{id:_e,type:typeof be=="number"?"number":"text",initialValue:be==null?"":String(be),isNumber:typeof be=="number",onBlur:fe=>{const ge=[...g],F=typeof be=="number"?parseFloat(fe)||0:fe;ge[J]={...ge[J],[A]:F},y(ge),s==null||s(ge),o==null||o()}},_e)}return Q==null?"-":typeof Q=="number"?Q.toLocaleString():String(Q)}}))},[n,g,a]),S=a?d:e,v=p.useMemo(()=>(a?g:n).filter(I=>!(I!=null&&I._overlayType)&&!(I!=null&&I.__isOverlay)),[a,g,n]),_=lo({data:S,columns:w,getCoreRowModel:so(),getSortedRowModel:ao(),getPaginationRowModel:oo(),initialState:{pagination:{pageSize:25}}}),b=lo({data:v,columns:C,getCoreRowModel:so(),getSortedRowModel:ao(),getPaginationRowModel:oo(),initialState:{pagination:{pageSize:25}}}),$=u==="nodes"?_:b;return r.jsxs("div",{className:"h-full w-full flex flex-col",style:{height:"100%",maxHeight:"100%"},children:[r.jsxs("div",{className:"flex border-b mb-4 flex-shrink-0",children:[r.jsxs("button",{onClick:()=>i("nodes"),className:`px-4 py-2 font-medium text-sm transition-colors ${u==="nodes"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Nodes (",S.length,")"]}),r.jsxs("button",{onClick:()=>i("edges"),className:`px-4 py-2 font-medium text-sm transition-colors ${u==="edges"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Edges (",v.length,")"]})]}),r.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:r.jsxs("div",{className:"overflow-auto flex-1 min-h-0",children:[r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 border-b sticky top-0 z-10",children:$.getHeaderGroups().map(R=>r.jsx("tr",{children:R.headers.map(I=>r.jsx("th",{className:"px-4 py-2 text-left font-semibold text-gray-700 bg-gray-50",children:I.isPlaceholder?null:r.jsxs("div",{className:I.column.getCanSort()?"cursor-pointer select-none hover:text-blue-600":"",onClick:I.column.getToggleSortingHandler(),children:[io(I.column.columnDef.header,I.getContext()),{asc:" ↑",desc:" ↓"}[I.column.getIsSorted()]??null]})},I.id))},R.id))}),r.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:$.getRowModel().rows.map(R=>r.jsx("tr",{className:"hover:bg-gray-50",children:R.getVisibleCells().map(I=>r.jsx("td",{className:"px-4 py-2",children:io(I.column.columnDef.cell,I.getContext())},I.id))},R.id))})]}),$.getRowModel().rows.length===0&&r.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No ",u," to display"]})]})}),r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-white flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-700",children:"Show"}),r.jsx("select",{value:$.getState().pagination.pageSize,onChange:R=>{$.setPageSize(Number(R.target.value))},className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[10,25,50,100].map(R=>r.jsx("option",{value:R,children:R},R))}),r.jsx("span",{className:"text-sm text-gray-700",children:"entries"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",$.getState().pagination.pageIndex+1," of"," ",$.getPageCount()]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>$.setPageIndex(0),disabled:!$.getCanPreviousPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"<<"}),r.jsx("button",{onClick:()=>$.previousPage(),disabled:!$.getCanPreviousPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"<"}),r.jsx("button",{onClick:()=>$.nextPage(),disabled:!$.getCanNextPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:">"}),r.jsx("button",{onClick:()=>$.setPageIndex($.getPageCount()-1),disabled:!$.getCanNextPage(),className:"px-2 py-1 text-sm border border-gray-300 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:">>"})]})]})]})]})}function is({id:e,type:n,initialValue:t,onBlur:s}){const o=p.useRef(null),[a,u]=p.useState(t);return p.useEffect(()=>{o.current&&document.activeElement!==o.current&&u(t)},[t]),r.jsx("input",{ref:o,id:e,type:n,value:a,onChange:i=>{u(i.target.value)},onBlur:i=>{s(i.target.value)},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",autoComplete:"off"})}function Yi({dataset:e,onClose:n,onSave:t,onDelete:s,onDuplicate:o}){const[a,u]=p.useState(e.name),[i,d]=p.useState(e.notes||""),[m,g]=p.useState(!1),[y,x]=p.useState(!1),[f,w]=p.useState(!1),[C,S]=p.useState("info"),[v,_]=p.useState(null),b=e.snapshots[0]||{timestamp:e.timeRange.start,nodes:[],edges:[]};p.useEffect(()=>{u(e.name),d(e.notes||""),_(null)},[e]);async function $(){g(!0);try{const K={...e,name:a.trim(),notes:i.trim()||void 0};if(v){K.snapshots=v.snapshots;const A=K.snapshots[0]||b;K.metadata=dn(A)}await t(K),n()}catch(K){console.error("Save error:",K),alert("Failed to save dataset: "+(K instanceof Error?K.message:"Unknown error"))}finally{g(!1)}}async function R(){x(!0);try{await s(),n()}catch(K){console.error("Delete error:",K),alert("Failed to delete dataset: "+(K instanceof Error?K.message:"Unknown error"))}finally{x(!1),w(!1)}}function I(K,A){const oe={...b,nodes:K,edges:A};_({...e,snapshots:[oe]})}const X=a!==e.name||i!==(e.notes||"")||v!==null;return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] flex flex-col",children:[r.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold",children:"Edit Dataset"}),r.jsx("button",{onClick:n,type:"button",className:"text-gray-400 hover:text-gray-600 text-2xl cursor-pointer transition-colors",children:"×"})]}),r.jsxs("div",{className:"border-b flex",children:[r.jsx("button",{onClick:()=>S("info"),type:"button",className:`px-6 py-3 font-medium cursor-pointer transition-colors ${C==="info"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Information"}),r.jsxs("button",{onClick:()=>S("data"),type:"button",className:`px-6 py-3 font-medium cursor-pointer transition-colors ${C==="data"?"border-b-2 border-blue-600 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:["Data (",b.nodes.length," nodes, ",b.edges.length," edges)"]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:C==="info"?r.jsxs("div",{className:"space-y-6 max-w-2xl",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Dataset Name ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",value:a,onChange:K=>u(K.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter a name for this dataset"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),r.jsx("textarea",{value:i,onChange:K=>d(K.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Add any notes about this dataset..."})]}),r.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[r.jsx("h3",{className:"font-medium text-gray-700 mb-2",children:"Dataset Information"}),r.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Type:"})," ",e.type.toUpperCase()]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Time Range:"})," ",e.timeRange.start,e.timeRange.end!==e.timeRange.start?` – ${e.timeRange.end}`:""]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Snapshots:"})," ",e.snapshots.length]}),e.filename&&r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Original File:"})," ",e.filename]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(e.createdAt).toLocaleDateString()]})]})]}),r.jsxs("div",{className:"border-t pt-4 space-y-3",children:[r.jsx("button",{onClick:o,type:"button",className:"w-full px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"Duplicate Dataset"}),r.jsx("button",{onClick:()=>w(!0),type:"button",className:"w-full px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 cursor-pointer transition-colors",children:"Delete Dataset"})]})]}):r.jsx("div",{className:"h-full",children:r.jsx(Xi,{nodes:b.nodes,edges:b.edges,onUpdate:I})})}),r.jsxs("div",{className:"p-6 border-t flex justify-end gap-3",children:[r.jsx("button",{onClick:n,type:"button",disabled:m||y,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 disabled:opacity-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:$,type:"button",disabled:m||y||!X&&C==="info"||!a.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer transition-colors",children:m?"Saving...":v?"Save All Changes":"Save Changes"})]}),f&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-60",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold mb-2",children:"Delete Dataset?"}),r.jsxs("p",{className:"text-gray-600 mb-4",children:['Are you sure you want to delete "',e.name,'"? This action cannot be undone.']}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>w(!1),type:"button",disabled:y,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:R,type:"button",disabled:y,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 cursor-pointer transition-colors",children:y?"Deleting...":"Delete"})]})]})})]})})}function Xi({nodes:e,edges:n,onUpdate:t}){const[s,o]=p.useState(e),[a,u]=p.useState(n);p.useEffect(()=>{o([...e]),u([...n])},[e,n]);const i=p.useRef(s),d=p.useRef(a);p.useEffect(()=>{i.current=s,d.current=a},[s,a]);const m=p.useCallback(f=>{o(f),i.current=f},[]),g=p.useCallback(f=>{u(f),d.current=f},[]),y=p.useRef(!1),x=p.useCallback(()=>{y.current&&(t(i.current,d.current),y.current=!1)},[t]);return r.jsx("div",{className:"h-full",children:r.jsx(Ro,{nodes:s,edges:a,onNodesChange:f=>{m(f),y.current=!0},onEdgesChange:f=>{g(f),y.current=!0},onBlur:x,editable:!0})})}class Ut extends p.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,t){var s,o;console.error("ErrorBoundary caught an error:",n,t),(o=(s=this.props).onError)==null||o.call(s,n,t)}render(){var n;return this.state.hasError?this.props.fallback?this.props.fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Something went wrong"}),r.jsx("p",{className:"text-sm text-red-700 mb-2",children:((n=this.state.error)==null?void 0:n.message)||"An error occurred"}),r.jsx("button",{type:"button",onClick:()=>this.setState({hasError:!1,error:null}),className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 cursor-pointer transition-colors",children:"Try again"})]}):this.props.children}}function Zi({selectedId:e,onSelect:n,onRefresh:t}){const[s,o]=p.useState([]),[a,u]=p.useState(!1),[i,d]=p.useState(null),[m,g]=p.useState(!1),[y,x]=p.useState(null),f=p.useRef(null);p.useEffect(()=>{w()},[]);async function w(){const R=await ei();o(R)}async function C(R,I){try{const K=`${R.type||"csv"}-${Date.now()}`,A={...R,id:K,snapshots:I.snapshots,metadata:I.metadata,createdAt:Date.now()};await qt(A),await w(),u(!1),x(null),n(K)}catch(X){throw console.error("Import error:",X),X}finally{f.current&&(f.current.value="")}}async function S(R,I){I.stopPropagation();const X=await Kt(R);X&&d(X)}async function v(R){await qt(R),await w(),e===R.id&&(t==null||t())}async function _(){i&&(await gs(i.id),await w(),e===i.id&&n(""),d(null))}async function b(){if(!i)return;const R=await ti(i.id);await w(),d(null),n(R.id)}async function $(){await ni(),await w(),g(!1),n(""),window.location.reload()}return r.jsxs("aside",{className:"h-full overflow-y-auto flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b",children:[r.jsx("h2",{className:"text-lg font-bold",children:"Datasets"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Stored in your browser"}),r.jsx("button",{onClick:()=>u(!0),className:"mt-3 w-full px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Import Dataset"}),r.jsx("input",{ref:f,type:"file",accept:".csv,.gexf",multiple:!0,className:"hidden"}),a&&r.jsx(Ut,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"Import Panel Error"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"The import panel encountered an error."}),r.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 cursor-pointer transition-colors",children:"Close"})]})}),children:r.jsx(si,{onClose:()=>{u(!1),x(null),f.current&&(f.current.value="")},onImport:C,fileInputRef:f,onFilesSelected:x,existingFile:y})})]}),r.jsxs("ul",{className:"divide-y flex-1 overflow-y-auto",children:[s.map(R=>r.jsx("li",{children:r.jsxs("div",{className:`flex items-center group ${e===R.id?"bg-blue-50":""}`,children:[r.jsxs("button",{className:"flex-1 text-left p-3 hover:bg-gray-50",onClick:()=>n(R.id),children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("div",{className:"font-medium",children:R.name}),r.jsxs("div",{className:"text-xs text-gray-500",children:[R.type.toUpperCase()," · ",R.timeRange.start,R.timeRange.end!==R.timeRange.start?`–${R.timeRange.end}`:""]})]})}),R.notes&&r.jsx("div",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:R.notes})]}),r.jsx("button",{onClick:I=>S(R.id,I),className:"px-2 py-1 text-gray-400 hover:text-blue-600 hover:bg-gray-100 rounded transition-all mr-2 cursor-pointer",title:"Edit dataset",type:"button",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})},R.id)),s.length===0&&r.jsx("li",{className:"p-3 text-sm text-gray-500",children:"No datasets yet"})]}),r.jsxs("div",{className:"p-4 border-t",children:[r.jsx("button",{onClick:()=>g(!0),type:"button",className:"w-full px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 cursor-pointer transition-colors",children:"Reset All Data"}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Delete all datasets and reload defaults"})]}),i&&r.jsx(Ut,{fallback:r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold text-red-800 mb-2",children:"Edit Panel Error"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"The edit panel encountered an error."}),r.jsx("button",{onClick:()=>d(null),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 cursor-pointer transition-colors",children:"Close"})]})}),children:r.jsx(Yi,{dataset:i,onClose:()=>d(null),onSave:v,onDelete:_,onDuplicate:b})}),m&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-60",children:r.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[r.jsx("h3",{className:"text-lg font-bold mb-2",children:"Reset All Data?"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"This will delete all datasets and reload the default test data. This action cannot be undone."}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>g(!1),type:"button",className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 cursor-pointer transition-colors",children:"Cancel"}),r.jsx("button",{onClick:$,type:"button",className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 cursor-pointer transition-colors",children:"Reset All Data"})]})]})})]})}function Qi({nodes:e,edges:n,width:t=1200,height:s=800}){const o=p.useRef(null),[a,u]=p.useState(null),[i,d]=p.useState(null);return p.useEffect(()=>{var fe,ge;if(!o.current||n.length===0||e.length===0){o.current&&De(o.current).selectAll("*").remove();return}De(o.current).selectAll("*").remove();const m=new Map;e.forEach(F=>{m.set(F.id,{id:F.id,label:F.label||F.id,outgoing:0,incoming:0})}),n.forEach(F=>{const B=m.get(F.source),Ce=m.get(F.target);B&&(B.outgoing+=F.value),Ce&&(Ce.incoming+=F.value)});const g=Array.from(m.values()).filter(F=>F.outgoing>0||F.incoming>0);if(g.length===0){De(o.current).append("text").attr("x",t/2).attr("y",s/2).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#666").text("No active nodes with flows");return}g.sort((F,B)=>B.outgoing+B.incoming-(F.outgoing+F.incoming));const y=50,x=t-50,f=20,w=15,C=2,S=5,v=g.reduce((F,B)=>F+B.outgoing,0),_=g.reduce((F,B)=>F+B.incoming,0),b=Math.max(s-2*f,400);let $=f;g.forEach(F=>{const B=v>0?Math.max(S,F.outgoing/v*b):Math.max(S,b/g.length);$+=B+C});let R=f;g.forEach(F=>{const B=_>0?Math.max(S,F.incoming/_*b):Math.max(S,b/g.length);R+=B+C});const I=Math.max(s,Math.max($,R)+100),X=I-2*f,K=De(o.current).attr("width",t).attr("height",I).style("font","12px sans-serif");let A=f;const oe=g.map((F,B)=>{const Ce=v>0?Math.max(S,F.outgoing/v*X):Math.max(S,X/g.length),Te=A;return A+=Ce+C,{node:F,x:y,y:Te,height:Math.max(S,Ce-C),side:"left",index:B}});A=f;const Q=g.map((F,B)=>{const Ce=_>0?Math.max(S,F.incoming/_*X):Math.max(S,X/g.length),Te=A;return A+=Ce+C,{node:F,x,y:Te,height:Math.max(S,Ce-C),side:"right",index:B}});let me=[];a&&i&&(i==="left"?me=n.filter(F=>F.source===a&&F.source!==F.target):me=n.filter(F=>F.target===a&&F.source!==F.target));const z=fo(yo);if(me.length>0){const F=me.map(L=>{const Le=oe.find(Qe=>Qe.node.id===L.source),G=Q.find(Qe=>Qe.node.id===L.target);if(!Le||!G)return null;const Be=Le.y+Le.height/2,ke=G.y+G.height/2;return{edge:L,sourceX:Le.x+w,sourceY:Be,targetX:G.x,targetY:ke,value:L.value,leftIndex:Le.index,rightIndex:G.index}}).filter(L=>L!==null),B=Math.max(...F.map(L=>L.value),1),Ce=2,Te=20,ot=K.append("g").attr("class","links");F.forEach(L=>{const Le=Ce+L.value/B*(Te-Ce),G=`gradient-${L.leftIndex}-${L.rightIndex}`,Be=K.append("defs").append("linearGradient").attr("id",G).attr("gradientUnits","userSpaceOnUse").attr("x1",L.sourceX).attr("x2",L.targetX).attr("y1",L.sourceY).attr("y2",L.targetY);Be.append("stop").attr("offset","0%").attr("stop-color",z(String(L.leftIndex))).attr("stop-opacity",.6),Be.append("stop").attr("offset","100%").attr("stop-color",z(String(L.rightIndex))).attr("stop-opacity",.6);const ke=bs(),Qe=(L.sourceX+L.targetX)/2;ke.moveTo(L.sourceX,L.sourceY),ke.bezierCurveTo(Qe,L.sourceY,Qe,L.targetY,L.targetX,L.targetY),ot.append("path").attr("d",ke.toString()).attr("stroke",`url(#${G})`).attr("stroke-width",Le).attr("fill","none").attr("stroke-opacity",.6).style("cursor","pointer").on("mouseover",function(Pe){De(this).attr("stroke-opacity",1).attr("stroke-width",Le+2),De("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("pointer-events","none").style("opacity",0).html(`${L.edge.source} → ${L.edge.target}<br/>${L.value.toLocaleString()}`).style("opacity",1)}).on("mousemove",function(Pe){De(".tooltip").style("left",`${Pe.pageX+10}px`).style("top",`${Pe.pageY-10}px`)}).on("mouseout",function(){De(this).attr("stroke-opacity",.6).attr("stroke-width",Le),De(".tooltip").remove()})})}const J=K.append("g").attr("class","left-nodes").selectAll("g.node").data(oe).join("g").attr("class","node").attr("transform",F=>`translate(${F.x}, ${F.y})`).style("cursor","pointer").on("click",function(F,B){F.stopPropagation(),a===B.node.id&&i==="left"?(u(null),d(null)):(u(B.node.id),d("left"))});J.append("rect").attr("width",w).attr("height",F=>F.height).attr("fill",(F,B)=>z(String(B))).attr("stroke",(F,B)=>gn(z(String(B))).darker().formatHex()).attr("stroke-width",F=>a===F.node.id&&i==="left"?3:1).attr("opacity",F=>a&&i==="left"&&a!==F.node.id?.3:1).on("mouseover",function(F,B){De(this).attr("fill",gn(z(String(B.index))).brighter(.5).formatHex())}).on("mouseout",function(F,B){De(this).attr("fill",z(String(B.index)))}),J.append("text").attr("x",w+6).attr("y",F=>F.height/2).attr("dy","0.35em").attr("text-anchor","start").text(F=>`${F.node.label} (${F.node.outgoing.toLocaleString()})`).style("font-size","11px").style("font-weight","500").style("fill","#333").attr("opacity",F=>a&&i==="left"&&a!==F.node.id?.3:1);const _e=K.append("g").attr("class","right-nodes").selectAll("g.node").data(Q).join("g").attr("class","node").attr("transform",F=>`translate(${F.x}, ${F.y})`).style("cursor","pointer").on("click",function(F,B){F.stopPropagation(),a===B.node.id&&i==="right"?(u(null),d(null)):(u(B.node.id),d("right"))});_e.append("rect").attr("x",-w).attr("width",w).attr("height",F=>F.height).attr("fill",(F,B)=>z(String(B))).attr("stroke",(F,B)=>gn(z(String(B))).darker().formatHex()).attr("stroke-width",F=>a===F.node.id&&i==="right"?3:1).attr("opacity",F=>a&&i==="right"&&a!==F.node.id?.3:1).on("mouseover",function(F,B){De(this).attr("fill",gn(z(String(B.index))).brighter(.5).formatHex())}).on("mouseout",function(F,B){De(this).attr("fill",z(String(B.index)))}),_e.append("text").attr("x",-w-6).attr("y",F=>F.height/2).attr("dy","0.35em").attr("text-anchor","end").text(F=>`${F.node.label} (${F.node.incoming.toLocaleString()})`).style("font-size","11px").style("font-weight","500").style("fill","#333").attr("opacity",F=>a&&i==="right"&&a!==F.node.id?.3:1),a?K.append("text").attr("x",t/2).attr("y",20).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#333").text(i==="left"?`Showing outgoing flows from ${(fe=oe.find(F=>F.node.id===a))==null?void 0:fe.node.label}`:`Showing incoming flows to ${(ge=Q.find(F=>F.node.id===a))==null?void 0:ge.node.label}`):K.append("text").attr("x",t/2).attr("y",20).attr("text-anchor","middle").attr("font-size","14px").attr("fill","#666").text("Click a node to see its connections"),K.append("text").attr("x",y+w/2).attr("y",I-10).attr("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold").attr("fill","#333").text("Outgoing"),K.append("text").attr("x",x-w/2).attr("y",I-10).attr("text-anchor","middle").attr("font-size","12px").attr("font-weight","bold").attr("fill","#333").text("Incoming"),K.on("click",function(F){(F.target===o.current||F.target.tagName==="svg")&&(u(null),d(null))})},[e,n,t,s,a,i]),r.jsxs("div",{className:"w-full h-full flex flex-col min-h-0",children:[r.jsxs("div",{className:"text-center text-xs text-gray-500 mb-2 flex-shrink-0",children:["Interaction design inspired by"," ",r.jsx("a",{href:"https://peoplemov.in/#f_AF",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"peoplemov.in by Carlo Zapponi"})]}),r.jsx("div",{className:"flex-1 overflow-auto min-h-0",children:r.jsx("svg",{ref:o,className:"border border-gray-200 rounded bg-white"})})]})}function Ji(e,n){const t=e.length,s=new Map;e.forEach((u,i)=>{s.set(u.id,i)});const o=Array(t).fill(null).map(()=>Array(t).fill(0));n.forEach(u=>{const i=s.get(u.source),d=s.get(u.target);i!==void 0&&d!==void 0&&(o[i][d]+=u.value)});const a=e.map(u=>u.label||u.id);return{matrix:o,labels:a,nodes:e}}function uo(e,n,t){return!t||t==="all"?e:e.filter(s=>{const o=s[n];return Array.isArray(o)?o.includes(t):o===t})}function el(e,n){const t=new Set;return e.forEach(s=>{const o=s[n];if(o!=null){if(Array.isArray(o)){o.filter(a=>typeof a=="string"||typeof a=="number").forEach(a=>t.add(a));return}(typeof o=="string"||typeof o=="number")&&t.add(o)}}),Array.from(t).sort((s,o)=>typeof s=="number"&&typeof o=="number"?s-o:String(s).localeCompare(String(o)))}function tl({nodes:e,edges:n,width:t=1e3,height:s=800}){const o=p.useRef(null);return p.useEffect(()=>{if(!o.current||n.length===0||e.length===0){o.current&&De(o.current).selectAll("*").remove();return}De(o.current).selectAll("*").remove();const a=Ji(e,n),u=De(o.current).attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${t} ${s}`).attr("preserveAspectRatio","xMidYMid meet"),i=Math.min(t,s)*.5-40,d=i-20,m=To().scaleExtent([.1,4]).on("zoom",function(_){C.attr("transform",_.transform.toString())});u.call(m);const g=u.append("g").attr("class","reset-button").style("cursor","pointer").attr("transform",`translate(${t-120}, 10)`).on("click",function(){u.transition().duration(750).call(m.transform,Lo)});g.append("rect").attr("width",110).attr("height",30).attr("rx",4).attr("fill","white").attr("stroke","#ccc").attr("stroke-width",1),g.append("text").attr("x",55).attr("y",20).attr("text-anchor","middle").attr("font-size","12px").attr("fill","#333").text("Reset View");const x=aa().padAngle(.05).sortSubgroups(sa)(a.matrix),f=xa().radius(d),w=fo(yo),C=u.append("g").attr("class","zoom-group"),S=C.append("g").attr("transform",`translate(${t/2}, ${s/2})`),v=S.append("g").selectAll("g").data(x.groups).join("g");v.append("path").attr("fill",_=>w(String(_.index))).attr("stroke",_=>gn(w(String(_.index))).darker().formatHex()).attr("d",Ra().innerRadius(d).outerRadius(i)).on("mouseover",function(_,b){De(this).attr("fill",gn(w(String(b.index))).brighter(1).formatHex()),S.selectAll("path.chord").style("opacity",$=>$.source.index===b.index||$.target.index===b.index?1:.2)}).on("mouseout",function(){De(this).attr("fill",_=>w(String(_.index))),S.selectAll("path.chord").style("opacity",1)}),v.append("text").attr("dy",".35em").attr("transform",_=>`
        rotate(${(_.startAngle+_.endAngle)/2*180/Math.PI-90})
        translate(${i+10})
        ${(_.startAngle+_.endAngle)/2>Math.PI?"rotate(180)":""}
      `).attr("text-anchor",_=>(_.startAngle+_.endAngle)/2>Math.PI?"end":"start").text(_=>a.labels[_.index]).style("font-size","12px").style("font-weight","500"),S.append("g").attr("fill-opacity",.67).selectAll("path").data(x).join("path").attr("class","chord").attr("d",_=>f(_)??"").attr("fill",_=>w(String(_.source.index))).attr("stroke",_=>gn(w(String(_.source.index))).darker().formatHex()).style("stroke-width","1px").on("mouseover",function(_,b){De(this).attr("fill-opacity",1).style("stroke-width","2px"),De("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0, 0, 0, 0.8)").style("color","white").style("padding","8px").style("border-radius","4px").style("pointer-events","none").style("opacity",0).style("transition","opacity 0.2s").html(`${a.labels[b.source.index]} → ${a.labels[b.target.index]}: ${b.source.value.toLocaleString()}`).style("opacity",1)}).on("mousemove",function(_){De(".tooltip").style("left",`${_.pageX+10}px`).style("top",`${_.pageY-10}px`)}).on("mouseout",function(){De(this).attr("fill-opacity",.67).style("stroke-width","1px"),De(".tooltip").remove()})},[e,n,t,s]),r.jsx("div",{className:"w-full h-full",children:r.jsx("svg",{ref:o,className:"border border-gray-200 rounded bg-white"})})}const nl=200,rl=600,sl=384,co=4;function ol({isCollapsed:e,onToggle:n,onResize:t,children:s,title:o="Settings",bottomContent:a}){const[u,i]=p.useState(sl),[d,m]=p.useState(!1),g=p.useRef(null),y=p.useRef(null);return p.useEffect(()=>{if(!d)return;const x=w=>{var C;if(!e&&((C=g.current)==null?void 0:C.getBoundingClientRect())){const v=Math.max(nl,Math.min(rl,window.innerWidth-w.clientX));i(v),t==null||t(v)}},f=()=>{m(!1)};return document.addEventListener("mousemove",x),document.addEventListener("mouseup",f),()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",f)}},[d,e,t]),r.jsxs("div",{ref:g,className:"bg-white border-l border-gray-200 flex flex-col transition-all duration-300  overflow-hidden relative",style:{minHeight:"100vh",width:e?`${co}px`:`${u}px`},children:[e&&r.jsxs(r.Fragment,{children:[r.jsx("button",{type:"button",onClick:n,className:"w-full h-full bg-gray-100 hover:bg-blue-400 cursor-pointer transition-colors",style:{width:`${co}px`},title:"Click to expand settings","aria-label":"Expand settings"}),r.jsx("button",{type:"button",onClick:n,className:"fixed bottom-4 right-4 z-50 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg cursor-pointer transition-all hover:scale-110 flex items-center justify-center",style:{width:"48px",height:"48px"},title:"Open visualization settings","aria-label":"Open visualization settings",children:r.jsx(Us,{className:"w-5 h-5"})})]}),!e&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:s}),a&&r.jsx("div",{className:"flex-shrink-0 border-t border-gray-200 bg-white",children:a}),r.jsxs("button",{type:"button",onClick:n,className:"w-full flex items-center justify-between p-2 border-t border-gray-200 flex-shrink-0 bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer","aria-label":"Collapse settings",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx(Us,{className:"w-4 h-4 text-gray-600"}),r.jsx("span",{className:"text-sm font-medium text-gray-700",children:o})]}),r.jsx(zo,{className:"w-4 h-4 text-gray-600 flex-shrink-0"})]}),r.jsx("div",{ref:y,onMouseDown:x=>{x.preventDefault(),m(!0)},className:"absolute top-0 left-0 w-1 h-full cursor-col-resize hover:bg-blue-400 bg-gray-300 transition-colors z-10",style:{touchAction:"none"},children:r.jsx("div",{className:"absolute top-1/2 left-0 transform -translate-y-1/2 -translate-x-0.5",children:r.jsx(Ho,{className:"w-3 h-6 text-gray-500"})})})]})]})}const $o=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],al=new Set($o),il=$o.length,go=Qo.reduce((e,n)=>(e[n]=n===2020?"ACS 1-year state-to-state migration flows for 2020 were not released by the Census Bureau due to pandemic-related data quality concerns.":"State-to-state migration data is unavailable for this year in the ACS 1-year series.",e),{}),ll=["visible_outgoing","visible_incoming","year_outgoing","year_incoming","net_year","self_year"],ul=["visible_outgoing","visible_incoming","year_outgoing","year_incoming","net_visible","net_year","self_year"];function an({title:e,subtitle:n,children:t,defaultOpen:s=!1,onReset:o}){const[a,u]=p.useState(s);return r.jsxs("div",{className:"border border-gray-200 rounded-md",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("button",{onClick:()=>u(!a),className:"flex-1 flex items-center justify-between p-3 hover:bg-gray-50 transition-colors text-left",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"font-semibold text-sm",children:e}),n&&r.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:n})]}),a?r.jsx(na,{className:"w-4 h-4 text-gray-600 flex-shrink-0"}):r.jsx(ea,{className:"w-4 h-4 text-gray-600 flex-shrink-0"})]}),o&&r.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),o()},className:"pr-3 text-[11px] font-medium text-blue-600 hover:text-blue-800 transition-colors",children:"Reset"})]}),a&&r.jsx("div",{className:"p-3 pt-0 border-t border-gray-200",children:t})]})}const mo=cn(["kriskogram","table","sankey","chord"]);function Rn(e){if(!e.length)return{mean:0,median:0};const n=[...e].sort((u,i)=>u-i),t=Math.floor(n.length/2),s=n.length%2!==0?n[t]:(n[t-1]+n[t])/2;return{mean:e.reduce((u,i)=>u+i,0)/e.length,median:s}}const Bt=e=>{const n=e!==void 0?lt().default(e):lt().optional();return Ee(t=>{if(t==null||t==="")return e;const s=typeof t=="string"?parseFloat(t):Number(t);return Number.isNaN(s)?e:s},n)},Wt=e=>Ee(n=>{if(typeof n=="boolean")return n;if(typeof n=="string"){if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1}return e},Yo().default(e));function ln(e,n){return Ee(t=>{if(typeof t=="string"){const s=t.toLowerCase(),o=e.find(a=>a.toLowerCase()===s);if(o)return o}return n},cn(e).default(n))}function cl(e){return Ee(n=>typeof n=="string"&&n.trim()!==""?n:e,mn().default(e))}const Un=()=>Ee(e=>e==null||e===""?null:typeof e=="string"?e:null,mn().nullable().default(null)),dl=()=>Ee(e=>Array.isArray(e)?e.map(n=>n==null?null:String(n)).filter(n=>!!(n&&n.trim())):typeof e=="string"?e.trim()===""?[]:e.split(",").map(n=>n.trim()).filter(n=>n.length>0):[],Ko(mn()).default([])),ls=e=>Ee(n=>{if(typeof n=="string"){const t=n.trim().toLowerCase();if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(t))return t.length===4?`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`:t}return e},mn().default(e));qo({dataset:mn().optional(),view:Ee(e=>typeof e=="string"&&mo.safeParse(e).success?e:"kriskogram",mo.default("kriskogram")),year:Bt(void 0),minThreshold:Bt(0),maxThreshold:Bt(2e5),maxEdges:Bt(500),edgeWeightScale:Ee(e=>{if(typeof e!="string")return"linear";const n=e.toLowerCase();return["linear","sqrt","log"].includes(n)?n:"linear"},cn(["linear","sqrt","log"]).default("linear")),edgeWidthMultiplier:Ee(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?1:Math.max(.1,Math.min(10,n))},lt().min(.1).max(10).default(1)),egoNodeId:Ee(e=>e==null||e===""||e==="null"?null:typeof e=="string"?e:void 0,mn().nullable().optional()),egoNeighborSteps:Ee(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseInt(e,10):Number(e);return Number.isNaN(n)||n<1?1:Math.max(1,Math.round(n))},lt().min(1).default(1)),egoStepColoring:Wt(!1),edgeType:Ee(e=>e==="null"||e===""?null:typeof e=="string"?e:void 0,mn().nullable().optional()),showAllNodes:Wt(!1),temporalOverlay:Wt(!1),temporalOverlayEdgeStyle:Ee(e=>{if(typeof e=="string"){const n=e.toLowerCase();if(["segmented","filled","outline"].includes(n))return n}return"filled"},cn(["segmented","filled","outline"]).default("filled")),temporalOverlayNodeStyle:Ee(e=>{if(typeof e=="string"){const n=e.toLowerCase();if(["filled","outline"].includes(n))return n}return"filled"},cn(["filled","outline"]).default("filled")),temporalOverlayYearsPast:Ee(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseInt(e,10):Number(e);return Number.isNaN(n)||n<0?0:Math.max(0,Math.round(n))},lt().min(0).default(1)),temporalOverlayYearsFuture:Ee(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseInt(e,10):Number(e);return Number.isNaN(n)||n<0?0:Math.max(0,Math.round(n))},lt().min(0).default(1)),temporalOverlayColorPast:ls("#fc8d59"),temporalOverlayColorMid:ls("#ffffbf"),temporalOverlayColorFuture:ls("#91bfdb"),temporalOverlayCurrentBlack:Wt(!0),nodeOrderMode:cl("alphabetical"),arcOpacity:Ee(e=>{if(e==null||e==="")return .85;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?.85:Math.max(0,Math.min(1,n))},lt().min(0).max(1).default(.85)),edgeWidthMode:ln(["fixed","weight"],"weight"),edgeColorAdvanced:Wt(!1),edgeColorHue:ln(["direction","region","division","attribute","single"],"direction"),edgeColorHueAttribute:Un(),edgeColorIntensity:ln(["constant","weight","attribute"],"weight"),edgeColorIntensityAttribute:Un(),edgeColorIntensityConst:Ee(e=>{if(e==null||e==="")return .6;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?.6:Math.max(0,Math.min(1,n))},lt().min(0).max(1).default(.6)),edgeColorInterGrayscale:Wt(!0),intraFilter:ln(["none","region","division","interRegion","interDivision"],"none"),baseEdgeWidth:Ee(e=>{if(e==null||e==="")return 2;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?2:Math.max(.5,Math.min(12,n))},lt().min(.5).max(12).default(2)),nodeColorMode:ln(["single","attribute","visible_outgoing","visible_incoming","year_outgoing","year_incoming","net_year","outgoing","incoming","self_year"],"single"),nodeColorAttribute:Un(),nodeSizeMode:ln(["fixed","attribute","visible_outgoing","visible_incoming","year_outgoing","year_incoming","net_visible","net_year","outgoing","incoming","self_year"],"fixed"),nodeSizeAttribute:Un(),nodeSizeWeightScale:Ee(e=>{if(typeof e!="string")return"linear";const n=e.toLowerCase();return["linear","sqrt","log"].includes(n)?n:"linear"},cn(["linear","sqrt","log"]).default("linear")),nodeSizeMultiplier:Ee(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?1:Math.max(.1,Math.min(10,n))},lt().min(.1).max(10).default(1)),interactionMode:ln(["pan","lens"],"pan"),lensRadius:Ee(e=>{if(e==null||e==="")return 80;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?80:Math.max(20,Math.min(300,n))},lt().min(20).max(300).default(80)),edgeSegmentLength:Bt(8),edgeSegmentGap:Bt(4),edgeSegmentAnimate:Wt(!1),edgeSegmentOffset:Bt(15),edgeSegmentSpeed:Bt(1),edgeSegmentScaleByWeight:Wt(!1),edgeSegmentCap:Ee(e=>{if(typeof e=="string"){const n=e.toLowerCase();if(["round","butt"].includes(n))return n}return"round"},cn(["round","butt"]).default("round")),edgeOutlineGap:Ee(e=>{if(e==null||e==="")return 3;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?3:Math.max(.5,n)},lt().min(.5).default(3)),labelScale:Ee(e=>{if(e==null||e==="")return 1;const n=typeof e=="string"?parseFloat(e):Number(e);return Number.isNaN(n)?1:Math.max(.5,Math.min(3,n))},lt().min(.5).max(3).default(1)),nodeFilterAttribute:Un(),nodeFilterValues:dl()});function vl(){const e=Go({from:"/explorer"}),n=Bo(),{leftSidebarCollapsed:t,leftSidebarWidth:s,setSidebarContent:o}=Wo(),[a,u]=p.useState(e.dataset),[i,d]=p.useState(void 0),[m,g]=p.useState(e.year),[y,x]=p.useState(!1),[f,w]=p.useState(null),[C,S]=p.useState(0),[v,_]=p.useState(e.minThreshold??0),[b,$]=p.useState(e.maxThreshold??2e5),[R,I]=p.useState(e.maxEdges??500),[X,K]=p.useState(e.edgeType??null),[A,oe]=p.useState(e.view),[Q,me]=p.useState(e.showAllNodes??!1),[z,re]=p.useState(Math.max(.5,Math.min(3,e.labelScale??1))),[J,be]=p.useState(e.egoNodeId??null),[_e,fe]=p.useState(e.egoNeighborSteps??1),[ge,F]=p.useState(e.egoStepColoring??!1),[B,Ce]=p.useState(e.edgeWeightScale??"linear"),[Te,ot]=p.useState(Math.max(.1,e.edgeWidthMultiplier??1)),[L,Le]=p.useState(e.temporalOverlay??!1),[G,Be]=p.useState(e.temporalOverlayEdgeStyle??"filled"),[ke,Qe]=p.useState(e.temporalOverlayNodeStyle??"filled"),[Pe,fn]=p.useState(e.edgeSegmentLength??8),[Je,Xn]=p.useState(e.edgeSegmentGap??4),[ct,Zn]=p.useState(e.edgeSegmentAnimate??!1),[E,D]=p.useState(e.edgeSegmentOffset??15),[se,Se]=p.useState(Math.max(.1,e.edgeSegmentSpeed??1)),[ce,ve]=p.useState(e.edgeSegmentScaleByWeight??!1),[pe,_t]=p.useState(e.edgeSegmentCap??"round"),[qe,Mt]=p.useState(Math.max(.5,e.edgeOutlineGap??3)),[Me,ze]=p.useState(e.temporalOverlayYearsPast??1),[At,Cs]=p.useState(e.temporalOverlayYearsFuture??1),[et,Qn]=p.useState(Mr(e.temporalOverlayColorPast,"#fc8d59")),[tt,Jn]=p.useState(Mr(e.temporalOverlayColorMid,"#ffffbf")),[nt,er]=p.useState(Mr(e.temporalOverlayColorFuture,"#91bfdb")),[Zt,Ns]=p.useState(e.temporalOverlayCurrentBlack??!0),[js,En]=p.useState(et),[Ms,In]=p.useState(tt),[Fs,An]=p.useState(nt),[Ke,$r]=p.useState(e.nodeFilterAttribute??null),[ht,Qt]=p.useState(e.nodeFilterValues??[]),Er=p.useRef(null),[pn,Eo]=p.useState(!1),[tr,Io]=p.useState(384),[hn,Rs]=p.useState({width:typeof window<"u"?window.innerWidth:1200,height:typeof window<"u"?window.innerHeight:800});p.useEffect(()=>(o(r.jsx(Ut,{fallback:r.jsxs("div",{className:"p-4",children:[r.jsx("h2",{className:"text-lg font-bold text-red-800 mb-2",children:"Dataset Sidebar Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The dataset sidebar encountered an error."})]}),children:r.jsx(Zi,{selectedId:a,onSelect:l=>{u(l),V({dataset:l})},onRefresh:()=>S(l=>l+1)})})),()=>{o(null)}),[a,C]),p.useEffect(()=>{if(typeof window>"u")return;const l=()=>{Rs({width:window.innerWidth,height:window.innerHeight})};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),p.useEffect(()=>{typeof window<"u"&&setTimeout(()=>{Rs({width:window.innerWidth,height:window.innerHeight})},100)},[t,pn,s,tr]);const[nr,$s]=p.useState(e.nodeOrderMode??"alphabetical"),[Ir,Es]=p.useState(e.arcOpacity??.85),[xn,Ar]=p.useState(e.edgeWidthMode??"weight"),[yn,Is]=p.useState(e.edgeColorAdvanced??!1),[Ve,Jt]=p.useState(e.edgeColorHue??"direction"),[en,rr]=p.useState(e.edgeColorHueAttribute??null),[Ft,kr]=p.useState(e.edgeColorIntensity??"weight"),[vn,sr]=p.useState(e.edgeColorIntensityAttribute??null),[or,Pr]=p.useState(e.edgeColorIntensityConst??.6),[ar,As]=p.useState(e.edgeColorInterGrayscale??!0),[dt,ks]=p.useState(e.intraFilter??"none"),[tn,Ps]=p.useState(e.baseEdgeWidth??2),[ir,Vs]=p.useState(e.nodeColorMode??"single"),[nn,Vr]=p.useState(e.nodeColorAttribute??null),[xt,Os]=p.useState(e.nodeSizeMode??"fixed"),[gt,Or]=p.useState(e.nodeSizeAttribute??null),[lr,Ds]=p.useState(e.nodeSizeWeightScale??"linear"),[bn,Ts]=p.useState(Math.max(.1,e.nodeSizeMultiplier??1)),[Dr,Tr]=p.useState(e.interactionMode??"pan"),[Ao,ko]=p.useState(e.lensRadius??80),[ml,Po]=p.useState({x:0,y:0}),V=p.useMemo(()=>l=>{n({to:"/explorer",search:c=>({view:c.view??"kriskogram",...c,...l}),replace:!0})},[n]),ur=p.useMemo(()=>{var l,c;return((c=(l=i==null?void 0:i.metadata)==null?void 0:l.hasCategoricalProperties)==null?void 0:c.nodes)??[]},[i]);p.useEffect(()=>{i&&Ke&&(ur.includes(Ke)||($r(null),Qt([]),V({nodeFilterAttribute:null,nodeFilterValues:[]})))},[i,ur,Ke,V]);const Vo=p.useMemo(()=>i&&i.timeRange.start!==i.timeRange.end,[i]);p.useMemo(()=>{var j,ae;if(!i)return 0;const l=(j=i.timeRange)==null?void 0:j.start,c=(ae=i.timeRange)==null?void 0:ae.end;return typeof l!="number"||typeof c!="number"?0:Math.max(0,c-l)},[i]);const Rt=p.useRef(!0);p.useEffect(()=>{ri().catch(()=>{}),gl().then(l=>{const c=e.dataset||l;c&&(u(c),!e.dataset&&Rt.current&&V({dataset:c})),Rt.current=!1}).catch(l=>w(l instanceof Error?l.message:"Failed to preload datasets"))},[]),p.useEffect(()=>{if(!a){d(void 0);return}x(!0),w(null),Kt(a).then(l=>{if(d(l),l){const{start:c,end:j}=l.timeRange??{};g(ae=>{const Y=te=>typeof te=="number"&&typeof c=="number"&&typeof j=="number"&&te>=c&&te<=j;return Y(ae)?ae:Y(e.year)?e.year:typeof c=="number"?c:ae??c??void 0})}}).catch(l=>w(l instanceof Error?l.message:"Failed to load dataset")).finally(()=>x(!1))},[a,C,e.year]);const we=p.useMemo(()=>{if(!(!i||m===void 0))return i.snapshots.find(l=>(typeof l.timestamp=="string"?parseInt(l.timestamp,10):l.timestamp)===m)},[i,m]),kn=p.useMemo(()=>{if(!we||!Ke)return[];const l=new Set;return we.nodes.forEach(c=>{const j=c==null?void 0:c[Ke];j!=null&&j!==""&&l.add(String(j))}),Array.from(l).sort((c,j)=>c.localeCompare(j))},[we,Ke]);p.useEffect(()=>{if(!Ke||!we||ht.length===0)return;const l=ht.filter(c=>kn.includes(c));l.length!==ht.length&&(Qt(l),V({nodeFilterValues:l}))},[Ke,ht,kn,we,V]),p.useMemo(()=>{if(!i)return new Map;const l=new Map;return i.snapshots.forEach(c=>{const j=typeof c.timestamp=="string"?parseInt(c.timestamp,10):c.timestamp;Number.isFinite(j)&&l.set(j,c)}),l},[i]);const Ie=p.useMemo(()=>{if(!i)return null;let l=1/0,c=-1/0,j=0,ae=0;const Y=[];if(i.snapshots.forEach(he=>{const Ne=Array.isArray(he==null?void 0:he.edges)?he.edges:[];let Oe=0;Ne.forEach(He=>{if(He!=null&&He.source&&He.source===He.target)return;const xe=Number(He==null?void 0:He.value);Number.isFinite(xe)&&(Oe+=1,xe<l&&(l=xe),xe>c&&(c=xe),ae+=1,Y.push(xe))}),Oe>j&&(j=Oe)}),l===1/0||c===-1/0)return{min:0,max:0,maxEdgesCount:j,mean:0,median:0};const{mean:te,median:Z}=Rn(Y);return{min:l,max:c,maxEdgesCount:j,mean:ae>0?te:0,median:ae>0?Z:0}},[i]),Ye=p.useMemo(()=>{if(!i)return null;let l=1/0,c=-1/0,j=0;const ae=[];if(i.snapshots.forEach(Z=>{const he=new Map,Ne=new Map;(Array.isArray(Z==null?void 0:Z.edges)?Z.edges:[]).forEach(xe=>{const Ge=Ne.get(xe.source)||0;Ne.set(xe.source,Ge+xe.value);const We=he.get(xe.target)||0;he.set(xe.target,We+xe.value)}),(Array.isArray(Z==null?void 0:Z.nodes)?Z.nodes:[]).forEach(xe=>{const Ge=(he.get(xe.id)||0)-(Ne.get(xe.id)||0);Ge<l&&(l=Ge),Ge>c&&(c=Ge);const We=Math.abs(Ge);We>j&&(j=We),ae.push(We)})}),l===1/0||c===-1/0)return{min:0,max:0,maxAbs:0,meanAbs:0,medianAbs:0};const{mean:Y,median:te}=Rn(ae);return{min:l,max:c,maxAbs:j,meanAbs:Y,medianAbs:te}},[i]),Ae=p.useMemo(()=>{if(!i)return null;let l=0,c=0;const j=[],ae=[];i.snapshots.forEach(Z=>{const he=new Map,Ne=new Map;(Array.isArray(Z==null?void 0:Z.edges)?Z.edges:[]).forEach(xe=>{const Ge=Ne.get(xe.source)||0;Ne.set(xe.source,Ge+xe.value);const We=he.get(xe.target)||0;he.set(xe.target,We+xe.value)}),(Array.isArray(Z==null?void 0:Z.nodes)?Z.nodes:[]).forEach(xe=>{const Ge=he.get(xe.id)||0,We=Ne.get(xe.id)||0;Ge>l&&(l=Ge),We>c&&(c=We),j.push(Ge),ae.push(We)})});const Y=Rn(j),te=Rn(ae);return{maxIncoming:l,maxOutgoing:c,meanIncoming:j.length>0?Y.mean:0,meanOutgoing:ae.length>0?te.mean:0,medianIncoming:j.length>0?Y.median:0,medianOutgoing:ae.length>0?te.median:0}},[i]),at=p.useMemo(()=>{if(!i)return null;let l=0;const c=[];i.snapshots.forEach(ae=>{const Y=Array.isArray(ae==null?void 0:ae.edges)?ae.edges:[],te=new Map;Y.forEach(Z=>{if(Z!=null&&Z.source&&Z.source===Z.target){const he=Number(Z.value);if(!Number.isFinite(he)||he<=0)return;const Ne=te.get(Z.source)||0;te.set(Z.source,Ne+he)}}),te.forEach(Z=>{Z>l&&(l=Z),c.push(Z)})});const j=Rn(c);return{max:l,mean:c.length>0?j.mean:0,median:c.length>0?j.median:0}},[i]),Ls=p.useMemo(()=>{var ae;if(!(i!=null&&i.metadata))return new Map;const l=((ae=i.metadata.hasNumericProperties)==null?void 0:ae.nodes)??[];if(!l.length)return new Map;const c=new Map;l.forEach(Y=>c.set(Y,[])),i.snapshots.forEach(Y=>{(Array.isArray(Y==null?void 0:Y.nodes)?Y.nodes:[]).forEach(Z=>{l.forEach(he=>{var Oe;const Ne=Z==null?void 0:Z[he];typeof Ne=="number"&&Number.isFinite(Ne)&&((Oe=c.get(he))==null||Oe.push(Ne))})})});const j=new Map;return c.forEach((Y,te)=>{if(!Y.length)return;const Z=Math.min(...Y),he=Math.max(...Y),{mean:Ne,median:Oe}=Rn(Y);j.set(te,{min:Z,max:he,mean:Ne,median:Oe})}),j},[i]);p.useEffect(()=>{if(!Ie)return;const{min:l,max:c,maxEdgesCount:j}=Ie;if(!Number.isFinite(l)||!Number.isFinite(c))return;const ae=(Ne,Oe,He)=>He<Oe||!Number.isFinite(Ne)||Ne<Oe?Oe:Ne>He?He:Ne,Y=ae(v,l,c);let te=ae(b,l,c);te<Y&&(te=Y);const Z=Math.max(1,j),he=Math.max(1,Math.min(R,Z));Y!==v&&_(Y),te!==b&&$(te),he!==R&&I(he)},[Ie,v,b,R]);const Ct=p.useMemo(()=>{if(!we||!(i!=null&&i.metadata))return null;const c=["migration_type","type","category","edge_type"].find(ae=>{var Y,te;return((Y=i.metadata)==null?void 0:Y.edgeProperties.includes(ae))||((te=i.metadata)==null?void 0:te.hasCategoricalProperties.edges.includes(ae))});if(!c)return null;const j=el(we.edges,c);return{property:c,values:j.map(ae=>String(ae))}},[we,i]);p.useEffect(()=>{K(null)},[a]),p.useEffect(()=>{we&&J&&(we.nodes.some(c=>c.id===J)||(be(null),ge&&F(!1),V({egoNodeId:null,egoStepColoring:!1})))},[we,J,ge,V]);const ee=p.useMemo(()=>{if(!i||!we)return{nodes:[],edges:[],baseEdges:[],overlayEdges:[],egoStepMax:0,overlayMeta:{hasPast:!1,hasFuture:!1,maxDelta:0}};const l=typeof m=="number"?m:null,c=!!(Ke&&ht.length>0),j=new Set(ht.map(N=>String(N))),ae=we.nodes,Y=c?ae.filter(N=>{const O=N==null?void 0:N[Ke];if(O==null)return!1;const T=String(O);return j.has(T)}):ae,te=new Set(Y.map(N=>N.id));if(te.size===0)return{nodes:[],baseEdges:[],edges:[],currentEdgeCount:0,egoStepMax:0,temporalOverlay:null};const Z=Math.max(0,Math.round(Me)),he=Math.max(0,Math.round(At)),Ne=N=>{const O=new Set,T=new Map,ne=new Map;let ye=0;if(!(A==="kriskogram"&&J))return N.forEach((de,St)=>O.add(St)),{allowedEdges:O,edgeSteps:T,nodeSteps:ne,maxStep:ye};const Fe=Math.max(1,Math.round(_e));let $e=new Set([J]);ne.set(J,0);const bt=new Set($e);for(let de=1;de<=Fe&&$e.size>0;de+=1){const St=new Set;N.forEach((h,M)=>{const k=h==null?void 0:h.source,q=h==null?void 0:h.target;if(!(!k||!q)&&($e.has(k)||$e.has(q))){O.add(M);const H=T.get(M);(H===void 0||de<H)&&T.set(M,de);const P=W=>{const ue=ne.get(W);(ue===void 0||de<ue)&&ne.set(W,de),bt.has(W)||(bt.add(W),St.add(W))};P(k),P(q)}}),$e=St}return ne.forEach(de=>{de>ye&&(ye=de)}),ne.has(J)||ne.set(J,0),{allowedEdges:O,edgeSteps:T,nodeSteps:ne,maxStep:ye}},Oe=N=>{const O=typeof N=="string"?N.trim().toLowerCase():"";return/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(O)?O.length===4?`#${O[1]}${O[1]}${O[2]}${O[2]}${O[3]}${O[3]}`:O:"#000000"},He=Oe(et),xe=Oe(tt),Ge=Oe(nt),We=Zt?"#000000":xe,Vn=N=>{const O=Oe(N).slice(1),T=parseInt(O,16);return Number.isNaN(T)||O.length!==6?{r:0,g:0,b:0}:{r:T>>16&255,g:T>>8&255,b:T&255}},_n=N=>Math.max(0,Math.min(255,Math.round(N))).toString(16).padStart(2,"0"),gr=(N,O,T)=>`#${_n(N)}${_n(O)}${_n(T)}`,Cn=(N,O,T)=>{const ne=Math.max(0,Math.min(1,T)),ye=Vn(N),Fe=Vn(O),$e=ye.r+(Fe.r-ye.r)*ne,bt=ye.g+(Fe.g-ye.g)*ne,de=ye.b+(Fe.b-ye.b)*ne;return gr($e,bt,de)},rn=N=>{if(N===0)return We;if(N<0){if(Z===0)return xe;const ne=1-Math.max(0,Math.min(1,Math.abs(N)/Math.max(Z,1)));return Cn(He,xe,ne)}if(he===0)return xe;const O=Math.max(0,Math.min(1,N/Math.max(he,1)));return Cn(xe,Ge,O)},On=new Map,Dn=new Map,Nn=new Map;we.edges.forEach(N=>{if(!te.has(N.source)||!te.has(N.target))return;const O=Dn.get(N.source)||0;Dn.set(N.source,O+N.value);const T=On.get(N.target)||0;if(On.set(N.target,T+N.value),N.source===N.target){const ne=Nn.get(N.source)||0;Nn.set(N.source,ne+N.value)}});const mr=(N,O)=>{if(dt==="none")return N;const T=new Map(O.map(ne=>[ne.id,ne]));return N.filter(ne=>{const ye=T.get(ne.source),Fe=T.get(ne.target);return!ye||!Fe?!1:dt==="region"?ye.region&&Fe.region&&ye.region===Fe.region:dt==="division"?ye.division&&Fe.division&&ye.division===Fe.division:dt==="interRegion"?ye.region&&Fe.region&&ye.region!==Fe.region:dt==="interDivision"?ye.division&&Fe.division&&ye.division!==Fe.division:!0})};let it=uo(we.edges,(Ct==null?void 0:Ct.property)||"",X);it=it.filter(N=>te.has(N.source)&&te.has(N.target)),it=mr(it,Y),it=it.filter(N=>(N==null?void 0:N.source)!==(N==null?void 0:N.target));const Vt=it.filter(N=>N.value>=v&&N.value<=b).sort((N,O)=>O.value-N.value).slice(0,R),Tn=Vt.map((N,O)=>({edge:N,idx:O})),{allowedEdges:fr,edgeSteps:sn,maxStep:jn}=Ne(Vt);let Nt=Tn;fr.size!==Tn.length&&(Nt=Tn.filter(({idx:N})=>fr.has(N)));let je=jn;const pr=G,hr=G==="segmented"?`${Math.max(1,Pe)} ${Math.max(.5,Je)}`:null,xr=G==="segmented"?Math.max(0,E):0,yr=G==="segmented"?pe:"round",Ot=Nt.map(({edge:N,idx:O})=>{const T=sn.get(O),ne={...N,__isOverlay:!1,__displayYear:l,__temporalDelta:0,_overlayType:void 0,_overlayYear:l,__overlayStyle:pr,__overlayDash:hr,__overlayDashOffset:xr,__overlayLineCap:yr,__segmentInitialGap:G==="segmented"?Math.max(0,E):0,__segmentSpeed:Math.max(.1,se),__segmentScaleByWeight:G==="segmented"&&ce,__segmentCycle:G==="segmented"?Math.max(1,Pe+Je):0,__segmentAnimate:G==="segmented"&&ct,__outlineGap:qe};return T!==void 0&&(ne._egoStep=T),ne}),ft=new Set;Ot.forEach(N=>{ft.add(N.source),ft.add(N.target)}),J&&ft.add(J);const Ln=new Map,zn=new Map;Ot.forEach(N=>{const O=zn.get(N.source)||0;zn.set(N.source,O+N.value);const T=Ln.get(N.target)||0;Ln.set(N.target,T+N.value)});const rt=[],Dt=new Map,Tt=new Map;let $t=0,vr=!1,Hn=!1;const Mn=new Map,Et=(N,O)=>{if(typeof O!="number"||!Number.isFinite(O))return null;let T=Mn.get(N);T||(T=new Map,Mn.set(N,T));let ne=T.get(O);return ne||(ne={year:O,totalIncoming:0,totalOutgoing:0,visibleIncoming:0,visibleOutgoing:0},T.set(O,ne)),ne},Lt=new Map;if(i&&i.snapshots.forEach(N=>{const O=typeof N.timestamp=="string"?parseInt(N.timestamp,10):N.timestamp;Number.isFinite(O)&&Lt.set(O,N)}),L&&i&&typeof m=="number"&&i.timeRange.start!==i.timeRange.end){const N=O=>{if(O===0||O<0&&Z===0||O>0&&he===0)return;const T=m+O,ne=Lt.get(T);if(!ne)return;const ye=Array.isArray(ne.edges)?ne.edges:[];let Fe=null;if(c&&(Fe=new Set(ne.nodes.filter(P=>{const W=P==null?void 0:P[Ke];return W==null?!1:j.has(String(W))}).map(P=>P.id)),Fe.size===0))return;let $e=uo(ye,(Ct==null?void 0:Ct.property)||"",X);if(dt!=="none"){const P=new Map(ne.nodes.map(W=>[W.id,W]));dt==="region"?$e=$e.filter(W=>{const ue=P.get(W.source),U=P.get(W.target);return ue&&U&&ue.region&&U.region&&ue.region===U.region}):dt==="division"?$e=$e.filter(W=>{const ue=P.get(W.source),U=P.get(W.target);return ue&&U&&ue.division&&U.division&&ue.division===U.division}):dt==="interRegion"?$e=$e.filter(W=>{const ue=P.get(W.source),U=P.get(W.target);return ue&&U&&ue.region&&U.region&&ue.region!==U.region}):dt==="interDivision"&&($e=$e.filter(W=>{const ue=P.get(W.source),U=P.get(W.target);return ue&&U&&ue.division&&U.division&&ue.division!==U.division}))}Fe&&($e=$e.filter(P=>Fe.has(P.source)&&Fe.has(P.target)));const bt=G==="segmented"?`${Math.max(1,Pe)} ${Math.max(.5,Je)}`:null,de=G==="segmented"?Math.max(0,E):0,St=G==="segmented"?pe:"round",h=$e.filter(P=>P.value>=v&&P.value<=b).sort((P,W)=>W.value-P.value).slice(0,R);$e.forEach(P=>{const W=P==null?void 0:P.source,ue=P==null?void 0:P.target,U=Number((P==null?void 0:P.value)??0);if(!W||!ue||!Number.isFinite(U))return;const Re=Et(W,T),Ue=Et(ue,T);Re&&(Re.totalOutgoing+=U),Ue&&(Ue.totalIncoming+=U)});const{allowedEdges:M,edgeSteps:k,maxStep:q}=Ne(h);q>je&&(je=q),h.map((P,W)=>({...P,_overlayType:O<0?"past":"future",_overlayYear:T,__isOverlay:!0,__displayYear:T,__temporalDelta:O,__overlayStyle:G,__overlayDash:bt,__overlayDashOffset:de,__overlayLineCap:St,__segmentInitialGap:G==="segmented"?Math.max(0,E):0,__segmentCycle:G==="segmented"?Math.max(1,Pe+Je):0,__segmentAnimate:G==="segmented"&&ct,__segmentSpeed:Math.max(.1,se),__segmentScaleByWeight:G==="segmented"&&ce,__outlineGap:qe,_egoStep:(()=>{const ue=k.get(W);if(ue!==void 0)return Math.max(1,ue)})()})).filter((P,W)=>M.has(W)).forEach(P=>{rt.push(P);const W=Et(P.source,T),ue=Et(P.target,T),U=Number((P==null?void 0:P.value)??0);if(W&&Number.isFinite(U)&&(W.visibleOutgoing+=U),ue&&Number.isFinite(U)&&(ue.visibleIncoming+=U),P._overlayType==="past"){vr=!0;const Re=Dt.get(P.source)||0;Dt.set(P.source,Re+P.value);const Ue=Dt.get(P.target)||0;Dt.set(P.target,Ue+P.value)}else{Hn=!0;const Re=Tt.get(P.source)||0;Tt.set(P.source,Re+P.value);const Ue=Tt.get(P.target)||0;Tt.set(P.target,Ue+P.value)}})};for(let O=-Z;O<0;O+=1)N(O);for(let O=1;O<=he;O+=1)N(O)}rt.length>0&&rt.forEach(N=>{ft.add(N.source),ft.add(N.target)});const Bn=(A==="kriskogram"&&Q?Y:Y.filter(N=>ft.has(N.id))).map(N=>{const O=Ln.get(N.id)||0,T=zn.get(N.id)||0,ne=On.get(N.id)||0,ye=Dn.get(N.id)||0,Fe=O-T,$e=ne-ye,bt=Nn.get(N.id)||0,de=Dt.get(N.id)||0,St=Tt.get(N.id)||0,h=St-de;Math.abs(h)>$t&&($t=Math.abs(h));const M=l!==null?Et(N.id,l):null;M&&(M.totalIncoming=ne,M.totalOutgoing=ye,M.visibleIncoming=O,M.visibleOutgoing=T);const k=Mn.get(N.id),q=k?Array.from(k.values()).map(H=>({year:H.year,total_incoming:H.totalIncoming,total_outgoing:H.totalOutgoing,visible_incoming:H.visibleIncoming,visible_outgoing:H.visibleOutgoing,net_total:H.totalIncoming-H.totalOutgoing,net_visible:H.visibleIncoming-H.visibleOutgoing,is_current:l!==null?H.year===l:!1})).sort((H,P)=>H.year-P.year):[];return{...N,_totalIncoming:O,_totalOutgoing:T,total_incoming_visible:O,total_outgoing_visible:T,total_incoming_year:ne,total_outgoing_year:ye,net_flow_visible:Fe,net_flow_year:$e,self_flow_year:bt,temporal_overlay_past_total:de,temporal_overlay_future_total:St,temporal_overlay_delta:h,_overlayPastTotal:de,_overlayFutureTotal:St,_overlayDelta:h,temporal_details:q}});L?Bn.forEach(N=>{const O=N._overlayDelta??N.temporal_overlay_delta??0,T=$t>0?Math.max(0,Math.min(1,Math.abs(O)/$t)):0;N._overlayStrokeWidth=O===0?2:1.5+T*3,N._overlayStrokeColor=rn(O)}):Bn.forEach(N=>{N._overlayStrokeWidth=2,N._overlayStrokeColor="#fff"});const vt=L?{hasPast:vr,hasFuture:Hn,nodeDeltaAbsMax:$t,style:G,edgeSegmentLength:Pe,edgeSegmentGap:Je,edgeSegmentOffset:E,edgeSegmentSpeed:se,edgeSegmentScaleByWeight:ce,edgeSegmentCap:pe,edgeSegmentAnimate:ct,edgeOutlineGap:qe,yearsPast:Z,yearsFuture:he,colorCurrent:We,colorPast:He,colorMid:xe,colorFuture:Ge,useBlackForCurrent:Zt,legendEntries:(()=>{const N=[],O=T=>{if(typeof m=="number"){const ye=m+T;if(T===0)return`${ye} (current)`;const Fe=Math.abs(T)===1?"year":"years";return T<0?`${ye} (${Math.abs(T)} ${Fe} past)`:`${ye} (${T} ${Fe} future)`}if(T===0)return"Current year";const ne=Math.abs(T)===1?"year":"years";return T<0?`${Math.abs(T)} ${ne} past`:`${T} ${ne} future`};N.push({label:O(0),color:We,delta:0});for(let T=-Z;T<0;T+=1)N.push({label:O(T),color:rn(T),delta:T});for(let T=1;T<=he;T+=1)N.push({label:O(T),color:rn(T),delta:T});return N})()}:null,Ur=L&&rt.length>0?[...Ot,...rt]:Ot;return{nodes:Bn,baseEdges:Ot,edges:Ur,currentEdgeCount:Ot.length,egoStepMax:je,temporalOverlay:vt}},[we,v,b,R,X,Ct,dt,Q,A,J,_e,B,L,G,ke,Me,At,et,tt,nt,Zt,Pe,Je,E,se,ce,pe,ct,qe,Ke,ht,i]),mt=p.useMemo(()=>{if(!we)return null;const l=we.edges.length,c=we.nodes.length,j=we.edges.reduce((te,Z)=>te+Z.value,0),ae=l>0?j/l:0,Y=l>0?Math.max(...we.edges.map(te=>te.value)):0;return{totalNodes:c,totalEdges:l,visibleNodes:ee.nodes.length,visibleEdges:ee.currentEdgeCount??ee.edges.filter(te=>!te._overlayType).length,avgValue:ae,maxValue:Y}},[we,ee]),yt=(Ie==null?void 0:Ie.min)??0,Pn=(Ie==null?void 0:Ie.max)??(mt==null?void 0:mt.maxValue)??yt,Sn=Math.max(yt,Pn),Oo=Math.max(Sn,1),zs=Math.max(1,Math.floor(Oo/1e3)),Lr=(Ie==null?void 0:Ie.maxEdgesCount)??(mt==null?void 0:mt.totalEdges)??0,zr=Math.max(500,Lr),Hr=p.useMemo(()=>{if(!ee||ee.currentEdgeCount===0)return;const l=ee.edges.filter(c=>!c._overlayType);if(l.length!==0)return Math.min(...l.map(c=>c.value))},[ee]),kt=p.useMemo(()=>ee.nodes.some(l=>l&&l.region),[ee]),Pt=p.useMemo(()=>ee.nodes.some(l=>l&&l.division),[ee]);p.useEffect(()=>{!kt&&Ve==="region"&&Jt("direction"),!Pt&&Ve==="division"&&Jt("direction")},[kt,Pt,Ve]);const Gr=p.useMemo(()=>{if(!ee||ee.currentEdgeCount===0)return;const l=ee.edges.filter(c=>!c._overlayType);if(l.length!==0)return Math.max(...l.map(c=>c.value))},[ee]);p.useEffect(()=>{A==="kriskogram"&&ee.nodes.length>0&&Er.current&&Er.current.updateData(ee.nodes,ee.edges)},[ee,A]);const Do=l=>{g(l),Rt.current||V({year:l})};p.useEffect(()=>{Rt.current||V({minThreshold:v,maxThreshold:b,maxEdges:R})},[v,b,R]),p.useEffect(()=>{Rt.current||V({view:A})},[A]),p.useEffect(()=>{Rt.current||V({edgeType:X})},[X]),p.useEffect(()=>{!Rt.current&&a&&V({dataset:a})},[a]),p.useEffect(()=>{Rt.current},[]),p.useEffect(()=>{we&&J&&(we.nodes.some(c=>c.id===J)||(be(null),ge&&F(!1),V({egoNodeId:null,egoStepColoring:!1})))},[we,J,ge,V]),p.useEffect(()=>{if(!i)return;const l=i.timeRange&&typeof i.timeRange.start=="number"&&typeof i.timeRange.end=="number"&&i.timeRange.start!==i.timeRange.end;(!l||!(typeof m=="number"&&l))&&L&&(Le(!1),V({temporalOverlay:!1,temporalOverlayEdgeStyle:G,temporalOverlayNodeStyle:ke,temporalOverlayCurrentBlack:Zt,temporalOverlayYearsPast:Me,temporalOverlayYearsFuture:At,temporalOverlayColorPast:et,temporalOverlayColorMid:tt,temporalOverlayColorFuture:nt,edgeSegmentLength:Pe,edgeSegmentGap:Je,edgeSegmentOffset:E,edgeSegmentCap:pe,edgeSegmentAnimate:ct,edgeOutlineGap:qe}))},[i,m,L,G,ke,Me,At,et,tt,nt,Pe,Je,E,pe,ct,qe,V]),p.useEffect(()=>{Rt.current||V({temporalOverlay:L,temporalOverlayYearsPast:Me,temporalOverlayYearsFuture:At,temporalOverlayColorPast:et,temporalOverlayColorMid:tt,temporalOverlayColorFuture:nt,temporalOverlayEdgeStyle:G,temporalOverlayNodeStyle:ke,edgeSegmentLength:Pe,edgeSegmentGap:Je,edgeSegmentOffset:E,edgeSegmentCap:pe,edgeSegmentAnimate:ct,edgeOutlineGap:qe})},[L,Me,At,et,tt,nt,G,ke,Pe,Je,E,pe,ct,qe,V]),p.useEffect(()=>{En(et)},[et]),p.useEffect(()=>{In(tt)},[tt]),p.useEffect(()=>{An(nt)},[nt]);const cr=(l,c,j,ae,Y)=>{const te=Mr(l,c);j(te),ae(te),V({[Y]:te})},wn=(l,c,j,ae,Y)=>{const te=l.trim();if(!/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(te)){ae(c);return}cr(te,c,j,ae,Y)},[dr,Hs]=p.useState("picker"),Br=p.useMemo(()=>{const l={nodeOrder:h=>h.label||h.id,nodeColor:()=>"#2563eb",nodeRadius:()=>6,edgeWidth:()=>tn,edgeColor:()=>"#1f77b4",nodeStroke:()=>({color:"#fff",width:2})};if(ee.nodes.length===0||ee.baseEdges.length===0)return{accessors:l,legendItems:[]};const c=ee.baseEdges.map(h=>h.value),j=c.length>0?Math.min(...c):0,ae=c.length>0?Math.max(...c):1,Y=(Ie==null?void 0:Ie.min)??j,te=(Ie==null?void 0:Ie.max)??ae,Z=Math.max(te-Y,0),he=h=>{if(!Number.isFinite(h)||Z<=0)return 0;const k=Math.min(Math.max(h,Y),te)-Y;switch(B){case"sqrt":{const q=Math.sqrt(Z);return q<=0?0:Math.max(0,Math.min(1,Math.sqrt(k)/q))}case"log":{const q=Math.log10(Z+1);return!Number.isFinite(q)||q<=0?0:Math.max(0,Math.min(1,Math.log10(k+1)/q))}case"linear":default:return Z<=0?0:Math.max(0,Math.min(1,k/Z))}},Ne=h=>{if(Z<=0)return Y;const M=Math.max(0,Math.min(1,h));switch(B){case"sqrt":return Y+Math.pow(M,2)*Z;case"log":{const k=Math.log10(Z+1);if(!Number.isFinite(k)||k<=0)return Y;const q=Math.pow(10,M*k)-1;return Y+q}case"linear":default:return Y+M*Z}},Oe=(Ie==null?void 0:Ie.mean)??(Y+te)/2,He=(Ie==null?void 0:Ie.median)??Ne(.5),xe=ee.nodes.map(h=>h.total_outgoing_visible||h._totalOutgoing||0),Ge=ee.nodes.map(h=>h.total_incoming_visible||h._totalIncoming||0),We=ee.nodes.map(h=>h.total_outgoing_year||0),Vn=ee.nodes.map(h=>h.total_incoming_year||0),_n=ee.nodes.map(h=>h.net_flow_visible||0),gr=ee.nodes.map(h=>h.net_flow_year||0),Cn=xe.length>0?Math.max(...xe):1,rn=Ge.length>0?Math.max(...Ge):1,On=We.length>0?Math.max(...We):1,Dn=Vn.length>0?Math.max(...Vn):1,Nn=_n.length>0?Math.max(..._n.map(h=>Math.abs(h))):1,mr=gr.length>0?Math.max(...gr.map(h=>Math.abs(h))):1,it=(Ae==null?void 0:Ae.maxOutgoing)??On,Vt=(Ae==null?void 0:Ae.maxIncoming)??Dn,Tn=(Ye==null?void 0:Ye.min)??-mr,fr=(Ye==null?void 0:Ye.max)??mr,sn=Math.max(Math.abs(Tn),Math.abs(fr))||1,jn=(at==null?void 0:at.max)??0,Nt=["#3b82f6","#f59e0b","#ef4444","#10b981","#8b5cf6","#ec4899","#14b8a6","#f97316"],je=ee.temporalOverlay,pr=!!je,hr=(je==null?void 0:je.nodeDeltaAbsMax)??0,xr=Math.max(0,(je==null?void 0:je.yearsPast)??0),yr=Math.max(0,(je==null?void 0:je.yearsFuture)??0),Ot=(je==null?void 0:je.colorPast)??et,ft=(je==null?void 0:je.colorMid)??tt,Ln=(je==null?void 0:je.colorFuture)??nt,zn=(je==null?void 0:je.colorCurrent)??(Zt?"#000000":ft),rt=h=>{const M=typeof h=="string"?h.trim().toLowerCase():"";return/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(M)?M.length===4?`#${M[1]}${M[1]}${M[2]}${M[2]}${M[3]}${M[3]}`:M:"#000000"},Dt=rt(zn),Tt=h=>{const M=rt(h).slice(1),k=parseInt(M,16);return Number.isNaN(k)||M.length!==6?{r:0,g:0,b:0}:{r:k>>16&255,g:k>>8&255,b:k&255}},$t=h=>Math.max(0,Math.min(255,Math.round(h))).toString(16).padStart(2,"0"),vr=(h,M,k)=>`#${$t(h)}${$t(M)}${$t(k)}`,Hn=(h,M,k)=>{const q=Math.max(0,Math.min(1,k)),H=Tt(h),P=Tt(M),W=H.r+(P.r-H.r)*q,ue=H.g+(P.g-H.g)*q,U=H.b+(P.b-H.b)*q;return vr(W,ue,U)},Mn=h=>{if(h===0)return Dt;if(h<0){if(xr===0)return rt(ft);const q=1-Math.max(0,Math.min(1,Math.abs(h)/Math.max(xr,1)));return Hn(rt(Ot),rt(ft),q)}if(yr===0)return rt(ft);const M=Math.max(0,Math.min(1,h/Math.max(yr,1)));return Hn(rt(ft),rt(Ln),M)},Et=!!(J&&ge&&(ee.egoStepMax??0)>0),Lt=ee.egoStepMax??0,Wr=h=>{if(Lt<=1)return"hsl(210, 80%, 55%)";const M=Math.max(1,Math.min(h,Lt)),k=Lt<=1?0:(M-1)/(Lt-1),q=210-k*150,H=60-k*20;return`hsl(${Math.round(q)}, 80%, ${Math.round(H)}%)`},Gn=(h,M)=>{const k=Array.from(new Set(ee.nodes.map(H=>H[h]).filter(H=>H!=null))),q=new Map;return k.forEach((H,P)=>{q.set(H,Nt[P%Nt.length])}),q.get(M)||Nt[0]},Bn=h=>{const M=Math.max(0,Math.min(1,h));switch(lr){case"sqrt":return Math.sqrt(M);case"log":{if(M<=0)return 0;const k=Math.log10(M*9+1),q=Math.log10(10);return q>0?Math.min(1,k/q):M}case"linear":default:return M}},vt=h=>{const k=3+Math.max(0,Math.min(1,Bn(h)))*9;return Math.max(1,k*bn)},Ur=h=>{switch(xt){case"fixed":return Math.max(1,6*bn);case"visible_outgoing":case"outgoing":return vt(Cn>0?(h.total_outgoing_visible||h._totalOutgoing||0)/Cn:0);case"visible_incoming":case"incoming":return vt(rn>0?(h.total_incoming_visible||h._totalIncoming||0)/rn:0);case"year_outgoing":return vt(it>0?(h.total_outgoing_year||0)/it:0);case"year_incoming":return vt(Vt>0?(h.total_incoming_year||0)/Vt:0);case"net_visible":{const M=Math.abs(h.net_flow_visible||0),k=Nn>0?Nn:1;return vt(M/k)}case"net_year":{const M=Math.abs(h.net_flow_year||0),k=sn>0?sn:1;return vt(M/k)}case"self_year":{const M=jn>0?(h.self_flow_year||0)/jn:0;return vt(M)}case"attribute":{if(!gt||typeof h[gt]!="number")return 6;const M=ee.nodes.map(W=>W[gt]).filter(W=>typeof W=="number");if(M.length===0)return 6;const k=Math.min(...M),H=Math.max(...M)-k||1,P=(h[gt]-k)/H;return vt(P)}default:return 6}},N=G,O=(h,M)=>{if(M==="outline")return Math.max(2.5,tn);if(xn==="weight"){const k=he(h),q=M==="segmented"?.5+k*12:.5+k*15;return Math.max(.25,q*Te)}return M==="segmented"?Math.max(tn,2):tn},T={nodeOrder:h=>{if(nr==="alphabetical")return h.label||h.id;const M=h[nr];return M==null?`ZZZ_${h.label||h.id}`:typeof M=="number"?`${String(1e6-M).padStart(10,"0")}_${h.label||h.id}`:`${String(M)}_${h.label||h.id}`},nodeColor:h=>{var P;const M=(W,ue)=>!Number.isFinite(W)||ue<=0?0:Math.max(0,Math.min(1,W/ue)),k=(W,ue,U)=>{const Ue=85-Math.max(0,Math.min(1,U))*45;return`hsl(${W}, ${ue}%, ${Ue}%)`},q=W=>{if(!Number.isFinite(W)||sn<=0)return"#6b7280";if(Math.abs(W)<1e-6)return"#9ca3af";const U=85-Math.max(0,Math.min(1,Math.abs(W)/sn))*45;return W>=0?`hsl(0, 75%, ${U}%)`:`hsl(210, 75%, ${U}%)`};let H="#2563eb";switch(ir){case"single":H="#2563eb";break;case"outgoing":case"visible_outgoing":H=k(24,85,M(h.total_outgoing_visible||h._totalOutgoing||0,Cn));break;case"incoming":case"visible_incoming":H=k(160,70,M(h.total_incoming_visible||h._totalIncoming||0,rn));break;case"year_outgoing":H=k(24,85,M(h.total_outgoing_year||0,it));break;case"year_incoming":H=k(160,70,M(h.total_incoming_year||0,Vt));break;case"net_year":H=q(h.net_flow_year||0);break;case"self_year":{const W=jn>0?(h.self_flow_year||0)/jn:0;H=k(280,70,W);break}case"attribute":{if(!nn){H="#2563eb";break}const W=h[nn];if(W==null){H="#9ca3af";break}if((P=i==null?void 0:i.metadata)!=null&&P.hasNumericProperties.nodes.includes(nn)){const ue=ee.nodes.map(Ht=>Ht[nn]).filter(Ht=>typeof Ht=="number");if(ue.length===0){H="#2563eb";break}const U=Math.min(...ue),Ue=Math.max(...ue)-U||1,zt=(Number(W)-U)/Ue;H=`hsl(${120-Math.max(0,Math.min(1,zt))*120}, 70%, 50%)`;break}H=Gn(nn,W);break}default:H="#2563eb";break}return h.__baseFillColor=H,H},nodeRadius:Ur,edgeWidth:h=>{const M=h.__overlayStyle??N;return O(h.value,M)},edgeColor:(h,M)=>{var W,ue;const k=h==null?void 0:h.__temporalDelta;if(pr)return typeof k=="number"?Mn(k):Dt;if(Et){const U=(h==null?void 0:h._egoStep)??0;if(U>0)return Wr(U)}if(!yn){if(Ve==="direction")return M?"#1f77b4":"#d62728";if(Ve==="single"){if(Ft==="weight"){const Re=80-he(h.value)*55;return`hsl(210, 70%, ${Math.round(Re)}%)`}return"#2563eb"}}let q="#2563eb";if(Ve==="direction")q=M?"#1f77b4":"#d62728";else if(Ve==="region"){const U=ee.nodes.find(Re=>Re.id===h.source);q=U!=null&&U.region?Gn("region",U.region):"#2563eb"}else if(Ve==="division"){const U=ee.nodes.find(Re=>Re.id===h.source);q=U!=null&&U.division?Gn("division",U.division):"#2563eb"}else if(Ve==="attribute"&&en){const U=h[en];if(U!=null)if((W=i==null?void 0:i.metadata)!=null&&W.hasNumericProperties.edges.includes(en)){const Re=ee.baseEdges.map(qr=>qr[en]).filter(qr=>typeof qr=="number"),Ue=Math.min(...Re),br=Math.max(...Re)-Ue||1;q=`hsl(${120-(Number(U)-Ue)/br*120}, 70%, 50%)`}else q=Gn(en,U)}let H=.6;if(Ft==="weight")H=Math.max(0,Math.min(1,he(h.value)));else if(Ft==="attribute"&&vn){const U=h[vn];if(U!=null&&((ue=i==null?void 0:i.metadata)!=null&&ue.hasNumericProperties.edges.includes(vn))){const Re=ee.baseEdges.map(Ht=>Ht[vn]).filter(Ht=>typeof Ht=="number"),Ue=Math.min(...Re),br=Math.max(...Re)-Ue||1;H=Math.max(0,Math.min(1,(Number(U)-Ue)/br))}}else Ft==="constant"&&(H=Math.max(0,Math.min(1,or)));if(ar&&(Ve==="region"||Ve==="division")){const U=ee.nodes.find(zt=>zt.id===h.source),Re=ee.nodes.find(zt=>zt.id===h.target);if(!(Ve==="region"?(U==null?void 0:U.region)&&U.region===(Re==null?void 0:Re.region):(U==null?void 0:U.division)&&U.division===(Re==null?void 0:Re.division)))return`hsl(0, 0%, ${80-H*50}%)`}const P=80-H*55;return Ve==="direction"?`hsl(${M?0:200}, 70%, ${Math.round(P)}%)`:Ve==="single"?`hsl(210, 70%, ${Math.round(P)}%)`:q},nodeStroke:h=>{const M=h.temporal_overlay_delta??0,k=h.__baseFillColor??"#2563eb";if(!pr||hr<=0)return{color:ke==="outline"?k:"#fff",width:ke==="outline"?2.5:2};const q=Math.min(1,Math.abs(M)/Math.max(hr,1));if(ke==="outline"){const P=2.5+(M===0?0:q*1.5);return{color:k,width:P}}const H=2+(M===0?0:q*2);return{color:Mn(M),width:H}}},ne=[],ye=je&&Array.isArray(je.legendEntries)?je.legendEntries.slice().sort((h,M)=>(h.delta??0)-(M.delta??0)):[];if(ye.length>0&&ne.push({type:"temporalOverlay",title:"Edge color (temporal)",entries:ye}),!Et&&Ve==="direction"&&ne.push({type:"direction",title:"Edge color (direction)",labels:{above:"Above baseline (clockwise)",below:"Below baseline (counter)"},colors:{above:"#d62728",below:"#1f77b4"}}),Et){const h=Array.from({length:Lt},(M,k)=>{const q=k+1;return{step:q,color:Wr(q)}});ne.push({type:"egoSteps",entries:h})}else if(yn){if(Ve==="region"&&kt){const M=Array.from(new Set(ee.nodes.map(k=>k.region).filter(Boolean))).slice(0,10).map((k,q)=>({label:k,color:Nt[q%Nt.length]}));ne.push({type:"categorical",title:"Edge color (region)",entries:M,interNote:ar?"Inter edges: grayscale by intensity":void 0})}else if(Ve==="division"&&Pt){const M=Array.from(new Set(ee.nodes.map(k=>k.division).filter(Boolean))).slice(0,10).map((k,q)=>({label:k,color:Nt[q%Nt.length]}));ne.push({type:"categorical",title:"Edge color (division)",entries:M,interNote:ar?"Inter edges: grayscale by intensity":void 0})}}else if(Ve!=="direction"){if(Ve==="single"&&Ft==="weight"){const M=[0,.5,1].map(k=>{const q=Ne(k),P=80-he(q)*55;return{value:q,color:`hsl(210, 70%, ${Math.round(P)}%)`,width:O(q,N),fraction:k}});ne.push({type:"weight",color:"#1f77b4",scale:B,min:Y,max:te,samples:M})}}if(ee.baseEdges.length>0){const h=new Set;if(xn==="weight"){const M=[],k=(q,H,P)=>{if(!Number.isFinite(H))return;const W=O(H,N),ue=`${q}:${Math.round(H)}`;h.has(ue)||(h.add(ue),M.push({label:q,value:H,width:W,fraction:P}))};k("Minimum",Y,0),Number.isFinite(Oe)&&k("Mean",Oe),Number.isFinite(He)?k("Median",He):k("Median",Ne(.5),.5),k("Maximum",te,1),ne.push({type:"edgeWidth",mode:"weight",scale:B,multiplier:Te,min:Y,max:te,samples:M})}else{const M=O(te,N);ne.push({type:"edgeWidth",mode:"fixed",baseWidth:M,samples:[{label:"Fixed",value:te,width:M}]})}}const Fe=()=>xt==="fixed"?"Fixed Radius":xt==="attribute"?gt?`Attribute: ${gt}`:"Attribute Value":Kr(xt),$e=[],bt=new Set,de=(h,M,k)=>{if(!Number.isFinite(M)||!Number.isFinite(k)||k<=0)return;const q=Math.max(0,Math.min(1,M/k)),H=`${h}:${Math.round(M)}`;bt.has(H)||(bt.add(H),$e.push({label:h,radius:vt(q),value:M}))};return(()=>{switch(xt){case"fixed":{const h=Math.max(1,6*bn);$e.push({label:"Fixed radius",radius:h,value:h});return}case"visible_outgoing":case"outgoing":case"year_outgoing":{const h=(Ae==null?void 0:Ae.maxOutgoing)??it??0,M=(Ae==null?void 0:Ae.meanOutgoing)??h/2,k=(Ae==null?void 0:Ae.medianOutgoing)??h/2;de("Minimum",0,h||1),de("Mean",M,h||1),de("Median",k,h||1),de("Maximum",h,h||1);return}case"visible_incoming":case"incoming":case"year_incoming":{const h=(Ae==null?void 0:Ae.maxIncoming)??Vt??0,M=(Ae==null?void 0:Ae.meanIncoming)??h/2,k=(Ae==null?void 0:Ae.medianIncoming)??h/2;de("Minimum",0,h||1),de("Mean",M,h||1),de("Median",k,h||1),de("Maximum",h,h||1);return}case"net_visible":case"net_year":{const h=(Ye==null?void 0:Ye.maxAbs)??sn??0,M=(Ye==null?void 0:Ye.meanAbs)??h/2,k=(Ye==null?void 0:Ye.medianAbs)??h/2;de("Minimum",0,h||1),de("Mean",M,h||1),de("Median",k,h||1),de("Maximum",h,h||1);return}case"self_year":{const h=(at==null?void 0:at.max)??0,M=(at==null?void 0:at.mean)??h/2,k=(at==null?void 0:at.median)??h/2;de("Minimum",0,h||1),de("Mean",M,h||1),de("Median",k,h||1),de("Maximum",h,h||1);return}case"attribute":{if(!gt)return;const h=Ls.get(gt);if(!h)return;const{min:M,max:k,mean:q,median:H}=h,P=k||1;de("Minimum",M,P),de("Mean",q,P),de("Median",H,P),de("Maximum",k,P);return}default:{const h=Math.max(it,Vt,1);de("Minimum",0,h),de("Mean",h/2,h),de("Median",h/2,h),de("Maximum",h,h)}}})(),ne.push({type:"nodeSize",mode:Fe(),scale:xt==="fixed"?void 0:lr,multiplier:xt==="fixed"?void 0:bn,note:xt==="attribute"&&gt?`Using numeric attribute "${gt}"`:void 0,entries:$e}),{accessors:T,legendItems:ne}},[ee,tn,i,Ie,Ae,Ye,at,yn,Ve,en,ar,Ft,vn,or,xn,Te,B,J,ge,Pt,kt,nn,ir,nr,gt,xt,bn,lr,Ls,nt,tt,et,Zt,G,L,ke,Me,At]);return r.jsx(Ut,{fallback:r.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-lg mx-4",children:[r.jsx("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"Explorer Error"}),r.jsx("p",{className:"text-gray-700 mb-4",children:"The explorer page encountered an error. Please refresh the page."}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 cursor-pointer transition-colors",children:"Reload Page"})]})}),children:r.jsxs("div",{className:"flex flex-1 h-full overflow-hidden",children:[r.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden h-full relative",children:[y&&r.jsx("div",{className:"p-4 bg-yellow-50 text-yellow-800",children:"Loading…"}),f&&r.jsx("div",{className:"p-4 bg-red-50 text-red-600",children:f}),i?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex-1 flex flex-col overflow-hidden bg-white",children:r.jsx("div",{className:`flex-1 overflow-hidden ${A==="table"?"":"p-4"}`,children:ee.nodes.length>0&&ee.baseEdges.length>0?r.jsxs(r.Fragment,{children:[A==="kriskogram"&&r.jsx(Ut,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Kriskogram Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The Kriskogram visualization encountered an error."})]}),children:r.jsx("div",{className:"w-full h-full",children:r.jsx(Uo,{ref:Er,nodes:ee.nodes,edges:ee.edges,width:Math.max(800,hn.width-(t?64:s)-(pn?4:tr)-40),height:Math.max(600,hn.height-80),margin:{top:60,right:40,bottom:60,left:40},arcOpacity:Ir,title:i.name,accessors:Br.accessors,legend:Br.legendItems.length>0?Br.legendItems:void 0,labelScale:z})})}),A==="table"&&r.jsx(Ut,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Table View Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The table view encountered an error."})]}),children:r.jsx("div",{className:"h-full w-full flex flex-col min-h-0",children:r.jsx(Ro,{nodes:ee.nodes,edges:ee.baseEdges})})}),A==="sankey"&&r.jsx(Ut,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Sankey Diagram Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The Sankey diagram encountered an error."})]}),children:r.jsx("div",{className:"h-full min-h-0",children:r.jsx(Qi,{nodes:ee.nodes,edges:ee.baseEdges,width:Math.max(800,hn.width-(t?64:s)-(pn?4:tr)-40),height:Math.max(600,hn.height-80)})})}),A==="chord"&&r.jsx(Ut,{fallback:r.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Chord Diagram Error"}),r.jsx("p",{className:"text-sm text-red-700",children:"The chord diagram encountered an error."})]}),children:r.jsx(tl,{nodes:ee.nodes,edges:ee.baseEdges,width:Math.max(800,hn.width-(t?64:s)-(pn?4:tr)-40),height:Math.max(600,hn.height-80)})})]}):we?r.jsxs("div",{className:"text-center text-gray-500 py-8",children:["No data meets the current threshold range (",v.toLocaleString()," - ",b.toLocaleString(),"). Try adjusting the filters."]}):r.jsx("div",{className:"px-6 py-8 text-center text-gray-600 space-y-3",children:typeof m=="number"&&go[m]?r.jsxs(r.Fragment,{children:[r.jsxs("p",{className:"text-lg font-semibold text-gray-700",children:["No state-to-state migration snapshot for ",m]}),r.jsx("p",{className:"text-sm leading-relaxed",children:go[m]})]}):r.jsx("p",{children:"No snapshot to display."})})})}),A==="kriskogram"&&r.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center gap-2 bg-white/90 backdrop-blur px-3 py-2 rounded shadow border border-gray-200",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Mode:"}),r.jsx("button",{type:"button",onClick:()=>{Tr("pan"),V({interactionMode:"pan"})},className:["text-xs px-2 py-1 rounded border",Dr==="pan"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"].join(" "),children:"Pan"}),r.jsx("button",{type:"button",onClick:()=>{Tr("lens"),V({interactionMode:"lens"})},className:["text-xs px-2 py-1 rounded border",Dr==="lens"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"].join(" "),children:"Edge Lens"}),Dr==="lens"&&r.jsxs("span",{className:"text-[10px] text-gray-600",children:["Wheel: radius (",Ao,"px)"]})]})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-lg mb-2",children:"No dataset selected"}),r.jsx("p",{className:"text-sm",children:"Select a dataset from the sidebar to begin exploring"})]})})]}),i&&r.jsx(ol,{isCollapsed:pn,onToggle:()=>Eo(!pn),onResize:Io,title:"Visualization Settings",bottomContent:r.jsxs("div",{className:"p-3",children:[r.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-2",children:"Visualization Type"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsx("button",{onClick:()=>{oe("kriskogram"),V({view:"kriskogram"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${A==="kriskogram"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Kriskogram"}),r.jsx("button",{onClick:()=>{oe("table"),V({view:"table"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${A==="table"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Table"}),r.jsx("button",{onClick:()=>{oe("sankey"),V({view:"sankey"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${A==="sankey"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Sankey"}),r.jsx("button",{onClick:()=>{oe("chord"),V({view:"chord"})},className:`px-3 py-2.5 rounded text-sm font-medium transition-colors ${A==="chord"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Chord"})]})]}),children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs(an,{title:i.name,defaultOpen:!0,subtitle:`${i.type.toUpperCase()} · ${i.timeRange.start}${i.timeRange.end!==i.timeRange.start?`–${i.timeRange.end}`:""}`,children:[i.notes&&r.jsx("div",{className:"text-xs text-gray-600 mt-2 whitespace-pre-wrap",children:i.notes}),!i.notes&&r.jsx("div",{className:"text-xs text-gray-500 italic mt-2",children:"No description available"})]}),mt&&r.jsxs("div",{className:"p-3 bg-gray-50 rounded grid grid-cols-2 gap-3 text-sm",children:[r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-600",children:"Nodes"}),r.jsxs("div",{className:"text-lg font-bold",children:[mt.visibleNodes,"/",mt.totalNodes]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-xs text-gray-600",children:"Edges"}),r.jsxs("div",{className:"text-lg font-bold",children:[mt.visibleEdges.toLocaleString(),"/",mt.totalEdges.toLocaleString()]})]})]}),r.jsx(an,{title:"General Settings",defaultOpen:!0,onReset:()=>{const l=Math.max(1,Lr);K(null),ks("none"),$r(null),Qt([]),_(yt),$(Pn),I(l),V({edgeType:null,intraFilter:"none",nodeFilterAttribute:null,nodeFilterValues:[],minThreshold:yt,maxThreshold:Pn,maxEdges:l})},children:r.jsxs("div",{className:"space-y-4",children:[Vo&&m!==void 0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium",children:["Year: ",m]}),r.jsx("input",{type:"range",min:i.timeRange.start,max:i.timeRange.end,value:m,onChange:l=>Do(parseInt(l.target.value)),className:"w-full"})]}),Ct&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium",children:["Edge Type (",Ct.property,")"]}),r.jsxs("select",{value:X||"all",onChange:l=>{const c=l.target.value==="all"?null:l.target.value;K(c),V({edgeType:c})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"all",children:"All Types"}),Ct.values.map(l=>r.jsx("option",{value:l,children:l},l))]})]}),(kt||Pt)&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-medium",children:"Edge Scope"}),r.jsxs("select",{value:dt,onChange:l=>{const c=l.target.value;ks(c),V({intraFilter:c})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"none",children:"All"}),kt&&r.jsx("option",{value:"region",children:"Intra Region"}),Pt&&r.jsx("option",{value:"division",children:"Intra Division"}),kt&&r.jsx("option",{value:"interRegion",children:"Inter Region"}),Pt&&r.jsx("option",{value:"interDivision",children:"Inter Division"})]})]}),ur.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium",children:"Node Filter"}),r.jsxs("select",{value:Ke??"",onChange:l=>{const c=l.target.value||null;$r(c),Qt([]),V({nodeFilterAttribute:c,nodeFilterValues:[]})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"All nodes"}),ur.map(l=>r.jsx("option",{value:l,children:l},l))]}),Ke&&(kn.length>0?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[r.jsx("button",{type:"button",className:"rounded px-2 py-1 hover:bg-gray-100",onClick:()=>{const l=[...kn];Qt(l),V({nodeFilterValues:l})},children:"Select all"}),r.jsx("button",{type:"button",className:"rounded px-2 py-1 hover:bg-gray-100",onClick:()=>{Qt([]),V({nodeFilterValues:[]})},children:"Clear"})]}),r.jsx("div",{className:"max-h-48 overflow-y-auto rounded-md border border-gray-200 divide-y divide-gray-100",children:kn.map(l=>{const c=ht.includes(l);return r.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-sm cursor-pointer hover:bg-gray-50",children:[r.jsx("input",{type:"checkbox",className:"h-3.5 w-3.5",checked:c,onChange:j=>{const ae=j.target.checked?Array.from(new Set([...ht,l])).sort((Y,te)=>Y.localeCompare(te)):ht.filter(Y=>Y!==l);Qt(ae),V({nodeFilterValues:ae})}}),r.jsx("span",{children:l})]},l)})}),ht.length===0&&r.jsxs("p",{className:"text-xs text-gray-500",children:["No specific values selected. All nodes for ",Ke," remain visible."]})]}):r.jsxs("p",{className:"text-xs text-gray-500 italic",children:["No values available for ",Ke," in this snapshot."]}))]}),we&&mt&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[r.jsxs("span",{children:["Min: ",v.toLocaleString()]}),Hr!==void 0&&Hr>v&&r.jsxs("span",{className:"text-xs text-gray-400",children:["(actual ",Hr.toLocaleString(),")"]})]}),(()=>{const l=Math.max(1,Lr),c=v>yt||b<Pn||R<l;return r.jsx("button",{onClick:()=>{_(yt),$(Pn),I(l)},disabled:!c,type:"button",className:`text-xs transition-colors ${c?"text-blue-600 hover:text-blue-800":"text-gray-400 cursor-not-allowed"}`,children:"Show All"})})()]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"range",min:yt,max:Sn||1,step:zs,value:v,onChange:l=>{const c=parseInt(l.target.value),j=Math.min(c,b);_(j),V({minThreshold:j})},className:"w-full"}),r.jsx("input",{type:"number",min:yt,max:Sn||1,value:v,onChange:l=>{const c=Number.parseInt(l.target.value);if(Number.isNaN(c))return;const j=Math.max(yt,Math.min(c,b));_(j),V({minThreshold:j})},className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded-md"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[r.jsxs("span",{children:["Max: ",b.toLocaleString()]}),Gr!==void 0&&Gr<b&&r.jsxs("span",{className:"text-xs text-gray-400",children:["(actual ",Gr.toLocaleString(),")"]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"range",min:yt,max:Sn||1,step:zs,value:b,onChange:l=>{const c=parseInt(l.target.value),j=Math.max(c,v);$(j),V({maxThreshold:j})},className:"w-full"}),r.jsx("input",{type:"number",min:yt,max:Sn||1,value:b,onChange:l=>{const c=Number.parseInt(l.target.value);if(Number.isNaN(c))return;const j=Math.min(Sn||1,Math.max(c,v));$(j),V({maxThreshold:j})},className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded-md"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-sm font-medium",children:["Max Edges: ",R]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"range",min:10,max:zr,step:10,value:R,onChange:l=>{const c=parseInt(l.target.value);I(c),V({maxEdges:c})},className:"w-full"}),r.jsx("input",{type:"number",min:1,max:zr,value:R,onChange:l=>{const c=Number.parseInt(l.target.value);if(Number.isNaN(c))return;const j=Math.max(1,Math.min(c,zr));I(j),V({maxEdges:j})},className:"w-24 px-2 py-1 text-sm border border-gray-300 rounded-md"})]}),r.jsxs("p",{className:"text-xs text-gray-600 italic",children:["After filtering by thresholds and edge type, edges are sorted by value (highest first) and the top ",R," edges are displayed."]})]})]})]})}),A==="kriskogram"&&r.jsx(an,{title:"Kriskogram Settings",defaultOpen:!0,onReset:()=>{me(!1),re(1),$s("alphabetical"),Es(.85),Ar("weight"),ot(1),Ps(2),Vs("single"),Vr(null),Os("fixed"),Or(null),Ds("linear"),Ts(1),Is(!1),Jt("direction"),rr(null),As(!0),kr("weight"),sr(null),Pr(.6),Tr("pan"),ko(80),Po({x:0,y:0}),be(null),fe(1),F(!1),Ce("linear"),Le(!1),Be("filled"),Qe("filled"),ze(1),Cs(1),Qn("#fc8d59"),Jn("#ffffbf"),er("#91bfdb"),Ns(!0),fn(8),Xn(4),D(15),Se(1),ve(!1),_t("round"),Zn(!1),Mt(3),V({showAllNodes:!1,labelScale:1,nodeOrderMode:"alphabetical",arcOpacity:.85,edgeWidthMode:"weight",edgeWidthMultiplier:1,baseEdgeWidth:2,nodeColorMode:"single",nodeColorAttribute:null,nodeSizeMode:"fixed",nodeSizeAttribute:null,nodeSizeWeightScale:"linear",nodeSizeMultiplier:1,edgeColorAdvanced:!1,edgeColorHue:"direction",edgeColorHueAttribute:null,edgeColorInterGrayscale:!0,edgeColorIntensity:"weight",edgeColorIntensityAttribute:null,edgeColorIntensityConst:.6,interactionMode:"pan",lensRadius:80,egoNodeId:null,egoNeighborSteps:1,egoStepColoring:!1,temporalOverlay:!1,temporalOverlayYearsPast:1,temporalOverlayYearsFuture:1,temporalOverlayColorPast:"#fc8d59",temporalOverlayColorMid:"#ffffbf",temporalOverlayColorFuture:"#91bfdb",temporalOverlayCurrentBlack:!0,edgeSegmentLength:8,edgeSegmentGap:4,edgeSegmentOffset:15,edgeSegmentSpeed:1,edgeSegmentScaleByWeight:!1,edgeSegmentCap:"round",edgeSegmentAnimate:!1,edgeWeightScale:"linear",edgeOutlineGap:3})},children:i!=null&&i.metadata?r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-label-scale",className:"text-sm font-medium text-gray-700",children:"Label size"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Scale node label text and badge."})]}),r.jsxs("div",{className:"flex flex-col items-end gap-1",children:[r.jsx("input",{id:"kriskogram-label-scale",type:"range",min:.5,max:3,step:.1,value:z,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.5,Math.min(3,c));re(j),V({labelScale:Number(j.toFixed(2))})},className:"w-36 accent-blue-600"}),r.jsx("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:r.jsxs("span",{children:[z.toFixed(2),"×"]})})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-show-all-nodes",className:"text-sm font-medium text-gray-700",children:"Always show all nodes"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Keeps every location visible even if its edges fall outside the filters."})]}),r.jsx("input",{id:"kriskogram-show-all-nodes",type:"checkbox",className:"w-4 h-4",checked:Q,onChange:l=>{const c=l.target.checked;me(c),V({showAllNodes:c})}})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Ego Focus"}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-ego-node",className:"text-xs font-medium text-gray-700",children:"Ego focus (optional)"}),r.jsxs("select",{id:"kriskogram-ego-node",value:J??"",onChange:l=>{const c=l.target.value,j=c===""?null:c;j===null?(be(null),ge&&F(!1),V({egoNodeId:null,egoStepColoring:!1})):(be(j),V({egoNodeId:j}))},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"No ego focus (show all eligible edges)"}),((we==null?void 0:we.nodes)??[]).map(l=>r.jsx("option",{value:l.id,children:l.label||l.id},l.id))]}),r.jsx("p",{className:"mt-1 text-[11px] text-gray-500",children:"Limit the visualization to flows centered on a selected node."})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-ego-steps",className:"text-xs font-medium text-gray-700",children:"Neighbor steps"}),r.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[r.jsx("input",{id:"kriskogram-ego-steps",type:"number",min:1,max:10,value:_e,disabled:!J,onChange:l=>{const c=Number.parseInt(l.target.value,10);if(Number.isNaN(c))return;const j=Math.max(1,Math.min(c,10));fe(j),V({egoNeighborSteps:j})},className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded-md disabled:bg-gray-100 disabled:text-gray-500"}),r.jsx("span",{className:"text-[11px] text-gray-500",children:"How many hops from the ego node to include (based on currently visible edges)."})]})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"kriskogram-ego-step-coloring",className:"text-xs font-medium text-gray-700",children:"Color edges by neighbor step"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Apply a step-based gradient for ego flows and show it in the legend."})]}),r.jsx("input",{id:"kriskogram-ego-step-coloring",type:"checkbox",className:"w-4 h-4",disabled:!J,checked:ge&&!!J,onChange:l=>{const c=l.target.checked&&!!J;F(c),V({egoStepColoring:c})}})]}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Edge and node styling options are available in the sections below."})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Temporal Overlay"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-temporal-overlay",children:"Show neighboring years"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Overlay edges from nearby years to compare past and future flows."})]}),r.jsx("input",{id:"kriskogram-temporal-overlay",type:"checkbox",className:"w-4 h-4",disabled:!i||i.timeRange.start===i.timeRange.end||typeof m!="number",checked:L&&(i==null?void 0:i.timeRange.start)!==(i==null?void 0:i.timeRange.end),onChange:l=>{const c=l.target.checked;Le(c),V({temporalOverlay:c})}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-temporal-overlay-years",children:"Neighbor years"}),r.jsxs("div",{className:"mt-1 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-[11px] text-gray-600 whitespace-nowrap",children:"Years before"}),r.jsx("input",{type:"number",min:0,max:10,value:Me,disabled:!L,onChange:l=>{const c=Number.parseInt(l.target.value,10);if(Number.isNaN(c))return;const j=Math.max(0,Math.min(c,10));ze(j),V({temporalOverlayYearsPast:j})},className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded-md disabled:bg-gray-100 disabled:text-gray-500"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-[11px] text-gray-600 whitespace-nowrap",children:"Years after"}),r.jsx("input",{type:"number",min:0,max:10,value:At,disabled:!L,onChange:l=>{const c=Number.parseInt(l.target.value,10);if(Number.isNaN(c))return;const j=Math.max(0,Math.min(c,10));Cs(j),V({temporalOverlayYearsFuture:j})},className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded-md disabled:bg-gray-100 disabled:text-gray-500"})]})]}),r.jsx("p",{className:"mt-1 text-[11px] text-gray-500",children:"Control how many past and future snapshots appear alongside the current year."}),(!i||i.timeRange.start===i.timeRange.end)&&r.jsx("p",{className:"mt-2 text-[11px] text-gray-400 italic",children:"Temporal overlay is unavailable because this dataset has a single year."})]})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Node"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Node Ordering"}),r.jsxs("select",{value:nr,onChange:l=>{const c=l.target.value;$s(c),V({nodeOrderMode:c})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"alphabetical",children:"Alphabetical"}),i.metadata.hasCategoricalProperties.nodes.map(l=>r.jsxs("option",{value:l,children:["By ",l]},l)),i.metadata.hasNumericProperties.nodes.map(l=>r.jsxs("option",{value:l,children:["By ",l]},l))]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Node Color"}),r.jsxs("select",{value:ir,onChange:l=>{const c=l.target.value;Vs(c);const j={nodeColorMode:c};c!=="attribute"&&(Vr(null),j.nodeColorAttribute=null),V(j)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"single",children:"Single Color"}),ll.map(l=>r.jsx("option",{value:l,children:Kr(l)},l)),r.jsx("option",{value:"attribute",children:"By Attribute"})]}),ir==="attribute"&&r.jsxs("select",{value:nn||"",onChange:l=>{const c=l.target.value||null;Vr(c),V({nodeColorAttribute:c})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select..."}),i.metadata.hasCategoricalProperties.nodes.map(l=>r.jsx("option",{value:l,children:l},l)),i.metadata.hasNumericProperties.nodes.map(l=>r.jsx("option",{value:l,children:l},l))]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Node Size"}),r.jsxs("select",{value:xt,onChange:l=>{const c=l.target.value;Os(c);const j={nodeSizeMode:c};c!=="attribute"&&(Or(null),j.nodeSizeAttribute=null),V(j)},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"fixed",children:"Fixed"}),ul.map(l=>r.jsx("option",{value:l,children:Kr(l)},l)),r.jsx("option",{value:"attribute",children:"By Attribute"})]}),xt==="attribute"&&r.jsxs("select",{value:gt||"",onChange:l=>{const c=l.target.value||null;Or(c),V({nodeSizeAttribute:c})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select..."}),i.metadata.hasNumericProperties.nodes.map(l=>r.jsx("option",{value:l,children:l},l))]}),r.jsxs("div",{className:"mt-2 border border-gray-200 rounded-md p-2 bg-gray-50",children:[r.jsx("div",{className:"text-[11px] font-semibold text-gray-600 uppercase tracking-wide",children:"Weight"}),r.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Scaling"}),r.jsxs("select",{value:lr,onChange:l=>{const c=l.target.value;Ds(c),V({nodeSizeWeightScale:c})},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"linear",children:"Linear"}),r.jsx("option",{value:"sqrt",children:"Square root"}),r.jsx("option",{value:"log",children:"Logarithmic"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Multiplier"}),r.jsx("input",{type:"number",min:.1,max:10,step:.1,value:bn,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.1,Math.min(10,c));Ts(j),V({nodeSizeMultiplier:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),r.jsx("p",{className:"mt-2 text-[10px] text-gray-500",children:"Apply curve scaling and an overall multiplier to flow-based node sizes."})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-node-styling",children:"Node styling"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Control how nodes are rendered. Outline mode hides the fill and emphasizes the stroke."}),r.jsxs("select",{id:"kriskogram-node-styling",value:ke,onChange:l=>{const c=l.target.value;Qe(c),V({temporalOverlayNodeStyle:c})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"filled",children:"Filled nodes"}),r.jsx("option",{value:"outline",children:"Outline only"})]})]})]}),r.jsxs("div",{className:"space-y-3 border border-gray-200 rounded-md p-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Edge"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Arc Opacity: ",Math.round(Ir*100),"%"]}),r.jsx("input",{type:"range",min:0,max:1,step:.05,value:Ir,onChange:l=>{const c=Number.parseFloat(l.target.value);Number.isNaN(c)||(Es(c),V({arcOpacity:c}))},className:"w-full"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Edge Width"}),r.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeWidthMode",value:"weight",checked:xn==="weight",onChange:()=>{Ar("weight"),V({edgeWidthMode:"weight"})},className:"w-3.5 h-3.5"}),r.jsx("span",{children:"By Weight"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeWidthMode",value:"fixed",checked:xn==="fixed",onChange:()=>{Ar("fixed"),V({edgeWidthMode:"fixed"})},className:"w-3.5 h-3.5"}),r.jsx("span",{children:"Fixed"})]})]}),xn==="fixed"&&r.jsxs("div",{className:"mt-2",children:[r.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Base Edge Width: ",tn.toFixed(1),"px"]}),r.jsx("input",{type:"range",min:.5,max:8,step:.1,value:tn,onChange:l=>{const c=Number.parseFloat(l.target.value);Number.isNaN(c)||(Ps(c),V({baseEdgeWidth:c}))},className:"w-full"})]}),r.jsxs("div",{className:"mt-2 border border-gray-200 rounded-md p-2 bg-gray-50",children:[r.jsx("div",{className:"text-[11px] font-semibold text-gray-600 uppercase tracking-wide",children:"Weight"}),r.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Scaling"}),r.jsxs("select",{value:B,onChange:l=>{const c=l.target.value;Ce(c),V({edgeWeightScale:c})},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"linear",children:"Linear (use raw weight differences)"}),r.jsx("option",{value:"sqrt",children:"Square root (compress extremes)"}),r.jsx("option",{value:"log",children:"Logarithmic (highlight small flows)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Multiplier"}),r.jsx("input",{type:"number",min:.1,max:10,step:.1,value:Te,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.1,Math.min(10,c));ot(j),V({edgeWidthMultiplier:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),r.jsx("p",{className:"mt-2 text-[10px] text-gray-500",children:"Scaling also shapes weight-based color intensity; the multiplier only stretches rendered edge widths."})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",htmlFor:"kriskogram-edge-style",children:"Line styling"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Choose how edges are drawn. Segmented uses dashed arcs; outline shows a thin perimeter."}),r.jsxs("select",{id:"kriskogram-edge-style",value:G,onChange:l=>{const c=l.target.value;Be(c),V({temporalOverlayEdgeStyle:c})},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"filled",children:"Filled (solid weight)"}),r.jsx("option",{value:"segmented",children:"Segmented (dashed)"}),r.jsx("option",{value:"outline",children:"Outline only"})]}),G==="segmented"&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-xs mt-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Dash length (px)"}),r.jsx("input",{type:"number",min:1,step:.5,value:Pe,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(1,c);fn(j),V({edgeSegmentLength:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Gap length (px)"}),r.jsx("input",{type:"number",min:.5,step:.5,value:Je,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.5,c);Xn(j),V({edgeSegmentGap:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Initial gap (px)"}),r.jsx("input",{type:"number",min:0,step:.5,value:E,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(0,c);D(j),V({edgeSegmentOffset:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),G==="segmented"&&r.jsxs("div",{className:"mt-2 space-y-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-[11px] font-medium text-gray-600",htmlFor:"kriskogram-edge-cap",children:"Segment cap style"}),r.jsxs("select",{id:"kriskogram-edge-cap",value:pe,onChange:l=>{const c=l.target.value;_t(c),V({edgeSegmentCap:c})},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"round",children:"Rounded segment ends"}),r.jsx("option",{value:"butt",children:"Sharp segment ends"})]})]}),r.jsxs("label",{className:"flex items-center justify-between text-[11px] font-medium text-gray-600",children:[r.jsx("span",{children:"Animate flow"}),r.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5",checked:ct,onChange:l=>{const c=l.target.checked;Zn(c),V({edgeSegmentAnimate:c})}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Animation speed multiplier"}),r.jsx("input",{type:"number",min:.1,step:.1,value:se,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.1,c);Se(j),V({edgeSegmentSpeed:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),r.jsx("p",{className:"mt-1 text-[10px] text-gray-500",children:"Higher values move dashes faster. 1.0 matches the legacy speed."})]}),r.jsxs("label",{className:"flex items-center justify-between text-[11px] font-medium text-gray-600",children:[r.jsx("span",{children:"Multiply speed by flow weight"}),r.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5",checked:ce,onChange:l=>{const c=l.target.checked;ve(c),V({edgeSegmentScaleByWeight:c})}})]})]}),r.jsxs("div",{className:"mt-3 space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Temporal overlay colors"}),r.jsx("p",{className:"mt-1 text-[10px] text-gray-500",children:"Choose the palette for past, midpoint, and future overlay arcs. Switch the input format in Interface Settings."})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-xs",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"block text-[11px] font-medium text-gray-600",children:"Past"}),dr==="picker"?r.jsx("input",{type:"color",value:et,disabled:!L,onChange:l=>cr(l.target.value,"#fc8d59",Qn,En,"temporalOverlayColorPast"),className:`h-8 w-full cursor-pointer ${L?"":"opacity-60 cursor-not-allowed"}`}):r.jsx("input",{type:"text",value:js,disabled:!L,onChange:l=>En(l.target.value),onBlur:l=>wn(l.target.value,et,Qn,En,"temporalOverlayColorPast"),onKeyDown:l=>{l.key==="Enter"&&wn(js,et,Qn,En,"temporalOverlayColorPast")},placeholder:"#fc8d59",className:"w-full rounded border border-gray-300 px-2 py-1 text-xs font-mono disabled:bg-gray-100 disabled:text-gray-500"})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"block text-[11px] font-medium text-gray-600",children:"Midpoint"}),dr==="picker"?r.jsx("input",{type:"color",value:tt,disabled:!L,onChange:l=>cr(l.target.value,"#ffffbf",Jn,In,"temporalOverlayColorMid"),className:`h-8 w-full cursor-pointer ${L?"":"opacity-60 cursor-not-allowed"}`}):r.jsx("input",{type:"text",value:Ms,disabled:!L,onChange:l=>In(l.target.value),onBlur:l=>wn(l.target.value,tt,Jn,In,"temporalOverlayColorMid"),onKeyDown:l=>{l.key==="Enter"&&wn(Ms,tt,Jn,In,"temporalOverlayColorMid")},placeholder:"#ffffbf",className:"w-full rounded border border-gray-300 px-2 py-1 text-xs font-mono disabled:bg-gray-100 disabled:text-gray-500"})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("span",{className:"block text-[11px] font-medium text-gray-600",children:"Future"}),dr==="picker"?r.jsx("input",{type:"color",value:nt,disabled:!L,onChange:l=>cr(l.target.value,"#91bfdb",er,An,"temporalOverlayColorFuture"),className:`h-8 w-full cursor-pointer ${L?"":"opacity-60 cursor-not-allowed"}`}):r.jsx("input",{type:"text",value:Fs,disabled:!L,onChange:l=>An(l.target.value),onBlur:l=>wn(l.target.value,nt,er,An,"temporalOverlayColorFuture"),onKeyDown:l=>{l.key==="Enter"&&wn(Fs,nt,er,An,"temporalOverlayColorFuture")},placeholder:"#91bfdb",className:"w-full rounded border border-gray-300 px-2 py-1 text-xs font-mono disabled:bg-gray-100 disabled:text-gray-500"})]})]}),r.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 border border-gray-200 rounded",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Current year color"}),r.jsx("p",{className:"text-[11px] text-gray-500",children:"Use the default black or reuse the midpoint color for the current year arcs."})]}),r.jsxs("select",{value:Zt?"default":"midpoint",onChange:l=>{const c=l.target.value!=="midpoint";Ns(c),V({temporalOverlayCurrentBlack:c})},disabled:!L,className:"px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500",children:[r.jsx("option",{value:"default",children:"Default (black)"}),r.jsx("option",{value:"midpoint",children:"Use midpoint color"})]})]})]}),G==="outline"&&r.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3 text-xs",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Outline thickness (px)"}),r.jsx("input",{type:"range",min:.5,max:12,step:.5,value:qe,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.5,c);Mt(j),V({edgeOutlineGap:j})},className:"mt-1 w-full"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-[11px] font-medium text-gray-600",children:"Precise value"}),r.jsx("input",{type:"number",min:.5,step:.5,value:qe,onChange:l=>{const c=Number.parseFloat(l.target.value);if(Number.isNaN(c))return;const j=Math.max(.5,c);Mt(j),V({edgeOutlineGap:j})},className:"mt-1 w-full px-2 py-1 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Edge Color"}),J&&ge&&r.jsx("span",{className:"text-[11px] text-gray-400",children:"(disabled by neighbor step coloring)"})]}),r.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-gray-600 cursor-pointer",children:[r.jsx("input",{type:"checkbox",className:"w-3.5 h-3.5",disabled:!!(J&&ge),checked:yn,onChange:l=>{const c=l.target.checked;J&&ge||(Is(c),V({edgeColorAdvanced:c}),c||(Jt("direction"),rr(null),As(!0),kr("weight"),sr(null),Pr(.6),V({edgeColorHue:"direction",edgeColorHueAttribute:null,edgeColorInterGrayscale:!0,edgeColorIntensity:"weight",edgeColorIntensityAttribute:null,edgeColorIntensityConst:.6})))}}),"Advanced"]})]}),!yn&&!(J&&ge)&&r.jsxs("div",{className:"flex flex-col gap-1.5 text-xs",children:[r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeColorHueSimple",value:"direction",checked:Ve==="direction",onChange:()=>{Jt("direction"),V({edgeColorHue:"direction"})},className:"w-3.5 h-3.5"}),r.jsx("span",{children:"By Direction (Above/Below)"})]}),r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"edgeColorHueSimple",value:"single",checked:Ve==="single",onChange:()=>{Jt("single"),V({edgeColorHue:"single"})},className:"w-3.5 h-3.5"}),r.jsx("span",{children:"Single Color"})]})]}),yn&&!(J&&ge)&&r.jsxs("div",{className:"mt-2 space-y-3 border border-gray-200 rounded-md p-3 bg-gray-50/60",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Hue Source"}),r.jsxs("select",{value:Ve,onChange:l=>{const c=l.target.value;Jt(c),V({edgeColorHue:c}),c!=="attribute"&&(rr(null),V({edgeColorHueAttribute:null}))},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"direction",children:"Direction (Above/Below)"}),r.jsx("option",{value:"single",children:"Single"}),r.jsx("option",{value:"region",disabled:!kt,children:"Region"}),r.jsx("option",{value:"division",disabled:!Pt,children:"Division"}),r.jsx("option",{value:"attribute",children:"Attribute"})]}),Ve==="attribute"&&(i==null?void 0:i.metadata)&&r.jsxs("div",{className:"mt-2",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Hue Attribute"}),r.jsxs("select",{className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:en||"",onChange:l=>{const c=l.target.value||null;rr(c),V({edgeColorHueAttribute:c})},children:[r.jsx("option",{value:"",children:"Select attribute…"}),i.metadata.hasCategoricalProperties.edges.concat(i.metadata.hasNumericProperties.edges).map(l=>r.jsx("option",{value:l,children:l},l))]})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Intensity Source"}),r.jsxs("select",{value:Ft,onChange:l=>{const c=l.target.value;kr(c),V({edgeColorIntensity:c}),c!=="attribute"&&(sr(null),V({edgeColorIntensityAttribute:null}))},className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"weight",children:"Weight"}),r.jsx("option",{value:"constant",children:"Constant"}),r.jsx("option",{value:"attribute",children:"Attribute"})]}),Ft==="constant"&&r.jsxs("div",{className:"mt-2",children:[r.jsxs("label",{className:"text-xs text-gray-600",children:["Constant Intensity: ",(or*100).toFixed(0),"%"]}),r.jsx("input",{type:"range",min:0,max:1,step:.01,value:or,onChange:l=>{const c=Number.parseFloat(l.target.value);Number.isNaN(c)||(Pr(c),V({edgeColorIntensityConst:c}))},className:"w-full"})]}),Ft==="attribute"&&(i==null?void 0:i.metadata)&&r.jsxs("div",{className:"mt-2",children:[r.jsx("label",{className:"text-xs text-gray-600",children:"Intensity Attribute"}),r.jsxs("select",{className:"w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:vn||"",onChange:l=>{const c=l.target.value||null;sr(c),V({edgeColorIntensityAttribute:c})},children:[r.jsx("option",{value:"",children:"Select attribute…"}),i.metadata.hasNumericProperties.edges.map(l=>r.jsx("option",{value:l,children:l},l))]})]})]})]})]})]})]}):r.jsx("div",{className:"text-xs text-gray-500 italic",children:"No dataset metadata available"})}),A==="table"&&r.jsx(an,{title:"Table Settings",defaultOpen:!1,children:r.jsx("div",{className:"text-xs text-gray-500 italic",children:"Settings to be added"})}),A==="sankey"&&r.jsx(an,{title:"Sankey Settings",defaultOpen:!1,children:r.jsx("div",{className:"text-xs text-gray-500 italic",children:"Settings to be added"})}),A==="chord"&&r.jsx(an,{title:"Chord Settings",defaultOpen:!1,children:r.jsx("div",{className:"text-xs text-gray-500 italic",children:"Settings to be added"})}),r.jsx(an,{title:"Interface Settings",defaultOpen:!1,onReset:()=>{Hs("picker")},children:r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700",children:"Color input format"}),r.jsxs("select",{value:dr,onChange:l=>{const c=l.target.value==="hex"?"hex":"picker";Hs(c)},className:"mt-1 w-full px-2 py-1.5 text-xs border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"picker",children:"Color picker"}),r.jsx("option",{value:"hex",children:"Hex input"})]}),r.jsx("p",{className:"mt-1 text-[10px] text-gray-500",children:"Choose whether temporal overlay colors are edited with the native color picker or by typing hex codes."})]})})})]})})]})})}async function gl(){const e="csv-usa-pre-2020",n="csv-usa-post-2020",t="csv-2021",s="gexf-sample",o="swiss-2016";let a=await Kt(e),u=await Kt(n);const i=S=>S?S.snapshots.every(v=>{const _=new Set(v.nodes.map(b=>b.label));if(_.size!==il)return!1;for(const b of _)if(!al.has(b))return!1;return!0}):!1;(a?!i(a):!1)&&(await gs(e).catch(()=>{}),a=void 0),(u?!i(u):!1)&&(await gs(n).catch(()=>{}),u=void 0);let g=!!a,y=!!u;const x=await Kt(t),f=await Kt(s),w=await Kt(o),C=async S=>{const v=[];for(const _ of S)try{const b=new URL(Object.assign({"../data/StateToStateMigrationUSCSV/state_to_state_migration_table_2022_t13_updated_2024_06_27_2022.csv":$a,"../data/StateToStateMigrationUSCSV/state_to_state_migration_table_2023_t13_2023.csv":Ea,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2005_2005.csv":Ia,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2005_2007_2005-2007.csv":Aa,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2005_2009_2005-2009.csv":ka,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2006_2006.csv":Pa,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2006_2008_2006-2008.csv":Va,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2007_2007.csv":Oa,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2007_2009_2007-2009.csv":Da,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2008_2008.csv":Ta,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2009_2009.csv":La,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2010_2010.csv":za,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2011_2011.csv":Ha,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2012_2012.csv":Ga,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2013_2013.csv":Ba,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2014_2014.csv":Wa,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2015_2015.csv":Ua,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2016_2016.csv":qa,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2017_2017.csv":Ka,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2018_2018.csv":Ya,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2019_2019.csv":Xa,"../data/StateToStateMigrationUSCSV/state_to_state_migrations_table_2021_2021.csv":Za})[`../data/StateToStateMigrationUSCSV/${_.filename}`],import.meta.url),$=await Sr(b.toString()),R=us($);v.push({timestamp:_.year,nodes:R.nodes,edges:R.edges})}catch(b){console.warn(`⚠️ Failed to load snapshot for ${_.filename}:`,b)}return v.sort((_,b)=>{const $=typeof _.timestamp=="string"?Number.parseInt(_.timestamp,10):_.timestamp,R=typeof b.timestamp=="string"?Number.parseInt(b.timestamp,10):b.timestamp;return $-R}),v};if(!a){const S=Ws.filter(_=>_.year<=2019),v=await C(S);if(v.length>0){const _=v[0],b=v[v.length-1],$=dn(_),R={id:e,name:"US State-to-State Migration (2005-2019)",notes:"Tidy ACS 1-year state-to-state migration flows from 2005 through 2019. The Census Bureau did not release 2020 1-year migration flows, so the series stops before the pandemic.",type:"csv",timeRange:{start:typeof _.timestamp=="string"?Number.parseInt(_.timestamp,10):_.timestamp,end:typeof b.timestamp=="string"?Number.parseInt(b.timestamp,10):b.timestamp},snapshots:v,metadata:$,createdAt:Date.now()};await qt(R),g=!0}}if(!u){const S=Ws.filter(_=>_.year>=2021),v=await C(S);if(v.length>0){const _=v[0],b=v[v.length-1],$=dn(_),R={id:n,name:"US State-to-State Migration (2021-2023)",notes:"Post-2020 ACS 1-year state-to-state migration flows. The 2022 release includes revised Connecticut flows per Census errata guidance.",type:"csv",timeRange:{start:typeof _.timestamp=="string"?Number.parseInt(_.timestamp,10):_.timestamp,end:typeof b.timestamp=="string"?Number.parseInt(b.timestamp,10):b.timestamp},snapshots:v,metadata:$,createdAt:Date.now()};await qt(R),y=!0}}if(!x){const S=new URL("/INF358_Project_Kriskogram/assets/State_to_State_Migrations_Table_2021-N7RTh5uH.csv",import.meta.url),v=await Sr(S.toString()),_=us(v),b={timestamp:2021,nodes:_.nodes,edges:_.edges},$=dn(b),R={id:t,name:"US State-to-State Migration (2021)",notes:"Real U.S. Census Bureau data showing migration flows between all 50 states from the American Community Survey 1-Year Estimates.",type:"csv",timeRange:{start:2021,end:2021},snapshots:[b],metadata:$,createdAt:Date.now()};await qt(R)}if(!f){const S=new URL("/INF358_Project_Kriskogram/assets/sample-migration-data-Dify6Mt1.gexf",import.meta.url),v=await Zo(S.toString()),_=po(v),b=_.length>0?dn(_[0]):void 0,$={id:s,name:"Sample Migration (GEXF)",notes:"AI-generated sample network dataset in GEXF format demonstrating temporal migration patterns with multiple time slices. This example dataset includes economic, geographic, and migration type attributes for demonstration purposes.",type:"gexf",timeRange:v.timeRange,snapshots:_,metadata:b,createdAt:Date.now()};await qt($)}if(!w){const S="/INF358_Project_Kriskogram/",v=`${S}data/Swiss_Relocations_2016_locations.csv`,_=`${S}data/Swiss_Relocations_2016_flows.csv`,b=await Sr(v),$=await Sr(_),R=vo({nodesFile:{content:b,idField:"id",labelField:"name"},edgesFile:{content:$,sourceField:"origin",targetField:"dest",valueField:"count"}}),I={timestamp:2016,nodes:R.nodes,edges:R.edges},X=dn(I),K={id:o,name:"Swiss Relocations (2016)",notes:"Relocations between Swiss cantons in 2016. This dataset contains 521,510 trips and uses a two-file CSV format with separate files for locations (cantons) and flows (relocations). Created by Ilya Boyandin.",type:"csv-two-file",timeRange:{start:2016,end:2016},snapshots:[I],metadata:X,createdAt:Date.now()};await qt(K)}if(g)return e;if(y)return n;if(x)return t}function Mr(e,n){if(typeof e=="string"){const t=e.trim().toLowerCase();if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(t))return t.length===4?`#${t[1]}${t[1]}${t[2]}${t[2]}${t[3]}${t[3]}`:t}return n}export{vl as component};
